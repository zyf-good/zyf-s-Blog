<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Android Kotlin åç¨‹ï¼ˆcoroutineï¼‰å…¥é—¨ç¯‡</title>
    <url>/2022/03/24/Android-Kotlin-%E5%8D%8F%E7%A8%8B%EF%BC%88coroutine-%EF%BC%89%E5%85%A5%E9%97%A8%E7%AF%87/Android-Kotlin-%E5%8D%8F%E7%A8%8B%EF%BC%88coroutine-%EF%BC%89%E5%85%A5%E9%97%A8%E7%AF%87/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>psï¼šæ–‡ç« ä¼šå¾ˆé•¿</code></p>
<p>ååŒç¨‹åºï¼ˆcoroutineï»¿ï¼‰å®åœ¨æ˜¯å¤ªå¥½ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥å­¦ä¹ å§ï¼æœ¬ç¯‡æ–‡ç« ä¼šé€šè¿‡è§£è¯»kotlinå®˜æ–¹æ–‡æ¡£å’Œandroid  developmentæ–‡æ¡£æ¥ä¸€æ­¥ä¸€æ­¥è®¤è¯†Kotlin åç¨‹ï¼Œæ²¡æœ‰Kotlin åŸºç¡€çš„å°ä¼™ä¼´å»ºè®®å…ˆå­¦ä¹ ä¸‹ Kotlin å“¦ã€‚</p>
<hr>
<h1 id="ä¸€ã€åç¨‹åŸºç¡€"><a href="#ä¸€ã€åç¨‹åŸºç¡€" class="headerlink" title="ä¸€ã€åç¨‹åŸºç¡€"></a>ä¸€ã€åç¨‹åŸºç¡€</h1><p>æœ¬èŠ‚ä»‹ç»åç¨‹åŸºæœ¬çš„æ¦‚å¿µã€‚ä¸‹é¢è¿™äº›éƒ½æ˜¯kotlinå®˜æ–¹çš„ä¾‹å­ï¼Œéå¸¸ç»å…¸ã€‚</p>
<blockquote>
<p>ä¾èµ–å’Œæƒé™</p>
</blockquote>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¾èµ–</span></span><br><span class="line"> implementation(<span class="string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.9&quot;</span>)</span><br><span class="line">      <span class="comment">//retrofit</span></span><br><span class="line">    api <span class="string">&#x27;com.squareup.retrofit2:retrofit:2.6.0&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;com.squareup.retrofit2:converter-gson:2.6.0&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;com.squareup.retrofit2:adapter-rxjava2:2.6.0&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;com.trello.rxlifecycle2:rxlifecycle-components:2.6.1&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;com.facebook.stetho:stetho:1.5.0&#x27;</span></span><br><span class="line">    api <span class="string">&#x27;com.facebook.stetho:stetho-okhttp3:1.5.0&#x27;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//æƒé™</span></span><br><span class="line"> &lt;!-- è®¿é—®ç½‘ç»œçš„æƒé™ --&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>&gt;&lt;/uses-permission&gt;</span><br></pre></td></tr></table></figure></div>



<h2 id="ç¬¬ä¸€ä¸ªåç¨‹"><a href="#ç¬¬ä¸€ä¸ªåç¨‹" class="headerlink" title="ç¬¬ä¸€ä¸ªåç¨‹"></a>ç¬¬ä¸€ä¸ªåç¨‹</h2><p>åç¨‹æ˜¯å¯æš‚åœè®¡ç®—çš„ä¸€ä¸ªå®ä¾‹ã€‚å®ƒåœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºçº¿ç¨‹ï¼Œå®ƒéœ€è¦ä¸€ä¸ªä»£ç å—æ¥è¿è¡Œï¼Œè¯¥ä»£ç å—ä¸å…¶ä½™ä»£ç åŒæ—¶å·¥ä½œã€‚ç„¶è€Œï¼Œåç¨‹å¹¶ä¸ç»‘å®šåˆ°ä»»ä½•ç‰¹å®šçš„çº¿ç¨‹ã€‚å®ƒå¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æš‚åœæ‰§è¡Œï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ¢å¤ã€‚<br>ååŒç¨‹åºå¯ä»¥è¢«è®¤ä¸ºæ˜¯è½»é‡çº§çš„çº¿ç¨‹ï¼Œä½†æ˜¯æœ‰è®¸å¤šé‡è¦çš„åŒºåˆ«ï¼Œä½¿å¾—å®ƒä»¬åœ¨ç°å®ç”Ÿæ´»ä¸­çš„ä½¿ç”¨ä¸çº¿ç¨‹éå¸¸ä¸åŒã€‚<br>ä¸‹é¢è¿™ä¸ªä»£ç ç¤ºä¾‹å°†æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªåç¨‹</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123; <span class="comment">// this: CoroutineScope  </span></span><br><span class="line">	<span class="comment">// launch a new coroutine and continue  å¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹å¹¶è¿æ¥</span></span><br><span class="line">    launch &#123; </span><br><span class="line">    <span class="comment">// non-blocking delay for 1 second (default time unit is ms)å»¶æ—¶ä¸€ç§’</span></span><br><span class="line">        delay(<span class="number">1000L</span>) </span><br><span class="line">        <span class="comment">// print after delay å»¶æ—¶åæ‰“å°</span></span><br><span class="line">        println(<span class="string">&quot;World!&quot;</span>) </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ä¸­çš„&quot;Hello&quot;ç»§ç»­æ‰§è¡Œï¼Œè€Œ&quot;World!&quot;å»¶æ—¶åæ‰“å°</span></span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¸å‡ºæ„æ–™ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</p>
<blockquote>
<p>Hello<br>World!</p>
</blockquote>
<p>ä»è¿™ä¸ªç»“æœæ¥çœ‹ï¼Œè¿™ç¡®å®å’Œçº¿ç¨‹å¾ˆåƒä¸æ˜¯å—ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸Šé¢çš„ä»£ç </p>
<p><em><strong>launch</strong></em><br>æ˜¯ä¸€ä¸ªåç¨‹æ„å»ºè€…ã€‚å®ƒä¸ä»£ç çš„å…¶ä½™éƒ¨åˆ†åŒæ—¶å¯åŠ¨ä¸€ä¸ªæ–°çš„åç¨‹ï¼Œè¯¥ç¨‹åºå°†ç»§ç»­ç‹¬ç«‹å·¥ä½œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆHelloé¦–å…ˆè¢«æ‰“å°å‡ºæ¥ã€‚<br><em><strong>delay</strong></em><br>æ˜¯ä¸€ç§ç‰¹æ®Šçš„æš‚åœåŠŸèƒ½ã€‚å®ƒä¼šåœ¨ç‰¹å®šæ—¶é—´æš‚åœåç¨‹ã€‚æŒ‚èµ·åç¨‹ï¼Œä½†ä¸ä¼šé˜»æ­¢åº•å±‚çº¿ç¨‹ï¼Œå…è®¸å…¶ä»–åç¨‹è¿è¡Œå¹¶å°†åº•å±‚çº¿ç¨‹ç”¨äºå…¶ä»£ç ã€‚å¯ä»¥ä¸çº¿ç¨‹ä¸­çš„sleep()ç›¸äº’å°è¯ä»¥ä¾¿è®°å¿†ï¼ˆå¹¶ä¸æ˜¯è¯´å¯ä»¥ç­‰ä»·å“¦ï¼‰<br><em><strong>runBlocking</strong></em><br>ä¹Ÿæ˜¯ä¸€ä¸ªåç¨‹æ„å»ºå™¨ï¼Œå®ƒå°†å¸¸è§„çš„fun mainï¼ˆï¼‰çš„éåç¨‹ä¸runBlocking{â€¦}å†…éƒ¨çš„ååŒç¨‹åºä»£ç è¿æ¥èµ·æ¥ã€‚åœ¨IDEä¸­ï¼Œåœ¨runBlockingå¼€å¤´çš„èŠ±æ‹¬å·åé¢æœ‰ä¸€ä¸ªæç¤ºï¼šCoroutineScopeã€‚</p>
<p><code>æ³¨æ„ï¼šå¦‚æœåœ¨è¿™æ®µä»£ç ä¸­åˆ é™¤æˆ–å¿˜è®°äº†runBlockingï¼Œå°†åœ¨å¯åŠ¨è°ƒç”¨ä¸­å¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œå› ä¸ºå¯åŠ¨åªåœ¨CoroutineScopeä¸­å£°æ˜ï¼š</code></p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">Unresolved reference: launch</span><br></pre></td></tr></table></figure></div>
<p>runBlockingçš„åç§°æ„å‘³ç€è¿è¡Œå®ƒçš„çº¿ç¨‹ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ä¸»çº¿ç¨‹ï¼‰åœ¨è°ƒç”¨æœŸé—´è¢«é˜»å¡ï¼Œç›´åˆ°runBlocking{â€¦}ä¸­çš„æ‰€æœ‰åç¨‹è¢«é˜»å¡å®Œæˆä»–ä»¬çš„ä»£ç é€»è¾‘ã€‚æ‚¨ç»å¸¸ä¼šçœ‹åˆ°åœ¨æœ€ä¸Šå±‚çš„åº”ç”¨ç¨‹åºåƒè¿™æ ·ä½¿ç”¨runBlockingï¼Œè€Œåœ¨çœŸæ­£çš„ä»£ç ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºçº¿ç¨‹æ˜¯æ˜‚è´µçš„èµ„æºï¼Œé˜»å¡å®ƒä»¬æ˜¯ä½æ•ˆçš„ï¼Œè€Œä¸”é€šå¸¸æ˜¯ä¸éœ€è¦çš„ã€‚</p>
<h3 id="ç»“æ„åŒ–å¹¶å‘"><a href="#ç»“æ„åŒ–å¹¶å‘" class="headerlink" title="ç»“æ„åŒ–å¹¶å‘"></a>ç»“æ„åŒ–å¹¶å‘</h3><p>ååŒè·¯ç”±éµå¾ªç»“æ„åŒ–å¹¶å‘åŸåˆ™ï¼Œè¿™æ„å‘³ç€æ–°çš„ååŒè·¯ç”±åªèƒ½åœ¨é™å®šååŒè·¯ç”±ç”Ÿå­˜æœŸçš„ç‰¹å®šååŒè·¯ç”±ä½œç”¨åŸŸä¸­å¯åŠ¨ã€‚ä¸Šé¢çš„ä¾‹å­æ˜¾ç¤ºrunBlockingå»ºç«‹äº†ç›¸åº”çš„ä½œç”¨åŸŸï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‰é¢çš„ä¾‹å­è¦ç­‰åˆ°Worldï¼å»¶è¿Ÿä¸€ç§’é’Ÿåæ‰“å°ï¼Œç„¶åé€€å‡ºã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ç¨‹åºä¸­ï¼Œå°†å¯åŠ¨è®¸å¤šååŒç¨‹åºã€‚ç»“æ„åŒ–å¹¶å‘ç¡®ä¿å®ƒä»¬ä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šæ³„æ¼ã€‚å¤–éƒ¨ä½œç”¨åŸŸåœ¨å…¶æ‰€æœ‰å­ååŒç¨‹åºå®Œæˆä¹‹å‰æ— æ³•å®Œæˆã€‚ç»“æ„åŒ–å¹¶å‘è¿˜å¯ä»¥ç¡®ä¿æ­£ç¡®æŠ¥å‘Šä»£ç ä¸­çš„ä»»ä½•é”™è¯¯ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šä¸¢å¤±ã€‚</p>
<h2 id="æŒ‚èµ·å‡½æ•°-suspend"><a href="#æŒ‚èµ·å‡½æ•°-suspend" class="headerlink" title="æŒ‚èµ·å‡½æ•° suspend"></a>æŒ‚èµ·å‡½æ•° suspend</h2><p>ä¸Šè¯‰ä»…ä»…æ˜¯ä¸€ä¸ªæœ€åŸºç¡€çš„ååŒç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥æå–launch{â€¦}ä¸­çš„ä»£ç å—å˜æˆä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ã€‚å½“ä½ å¯¹è¿™æ®µä»£ç æ‰§è¡Œâ€œæå–å‡½æ•°â€é‡æ„æ—¶ï¼ˆå°±æ˜¯alt+enterå•¦ï¼‰ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªå¸¦æœ‰suspendä¿®é¥°ç¬¦çš„æ–°å‡½æ•°ï¼ˆæŒ‚èµ·å‡½æ•°ï¼‰ã€‚è¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªæš‚åœåŠŸèƒ½ã€‚æŒ‚èµ·å‡½æ•°å¯ä»¥åƒå¸¸è§„å‡½æ•°ä¸€æ ·åœ¨ååŒè·¯ç”±ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥ä½¿ç”¨å…¶ä»–æŒ‚èµ·å‡½æ•°ï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„å»¶è¿Ÿï¼‰æ¥æŒ‚èµ·ååŒè·¯ç”±çš„æ‰§è¡Œã€‚</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123; <span class="comment">// this: CoroutineScope</span></span><br><span class="line">    launch &#123; doWorld() &#125;</span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// this is your first suspending function</span></span><br><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªæŒ‚èµ·å‡½æ•°</span></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">doWorld</span><span class="params">()</span></span> &#123;</span><br><span class="line">    delay(<span class="number">1000L</span>)</span><br><span class="line">    println(<span class="string">&quot;World!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>åŒæ ·å¾—åˆ°å¦‚ä¸‹ç»“æœ</p>
<blockquote>
<p>Hello<br>World!</p>
</blockquote>
<h2 id="èŒƒå›´æ„é€ å™¨-Scope-builder"><a href="#èŒƒå›´æ„é€ å™¨-Scope-builder" class="headerlink" title="èŒƒå›´æ„é€ å™¨ Scope builder"></a>èŒƒå›´æ„é€ å™¨ Scope builder</h2><p>é™¤äº†ä¸åŒæ„å»ºå™¨æä¾›çš„ååŒç¨‹åºä½œç”¨åŸŸä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ååŒç¨‹åºä½œç”¨åŸŸæ„å»ºå™¨å£°æ˜è‡ªå·±çš„ä½œç”¨åŸŸã€‚å®ƒåˆ›å»ºäº†ä¸€ä¸ªåç¨‹ä½œç”¨åŸŸï¼Œç›´åˆ°æ‰€æœ‰å¯åŠ¨çš„å­é¡¹éƒ½å®Œæˆåæ‰ä¼šå®Œæˆã€‚</p>
<p>runBlockingå’ŒcoroutineScopeçš„æ„å»ºè€…å¯èƒ½çœ‹èµ·æ¥å¾ˆç›¸ä¼¼ï¼Œå› ä¸ºä»–ä»¬éƒ½åœ¨ç­‰å¾…è‡ªå·±çš„ä¸»ä½“å’Œæ‰€æœ‰å­é¡¹çš„å®Œæˆã€‚ä¸»è¦åŒºåˆ«åœ¨äºrunBlockingæ–¹æ³•é˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œè€ŒcoroutineScopeåªæ˜¯æš‚åœï¼Œé‡Šæ”¾åº•å±‚çº¿ç¨‹ä¾›å…¶ä»–ä½¿ç”¨ã€‚ç”±äºè¿™ç§å·®å¼‚ï¼ŒrunBlockingæ˜¯ä¸€ä¸ªå¸¸è§„å‡½æ•°ï¼Œè€ŒcoroutineScopeæ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»ä»»ä½•æŒ‚èµ·å‡½æ•°ä½¿ç”¨coroutineScopeã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†Helloå’ŒWorldçš„å¹¶å‘æ‰“å°ç§»åŠ¨åˆ°suspend fun doWorldï¼ˆï¼‰å‡½æ•°ä¸­ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    doWorld()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">doWorld</span><span class="params">()</span></span> = coroutineScope &#123;  <span class="comment">// this: CoroutineScope</span></span><br><span class="line">    launch &#123;</span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">&quot;World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>åŒæ ·çš„ç»“æœï¼š</p>
<blockquote>
<p>Hello<br>World!</p>
</blockquote>
<h2 id="èŒƒå›´æ„é€ å™¨-Scope-builder-å’Œ-å¹¶å‘-concurrency"><a href="#èŒƒå›´æ„é€ å™¨-Scope-builder-å’Œ-å¹¶å‘-concurrency" class="headerlink" title="èŒƒå›´æ„é€ å™¨ Scope builder å’Œ å¹¶å‘ concurrency"></a>èŒƒå›´æ„é€ å™¨ Scope builder å’Œ å¹¶å‘ concurrency</h2><p>èŒƒå›´æ„é€ å™¨ å¯ä»¥åœ¨ä»»ä½•æŒ‚èµ·å‡½æ•°ä¸­ä½¿ç”¨ï¼Œä»¥æ‰§è¡Œå¤šä¸ªå¹¶å‘æ“ä½œã€‚è®©æˆ‘ä»¬åœ¨doWorldæŒ‚èµ·å‡½æ•°ä¸­å¯åŠ¨ä¸¤ä¸ªå¹¶å‘ååŒè·¯ç”±ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sequentially executes doWorld followed by &quot;Done&quot;</span></span><br><span class="line"><span class="comment">//é¡ºåºæ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    doWorld()</span><br><span class="line">    println(<span class="string">&quot;Done&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concurrently executes both sections</span></span><br><span class="line"><span class="comment">//åŒæ—¶æ‰§è¡Œä¸¤ä¸ªéƒ¨åˆ†</span></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">doWorld</span><span class="params">()</span></span> = coroutineScope &#123; <span class="comment">// this: CoroutineScope</span></span><br><span class="line">    launch &#123;</span><br><span class="line">        delay(<span class="number">2000L</span>)</span><br><span class="line">        println(<span class="string">&quot;World 2&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    launch &#123;</span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">&quot;World 1&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>launch {â€¦}ä¸­çš„ä¸¤æ®µä»£ç å—åŒæ—¶æ‰§è¡Œï¼Œä»å¼€å§‹ä¸€ç§’åï¼Œé¦–å…ˆæ‰“å°World 1ï¼Œä»å¼€å§‹ä¸¤ç§’åæ‰“å°World 2ã€‚doWorldä¸­çš„ä¸€ä¸ªcoroutineScopeåªæœ‰åœ¨ä¸¤è€…éƒ½å®Œæˆåæ‰èƒ½å®Œæˆï¼Œå› æ­¤doWorldè¿”å›å¹¶å…è®¸ä»…åœ¨å®Œæˆåæ‰“å°Doneå­—ç¬¦ä¸²ï¼š</p>
<blockquote>
<p>Hello<br>World 1<br>World 2<br>Done</p>
</blockquote>
<h2 id="job"><a href="#job" class="headerlink" title="job"></a>job</h2><p> launchåç¨‹æ„é€ å™¨è¿”å›ä¸€ä¸ªjobå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯å¯åŠ¨ååŒç¨‹åºçš„å¥æŸ„ï¼Œå¯ç”¨äºæ˜¾å¼ç­‰å¾…å…¶å®Œæˆã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ç­‰å¾…å­ååŒç¨‹åºå®Œæˆï¼Œç„¶åæ‰“å°â€œDoneâ€å­—ç¬¦ä¸²ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> job = launch &#123; </span><br><span class="line">    <span class="comment">// launch a new coroutine and keep a reference to its Job</span></span><br><span class="line">    <span class="comment">//å¯åŠ¨ä¸€ä¸ªæ–°çš„ååŒç¨‹åºï¼Œå¹¶ä¿ç•™å¯¹å…¶å·¥ä½œçš„å¼•ç”¨</span></span><br><span class="line">        delay(<span class="number">1000L</span>)</span><br><span class="line">        println(<span class="string">&quot;World!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">    <span class="comment">// wait until child coroutine completes</span></span><br><span class="line">    <span class="comment">//ç­‰å¾…å­ååŒç¨‹åºå®Œæˆ</span></span><br><span class="line">    job.join() </span><br><span class="line">    println(<span class="string">&quot;Done&quot;</span>)     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Hello<br>World!<br>Done</p>
</blockquote>
<h2 id="è½»é‡çº§"><a href="#è½»é‡çº§" class="headerlink" title="è½»é‡çº§"></a>è½»é‡çº§</h2><p>æˆ‘ä»¬æœ‰å¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"></span><br><span class="line"><span class="comment">//sampleStart</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    repeat(<span class="number">100_000</span>) &#123; <span class="comment">// launch a lot of coroutines</span></span><br><span class="line">        launch &#123;</span><br><span class="line">            delay(<span class="number">5000L</span>)</span><br><span class="line">            print(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//sampleEnd</span></span><br></pre></td></tr></table></figure></div>
<p>å®ƒä¼šå¯åŠ¨10ä¸‡ä¸ªåç¨‹ï¼Œ5ç§’åï¼Œæ¯ä¸ªååŒç¨‹åºéƒ½ä¼šæ‰“å°ä¸€ä¸ªç‚¹ã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç”¨çº¿ç¨‹è¯•è¯•ï¼ˆåˆ é™¤runBlockingï¼Œç”¨threadæ›¿æ¢launchï¼Œç”¨thread.sleepæ›¿æ¢delayï¼‰ã€‚ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆ<em><strong>ä»£ç å¾ˆå¯èƒ½ä¼šäº§ç”ŸæŸç§å†…å­˜ä¸è¶³é”™è¯¯</strong></em>ï¼‰</p>
<h1 id="äºŒã€Android-ä¸Šçš„-Kotlin-åç¨‹"><a href="#äºŒã€Android-ä¸Šçš„-Kotlin-åç¨‹" class="headerlink" title="äºŒã€Android ä¸Šçš„ Kotlin åç¨‹"></a>äºŒã€Android ä¸Šçš„ Kotlin åç¨‹</h1><p>Androidçš„å¼€å‘æ–‡æ¡£ä¸­æ˜¯è¿™ä¹ˆä»‹ç»åç¨‹çš„ï¼š<br>åç¨‹æ˜¯ä¸€ç§å¹¶å‘è®¾è®¡æ¨¡å¼ï¼Œæ‚¨å¯ä»¥åœ¨ Android å¹³å°ä¸Šä½¿ç”¨å®ƒæ¥ç®€åŒ–å¼‚æ­¥æ‰§è¡Œçš„ä»£ç ã€‚åç¨‹æ˜¯åœ¨ç‰ˆæœ¬ 1.3 ä¸­æ·»åŠ åˆ° Kotlin çš„ï¼Œå®ƒåŸºäºæ¥è‡ªå…¶ä»–è¯­è¨€çš„æ—¢å®šæ¦‚å¿µã€‚</p>
<p>åœ¨ Android ä¸Šï¼Œåç¨‹æœ‰åŠ©äºç®¡ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œå¦‚æœç®¡ç†ä¸å½“ï¼Œè¿™äº›ä»»åŠ¡å¯èƒ½ä¼šé˜»å¡ä¸»çº¿ç¨‹å¹¶å¯¼è‡´åº”ç”¨æ— å“åº”ã€‚ä½¿ç”¨åç¨‹çš„ä¸“ä¸šå¼€å‘è€…ä¸­æœ‰è¶…è¿‡ 50% çš„äººåæ˜ ä½¿ç”¨åç¨‹æé«˜äº†å·¥ä½œæ•ˆç‡ã€‚æœ¬ä¸»é¢˜ä»‹ç»å¦‚ä½•ä½¿ç”¨ Kotlin åç¨‹è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œä»è€Œè®©æ‚¨èƒ½å¤Ÿç¼–å†™å‡ºæ›´æ¸…æ™°ã€æ›´ç®€æ´çš„åº”ç”¨ä»£ç ã€‚</p>
<h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><p>åç¨‹æ˜¯æˆ‘ä»¬åœ¨ Android ä¸Šè¿›è¡Œå¼‚æ­¥ç¼–ç¨‹çš„æ¨èè§£å†³æ–¹æ¡ˆã€‚å€¼å¾—å…³æ³¨çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>è½»é‡</strong>ï¼šæ‚¨å¯ä»¥åœ¨å•ä¸ªçº¿ç¨‹ä¸Šè¿è¡Œå¤šä¸ªåç¨‹ï¼Œå› ä¸ºåç¨‹æ”¯æŒæŒ‚èµ·ï¼Œä¸ä¼šä½¿æ­£åœ¨è¿è¡Œåç¨‹çš„çº¿ç¨‹é˜»å¡ã€‚æŒ‚èµ·æ¯”é˜»å¡èŠ‚çœå†…å­˜ï¼Œä¸”æ”¯æŒå¤šä¸ªå¹¶è¡Œæ“ä½œã€‚</li>
<li><strong>å†…å­˜æ³„æ¼æ›´å°‘</strong>ï¼šä½¿ç”¨ç»“æ„åŒ–å¹¶å‘æœºåˆ¶åœ¨ä¸€ä¸ªä½œç”¨åŸŸå†…æ‰§è¡Œå¤šé¡¹æ“ä½œã€‚</li>
<li><strong>å†…ç½®å–æ¶ˆæ”¯æŒ</strong>ï¼šå–æ¶ˆæ“ä½œä¼šè‡ªåŠ¨åœ¨è¿è¡Œä¸­çš„æ•´ä¸ªåç¨‹å±‚æ¬¡ç»“æ„å†…ä¼ æ’­ã€‚</li>
<li><strong>Jetpack é›†æˆ</strong>ï¼šè®¸å¤š Jetpack åº“éƒ½åŒ…å«æä¾›å…¨é¢åç¨‹æ”¯æŒçš„æ‰©å±•ã€‚æŸäº›åº“è¿˜æä¾›è‡ªå·±çš„åç¨‹ä½œç”¨åŸŸï¼Œå¯ä¾›æ‚¨ç”¨äºç»“æ„åŒ–å¹¶å‘ã€‚</li>
</ul>
<h2 id="Android-ä¸Š-Kotlin-åç¨‹-Retrofitè¿›è¡Œç½‘ç»œè¯·æ±‚çš„ç¤ºä¾‹"><a href="#Android-ä¸Š-Kotlin-åç¨‹-Retrofitè¿›è¡Œç½‘ç»œè¯·æ±‚çš„ç¤ºä¾‹" class="headerlink" title="Android ä¸Š Kotlin åç¨‹+Retrofitè¿›è¡Œç½‘ç»œè¯·æ±‚çš„ç¤ºä¾‹"></a>Android ä¸Š Kotlin åç¨‹+Retrofitè¿›è¡Œç½‘ç»œè¯·æ±‚çš„ç¤ºä¾‹</h2><p>ä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨å•ç‹¬çš„Retrofitï¼Œå¦‚æœå¯¹Retrofitä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥å‚è€ƒç¬”è€…çš„è¿™ç¯‡æ–‡ç« </p>
<blockquote>
<p>javaç‰ˆæœ¬çš„,æ”¯æŒåç¨‹çš„Retrofitç‰ˆæœ¬æ˜¯è‡³å°‘è¦åˆ°å¤§äº2.6å“¦ï¼Œæœ¬æ–‡ä½¿ç”¨çš„å°±æ˜¯2.6ç‰ˆæœ¬çš„Retrofit<br><a class="link"   href="https://blog.csdn.net/shop_and_sleep/article/details/123526236?spm=1001.2014.3001.5502" >android retrofit ä»æ— çŸ¥åˆ°å…¥é—¨ï¼ˆæœ€æ–°æœ€å…¨ï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</blockquote>
<h3 id="ä¸€äº›ä»£ç çš„å‡†å¤‡"><a href="#ä¸€äº›ä»£ç çš„å‡†å¤‡" class="headerlink" title="ä¸€äº›ä»£ç çš„å‡†å¤‡"></a>ä¸€äº›ä»£ç çš„å‡†å¤‡</h3><blockquote>
<p>API</p>
</blockquote>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> retrofit2.Call</span><br><span class="line"><span class="keyword">import</span> retrofit2.Response</span><br><span class="line"><span class="keyword">import</span> retrofit2.http.GET</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ISystemRemoteService</span> &#123;</span><br><span class="line">    <span class="meta">@get:GET</span>(<span class="string">&quot;/system/alive&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> systemStatus: Call&lt;Response&lt;Any&gt;&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>RetrofitService</p>
</blockquote>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> retrofit2.Retrofit</span><br><span class="line"><span class="keyword">import</span> okhttp3.OkHttpClient</span><br><span class="line"><span class="keyword">import</span> com.zyf.kotlindemo.HttpsUtils</span><br><span class="line"><span class="keyword">import</span> kotlin.Throws</span><br><span class="line"><span class="keyword">import</span> com.zyf.kotlindemo.RetrofitService</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RetrofitService</span> <span class="keyword">private</span> <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> retrofit: Retrofit</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">create</span><span class="params">(clazz: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;?)</span></span>: T &#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(clazz)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> client = OkHttpClient.Builder()</span><br><span class="line">            .connectTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">            .readTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">            .sslSocketFactory(HttpsUtils.getSslSocketFactory(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>))</span><br><span class="line">            .hostnameVerifier &#123; hostname, session -&gt; <span class="literal">true</span> &#125;</span><br><span class="line">            .writeTimeout(<span class="number">30</span>, TimeUnit.SECONDS).addInterceptor &#123; chain -&gt;</span><br><span class="line">                <span class="keyword">val</span> builder = chain.request()</span><br><span class="line">                    .newBuilder()</span><br><span class="line">                <span class="keyword">val</span> request = builder.build()</span><br><span class="line">                chain.proceed(request)</span><br><span class="line">            &#125;.build()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">var</span> i: RetrofitService? = <span class="literal">null</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">i</span><span class="params">()</span></span>: RetrofitService? &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="literal">null</span>) &#123;</span><br><span class="line">                i = RetrofitService()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">rebuild</span><span class="params">()</span></span> &#123;</span><br><span class="line">            i = RetrofitService()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> serverUrl = <span class="string">&quot;https://blog.csdn.net/shop_and_sleep&quot;</span></span><br><span class="line">        retrofit = Retrofit.Builder()</span><br><span class="line">            .baseUrl(serverUrl) <span class="comment">//è®¾ç½®è¶…æ—¶æ—¶é—´,intercept</span></span><br><span class="line">            .client(client)</span><br><span class="line">            .build()</span><br><span class="line">        Log.i(<span class="string">&quot;ServerUrl:------&quot;</span>, serverUrl)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="Kotlin-ç®€å•ä½¿ç”¨Retrofit"><a href="#Kotlin-ç®€å•ä½¿ç”¨Retrofit" class="headerlink" title="Kotlin ç®€å•ä½¿ç”¨Retrofit"></a>Kotlin ç®€å•ä½¿ç”¨Retrofit</h3><blockquote>
<p>åªä½¿ç”¨Retrofitä¸ä½¿ç”¨åç¨‹</p>
</blockquote>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> api = RetrofitService.i()?.create(ISystemRemoteService::<span class="keyword">class</span>.java)</span><br><span class="line">       <span class="keyword">val</span> call = api?.systemStatus</span><br><span class="line">       <span class="comment">//è¿™é‡Œå› ä¸ºæˆ‘æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥åªèƒ½å¼‚æ­¥</span></span><br><span class="line">       <span class="keyword">val</span> result = call?.enqueue(<span class="keyword">object</span> : Callback&lt;Response&lt;Any&gt;&gt;&#123;</span><br><span class="line">           <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResponse</span><span class="params">(call: <span class="type">Call</span>&lt;<span class="type">Response</span>&lt;<span class="type">Any</span>&gt;&gt;, response: <span class="type">Response</span>&lt;<span class="type">Response</span>&lt;<span class="type">Any</span>&gt;&gt;)</span></span> &#123;</span><br><span class="line">               <span class="comment">//æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailure</span><span class="params">(call: <span class="type">Call</span>&lt;<span class="type">Response</span>&lt;<span class="type">Any</span>&gt;&gt;, t: <span class="type">Throwable</span>)</span></span> &#123;</span><br><span class="line">               <span class="comment">//å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;)</span><br></pre></td></tr></table></figure></div>
<h3 id="Kotlin-android-ç®€å•ä½¿ç”¨åç¨‹"><a href="#Kotlin-android-ç®€å•ä½¿ç”¨åç¨‹" class="headerlink" title="Kotlin android ç®€å•ä½¿ç”¨åç¨‹"></a>Kotlin android ç®€å•ä½¿ç”¨åç¨‹</h3><p>åœ¨ç¬¬ä¸€ä¸ªåç¨‹ä¸­æˆ‘ä»¬çŸ¥é“æ¯ä¸€ä¸ªåç¨‹éƒ½è¦æœ‰ä¸€ä¸ªèŒƒå›´æ„é€ å™¨ï¼Œé‚£ä¹ˆåœ¨å®‰å“ä¸­ä¹‹å‰çš„ç¬¬ä¸€ä¸ªåç¨‹å°±å¯ä»¥å˜ä¸º</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">CoroutineScope(Dispatchers.Main).launch &#123;</span><br><span class="line">    <span class="comment">// non-blocking delay for 1 second (default time unit is ms)å»¶æ—¶ä¸€ç§’</span></span><br><span class="line">    delay(<span class="number">1000L</span>)</span><br><span class="line">    <span class="comment">// print after delay å»¶æ—¶åæ‰“å°</span></span><br><span class="line">    println(<span class="string">&quot;World!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;Hello&quot;</span>)</span><br></pre></td></tr></table></figure></div>
<p><em><strong>Dispatchers.Main</strong></em><br>ä»£è¡¨åœ¨ä¸»çº¿ç¨‹ä¸­å¼€å¯è¿™ä¸ªåç¨‹ï¼ŒDispatchersæ˜¯ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œé™¤äº†Mainï¼Œåœ¨ä»–çš„æºç ä¸­æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å…¶ä»–çš„ï¼Œä»¥ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¥é˜è¿°ï¼š</p>
<table>
<thead>
<tr>
<th>åˆ†ç»„</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>Default</td>
<td>é»˜è®¤çš„è°ƒåº¦å™¨ï¼ˆå¦‚æœä¸å†™å¾—è¯é»˜è®¤å°±æ˜¯è¿™ä¸ªï¼‰</td>
</tr>
<tr>
<td>Main</td>
<td>ä¸»çº¿ç¨‹çš„è°ƒåº¦å™¨ï¼ˆå¦‚æœä¸å†™å¾—è¯é»˜è®¤å°±æ˜¯è¿™ä¸ªï¼‰</td>
</tr>
<tr>
<td>Unconfined</td>
<td>ä¸€ä¸ªä¸å±€é™äºä»»ä½•ç‰¹å®šçº¿ç¨‹çš„ååŒç¨‹åºè°ƒåº¦ç¨‹åº</td>
</tr>
<tr>
<td>IO</td>
<td>é¡¾åæ€ä¹‰è®¾è®¡ç”¨äºå°†é˜»å¡IOä»»åŠ¡å¸è½½åˆ°å…±äº«çº¿ç¨‹æ± çš„è°ƒåº¦å™¨ï¼‰</td>
</tr>
</tbody></table>
<h3 id="Kotlin-android-ç®€å•ä½¿ç”¨åç¨‹-retrofit"><a href="#Kotlin-android-ç®€å•ä½¿ç”¨åç¨‹-retrofit" class="headerlink" title="Kotlin android ç®€å•ä½¿ç”¨åç¨‹+retrofit"></a>Kotlin android ç®€å•ä½¿ç”¨åç¨‹+retrofit</h3><p>äº†è§£äº†è°ƒåº¦å™¨Dispatchersï¼Œåç¨‹æ„é€ å™¨ï¼Œå’Œåç¨‹æ„é€ å™¨çš„è¿”å›jobåï¼Œä¸€ä¸ªç®€å•çš„ç½‘ç»œè¯·æ±‚å°±é¡ºå…¶è‡ªç„¶çš„å‡ºç°äº†ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">CoroutineScope(Dispatchers.Main).launch &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*å› ä¸ºç¬¬ä¸€ä¸ªåç¨‹è¿˜æ˜¯ä¸»çº¿ç¨‹ï¼Œ</span></span><br><span class="line"><span class="comment">        Androidè§„å®šç½‘ç»œè¯·æ±‚å¿…é¡»åœ¨å­çº¿ç¨‹,</span></span><br><span class="line"><span class="comment">        æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é€šè¿‡withContextè·å–è¯·æ±‚ç»“æœ,</span></span><br><span class="line"><span class="comment">        é€šè¿‡è°ƒåº¦å™¨Dispatcheråˆ‡æ¢åˆ°IOçº¿ç¨‹,</span></span><br><span class="line"><span class="comment">        è¿™ä¸ªæ“ä½œä¼šæŒ‚èµ·å½“å‰åç¨‹,ä½†æ˜¯ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹*/</span></span><br><span class="line">        <span class="keyword">val</span> result = withContext(Dispatchers.IO) &#123;</span><br><span class="line">            <span class="comment">/*è¿™é‡Œå·²ç»æ˜¯åœ¨å­çº¿ç¨‹äº†,</span></span><br><span class="line"><span class="comment">        	æ‰€ä»¥ä½¿ç”¨execute()åŒæ­¥è¯·æ±‚</span></span><br><span class="line"><span class="comment">      		withContextä¼šæŠŠé—­åŒ…æœ€åä¸€è¡Œä»£ç çš„è¿”å›å€¼è¿”å›å‡ºå»</span></span><br><span class="line"><span class="comment">      		æ‰€ä»¥ä¸Šé¢çš„resultå°±æ˜¯Responseç±»å‹*/</span></span><br><span class="line">            RetrofitService.i()?.create(ISystemRemoteService::<span class="keyword">class</span>.java)?.</span><br><span class="line">            systemStatus?.</span><br><span class="line">            execute()?.</span><br><span class="line">            body()</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(<span class="string">&quot;onCreate&quot;</span>, <span class="string">&quot;result: &quot;</span>+result.toString())</span><br><span class="line">        <span class="keyword">if</span> (result?.isSuccessful == <span class="literal">true</span>)&#123;</span><br><span class="line">            Toast.makeText(mContext, <span class="string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>å…¶ä¸­ <em><strong>withContext</strong></em> ä½¿ç”¨ç»™å®šçš„ååŒè·¯ç”±ä¸Šä¸‹æ–‡è°ƒç”¨æŒ‡å®šçš„æŒ‚èµ·å—ï¼ŒæŒ‚èµ·ç›´åˆ°å®Œæˆï¼Œç„¶åè¿”å›ï¼Œé™¤äº† <em><strong>launch</strong></em><br>ï¼Œ<em><strong>withContext</strong></em>ï¼Œè¿˜æœ‰ <em><strong>async</strong></em> ï¼Œç”±äºç¯‡å¹…åŸå› ä¸å¤šèµ˜è¿°ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œäº†è§£ï¼›</p>
</blockquote>
<p> å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœè°ƒç”¨äº†<em><strong>withContext</strong></em>ï¼Œåœ¨å…¶è°ƒåº¦å™¨å¼€å§‹æ‰§è¡Œä»£ç æ—¶è¢«å–æ¶ˆï¼Œå®ƒå°†ä¸¢å¼ƒâ€™withContextâ€™çš„ç»“æœå¹¶æŠ›å‡º[CancellationException]ã€‚<br> ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±ä¸å¾—ä¸æåç¨‹çš„å†…ç½®å–æ¶ˆæ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å®Œæ•´ä»£ç å˜æˆäº†å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> android.view.Gravity</span><br><span class="line"><span class="keyword">import</span> android.widget.Button</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast</span><br><span class="line"><span class="keyword">import</span> kotlinx.android.synthetic.main.activity_main.*</span><br><span class="line"><span class="keyword">import</span> kotlinx.coroutines.*</span><br><span class="line"><span class="keyword">import</span> retrofit2.Call</span><br><span class="line"><span class="keyword">import</span> retrofit2.Callback</span><br><span class="line"><span class="keyword">import</span> retrofit2.Response</span><br><span class="line"><span class="keyword">import</span> kotlin.coroutines.CoroutineContext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() ,CoroutineScope &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> mContext <span class="keyword">by</span> lazy &#123; <span class="keyword">this</span> &#125; <span class="comment">//ï¼ˆè¿™é‡Œä½¿ç”¨äº†å§”æ‰˜ï¼Œè¡¨ç¤ºåªæœ‰ä½¿ç”¨åˆ°mContext æ‰ä¼šæ‰§è¡Œè¯¥æ®µä»£ç ï¼‰</span></span><br><span class="line">    <span class="comment">//jobç”¨äºæ§åˆ¶åç¨‹,åé¢launch&#123;&#125;å¯åŠ¨çš„åç¨‹,è¿”å›çš„jobå°±æ˜¯è¿™ä¸ªjobå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> job: Job</span><br><span class="line">    <span class="comment">//ç»§æ‰¿CoroutineScopeå¿…é¡»åˆå§‹åŒ–coroutineContextå˜é‡</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ˜¯æ ‡å‡†å†™æ³•,+å…¶å®æ˜¯plusæ–¹æ³•å‰é¢è¡¨ç¤ºjob,ç”¨äºæ§åˆ¶åç¨‹,åé¢æ˜¯Dispatchers,æŒ‡å®šå¯åŠ¨çš„çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> coroutineContext: CoroutineContext</span><br><span class="line">        <span class="keyword">get</span>() = job + Dispatchers.Main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        job = Job()</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        CoroutineScope(Dispatchers.Main).launch &#123;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">             RetrofitService.i()?.create(ISystemRemoteService::<span class="keyword">class</span>.java)?.</span><br><span class="line">                systemStatus?.</span><br><span class="line">                execute()?.</span><br><span class="line">                body()</span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(<span class="string">&quot;onCreate&quot;</span>, <span class="string">&quot;result: &quot;</span>+result.toString())</span><br><span class="line">            <span class="keyword">if</span> (result?.isSuccessful == <span class="literal">true</span>)&#123;</span><br><span class="line">                Toast.makeText(mContext, <span class="string">&quot;è¯·æ±‚æˆåŠŸ&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">    	<span class="comment">//å½“acitivityç»“æŸä¹‹å,æˆ‘ä»¬ä¸éœ€è¦å†è¯·æ±‚ç½‘ç»œäº†,ç»“æŸå½“å‰åç¨‹</span></span><br><span class="line">        job.cancel()</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™ä¸ªç®€å•ç¤ºä¾‹åˆ°æ­¤å°±ç»“æŸäº†ï¼Œä½†å®é™…é¡¹ç›®ä¸€èˆ¬ä¼šåœ¨viewmodelä¸­ä½¿ç”¨ç½‘ç»œè¯·æ±‚è€Œä¸æ˜¯åœ¨activityä¸­ï¼Œè¿™å°±ä¸å¾—ä¸æåç¨‹çš„å¦ä¸€ä¸ªä¼˜ç‚¹Jetpack é›†æˆäº†ï¼Œå¦‚æœæ˜¯åœ¨viewmodelä¸­ï¼Œå¯ä»¥ä½¿ç”¨viewModelScopeæ¥ç»‘å®šviewModelçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦åˆ™å°±è¦åƒç¤ºä¾‹é‚£æ ·æ‰‹åŠ¨è°ƒç”¨ job.cancel()æ–¹æ³•</p>
<hr>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a class="link"   href="https://www.kotlincn.net/docs/reference/" >kotlinå®˜æ–¹æ–‡æ¡£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://developer.android.google.cn/kotlin" >å®‰å“å®˜æ–¹æ–‡æ¡£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://www.cnblogs.com/sw-code/p/14451921.html" >åç¨‹é…åˆretrofitè°ƒç”¨ç½‘ç»œè¯·æ±‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link"   href="https://blog.csdn.net/weixin_44407870/article/details/86767075" >Androidä¸­ä½¿ç”¨Kotlinåç¨‹(Coroutines)å’ŒRetrofitè¿›è¡Œç½‘ç»œè¯·æ±‚(ä¸€) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Kotlinåç¨‹ï¼ˆcoroutineï¼‰</tag>
      </tags>
  </entry>
  <entry>
    <title>Android Socket ç®€å•ä»‹ç»</title>
    <url>/2023/08/11/Android-Socket-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/Android-Socket-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘éœ€æ±‚éœ€è¦ä½¿ç”¨Socketè¿›è¡Œé€šè®¯ï¼Œæˆ‘åœ¨å·¥ä½œåçš„å®‰å“å¼€å‘ä¸­æ²¡æœ‰æ¥è§¦è¿‡ï¼Œæ‰€ä»¥æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼›<br>å†™çš„æ—¶å€™æƒ³èµ·æ¥å¥½åƒä¸Šå¤§å­¦çš„æ—¶å€™å­¦è¿‡ï¼Œåé¢ä¸€ç›´æ²¡ç”¨å¿˜è®°äº†ï¼›<br>ä¹‹å‰å…¬å¸åŒäº‹çš„ç”·æœ‹å‹ä¹Ÿåœ¨å†™è¿™ä¸ªæ¥ç€ï¼Œæˆ‘å½“æ—¶è¿˜å˜²ç¬‘æ€ä¹ˆè¿˜ä¼šæœ‰äººç”¨è¿™ä¸ªï¼Œç°åœ¨è‡ªå·±é‡åˆ°äº†ğŸ•ï¼›</p>
<hr>
<h1 id="ä¸€ã€Socketæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€Socketæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€Socketæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€Socketæ˜¯ä»€ä¹ˆï¼Ÿ</h1><h2 id="ç™¾åº¦ç™¾ç§‘çš„è§£é‡Š"><a href="#ç™¾åº¦ç™¾ç§‘çš„è§£é‡Š" class="headerlink" title="ç™¾åº¦ç™¾ç§‘çš„è§£é‡Š"></a>ç™¾åº¦ç™¾ç§‘çš„è§£é‡Š</h2><p>æ‰€è°“å¥—æ¥å­—(Socket)ï¼Œå°±æ˜¯å¯¹ç½‘ç»œä¸­ä¸åŒä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹çš„æŠ½è±¡ã€‚ä¸€ä¸ªå¥—æ¥å­—å°±æ˜¯ç½‘ç»œä¸Šè¿›ç¨‹é€šä¿¡çš„ä¸€ç«¯ï¼Œæä¾›äº†åº”ç”¨å±‚è¿›ç¨‹åˆ©ç”¨ç½‘ç»œåè®®äº¤æ¢æ•°æ®çš„æœºåˆ¶ã€‚ä»æ‰€å¤„çš„åœ°ä½æ¥è®²ï¼Œå¥—æ¥å­—ä¸Šè”åº”ç”¨è¿›ç¨‹ï¼Œä¸‹è”ç½‘ç»œåè®®æ ˆï¼Œæ˜¯åº”ç”¨ç¨‹åºé€šè¿‡ç½‘ç»œåè®®è¿›è¡Œé€šä¿¡çš„æ¥å£ï¼Œæ˜¯åº”ç”¨ç¨‹åºä¸ç½‘ç»œåè®®æ ˆè¿›è¡Œäº¤äº’çš„æ¥å£ã€‚</p>
<p>å¥—æ¥å­—Socket&#x3D;ï¼ˆIPåœ°å€ï¼šç«¯å£å·ï¼‰ï¼Œå¥—æ¥å­—çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ç‚¹åˆ†åè¿›åˆ¶çš„lPåœ°å€åé¢å†™ä¸Šç«¯å£å·ï¼Œä¸­é—´ç”¨å†’å·æˆ–é€—å·éš”å¼€ã€‚æ¯ä¸€ä¸ªä¼ è¾“å±‚è¿æ¥å”¯ä¸€åœ°è¢«é€šä¿¡ä¸¤ç«¯çš„ä¸¤ä¸ªç«¯ç‚¹ï¼ˆå³ä¸¤ä¸ªå¥—æ¥å­—ï¼‰æ‰€ç¡®å®šã€‚ä¾‹å¦‚ï¼šå¦‚æœIPåœ°å€æ˜¯210.37.145.1ï¼Œè€Œç«¯å£å·æ˜¯23ï¼Œé‚£ä¹ˆå¾—åˆ°å¥—æ¥å­—å°±æ˜¯(210.37.145.1:23)</p>
<h2 id="æˆ‘è‡ªå·±çš„ç†è§£"><a href="#æˆ‘è‡ªå·±çš„ç†è§£" class="headerlink" title="æˆ‘è‡ªå·±çš„ç†è§£"></a>æˆ‘è‡ªå·±çš„ç†è§£</h2><p>åˆ†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ï¼Œsocketä»¥æœåŠ¡ç«¯çš„ipåœ°å€å’Œçº¦å®šå¥½çš„ç«¯å£å·è¿›è¡Œç»„åˆå¾—åˆ°å¥—æ¥å­—è¿›è¡Œä¸€ä¸ªä¸¤ç«¯çš„ç›¸äº’è¿æ¥ï¼Œè¾¾åˆ°èƒ½å¤Ÿäº’ç›¸æ”¶å‘æ¶ˆæ¯çš„ä¸€ä¸ªç›®çš„ã€‚</p>
<h1 id="äºŒã€ç®€å•ç¤ºä¾‹"><a href="#äºŒã€ç®€å•ç¤ºä¾‹" class="headerlink" title="äºŒã€ç®€å•ç¤ºä¾‹"></a>äºŒã€ç®€å•ç¤ºä¾‹</h1><p>ä¸‹é¢çš„ä»£ç å°†æ¼”ç¤ºå¦‚ä½•åœ¨ä¸€ä¸ªappä¸­å®ç°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ç®€å•ç¤ºä¾‹</p>
<h2 id="1-æœåŠ¡ç«¯"><a href="#1-æœåŠ¡ç«¯" class="headerlink" title="1.æœåŠ¡ç«¯"></a>1.æœåŠ¡ç«¯</h2><p>å…ˆåˆ›å»ºæŠ½è±¡çš„<strong>ServerCallback</strong></p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ServerCallback</span> &#123;</span><br><span class="line">    <span class="comment">//æ¥æ”¶å®¢æˆ·ç«¯çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">receiveClientMsg</span><span class="params">(success: <span class="type">Boolean</span>, msg: <span class="type">String</span>)</span></span></span><br><span class="line">    <span class="comment">//å…¶ä»–æ¶ˆæ¯ï¼Œä¾‹å¦‚æœ‰å®¢æˆ·ç«¯è¿æ¥å’Œå‘é€æ¶ˆæ¯æˆåŠŸç­‰</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">otherMsg</span><span class="params">(msg: <span class="type">String</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶ååˆ›å»º<strong>SocketServer</strong>æ¥ç®¡ç†æœåŠ¡ç«¯çš„è¿æ¥</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> java.io.IOException</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket</span><br><span class="line"><span class="keyword">import</span> java.net.Socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> SocketServer &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> TAG = SocketServer::<span class="keyword">class</span>.java.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> SOCKET_PORT =</span><br><span class="line">        <span class="number">7878</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> socket: Socket? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> serverSocket: ServerSocket? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mCallback: ServerCallback</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> outputStream: OutputStream</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = <span class="literal">true</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å¯æœåŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startServer</span><span class="params">(callback: <span class="type">ServerCallback</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;startServer: &quot;</span>)</span><br><span class="line">        mCallback = callback</span><br><span class="line">        Thread &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                serverSocket = ServerSocket(SOCKET_PORT)</span><br><span class="line">                <span class="keyword">while</span> (result) &#123;</span><br><span class="line">                    socket = serverSocket?.accept()</span><br><span class="line">                    mCallback.otherMsg(<span class="string">&quot;<span class="subst">$&#123;socket?.inetAddress&#125;</span> to connected&quot;</span>)</span><br><span class="line">                    ServerThread(socket!!, mCallback).start()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">                result = <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­æœåŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">stopServer</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;stopServer: &quot;</span>)</span><br><span class="line">        socket?.apply &#123;</span><br><span class="line">            shutdownInput()</span><br><span class="line">            shutdownOutput()</span><br><span class="line">            close()</span><br><span class="line">        &#125;</span><br><span class="line">        serverSocket?.close()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€åˆ°å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">sendToClient</span><span class="params">(msg: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        Thread &#123;</span><br><span class="line">            <span class="keyword">if</span> (socket!!.isClosed) &#123;</span><br><span class="line">                Log.e(TAG, <span class="string">&quot;sendToClient: Socket is closed&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span><span class="symbol">@Thread</span></span><br><span class="line">            &#125;</span><br><span class="line">            outputStream = socket!!.getOutputStream()</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                outputStream.write(msg.toByteArray())</span><br><span class="line">                outputStream.flush()</span><br><span class="line">                mCallback.otherMsg(<span class="string">&quot;toClient: <span class="variable">$msg</span>&quot;</span>)</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;å‘é€åˆ°å®¢æˆ·ç«¯æˆåŠŸ&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">                Log.e(TAG, <span class="string">&quot;å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯å¤±è´¥&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ServerThread</span>(<span class="keyword">private</span> <span class="keyword">val</span> socket: Socket, <span class="keyword">private</span> <span class="keyword">val</span> callback: ServerCallback) :</span><br><span class="line">        Thread() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">val</span> inputStream: InputStream?</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream = socket.getInputStream()</span><br><span class="line">                <span class="keyword">val</span> buffer = ByteArray(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">var</span> len: <span class="built_in">Int</span></span><br><span class="line">                <span class="keyword">var</span> receiveStr = <span class="string">&quot;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> (inputStream.available() == <span class="number">0</span>) &#123;</span><br><span class="line">                    Log.e(TAG, <span class="string">&quot;inputStream.available() == 0&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span> (inputStream.read(buffer).also &#123; len = it &#125; != -<span class="number">1</span>) &#123;</span><br><span class="line">                    receiveStr += String(buffer, <span class="number">0</span>, len, Charsets.UTF_8)</span><br><span class="line">                    <span class="keyword">if</span> (len &lt; <span class="number">1024</span>) &#123;</span><br><span class="line">                        callback.receiveClientMsg(<span class="literal">true</span>, receiveStr)</span><br><span class="line">                        receiveStr = <span class="string">&quot;&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">                e.message?.let &#123; Log.e(<span class="string">&quot;socket error&quot;</span>, it) &#125;</span><br><span class="line">                callback.receiveClientMsg(<span class="literal">false</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨é€šè¿‡startServeræ–¹æ³•åˆå§‹åŒ–ServerSocketæ—¶ï¼Œåªä½¿ç”¨åˆ°äº†SOCKET_PORTï¼Œè¿™ä¸ªServerSocketæ–¹æ³•æ¥æ”¶ä¸€ä¸ªç«¯å£å·ï¼Œä¸æ¥æ”¶ipï¼Œå› ä¸ºå®ƒå°†ä½œä¸ºæœåŠ¡ç«¯<br><strong>ServerSocketæ–¹æ³•çš„æ³¨é‡Šè¯‘æ–‡ï¼š</strong> åˆ›å»ºç»‘å®šåˆ°æŒ‡å®šç«¯å£çš„æœåŠ¡å™¨å¥—æ¥å­—ã€‚ç«¯å£å·ä¸º0è¡¨ç¤ºç«¯å£å·æ˜¯è‡ªåŠ¨åˆ†é…çš„ï¼Œé€šå¸¸æ˜¯ä»ä¸´æ—¶ç«¯å£èŒƒå›´åˆ†é…çš„ã€‚ç„¶åå¯ä»¥é€šè¿‡è°ƒç”¨getLocalPortæ¥æ£€ç´¢è¿™ä¸ªç«¯å£å·ã€‚ä¼ å…¥è¿æ¥æŒ‡ç¤º(è¿æ¥è¯·æ±‚)çš„æœ€å¤§é˜Ÿåˆ—é•¿åº¦è®¾ç½®ä¸º50ã€‚å¦‚æœè¿æ¥æŒ‡ç¤ºåœ¨é˜Ÿåˆ—å·²æ»¡æ—¶åˆ°è¾¾ï¼Œåˆ™æ‹’ç»è¿æ¥ã€‚</p>
<h2 id="2-å®¢æˆ·ç«¯"><a href="#2-å®¢æˆ·ç«¯" class="headerlink" title="2.å®¢æˆ·ç«¯"></a>2.å®¢æˆ·ç«¯</h2><p>åŒæ ·æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŠ½è±¡çš„ <strong>ClientCallback</strong></p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ClientCallback</span> &#123;</span><br><span class="line">    <span class="comment">//æ¥æ”¶æœåŠ¡ç«¯çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">receiveServerMsg</span><span class="params">(msg: <span class="type">String</span>)</span></span></span><br><span class="line">    <span class="comment">//å…¶ä»–æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">otherMsg</span><span class="params">(msg: <span class="type">String</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶ååˆ›å»ºSocketClientæ¥ç®¡ç†æœåŠ¡ç«¯çš„è¿æ¥</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> java.io.IOException</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream</span><br><span class="line"><span class="keyword">import</span> java.net.Socket</span><br><span class="line"><span class="keyword">import</span> java.util.Locale</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> SocketClient &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> TAG = SocketClient::<span class="keyword">class</span>.java.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> socket: Socket? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> outputStream: OutputStream? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> inputStreamReader: InputStreamReader? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mCallback: ClientCallback</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> SOCKET_PORT = <span class="number">7878</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿æ¥æœåŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">connectServer</span><span class="params">(ipAddress: <span class="type">String</span>, callback: <span class="type">ClientCallback</span>)</span></span> &#123;</span><br><span class="line">        mCallback = callback</span><br><span class="line">        Thread &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = Socket(ipAddress, SOCKET_PORT)</span><br><span class="line">                ClientThread(socket!!, mCallback).start()</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­è¿æ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">closeConnect</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inputStreamReader?.close()</span><br><span class="line">            outputStream?.close()</span><br><span class="line">            socket?.apply &#123;</span><br><span class="line">                shutdownInput()</span><br><span class="line">                shutdownOutput()</span><br><span class="line">                close()</span><br><span class="line">            &#125;</span><br><span class="line">            Log.d(TAG, <span class="string">&quot;å…³é—­è¿æ¥&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">catch</span> (e: Exception)&#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ•°æ®è‡³æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg è¦å‘é€è‡³æœåŠ¡å™¨çš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">sendToServer</span><span class="params">(msg: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        Thread &#123;</span><br><span class="line">            <span class="keyword">if</span> (socket!!.isClosed) &#123;</span><br><span class="line">                Log.e(TAG, <span class="string">&quot;sendToServer: Socket is closed&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span><span class="symbol">@Thread</span></span><br><span class="line">            &#125;</span><br><span class="line">            outputStream = socket?.getOutputStream()</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                outputStream?.write(msg.toByteArray())</span><br><span class="line">                outputStream?.flush()</span><br><span class="line">                mCallback.otherMsg(<span class="string">&quot;toServer: <span class="variable">$msg</span>&quot;</span>)</span><br><span class="line">                Log.e(TAG, <span class="string">&quot;å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯æˆåŠŸ&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">                Log.e(TAG, <span class="string">&quot;å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯å¤±è´¥&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ClientThread</span>(<span class="keyword">private</span> <span class="keyword">val</span> socket: Socket, <span class="keyword">private</span> <span class="keyword">val</span> callback: ClientCallback) : Thread() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">val</span> inputStream: InputStream?</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                inputStream = socket.getInputStream()</span><br><span class="line">                <span class="keyword">val</span> buffer = ByteArray(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">var</span> len: <span class="built_in">Int</span></span><br><span class="line">                <span class="keyword">var</span> receiveStr = <span class="string">&quot;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> (inputStream.available() == <span class="number">0</span>) &#123;</span><br><span class="line">                    Log.e(TAG, <span class="string">&quot;inputStream.available() == 0&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span> (inputStream.read(buffer).also &#123; len = it &#125; != -<span class="number">1</span>) &#123;</span><br><span class="line">                    receiveStr += String(buffer, <span class="number">0</span>, len, Charsets.UTF_8)</span><br><span class="line">                    <span class="keyword">if</span> (len &lt; <span class="number">1024</span>) &#123;</span><br><span class="line">                        callback.receiveServerMsg(receiveStr)</span><br><span class="line">                        receiveStr = <span class="string">&quot;&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: IOException) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">                e.message?.let &#123; Log.e(<span class="string">&quot;socket error&quot;</span>, it) &#125;</span><br><span class="line">                callback.receiveServerMsg( <span class="string">&quot;&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯é€šè¿‡connectServeræ–¹æ³•è¿æ¥æœåŠ¡ç«¯æ—¶ï¼Œä½¿ç”¨äº†Socketæ–¹æ³•ï¼Œå®ƒæ¥æ”¶äº†ä¸€ä¸ªipå’Œä¸€ä¸ªçº¦å®šå¥½çš„ç«¯å£å·ï¼Œè¿™é‡Œçš„ipå°±æ˜¯æœåŠ¡ç«¯çš„ip<br><strong>Socketæ–¹æ³•çš„æ³¨é‡Šè¯‘æ–‡ä¸ºï¼š</strong> åˆ›å»ºæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šä¸»æœºä¸Šçš„æŒ‡å®šç«¯å£å·ã€‚å¦‚æœæŒ‡å®šçš„ä¸»æœºä¸ºç©ºï¼Œåˆ™ç›¸å½“äºæŒ‡å®šåœ°å€ä¸ºInetAddressã€‚getByName (null)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒç›¸å½“äºæŒ‡å®šloopbackæ¥å£çš„åœ°å€ã€‚</p>
<h2 id="3-å¸ƒå±€"><a href="#3-å¸ƒå±€" class="headerlink" title="3.å¸ƒå±€"></a>3.å¸ƒå±€</h2><div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    xmlns:app=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="line">    android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:id=<span class="string">&quot;@+id/lay_server&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">&quot;@+id/tv_ip_address&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:padding=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;Ipåœ°å€ï¼š&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">&quot;@+id/btn_start_service&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_marginStart=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:layout_marginEnd=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;å¼€å¯æœåŠ¡&quot;</span></span><br><span class="line">             /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">&quot;@+id/btn_connect_service&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_marginStart=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:layout_marginEnd=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;å¼€å¯é“¾æ¥&quot;</span></span><br><span class="line">             /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">&quot;@+id/btn_client_send_msg&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_marginStart=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:layout_marginEnd=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯&quot;</span></span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=<span class="string">&quot;@+id/btn_server_send_msg&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_marginStart=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:layout_marginEnd=<span class="string">&quot;16dp&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;æœåŠ¡ç«¯å‘é€æ¶ˆæ¯&quot;</span></span><br><span class="line">            /&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="4-å®ç°"><a href="#4-å®ç°" class="headerlink" title="4.å®ç°"></a>4.å®ç°</h2><p>åœ¨activityä¸­</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.net.wifi.WifiManager</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> com.zyf.vlc.databinding.ActivityMainBinding</span><br><span class="line"><span class="keyword">import</span> com.zyf.vlc.socket.ClientCallback</span><br><span class="line"><span class="keyword">import</span> com.zyf.vlc.socket.ServerCallback</span><br><span class="line"><span class="keyword">import</span> com.zyf.vlc.socket.SocketClient</span><br><span class="line"><span class="keyword">import</span> com.zyf.vlc.socket.SocketServer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>(),ServerCallback, ClientCallback &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">val</span> TAG = <span class="string">&quot;MainActivity&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: ActivityMainBinding</span><br><span class="line"></span><br><span class="line">    <span class="comment">//SocketæœåŠ¡æ˜¯å¦æ‰“å¼€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> openSocket = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> connectSocket = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">        binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        binding.tvIpAddress.text = <span class="string">&quot;Ipåœ°å€ï¼š<span class="subst">$&#123;getIp()&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼€å¯æœåŠ¡/å…³é—­æœåŠ¡ æœåŠ¡ç«¯å¤„ç†</span></span><br><span class="line">        binding.btnStartService.setOnClickListener &#123;</span><br><span class="line">            openSocket = <span class="keyword">if</span> (openSocket) &#123;</span><br><span class="line">                SocketServer.stopServer();<span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> SocketServer.startServer(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ”¹å˜æŒ‰é’®æ–‡å­—</span></span><br><span class="line">            binding.btnStartService.text = <span class="keyword">if</span> (openSocket) <span class="string">&quot;å…³é—­æœåŠ¡&quot;</span> <span class="keyword">else</span> <span class="string">&quot;å¼€å¯æœåŠ¡&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        binding.btnConnectService.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> ip = getIp()</span><br><span class="line">            connectSocket = <span class="keyword">if</span> (connectSocket) &#123;</span><br><span class="line">                SocketClient.closeConnect();<span class="literal">false</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                SocketClient.connectServer(ip, <span class="keyword">this</span>);<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            binding.btnConnectService.text = <span class="keyword">if</span> (connectSocket) <span class="string">&quot;å…³é—­è¿æ¥&quot;</span> <span class="keyword">else</span> <span class="string">&quot;è¿æ¥æœåŠ¡&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        binding.btnClientSendMsg.setOnClickListener &#123;</span><br><span class="line">            SocketClient.sendToServer(<span class="string">&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        binding.btnServerSendMsg.setOnClickListener &#123;</span><br><span class="line">            SocketServer.sendToClient(<span class="string">&quot;æœåŠ¡ç«¯å‘é€æ¶ˆæ¯&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getIp</span><span class="params">()</span></span> =</span><br><span class="line">        intToIp((applicationContext.getSystemService(WIFI_SERVICE) <span class="keyword">as</span> WifiManager).connectionInfo.ipAddress)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">intToIp</span><span class="params">(ip: <span class="type">Int</span>)</span></span> =</span><br><span class="line">        <span class="string">&quot;<span class="subst">$&#123;(ip and <span class="number">0xFF</span>)&#125;</span>.<span class="subst">$&#123;(ip shr <span class="number">8</span> and <span class="number">0xFF</span>)&#125;</span>.<span class="subst">$&#123;(ip shr <span class="number">16</span> and <span class="number">0xFF</span>)&#125;</span>.<span class="subst">$&#123;(ip shr <span class="number">24</span> and <span class="number">0xFF</span>)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">receiveClientMsg</span><span class="params">(success: <span class="type">Boolean</span>, msg: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;receiveClientMsg: <span class="variable">$msg</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">receiveServerMsg</span><span class="params">(msg: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;receiveServerMsg: <span class="variable">$msg</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">otherMsg</span><span class="params">(msg: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;otherMsg: <span class="variable">$msg</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>


<p>æœ€ç»ˆå®ç°çš„æ•ˆæœå¦‚ä¸‹</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/socket1.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>è¿è¡Œåä¾æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹æ—¥å¿—<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/socket2.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<hr>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a class="link"   href="https://blog.csdn.net/qq_38436214/article/details/126177462" >Android Socketé€šè®¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡ç®€å•ä»‹ç»äº†Android ä¸­Socket çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶é€šè¿‡ç®€å•çš„ç¤ºä¾‹å¸®åŠ©ç†è§£ã€‚<br>å¯ä»¥å…³æ³¨ä¸‹<a class="link"   href="http://weixin.qq.com/r/kRyxqZbENMtLrdLK90mD" >æˆ‘çš„å…¬ä¼—å· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œæˆ‘ä¼šä¸å®šæ—¶åˆ†äº«æ–‡ç« å’Œå¸®åŠ©è§£å†³é—®é¢˜</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Socket</tag>
      </tags>
  </entry>
  <entry>
    <title>Androidåœ¨MVVMä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¸€äº›æ€è€ƒ</title>
    <url>/2022/12/23/Android%E5%9C%A8MVVM%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/Android%E5%9C%A8MVVM%E4%B8%AD%E4%BD%BF%E7%94%A8%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>äººæ€»æ˜¯åœ¨ä¸æ–­åœ°å­¦ä¹ ä¸­è¿›æ­¥ï¼Œåœ¨å­¦ä¹ äº†è®¾è®¡æ¨¡å¼è¿‡åï¼Œä¸€ç›´æƒ³å°†å…¶ç”¨åˆ°é¡¹ç›®å½“ä¸­ï¼Œå°†å…¶èä¼šè´¯é€šï¼Œä½†æ˜¯å¼ºè¡Œä½¿ç”¨åè€Œä¼šé€‚å¾—å…¶åï¼Œå› æ­¤ï¼Œè¿˜æ˜¯éœ€è¦åœ¨åˆé€‚çš„åœ°æ–¹ä½¿ç”¨ï¼Œæ–¹ä¸ºæ­£é“ã€‚<em>æœ¬æ–‡å°†ä¼šä»‹ç»åœ¨ä¸€ä¸ªfragmentä¸­é€šè¿‡é€‚é…å™¨è®¾è®¡æ¨¡å¼åˆ‡æ¢ä¸åŒçš„viewmodelæ¥å±•ç¤ºä¸åŒçš„æ•°æ®ï¼Œä»¥è¾¾åˆ°æ›¿æ¢viewpager+fragmentçš„æ•ˆæœã€‚</em></p>
<hr>
<h1 id="ä¸€ã€é€‚é…å™¨è®¾è®¡æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä¸€ã€é€‚é…å™¨è®¾è®¡æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä¸€ã€é€‚é…å™¨è®¾è®¡æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä¸€ã€é€‚é…å™¨è®¾è®¡æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>å¦‚æœæˆ‘ä»¬è¦åœ¨æ‰‹æœºå±å¹•ä¸Šå±•ç¤ºå¦‚ä¸‹åˆ—è¡¨ï¼Œå­¦è¿‡Andoridçš„æœ‹å‹éƒ½çŸ¥é“ï¼Œå±•ç¤ºä¸€ä¸ªåˆ—è¡¨éœ€è¦ä½¿ç”¨recycleviewï¼Œç„¶åæ–°å»ºä¸€ä¸ªå¸ƒå±€å±•ç¤ºitemï¼Œç„¶åå°±æ˜¯æˆ‘ä»¬ä»Šå¤©çš„é‡å¤´æˆï¼Œ<strong>adapterï¼ˆé€‚é…å™¨ ï¼‰</strong>ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªadapteræ¥è®²itemå¸ƒå±€å¡«å……åˆ°recycleviewä¸­å¹¶å±•ç¤ºå‡ºæ¥ã€‚</p>
<p>è¿™æ—¶æœ‰çš„æœ‹å‹å°±è¦ç¬‘äº†ï¼Œä½ ä¸ä¼šè·Ÿæˆ‘è¯´è¿™å°±æ˜¯é€‚é…å™¨æ¨¡å¼å§ï¼Ÿé‚£æˆ‘ä¼šäº†ï¼›æ²¡é”™ï¼Œè¿™å°±æ˜¯é€‚é…å™¨æ¨¡å¼ï¼Œé€šè¿‡åˆ‡æ¢ä¸åŒçš„adapterï¼Œä½ å¯ä»¥å±•ç¤ºä¸åŒçš„itemæ•°æ®ï¼Œè¿™å…¶ä¸­recycleviewæ˜¯è¢«é€‚é…è€…ï¼Œæˆ‘ä»¬åˆ›å»ºçš„adapteræ˜¯å…·ä½“çš„é€‚é…ç»™recycleviewçš„å®ç°ï¼Œè€Œæˆ‘ä»¬ç»§æ‰¿çš„ RecyclerView.Adapter<br>åˆ™æ˜¯ä¸€ä¸ªé€šç”¨çš„è§„èŒƒï¼Œå‘Šè¯‰recycleviewæˆ‘ä»¬æ˜¯æ¥é€‚é…çš„ã€‚</p>
<p>å¦‚æœç”¨æ›´é€šä¿—æ˜“æ‡‚çš„è¯æ¥è¯´ï¼Œå°±ç›¸å½“äºä½ å»æ‰¾å·¥ä½œï¼Œç„¶åè·Ÿè€æ¿è¯´æˆ‘è¦é¢è¯•å®‰å“å¼€å‘å·¥ç¨‹å¸ˆï¼Œ<br>è€æ¿å°±æ˜¯è¢«é€‚é…è€…ï¼Œä½ å°±æ˜¯å…·ä½“çš„é€‚é…ï¼Œå®‰å“å¼€å‘å·¥ç¨‹å¸ˆå°±æ˜¯çº¦å®šçš„è§„èŒƒ</p>
<h1 id="äºŒã€MVVMä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼"><a href="#äºŒã€MVVMä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼" class="headerlink" title="äºŒã€MVVMä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼"></a>äºŒã€MVVMä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼</h1><h2 id="1-åŸå› "><a href="#1-åŸå› " class="headerlink" title="1.åŸå› "></a>1.åŸå› </h2><blockquote>
<p>å†å…ˆè¯´ä¸€ä¸‹å“¦ï¼Œä¸è¦å¼ºè¡Œä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œå› ä¸ºé‚£ä¼šæ˜¾å¾—ä½ åœ¨ç‚«æŠ€ã€‚</p>
</blockquote>
<p>æ¥åˆ°ä¸€ä¸ªéœ€æ±‚æ˜¯è¦åœ¨ä¸€ä¸ªfragmentä¸­æ”¾ä¸€å¼ é«˜å¾·åœ°å›¾ï¼Œç„¶ååœ¨åœ°å›¾ä¸­åŠ¨æ€åˆ‡æ¢tabè¿‡åï¼Œåˆ‡æ¢å±•ç¤ºåœ¨åœ°å›¾ä¸Šçš„æ•°æ®ï¼Œæœ¬ç€èƒ½æŠ„ç»ä¸è‡ªå·±å†™çš„å·¥ä½œæ€åº¦ï¼Œæˆ‘åœ¨éœ€æ±‚ä¼šè¿˜æ²¡å¼€çš„æ—¶å€™ï¼Œå°±åœ¨çœ‹éš”å£ä¸šåŠ¡ç»„çš„è¿™ä¸ªéœ€æ±‚æ˜¯æ€ä¹ˆå†™çš„äº†ï¼Œç„¶åæˆ‘å°±æ„Ÿå—åˆ°äº†éš”å£ä¸šåŠ¡ç»„å¯¹è¿™ä¸ªä¸–ç•Œæ·±æ·±çš„æ¶æ„ï¼Œå…ˆè¯´ä¸‹ä»–ä»¬çš„å®ç°å§ï¼Œå±å¹•ä¸Šæ–¹æ˜¯ä¸€ä¸ªtablayoutï¼Œä¸‹æ–¹æ˜¯ä¸ªviewpagerï¼Œå¸¦äº†6ä¸ªæ¨¡å—çš„fragmentï¼Œç„¶åæ¯ä¸€ä¸ªfragmentéƒ½æ˜¯ç›¸åŒçš„åœ°å›¾é€»è¾‘å’Œå¸ƒå±€ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å±•ç¤ºæ•°æ®ä¸åŒï¼Œç­›é€‰é¡¹ä¸åŒï¼Œæ¯ä¸€ä¸ªfragmentè¾¾åˆ°äº†æƒŠäººçš„3000+è¡Œçš„ä»£ç é‡ï¼Œé€šç¯‡éƒ½æ˜¯é‡å¤çš„é€»è¾‘å’Œä»¤äººæ˜æ˜æ¬²ç¡çš„ä»£ç ï¼Œæˆ‘çœ‹äº†åŠä¸ªå°æ—¶å°±å›°çš„ä¸è¡Œäº†ï¼Œé†’æ¥è¿‡åé•¿å¹æ¯ä»¥æ©æ³£å…®ï¼Œè¿˜æ˜¯è‡ªå·±å†™å§ï¼›åœ¨è¿™ä¸ªéœ€æ±‚çš„èƒŒæ™¯ä¸‹ä½¿ç”¨è¿™ä¸ªå†™æ³•ï¼Œæˆ‘åªèƒ½è¯´è„‘è¢‹è¢«é—¨å¤¹äº†ã€‚äºæ˜¯å°±æƒ³åˆ°äº†ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ã€‚æ¯•ç«Ÿï¼ŒçœŸçš„åªæœ‰å±•ç¤ºçš„æ•°æ®å’Œç­›é€‰é¡¹ä¸åŒï¼ŒUIéƒ½æ˜¯å¤§åŒå°å¼‚çš„ï¼Œèƒ½ç”¨ä¸€ä¸ªå¸ƒå±€ä¸ºä»€ä¹ˆè¦ç”¨å…­ä¸ªå‘¢ï¼Œæ˜¯å§</p>
<h2 id="2-å®ç°"><a href="#2-å®ç°" class="headerlink" title="2.å®ç°"></a>2.å®ç°</h2><p>æ•²å®šäº†ä½¿ç”¨çš„æ–¹æ³•è¿‡åï¼Œå°±æ˜¯è®¾è®¡çš„é˜¶æ®µäº†ï¼Œå› ä¸ºé¡¹ç›®æ˜¯MVVMçš„ï¼Œæœ€ç»ˆæ•²å®šå¯¹viewmodelä¸‹æ‰‹ï¼Œå› ä¸ºviewmodelå°±æ˜¯å¯¹æ•°æ®çš„å¤„ç†ï¼Œè€Œæˆ‘ä»¬æ­£å¥½å·®å¼‚å°±åœ¨æ•°æ®å±‚ï¼Œå› æ­¤æˆ‘æ–°åˆ›å»ºäº†ä¸€ä¸ªå®ä½“ç±»</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MapEntity</span> &#123;</span><br><span class="line">    <span class="comment">//åŒºåŸŸç¼–å·</span></span><br><span class="line">    <span class="keyword">var</span> areaCode = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment">//åŒºåŸŸåç§°</span></span><br><span class="line">    <span class="keyword">var</span> areaNames = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment">//çº¬åº¦</span></span><br><span class="line">    <span class="keyword">var</span> latitude = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment">//ç»åº¦</span></span><br><span class="line">    <span class="keyword">var</span> longitude = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment">//ç»Ÿè®¡æ•°é‡</span></span><br><span class="line">    <span class="keyword">var</span> mapCount = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> dataList : List&lt;Any&gt; = emptyList()</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™é‡Œçš„dataListå°±æ˜¯æˆ‘å‡†å¤‡ç”¨æ¥å±•ç¤ºçš„æ•°æ®ï¼Œä½†æ˜¯å› ä¸ºæ¯ä¸€ä¸ªæ•°æ®ç±»å‹éƒ½æœ‰å·®å¼‚ï¼Œæ‰€ä»¥æ²¡æœ‰å£°æ˜å…·ä½“çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ä½¿ç”¨Anyä»£æ›¿ã€‚<br>ç„¶åå®šä¹‰ä¸€ä¸ªå®‰å“å¼€å‘å·¥ç¨‹å¸ˆçš„èŒä½ï¼›ï¼ˆæ–°å»ºä¸€ä¸ªviewmodelçš„æ¥å£ï¼‰ï¼Œç±»ä¼¼å¦‚ä¸‹</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IBaseMapViewModel</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getList: MutableLiveData&lt;List&lt;Any&gt;&gt;</span><br><span class="line">        <span class="keyword">get</span>() = MutableLiveData&lt;List&lt;Any&gt;&gt;()</span><br><span class="line">        <span class="keyword">set</span>(value) = TODO()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> isEmpty: MutableLiveData&lt;<span class="built_in">Boolean</span>&gt;</span><br><span class="line">        <span class="keyword">get</span>() = MutableLiveData()</span><br><span class="line">        <span class="keyword">set</span>(value) = TODO()</span><br><span class="line">    <span class="keyword">var</span> loading: MutableLiveData&lt;<span class="built_in">Boolean</span>&gt;</span><br><span class="line">        <span class="keyword">get</span>() = MutableLiveData()</span><br><span class="line">        <span class="keyword">set</span>(value) = TODO()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">var</span> hintString : String</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> type : <span class="built_in">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> drawable : <span class="built_in">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> drawableClick : <span class="built_in">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getMapData</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        botRightLat: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        botRightLon: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        categoryNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        industryNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        thirdCategoryNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        keyWord: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        searchType: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        topLeftLat: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        topLeftLon: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        context: <span class="type">Context</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        distance: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        mCenterLatLng: <span class="type">LatLng</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        employmentStatus: <span class="type">String</span>,<span class="comment">//ç”¨å·¥çŠ¶æ€</span></span></span></span><br><span class="line"><span class="params"><span class="function">        proficiency: <span class="type">String</span>, <span class="comment">//ä¸“ä¸šèŒçº§ 	ç†Ÿç»ƒåº¦ï¼ˆä¸“ä¸šèŒçº§ 1:é«˜çº§å·¥(å¤§å·¥) 2:ä¸­çº§å·¥(ä¸­å·¥) 3:åˆçº§å·¥(å°å·¥)ï¼‰</span></span></span></span><br><span class="line"><span class="params"><span class="function">        workYear: <span class="type">String</span>, <span class="comment">//å·¥é¾„ 1-3ä¼ 1 3-5ä¼ 2 5-10ä¼ 3 10ä»¥ä¸Šä¼ 4</span></span></span></span><br><span class="line"><span class="params"><span class="function">        qualificationTypeNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        qualificationClassNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        teamNumber: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        businessType : <span class="type">String</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æˆéƒ½æˆ¿å»ºæ°´æ³¥å·¥æˆéƒ½æˆ¿å»ºæ°´â€¦ 2.2w/æœˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getMarkerText</span><span class="params">(item: <span class="type">MapEntity</span>)</span></span>:String</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç­‰12ä»½å·¥ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getMarkerNum</span><span class="params">(item: <span class="type">MapEntity</span>,isProvince:<span class="type">Boolean</span>)</span></span>:String</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getUrlSetting</span><span class="params">( id:<span class="type">String</span>,  type:<span class="type">Int</span>,  modelType:<span class="type">String</span>, userNo:<span class="type">String</span>, context: <span class="type">Context</span>)</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªæŠ½è±¡çš„viemodelä¸­æˆ‘ä»¬çš„å…¥å‚åŒ…å«äº†MapEntityï¼›å†çœ‹getMapDataæ–¹æ³•çš„å…¥å‚å¯èƒ½ä¼šæœ‰ç‚¹å¤šï¼Œè¿™æ˜¯å› ä¸ºä»–åŒ…å«äº†æ‰€æœ‰å…­ä¸ªé¡µé¢çš„ç­›é€‰é¡¹ï¼Œè¿™ä¹Ÿç®—æ˜¯é€‚é…å™¨æ¨¡å¼çš„ä¸€ç§ç¼ºç‚¹å§</p>
<p>ç„¶åå°±æ˜¯åˆ›å»ºâ€œä½ â€è¿™æ ·ä¸€ä¸ªviemodelå•¦</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MapViewModel</span> () : BaseViewModel(), IBaseMapViewModel &#123;</span><br></pre></td></tr></table></figure></div>
<p>å®ç°IBaseMapViewModelä¸­çš„æ¥å£ï¼Œå¹¶å…·ä½“çš„å¤„ç†æ¯ä¸ªæ•°æ®å®ä½“ç±»çš„å±•ç¤ºï¼Œè¿™æ ·çš„å…·ä½“ä¸šåŠ¡viewmodelï¼Œæˆ‘ä¸€å…±åˆ›å»ºäº†å…­ä¸ªï¼</p>
<p>æœ€åæ€ä¹ˆä½¿ç”¨è¿™äº›å…·ä½“çš„viewmodelå‘¢ï¼Œåœ¨fragmentä¸­ï¼Œå…ˆå®šä¹‰æŠ½è±¡çš„viewmodel</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åœ°å›¾viewmodel</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> viewModel: IBaseMapViewModel</span><br></pre></td></tr></table></figure></div>

<p>ç„¶åé€šè¿‡tablayoutç‚¹å‡»ä¸åŒçš„positionæ¥åˆå§‹åŒ–ä¸åŒçš„viewmodel</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">when</span> (selectSecondTap) &#123;</span><br><span class="line">           xxxxType -&gt; &#123;</span><br><span class="line">               viewModel = MapViewModel()</span><br><span class="line">           &#125;</span><br><span class="line">          </span><br><span class="line">          ......</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œæœ‰ä¸ªå‘å°±æ˜¯observeåœ¨æ¯æ¬¡é‡æ–°åˆå§‹åŒ–viewmodelåä¹Ÿè¦é‡æ–°åˆå§‹åŒ–ï¼Œä¸ç„¶å°±ä¼šå¾—ä¸åˆ°è¯·æ±‚åçš„æ•°æ®</p>
<hr>
<h1 id="è¿™æ ·ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹çš„æ€»ç»“"><a href="#è¿™æ ·ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹çš„æ€»ç»“" class="headerlink" title="è¿™æ ·ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹çš„æ€»ç»“"></a>è¿™æ ·ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹çš„æ€»ç»“</h1><p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å‡å°‘äº†ä»£ç é‡ï¼Œç¼©å‡äº†fragmentçš„ä»£ç é‡ï¼Œä»3000+è¡Œç¼©å‡åˆ°äº†1000+è¡Œ</li>
<li>ä»£ç æ›´æ¸…æ™°ï¼ŒåŸºæœ¬ä¸Šåªæœ‰åˆ‡æ¢viewmodelçš„æ—¶å€™æ‰æœ‰åˆ¤æ–­ï¼Œå…¶ä»–éƒ½æ˜¯å®æ‰“å®çš„ä¸šåŠ¡ä»£ç </li>
<li>å‡å°‘ç»´æŠ¤æˆæœ¬ï¼Œå¦‚æœè¦åœ¨å…­ä¸ªçš„åŸºç¡€ä¸Šå†æ–°å¢æ•°æ®å±•ç¤ºåªéœ€è¦å†åŠ ä¸€ä¸ªviewmodelå’Œ é€»è¾‘åˆ¤æ–­ï¼Œéå¸¸æ–¹ä¾¿</li>
</ul>
<p> ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¸åŒçš„åœ°æ–¹è¦åšé¢å¤–çš„å¤„ç†ï¼Œå¦‚æœä¸å†™æ³¨é‡Šï¼Œé‚£ä¸€å—ä»£ç çœ‹ç€å°±æ¯”è¾ƒå“äººäº†ï¼ˆä¾‹å¦‚getMapDataçš„å…¥å‚ï¼‰</li>
<li>å¦‚æœéœ€æ±‚å‡ºç°å·¨å¤§å˜æ›´ï¼Œä¾‹å¦‚ä¸åŒçš„æ•°æ®è¦é‡‡ç”¨ä¸åŒçš„è¡¨ç°æ–¹å¼ï¼Œå°±è¦æ¨å€’é‡å†™æˆ–è€…æ–°å¢å¾ˆå¤šæ— æ„ä¹‰çš„æ¥å£ï¼Œè®©å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§å˜å¾—å¾ˆå·®</li>
</ul>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>Andserver é…ç½®æœ¬åœ°æ–‡ä»¶æµè§ˆå™¨å®ç°webviewå±•ç°æœ¬åœ°å›¾ç‰‡</title>
    <url>/2022/05/11/Andserver-%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%9E%E7%8E%B0webview%E5%B1%95%E7%8E%B0%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/Andserver-%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%B5%8F%E8%A7%88%E5%99%A8%E5%AE%9E%E7%8E%B0webview%E5%B1%95%E7%8E%B0%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨å®‰å“çš„vueçš„æœ¬åœ°é¡µé¢ä¸ŠåŠ è½½æœ¬åœ°çš„å›¾ç‰‡ï¼Œè€Œä¸æ˜¯ç½‘ç»œå›¾ç‰‡ï¼Œè¿™æ ·å½“è®¾å¤‡æ²¡æœ‰ç½‘ç»œçš„æ—¶å€™å›¾ç‰‡ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œå› ä¸ºé¡¹ç›®ä½¿ç”¨çš„æ˜¯andserver+webviewè¿™ç§é¡¹ç›®ç»“æ„ï¼Œç”¨Andserveræ¥è§£å†³è¿™ä¸ªé—®é¢˜æœ€å¥½ä¸è¿‡ï¼›å¤§æ¦‚çš„æ€è·¯å°±æ˜¯å…ˆå°†éœ€è¦åŠ è½½çš„ç½‘ç»œå›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åé€šè¿‡andserveræä¾›çš„WebConfigå¢åŠ ä¸€ä¸ªç±»ä¼¼æœ¬åœ°çš„æ–‡ä»¶æµè§ˆå™¨é™æ€ç½‘ç«™ï¼Œå½“ä½ çš„æœ¬åœ°ç«¯å£è®¿é—®è¯¥è·¯å¾„æ—¶å°±å¯ä»¥åŠ è½½å‡ºä¿å­˜å¥½çš„æœ¬åœ°å›¾ç‰‡ï¼›</p>
<hr>
<h1 id="ä¸€ã€å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°"><a href="#ä¸€ã€å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°" class="headerlink" title="ä¸€ã€å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°"></a>ä¸€ã€å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°</h1><p>å°è£…ä¸€ä¸ªå†™å¥½äº†çš„ä¸‹è½½ç½‘ç»œå›¾ç‰‡çš„å·¥å…·ç±»</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.os.AsyncTask;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aw.ccpos.client.Client;</span><br><span class="line"><span class="keyword">import</span> com.aw.ccpos.client.logger.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.HttpsURLConnection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span> : xxxx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : yifeng_zeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span> : 2022/2/18 14:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : ä¿å­˜ç½‘ç»œå›¾ç‰‡åˆ°å®‰å“æœ¬åœ°å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NetworkImageUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;NetworkImageUtil&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> Bitmap bitmap;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">corePoolSize</span> <span class="operator">=</span> <span class="number">60</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maximumPoolSize</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">keepAliveTime</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Runnable&gt; workQueue = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;(maximumPoolSize);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Executor</span> <span class="variable">threadPoolExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(corePoolSize, maximumPoolSize, keepAliveTime, TimeUnit.SECONDS, workQueue);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> NetworkImageUtil instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> NetworkImageUtil <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>)&#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">NetworkImageUtil</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * params &quot;/fs/img/2494831762213019.çŒ´å¤´è‡.jpeg&quot;</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveImage</span><span class="params">(String... params)</span>&#123;</span><br><span class="line">        <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Task</span>();</span><br><span class="line">        task.executeOnExecutor(threadPoolExecutor,params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç½‘ç»œå›¾ç‰‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageurl å›¾ç‰‡ç½‘ç»œåœ°å€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Bitmap è¿”å›ä½å›¾</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Bitmap <span class="title function_">getImageInputStream</span><span class="params">(String imageurl)</span>&#123;</span><br><span class="line">        <span class="type">HttpsURLConnection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        Bitmap bitmap=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(imageurl);</span><br><span class="line">            Logger.d(TAG, <span class="string">&quot;download image with url: &quot;</span> +  url);</span><br><span class="line">            connection = (HttpsURLConnection) url.openConnection();</span><br><span class="line">            connection.setSSLSocketFactory(HttpsUtils.getSslSocketFactory(<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>));</span><br><span class="line">            connection.connect();</span><br><span class="line">            <span class="comment">// expect HTTP 200 OK, so we don&#x27;t mistakenly save error</span></span><br><span class="line">            <span class="comment">// report</span></span><br><span class="line">            <span class="comment">// instead of the file</span></span><br><span class="line">            <span class="keyword">if</span> (connection.getResponseCode() != HttpURLConnection.HTTP_OK) &#123;</span><br><span class="line">                Logger.e(TAG, <span class="string">&quot;Server returned HTTP &quot;</span>+connection.getResponseCode() + <span class="string">&quot; &quot;</span></span><br><span class="line">                        + connection.getResponseMessage() );</span><br><span class="line">            &#125;</span><br><span class="line">            InputStream inputStream=connection.getInputStream();</span><br><span class="line">            bitmap= BitmapFactory.decodeStream(inputStream);</span><br><span class="line">            inputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bitmap;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜ä½å›¾åˆ°æœ¬åœ°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bitmap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path æœ¬åœ°è·¯å¾„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveImage</span><span class="params">(Bitmap bitmap, String path)</span>&#123;</span><br><span class="line"><span class="comment">//        File file=new File(path);</span></span><br><span class="line">        FileOutputStream fileOutputStream=<span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒ</span></span><br><span class="line"><span class="comment">//        if (!file.exists()) &#123;</span></span><br><span class="line"><span class="comment">//            file.mkdirs();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileOutputStream=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;/sdcard/image&quot;</span>+path);</span><br><span class="line">            bitmap.compress(Bitmap.CompressFormat.JPEG, <span class="number">100</span>,fileOutputStream);</span><br><span class="line">            fileOutputStream.close();</span><br><span class="line">            Logger.d(TAG, <span class="string">&quot;SavaImage: success: &quot;</span>+path);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Logger.e(TAG, <span class="string">&quot;SavaImage: fail: &quot;</span>+path);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼‚æ­¥çº¿ç¨‹ä¸‹è½½å›¾ç‰‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">extends</span> <span class="title class_">AsyncTask</span>&lt;String, Integer, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> String <span class="title function_">doInBackground</span><span class="params">(String... params)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (bitmap!=<span class="literal">null</span>)&#123;</span><br><span class="line">                bitmap=<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            bitmap=NetworkImageUtil.getInstance().getImageInputStream((String)params[<span class="number">0</span>]);</span><br><span class="line">            NetworkImageUtil.getInstance().saveImage(bitmap, (String)params[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPostExecute</span><span class="params">(String result)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>æ³¨é‡Šå†™çš„æŒºè¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°ï¼Œç®€å•æä¸‹HttpsUtilsæ˜¯å°è£…çš„ä¸€ä¸ªHttpsUtilsçš„å·¥å…·ç±»ï¼Œæœ‰éœ€è¦å¯ä»¥å»æˆ‘çš„è¿™ç¯‡æ–‡ç« é‡Œå»æ‰¾ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç¯‡ä½¿ç”¨andserverçš„æ–‡ç« ï¼Œä¾§é‡ç‚¹ä¸ä¸€æ ·ï¼Œå¦‚æœä½ çš„ç½‘ç»œå›¾ç‰‡æ˜¯httpçš„ï¼Œå½“æˆ‘æ²¡è¯´ã€‚<br> é“¾æ¥:æ–‡ç« åœ°å€ <a class="link"   href="https://blog.csdn.net/shop_and_sleep/article/details/122057541?spm=1001.2014.3001.5502" >andriod andserver å…¨å±€è½¬å‘ä»£ç†ï¼ˆéƒ¨åˆ†æ¥å£åœ¨æœ¬åœ°ï¼‰çš„å®ç°æ€è·¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</p>
<h1 id="äºŒã€Andserver-çš„æœ¬åœ°æ–‡ä»¶æµè§ˆå™¨"><a href="#äºŒã€Andserver-çš„æœ¬åœ°æ–‡ä»¶æµè§ˆå™¨" class="headerlink" title="äºŒã€Andserver çš„æœ¬åœ°æ–‡ä»¶æµè§ˆå™¨"></a>äºŒã€Andserver çš„æœ¬åœ°æ–‡ä»¶æµè§ˆå™¨</h1><h2 id="1-Andserver-çš„WebConfigä¸-Config"><a href="#1-Andserver-çš„WebConfigä¸-Config" class="headerlink" title="1.Andserver çš„WebConfigä¸@Config"></a>1.Andserver çš„WebConfigä¸@Config</h2><p>å€Ÿç”¨andserveræ–‡æ¡£çš„è§£é‡Šï¼š<br>æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸ªæœºå™¨ä¸Šå¯ä»¥éƒ¨ç½²å¤šä¸ª Web Serverï¼Œæ¯ä¸ª WebServer å¯ä»¥æœ‰ä¸åŒçš„é…ç½®ï¼ŒåŒæ ·çš„ AndServer ä¹Ÿæä¾›äº†è¿™æ ·çš„èƒ½åŠ›ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨Configæ³¨è§£æ¥æ ‡è®°æŸä¸ªç±»æ˜¯ Server çš„é…ç½®ç±»ï¼Œè¿™ä¸ªé…ç½®æ€»ä¸èƒ½çå†™å§ï¼Ÿæ‰€ä»¥Configæ³¨è§£çš„ç±»éœ€è¦å®ç°WebConfigæ¥å£ï¼ŒWebConfigæ¥å£ç”¨æ¥ç»Ÿä¸€æä¾›é…ç½®çš„ APIã€‚<br>ä»£ç å¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Config</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> <span class="keyword">implements</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfig</span><span class="params">(Context context, Delegate delegate)</span> &#123;</span><br><span class="line">        <span class="comment">// å¢åŠ ä¸€ä¸ªé™æ€ç½‘ç«™</span></span><br><span class="line">        delegate.addWebsite(<span class="keyword">new</span> <span class="title class_">AssetsWebsite</span>(context, <span class="string">&quot;/web&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰é…ç½®è¡¨å•è¯·æ±‚å’Œæ–‡ä»¶ä¸Šä¼ çš„æ¡ä»¶</span></span><br><span class="line">        delegate.setMultipart(Multipart.newBuilder()</span><br><span class="line">            .allFileMaxSize(<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">20</span>) <span class="comment">// å•ä¸ªè¯·æ±‚ä¸Šä¼ æ–‡ä»¶æ€»å¤§å°</span></span><br><span class="line">            .fileMaxSize(<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">5</span>) <span class="comment">// å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å¤§å°</span></span><br><span class="line">            .maxInMemorySize(<span class="number">1024</span> * <span class="number">10</span>) <span class="comment">// ä¿å­˜ä¸Šä¼ æ–‡ä»¶æ—¶bufferå¤§å°</span></span><br><span class="line">            .uploadTempDir(<span class="keyword">new</span> <span class="title class_">File</span>(context.getCacheDir(), <span class="string">&quot;_server_upload_cache_&quot;</span>)) <span class="comment">// æ–‡ä»¶ä¿å­˜ç›®å½•</span></span><br><span class="line">            .build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªé™æ€çš„ç½‘ç«™ï¼Œé€šè¿‡æœ¬åœ°çš„ç«¯å£å†åŠ ä¸Š&#x2F;webå°±å¯ä»¥è®¿é—®äº†ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚ä½†æˆ‘ä»¬å·²ç»çŸ¥é“é€šè¿‡addWebsiteï¼ŒæŠ€èƒ½éƒ¨ç½²ä¸€ä¸ªé™æ€ç½‘ç«™äº†ï¼Œé‚£ä¹ˆé™æ€æ–‡ä»¶æµè§ˆå™¨å°±ä¸å†é¥è¿œã€‚<br>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯å› ä¸ºSDå¡ä¹Ÿæ˜¯ç£ç›˜ï¼Œæ‰€ä»¥è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ã€‚</p>
<p>æ³¨æ„ï¼šFileBrowseræ”¯æŒçƒ­æ’æ‹”ã€‚</p>
<h2 id="2-FileBrowseï¼ˆæ–‡ä»¶æµè§ˆå™¨ï¼‰"><a href="#2-FileBrowseï¼ˆæ–‡ä»¶æµè§ˆå™¨ï¼‰" class="headerlink" title="2.FileBrowseï¼ˆæ–‡ä»¶æµè§ˆå™¨ï¼‰"></a>2.FileBrowseï¼ˆæ–‡ä»¶æµè§ˆå™¨ï¼‰</h2><p>åœ¨andserverçš„æ—§ç‰ˆæ–‡æ¡£ä¸­ï¼Œæˆ‘å‘ç°äº†æˆ‘éœ€è¦çš„ä¸œè¥¿<br>FileBrowseå¯ä»¥éƒ¨ç½²SDå¡ä¸­çš„å†…å®¹ä¾›åˆ«äººä»¥æ–‡ä»¶çš„å½¢å¼æµè§ˆã€‚å¹¶ä¸”å®ƒè¿˜æ”¯æŒæ”¯æŒçƒ­æ’æ‹”ã€‚</p>
<p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ç¤ºä¾‹ä»£ç ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Config</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AndServerConfig</span> <span class="keyword">implements</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">localImageUrl</span> <span class="operator">=</span> <span class="string">&quot;/sdcard/image/fs/img/&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onConfig</span><span class="params">(Context context, Delegate delegate)</span> &#123;</span><br><span class="line">        File file=<span class="keyword">new</span> <span class="title class_">File</span>(localImageUrl);</span><br><span class="line">        <span class="comment">//æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒ</span></span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            file.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶æµè§ˆå™¨ç½‘ç«™</span></span><br><span class="line">        delegate.addWebsite(<span class="keyword">new</span> <span class="title class_">FileBrowser</span>(<span class="string">&quot;/sdcard/image/&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è·¯å¾„è¯´æ˜<br>ä¾‹å¦‚æˆ‘ä»¬æŠŠ&#x2F;sdcardç›®å½•ä½œä¸ºéƒ¨ç½²ç›®å½•ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬åœ¨æŸä¸ªæ‰‹æœºä¸Šéƒ¨ç½²new FileBrowse(â€œ&#x2F;sdcardâ€);ç›®å½•ï¼Œè¿™ä¸ªæ‰‹æœºçš„æœ¬æœºå±€åŸŸç½‘IPæ˜¯192.168.1.11ï¼Œæˆ‘ä»¬æŒ‡å®šAndServerç›‘å¬çš„ç«¯å£æ˜¯8080ã€‚</p>
<p>å½“ç”¨æˆ·åœ¨åœ°å€æ è¾“å…¥<a href="http://192.168.1.11:8080æ—¶å¹¶è®¿é—®åï¼Œç”¨æˆ·å°†çœ‹åˆ°ä¸€ä¸ªç½‘é¡µï¼Œç½‘é¡µä¸Šé¢ä¼šåˆ—å‡º/sdcardä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶ä¸”åœ¨æ–‡ä»¶å’Œç›®å½•ä¸ŠåŠ ä¸Šè¶…é“¾æ¥ã€‚å½“ç”¨æˆ·ç‚¹å‡»æ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šç›´æ¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶æˆ–è€…è®©ç”¨æˆ·ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ï¼›å½“ç”¨æˆ·ç‚¹å‡»ç›®å½•æ—¶ï¼Œç”¨æˆ·å°†ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°é¡µé¢ä¸­åˆ—å‡ºäº†ä»–ç‚¹å‡»çš„ç›®å½•ä¸­çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ã€‚">http://192.168.1.11:8080æ—¶å¹¶è®¿é—®åï¼Œç”¨æˆ·å°†çœ‹åˆ°ä¸€ä¸ªç½‘é¡µï¼Œç½‘é¡µä¸Šé¢ä¼šåˆ—å‡º/sdcardä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œå¹¶ä¸”åœ¨æ–‡ä»¶å’Œç›®å½•ä¸ŠåŠ ä¸Šè¶…é“¾æ¥ã€‚å½“ç”¨æˆ·ç‚¹å‡»æ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šç›´æ¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶æˆ–è€…è®©ç”¨æˆ·ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ï¼›å½“ç”¨æˆ·ç‚¹å‡»ç›®å½•æ—¶ï¼Œç”¨æˆ·å°†ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°é¡µé¢ä¸­åˆ—å‡ºäº†ä»–ç‚¹å‡»çš„ç›®å½•ä¸­çš„æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶ã€‚</a></p>
<hr>
<p>è‡³æ­¤ï¼ŒAndserver é…ç½®æœ¬åœ°æ–‡ä»¶æµè§ˆå™¨å®ç°webviewå±•ç°æœ¬åœ°å›¾ç‰‡çš„åŸºæœ¬åŠŸèƒ½å¤§æ¦‚éƒ½å®ç°äº†ï¼Œå¦‚æœæƒ³è¦å®ç°å…¶ä»–çš„é…ç½®ï¼Œä¾‹å¦‚åŠ è½½Assetsç›®å½•ä¸‹çš„é™æ€ç½‘ç«™,Sdcardä¸‹çš„é™æ€ç½‘ç«™ï¼Œä½ å¯ä»¥ç…§çŒ«ç”»è™</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½Assetsç›®å½•</span></span><br><span class="line">delegate.addWebsite(<span class="keyword">new</span> <span class="title class_">AssetsWebsite</span>(context, <span class="string">&quot;assets/web/website&quot;</span>));</span><br><span class="line"><span class="comment">//Sdcard</span></span><br><span class="line">delegate.addWebsite(<span class="keyword">new</span> <span class="title class_">StorageWebsite</span>(<span class="string">&quot;/sdcard/andserver/website&quot;</span>));</span><br></pre></td></tr></table></figure></div>
<p>ç”šè‡³äºè‡ªå®šä¹‰çš„httpè·¯å¾„çš„é™æ€ç½‘ç«™</p>
<h1 id="ä¸‰ã€Andserver-çš„è‡ªå®šä¹‰ç½‘ç«™"><a href="#ä¸‰ã€Andserver-çš„è‡ªå®šä¹‰ç½‘ç«™" class="headerlink" title="ä¸‰ã€Andserver çš„è‡ªå®šä¹‰ç½‘ç«™"></a>ä¸‰ã€Andserver çš„è‡ªå®šä¹‰ç½‘ç«™</h1><p>å¦‚æœAndServerè‡ªå¸¦çš„ç½‘ç«™ä¸å¤Ÿç”¨æˆ–è€…å’Œå¼€å‘è€…çš„éœ€æ±‚æœ‰å‡ºå…¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç½‘ç«™ã€‚</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWeibsite</span> implement Website &#123;</span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">delegate.addWebsite(<span class="keyword">new</span> <span class="title class_">MyWeibsite</span> ());</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>å®ç°Websiteæ¥å£ï¼Œæˆ–è€…ç»§æ‰¿SimpleWebsiteåŸºç±»ï¼Œç„¶åæ·»åŠ è¿›å»ï¼ŒçœŸçš„å°±æ˜¯ä½ æƒ³çš„é‚£ä¹ˆç®€å•</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Andserver</tag>
      </tags>
  </entry>
  <entry>
    <title>ComposeDesktopå®æˆ˜å®å¯æ¢¦å›¾é‰´</title>
    <url>/2023/06/14/ComposeDesktop%E5%AE%9E%E6%88%98%E5%AE%9D%E5%8F%AF%E6%A2%A6%E5%9B%BE%E9%89%B4/ComposeDesktop%E5%AE%9E%E6%88%98%E5%AE%9D%E5%8F%AF%E6%A2%A6%E5%9B%BE%E9%89%B4/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>  é˜…è¯»æœ¬æ–‡éœ€è¦ä¸€å®šcomposeåŸºç¡€ï¼Œå¦‚æœæ²¡æœ‰è¯·ç§»æ­¥<a class="link"   href="https://blog.csdn.net/shop_and_sleep/article/details/124569994?spm=1001.2014.3001.5501" >Jetpack Composeå…¥é—¨è¯¦è§£ï¼ˆå®æ—¶æ›´æ–°ï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>æ¥å£æ•°æ®æ¥æºäº<a class="link"   href="https://pokeapi.co/" >pokeapi <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h2 id="é¡¹ç›®æºä»£ç å¦‚æœä½ è§‰å¾—ä¸é”™ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªstarï¼ŒTHKS"><a href="#é¡¹ç›®æºä»£ç å¦‚æœä½ è§‰å¾—ä¸é”™ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªstarï¼ŒTHKS" class="headerlink" title="é¡¹ç›®æºä»£ç å¦‚æœä½ è§‰å¾—ä¸é”™ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªstarï¼ŒTHKS"></a><a class="link"   href="https://github.com/zyf-good/pokemon2/tree/master" >é¡¹ç›®æºä»£ç  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>å¦‚æœä½ è§‰å¾—ä¸é”™ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªstarï¼ŒTHKS</h2><h1 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h1><p>é—²è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ç°æ•ˆæœ<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/desktop.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªéå¸¸ç®€æ´çš„å®å¯æ¢¦å›¾é‰´ï¼Œå±•ç¤ºäº†æ‰€æœ‰ä¸–ä»£çš„å®å¯æ¢¦ï¼Œå¹¶æä¾›äº†æœç´¢ï¼Œä¸å®å¯æ¢¦å›¾é‰´appçš„UIæœ‰äº†ä¸€äº›å˜åŒ–ã€‚</p>
<hr>
<h1 id="ä¸€ã€æ¶æ„ä»‹ç»"><a href="#ä¸€ã€æ¶æ„ä»‹ç»" class="headerlink" title="ä¸€ã€æ¶æ„ä»‹ç»"></a>ä¸€ã€æ¶æ„ä»‹ç»</h1><p>å¦‚å›¾ï¼Œå±•ç¤ºäº†ä¸»è¦çš„ä¸€äº›æ–‡ä»¶ï¼š<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image111.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>æœ¬é¡¹ç›®æ²¡æœ‰é€‚é…å®‰å“ç«¯ï¼ŒiOSç«¯å’Œwebç«¯ï¼ˆå¦‚æœæœ‰ä¹äºå¼€æºçš„å°ä¼™ä¼´å¯ä»¥è”ç³»æˆ‘ï¼‰ï¼Œå› æ­¤æ‰€æœ‰æ ¸å¿ƒä»£ç éƒ½åœ¨desktopä¸­</p>
<ul>
<li>http  - æ¥å£ </li>
<li>util -å·¥å…·ç±»</li>
<li>ui -Composeç»„ä»¶           </li>
<li>viewmodels - viewmodel</li>
</ul>
<h1 id="äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»"><a href="#äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»" class="headerlink" title="äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»"></a>äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»</h1><h2 id="PreCompose"><a href="#PreCompose" class="headerlink" title="PreCompose"></a>PreCompose</h2><p>é€šè¿‡<a class="link"   href="https://github.com/Tlaster/PreCompose" >PreCompose <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>        è¿™ä¸ªä¸‰æ–¹åº“ï¼Œå¯ä»¥åƒå†™appä¸€æ ·å†™desktopï¼Œå½“ç„¶è¿™é‡Œé¢æœ‰ä¸€äº›ä¸appä½¿ç”¨æœ‰äº›å·®åˆ«</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.DpSize       </span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.window.application</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.window.rememberWindowState</span><br><span class="line"><span class="keyword">import</span> moe.tlaster.precompose.PreComposeWindow</span><br><span class="line"><span class="keyword">import</span> ui.FullScreenView</span><br><span class="line"><span class="keyword">import</span> util.EnvUtil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> = application &#123;</span><br><span class="line">    <span class="keyword">val</span> windowState = rememberWindowState(size = DpSize(AppConfig.windowMinWidth, AppConfig.windowMinHeight))</span><br><span class="line">    PreComposeWindow(</span><br><span class="line">        state = windowState,</span><br><span class="line">        onCloseRequest = ::exitApplication,</span><br><span class="line">        undecorated = EnvUtil.isWindows(),</span><br><span class="line">        title = <span class="string">&quot;&quot;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">//window.minimumSize = Dimension(AppConfig.windowMinWidth.value.toInt(), AppConfig.windowMinHeight.value.toInt())</span></span><br><span class="line">        window.rootPane.apply &#123;</span><br><span class="line">            rootPane.putClientProperty(<span class="string">&quot;apple.awt.fullWindowContent&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">            rootPane.putClientProperty(<span class="string">&quot;apple.awt.transparentTitleBar&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">            rootPane.putClientProperty(<span class="string">&quot;apple.awt.windowTitleVisible&quot;</span>, <span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        FullScreenView()</span><br><span class="line">        <span class="comment">//CpnWindowsPlaformDecoratedButtons(windowState)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>PreComposeWindowå°±æ˜¯å¿…å¤‡çš„ï¼Œä¸ç„¶åç»­ä½¿ç”¨æ‰€æœ‰çš„ä¸PreComposeç›¸å…³çš„éƒ½ä¼šæŠ¥é”™<br>ä¾‹å¦‚åˆå§‹åŒ–viewmodel</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> moe.tlaster.precompose.ui.viewModel  </span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> viewModel  = viewModel &#123; PokemonListViewModel() &#125;</span><br></pre></td></tr></table></figure></div>


<h2 id="åŠ è½½ç½‘ç»œå›¾ç‰‡"><a href="#åŠ è½½ç½‘ç»œå›¾ç‰‡" class="headerlink" title="åŠ è½½ç½‘ç»œå›¾ç‰‡"></a>åŠ è½½ç½‘ç»œå›¾ç‰‡</h2><p>æ¡Œé¢ç«¯åŠ è½½ç½‘ç»œå›¾ä¹Ÿæ²¡æœ‰å®‰å“çš„åŸç”Ÿåº“ä½¿ç”¨ï¼Œè¿™é‡Œä½¿ç”¨äº†<a class="link"   href="https://github.com/succlz123/compose-desktop-imageloader" >compose-desktop-imageloader <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>       </p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> ui.common             </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.Image </span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable </span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier </span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.layout.ContentScale </span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.res.painterResource </span><br><span class="line"><span class="keyword">import</span> org.succlz123.lib.imageloader.ImageAsyncImageFile </span><br><span class="line"><span class="keyword">import</span> org.succlz123.lib.imageloader.ImageAsyncImageUrl </span><br><span class="line"><span class="keyword">import</span> org.succlz123.lib.imageloader.ImageRes </span><br><span class="line"><span class="keyword">import</span> org.succlz123.lib.imageloader.core.ImageCallback </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AsyncImage</span><span class="params">( </span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">    url: <span class="type">String</span>?, </span></span></span><br><span class="line"><span class="params"><span class="function">    placeHolderUrl: <span class="type">String</span>? = <span class="string">&quot;image/ic_pokmon.jpeg&quot;</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">    errorUrl: <span class="type">String</span>? = <span class="string">&quot;image/ic_pokmon.jpeg&quot;</span>, </span></span></span><br><span class="line"><span class="params"><span class="function">    contentScale: <span class="type">ContentScale</span> = ContentScale.Crop </span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> imgUrl = url ?: <span class="string">&quot;image/ic_pokmon.jpeg&quot;</span> </span><br><span class="line">    <span class="keyword">if</span> (imgUrl.startsWith(<span class="string">&quot;http&quot;</span>)) &#123; </span><br><span class="line">        ImageAsyncImageUrl(url = imgUrl, imageCallback = ImageCallback(placeHolderView = &#123; </span><br><span class="line">            placeHolderUrl?.let &#123; </span><br><span class="line">                Image( </span><br><span class="line">                    painter = painterResource(placeHolderUrl), </span><br><span class="line">                    contentDescription = imgUrl, </span><br><span class="line">                    modifier = modifier, </span><br><span class="line">                    contentScale = contentScale </span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, errorView = &#123; </span><br><span class="line">            errorUrl?.let &#123; </span><br><span class="line">                Image( </span><br><span class="line">                    painter = painterResource(errorUrl), </span><br><span class="line">                    contentDescription = imgUrl, </span><br><span class="line">                    modifier = modifier, </span><br><span class="line">                    contentScale = contentScale </span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            Image( </span><br><span class="line">                painter = it, contentDescription = imgUrl, modifier = modifier, contentScale = contentScale </span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (imgUrl.startsWith(<span class="string">&quot;/&quot;</span>) || imgUrl.contains(<span class="string">&quot;:\\&quot;</span>)) &#123; </span><br><span class="line">        ImageAsyncImageFile(filePath = imgUrl, imageCallback = ImageCallback(placeHolderView = &#123; </span><br><span class="line">            placeHolderUrl?.let &#123; </span><br><span class="line">                Image( </span><br><span class="line">                    painter = painterResource(placeHolderUrl), </span><br><span class="line">                    contentDescription = imgUrl, </span><br><span class="line">                    modifier = modifier, </span><br><span class="line">                    contentScale = contentScale </span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, errorView = &#123; </span><br><span class="line">            errorUrl?.let &#123; </span><br><span class="line">                Image( </span><br><span class="line">                    painter = painterResource(errorUrl), </span><br><span class="line">                    contentDescription = imgUrl, </span><br><span class="line">                    modifier = modifier, </span><br><span class="line">                    contentScale = contentScale </span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            Image( </span><br><span class="line">                painter = it, contentDescription = imgUrl, modifier = modifier, contentScale = contentScale </span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        ImageRes(resName = imgUrl, imageCallback = ImageCallback(placeHolderView = &#123; </span><br><span class="line">            placeHolderUrl?.let &#123; </span><br><span class="line">                Image( </span><br><span class="line">                    painter = painterResource(placeHolderUrl), </span><br><span class="line">                    contentDescription = imgUrl, </span><br><span class="line">                    modifier = modifier, </span><br><span class="line">                    contentScale = contentScale </span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, errorView = &#123; </span><br><span class="line">            errorUrl?.let &#123; </span><br><span class="line">                Image( </span><br><span class="line">                    painter = painterResource(errorUrl), </span><br><span class="line">                    contentDescription = imgUrl, </span><br><span class="line">                    modifier = modifier, </span><br><span class="line">                    contentScale = contentScale </span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            Image( </span><br><span class="line">                painter = it, contentDescription = imgUrl, modifier = modifier, contentScale = contentScale </span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>


<h1 id="è‡´è°¢"><a href="#è‡´è°¢" class="headerlink" title="è‡´è°¢"></a>è‡´è°¢</h1><p>é¡¹ç›®ä¸­å¤§éƒ¨åˆ†æŠ€æœ¯æ ˆéƒ½å‚è€ƒè‡ª<a class="link"   href="https://github.com/sskEvan/NCMusicDesktop" >NCMusicDesktop <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œæ„Ÿè°¢å¤§ä½¬</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Jetpack Compose</tag>
      </tags>
  </entry>
  <entry>
    <title>Jetpack Compose å®æˆ˜ å®å¯æ¢¦å›¾é‰´</title>
    <url>/2023/04/13/Jetpack-Compose-%E5%AE%9E%E6%88%98-%E5%AE%9D%E5%8F%AF%E6%A2%A6%E5%9B%BE%E9%89%B4/Jetpack-Compose-%E5%AE%9E%E6%88%98-%E5%AE%9D%E5%8F%AF%E6%A2%A6%E5%9B%BE%E9%89%B4/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>  é˜…è¯»æœ¬æ–‡éœ€è¦ä¸€å®šcomposeåŸºç¡€ï¼Œå¦‚æœæ²¡æœ‰è¯·ç§»æ­¥<a class="link"   href="https://blog.csdn.net/shop_and_sleep/article/details/124569994?spm=1001.2014.3001.5501" >Jetpack Composeå…¥é—¨è¯¦è§£ï¼ˆå®æ—¶æ›´æ–°ï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>  å­¦Composeå­¦äº†æœ‰å°åŠå¹´çš„æ—¶é—´äº†ï¼Œä¸€ç›´éƒ½æ˜¯çœ‹å®˜æ–¹çš„ä¸€äº›åŸºç¡€çš„æ•™ç¨‹å¹¶æ€»ç»“å­¦ä¹ ã€‚æœ€è¿‘ç»ˆäºå®æˆ˜äº†ä¸€ä¸ªå®å¯æ¢¦å›¾é‰´çš„å°é¡¹ç›®ï¼Œéº»é›€è™½å°äº”è„ä¿±å…¨ã€‚é™¤äº†Composeå¤–ï¼Œè¿˜ä½¿ç”¨äº†ä¸€ä¸‹ä¸€äº›Jetpackç»„ä»¶</p>
<ul>
<li><p><a class="link"   href="https://google.github.io/accompanist/pager/" >accompanist-pager <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://github.com/coil-kt/coil" >coil <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://developer.android.google.cn/training/dependency-injection/hilt-jetpack#compose" >hilt <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://developer.android.google.cn/topic/libraries/architecture/paging/v3-overview" >paging3 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://developer.android.google.cn/jetpack/compose/navigation" >navigation-compose <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://google.github.io/accompanist/systemuicontroller/" >accompanist-systemuicontroller <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://square.github.io/retrofit/" >Retrofit <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> </p>
</li>
<li><p><a class="link"   href="https://developer.android.com/kotlin/flow" >Kotlin Flow <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
</ul>
<p>æ¥å£æ•°æ®æ¥æºäº<a class="link"   href="https://pokeapi.co/" >pokeapi <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   href="https://github.com/zyf-good/pokemon" >é¡¹ç›®æºä»£ç  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>å¦‚æœä½ è§‰å¾—ä¸é”™ï¼Œè¯·ç»™æˆ‘ä¸€ä¸ªstarï¼ŒTHKS</p>
<hr>
<h1 id="å®ç°æ•ˆæœ"><a href="#å®ç°æ•ˆæœ" class="headerlink" title="å®ç°æ•ˆæœ"></a>å®ç°æ•ˆæœ</h1><p>é—²è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ç°æ•ˆæœ<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/Pokmon1.gif"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªéå¸¸ç®€æ´çš„å®å¯æ¢¦å›¾é‰´ï¼Œå±•ç¤ºäº†æ‰€æœ‰ä¸–ä»£çš„å®å¯æ¢¦ï¼Œå¹¶æä¾›äº†æœç´¢ï¼Œç‚¹å‡»è¿›å…¥è¯¦æƒ…æŸ¥çœ‹ä»–ä»¬çš„å±æ€§</p>
<h1 id="ä¸€ã€æ¶æ„ä»‹ç»"><a href="#ä¸€ã€æ¶æ„ä»‹ç»" class="headerlink" title="ä¸€ã€æ¶æ„ä»‹ç»"></a>ä¸€ã€æ¶æ„ä»‹ç»</h1><p>å¦‚å›¾ï¼Œå±•ç¤ºäº†ä¸»è¦çš„ä¸€äº›æ–‡ä»¶ï¼š<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/Pokmon2.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<ul>
<li>api   - æ¥å£</li>
<li>nav - navigationå¯¼èˆª</li>
<li>utils -å·¥å…·ç±»</li>
<li>view -Composeç»„ä»¶</li>
<li>viewmodels - viewmodel</li>
</ul>
<h1 id="äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»"><a href="#äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»" class="headerlink" title="äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»"></a>äºŒã€ä¸€äº›çš„åŠŸèƒ½ç‚¹çš„ä»‹ç»</h1><p>ä¸»è¦æ˜¯å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜</p>
<h2 id="åŠ è½½å›¾ç‰‡å¹¶è·å–ä¸»è‰²-å†è®²ä¸»è‰²è®¾ç½®ä¸ºèƒŒæ™¯"><a href="#åŠ è½½å›¾ç‰‡å¹¶è·å–ä¸»è‰²-å†è®²ä¸»è‰²è®¾ç½®ä¸ºèƒŒæ™¯" class="headerlink" title="åŠ è½½å›¾ç‰‡å¹¶è·å–ä¸»è‰²,å†è®²ä¸»è‰²è®¾ç½®ä¸ºèƒŒæ™¯"></a>åŠ è½½å›¾ç‰‡å¹¶è·å–ä¸»è‰²,å†è®²ä¸»è‰²è®¾ç½®ä¸ºèƒŒæ™¯</h2><p>å±•ç¤ºå›¾ç‰‡æœ¬æ¥æœ‰å°è£…å¥½çš„<em><strong>CommonImage.kt</strong></em>ç”¨æ¥å±•ç¤ºå›¾ç‰‡ï¼Œä½†æ˜¯åœ¨åˆ—è¡¨ä¸­æ¯ä¸€å¼ å›¾ç‰‡çš„èƒŒæ™¯è‰²éƒ½æ˜¯åŠ¨æ€è·å–çš„ï¼Œå½“æ—¶åšçš„æ—¶å€™è§‰å¾—æ¯”è¾ƒéš¾å¼„ï¼Œåé¢å®ç°äº†è¿‡åå°±è§‰å¾—è¿˜å¥½å•¦ã€‚</p>
<p>å¼•å…¥çš„åº“</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">implementation <span class="string">&quot;io.coil-kt:coil-compose:2.1.0&quot;</span></span><br><span class="line">    <span class="comment">//get Dominant image color</span></span><br><span class="line">implementation <span class="string">&#x27;androidx.palette:palette-ktx:1.0.0&#x27;</span></span><br></pre></td></tr></table></figure></div>
<p>ä¸»è¦ä»£ç åœ¨<strong>FullScreenView.kt</strong>ä¸­çš„ <strong>item()</strong> ä¸­</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æˆ‘ä»¬æ‰€åŠ¨æ€è·å–çš„å›¾ç‰‡èƒŒæ™¯è‰²</span></span><br><span class="line"><span class="keyword">var</span> backgroundColor <span class="keyword">by</span> remember &#123; mutableStateOf(<span class="number">0</span>) &#125;</span><br><span class="line">   <span class="keyword">val</span> context = LocalContext.current</span><br><span class="line">   <span class="comment">//ImageRequest</span></span><br><span class="line">   <span class="keyword">val</span> modelBuilder = ImageRequest.Builder(context).<span class="keyword">data</span>(item.url.getPicUrl()).crossfade(<span class="literal">false</span>)</span><br><span class="line">       .allowHardware(<span class="literal">false</span>).transformations().placeholder(R.drawable.ic_pokeball)</span><br><span class="line">       .error(R.drawable.ic_pokeball)</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å¯ä¸€ä¸ªè·å–åç¨‹çš„é™„å¸¦æ•ˆåº”å½“ImageRequestå‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šè¿‡ImageRequestæ¥åŠ¨æ€è·å–bitmap</span></span><br><span class="line"><span class="comment">//å†é€šè¿‡Paletteæ¥è·å–å…¶ä¸»è‰²</span></span><br><span class="line">   LaunchedEffect(modelBuilder.build()) &#123;</span><br><span class="line">       <span class="keyword">val</span> bitmap = context.imageLoader.execute(modelBuilder.build()).drawable?.toBitmap(</span><br><span class="line">           config = Bitmap.Config.RGBA_F16</span><br><span class="line">       )</span><br><span class="line">       bitmap?.let &#123;</span><br><span class="line">           <span class="keyword">val</span> palette = Palette.from(bitmap).generate()</span><br><span class="line">           <span class="comment">//å½“backgroundColorå¾—åˆ°å€¼ï¼Œå¯ç»„åˆé¡¹é‡ç»„</span></span><br><span class="line">           backgroundColor = palette.getDominantColor(<span class="number">0</span>)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢çš„ä»£ç æœ€ç»ˆèƒ½å®ç°æˆ‘æƒ³è¦çš„æ•ˆæœï¼Œä½†æ˜¯æˆ‘å§‹ç»ˆè§‰å¾—ä¸å¤Ÿä¼˜é›…ï¼Œåé¢æœ‰æœºä¼šåœ¨å°è£…ä¸€ä¸‹å§</p>
<h2 id="ä¸€ä¸ªè¿›åº¦ç¼“æ…¢å¢åŠ çš„åœ†å½¢è¿›åº¦æ¡"><a href="#ä¸€ä¸ªè¿›åº¦ç¼“æ…¢å¢åŠ çš„åœ†å½¢è¿›åº¦æ¡" class="headerlink" title="ä¸€ä¸ªè¿›åº¦ç¼“æ…¢å¢åŠ çš„åœ†å½¢è¿›åº¦æ¡"></a>ä¸€ä¸ªè¿›åº¦ç¼“æ…¢å¢åŠ çš„åœ†å½¢è¿›åº¦æ¡</h2><p>ä¹Ÿæ˜¯å°è£…å¥½çš„é€šç”¨ç»„ä»¶<strong>CommonCircularProgress.kt</strong> </p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">CommonAttributeCircularProgress</span><span class="params">(text:<span class="type">String</span>,content:<span class="type">String</span>,mProgress: <span class="type">Float</span>,modifier: <span class="type">Modifier</span>)</span></span>&#123;</span><br><span class="line">    Column(</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">var</span> progress = remember &#123;</span><br><span class="line">            mutableStateOf(<span class="number">0.0f</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        LaunchedEffect(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> state = <span class="number">0.0f</span></span><br><span class="line">            <span class="keyword">while</span> (state &lt;= mProgress) &#123;</span><br><span class="line">                progress.value = state</span><br><span class="line">                state += mProgress / <span class="number">10f</span></span><br><span class="line">                delay(<span class="number">50</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Box()&#123;</span><br><span class="line">            Text(text = text,modifier = modifier.align(Alignment.Center))</span><br><span class="line">            CircularProgressIndicator(progress = <span class="number">1f</span>,</span><br><span class="line">                color = Color(<span class="number">0xFFffcba4</span>),</span><br><span class="line">                modifier = modifier</span><br><span class="line">                    .align(Alignment.Center)</span><br><span class="line">                    .size(<span class="number">150.</span>cdp, <span class="number">150.</span>cdp)</span><br><span class="line">            )</span><br><span class="line">            CircularProgressIndicator(progress = progress.value,</span><br><span class="line">                color = MaterialTheme.colors.secondary,</span><br><span class="line">                modifier = modifier</span><br><span class="line">                    .align(Alignment.Center)</span><br><span class="line">                    .size(<span class="number">150.</span>cdp, <span class="number">150.</span>cdp)</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        Text(text = content, modifier = modifier.padding(top = <span class="number">10.</span>cdp))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘æ²¡æœ‰æ‰¾åˆ°èƒ½ç»™CircularProgressIndicatorå¯ç»„åˆé¡¹ç›®è®¾ç½®è¿›åº¦æ¡èŒƒå›´å†…çš„èƒŒæ™¯çš„å±æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨äº†boxå°†å…¶è¦†ç›–ä¸€ä¸ªCircularProgressIndicatorå¯ç»„åˆé¡¹æ¥å®ç°å…¶èƒŒæ™¯çš„å‡è±¡</p>
<h2 id="å•Activityä½¿ç”¨navigationè·³è½¬Composeå¯ç»„åˆé¡¹è¿”å›æ—¶é¡µé¢é‡ç»„çš„é—®é¢˜"><a href="#å•Activityä½¿ç”¨navigationè·³è½¬Composeå¯ç»„åˆé¡¹è¿”å›æ—¶é¡µé¢é‡ç»„çš„é—®é¢˜" class="headerlink" title="å•Activityä½¿ç”¨navigationè·³è½¬Composeå¯ç»„åˆé¡¹è¿”å›æ—¶é¡µé¢é‡ç»„çš„é—®é¢˜"></a>å•Activityä½¿ç”¨navigationè·³è½¬Composeå¯ç»„åˆé¡¹è¿”å›æ—¶é¡µé¢é‡ç»„çš„é—®é¢˜</h2><p>åˆ—è¡¨é¡¹æ•°æ®æˆ‘æŒ‰ç…§å®˜æ–¹æ¨èä½¿ç”¨çš„æ–¹æ³•ç›´æ¥ä½¿ç”¨äº†<strong>collectAsLazyPagingItems</strong>ï¼Œç„¶åæˆ‘å‘ç°å®ƒç¡®å®èµ·ä½œç”¨äº†ï¼Œä½†æ˜¯ä¹Ÿå‘ç”Ÿäº†ä¸Šè¯‰é—®é¢˜ï¼Œæˆ‘æ¯ä¸€æ¬¡ä»è¯¦æƒ…é¡µè¿”å›åˆ°åˆ—è¡¨é¡µï¼Œåˆ—è¡¨é¡µéƒ½ä¼šé—ªçƒç„¶åé‡ç»„ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸€æ¬¡è¿”å›ï¼Œå¯ç»„åˆé¡¹éƒ½é‡æ–°è¿›è¡Œäº†è¯·æ±‚å¯¼è‡´æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå¯¼è‡´é‡ç»„ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘åœ¨viewmodelä¸­ä¿å­˜äº†ä¸€ä»½è¯·æ±‚å¾—åˆ°çš„æ•°æ®</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@HiltViewModel</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PokemonListViewModel</span> <span class="meta">@Inject</span> <span class="keyword">constructor</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> pokemonRepository: PokemonRepository</span><br><span class="line">) :</span><br><span class="line">    ViewModel() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®å¯æ¢¦åˆ—è¡¨æ•°æ®æµ  currentResultæ˜¯ä¸ºäº†ä¿è¯ä»è¯¦æƒ…é¡µé¢è¿”å›æ—¶ä¸é‡æ–°åŠ è½½æ•°æ®</span></span><br><span class="line">    <span class="keyword">var</span> currentResult: Flow&lt;PagingData&lt;PokemonResult&gt;&gt;? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getPokemon</span><span class="params">(searchString: <span class="type">String</span>?)</span></span>: Flow&lt;PagingData&lt;PokemonResult&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> newResult = pokemonRepository.getPokemon(searchString).cachedIn(viewModelScope)</span><br><span class="line">        currentResult = newResult</span><br><span class="line">        <span class="keyword">return</span> newResult</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å¹¶åœ¨é¡µé¢ä¸­è¿™æ ·æ­£ç¡®ä½¿ç”¨<strong>collectAsLazyPagingItems</strong></p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> list: LazyPagingItems&lt;PokemonResult&gt;? = <span class="literal">null</span></span><br><span class="line">list = <span class="keyword">if</span> (vm.currentResult != <span class="literal">null</span>) &#123;</span><br><span class="line">    vm.currentResult!!.collectAsLazyPagingItems()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vm.getPokemon(searchString.value).collectAsLazyPagingItems()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·å½“æˆ‘ä»è¯¦æƒ…é¡µè¿”å›åˆ°åˆ—è¡¨é¡µæ—¶ï¼Œé¡µé¢æ˜¾ç¤ºæ­£å¸¸</p>
<h2 id="hiltViewModel"><a href="#hiltViewModel" class="headerlink" title="hiltViewModel()"></a>hiltViewModel()</h2><p>åœ¨ä½¿ç”¨viemodelæ—¶ï¼Œä¸€å¼€å§‹æˆ‘æŒ‰ç…§å®˜æ–¹ä½¿ç”¨viewmodelçš„ç¤ºä¾‹ä½¿ç”¨äº†**viewModel()**æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨è°ƒè¯•ä¸­æ˜¯æ­£å¸¸çš„ã€‚</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> vm: PokemonListViewModel = viewModel()</span><br></pre></td></tr></table></figure></div>

<p>å¯å½“æˆ‘åœ¨åŠ å…¥<strong>navigation</strong> åï¼Œviewmodelå¹¶ä¸èƒ½æ­£å¸¸çš„å·¥ä½œï¼Œåæ¥æŸ¥é˜…èµ„æ–™å‘ç°è¦ä½¿ç”¨</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">implementation <span class="string">&quot;androidx.navigation:navigation-compose:2.5.0-beta01&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>åŒ…ä¸­çš„ <strong>hiltViewModel()</strong></p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> vm: PokemonListViewModel = hiltViewModel()</span><br></pre></td></tr></table></figure></div>

<hr>
<h1 id="ä¸»è¦å‚è€ƒé¡¹ç›®"><a href="#ä¸»è¦å‚è€ƒé¡¹ç›®" class="headerlink" title="ä¸»è¦å‚è€ƒé¡¹ç›®"></a>ä¸»è¦å‚è€ƒé¡¹ç›®</h1><p>Jetpack Composeä»¿å†™ç½‘æ˜“äº‘éŸ³ä¹<br><a class="link"   href="https://github.com/sskEvan/NCMusic" >NCMusic <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>;<br>ä¸€ä¸ªä½¿ç”¨åŸç”Ÿxml kotlinå†™çš„å®å¯æ¢¦å›¾é‰´<br><a class="link"   href="https://github.com/ronnieotieno/PokeApi-Pokedex" >PokeApi-Pokedex <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>;</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ•´ä¸ªé¡¹ç›®å…¶å®å°±ä¸¤ä¸ªå¯ç»„åˆé¡¹ï¼Œä¸€ä¸ªæ˜¯FullScreenViewï¼ˆåˆ—è¡¨é¡µï¼‰ï¼Œä¸€ä¸ªæ˜¯AttributeDetailViewï¼ˆè¯¦æƒ…é¡µï¼‰ï¼Œæ¯ä¸ªé¡µé¢å°±200è¡Œä»£ç å·¦å³ï¼Œå¯¹æ¯”èµ·åŸç”Ÿxmlï¼Œçš„ç¡®æ˜¯å°‘äº†å¾ˆå¤šæ ·æ¿ä»£ç </p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Jetpack Compose</tag>
      </tags>
  </entry>
  <entry>
    <title>Jetpack Composeå…¥é—¨</title>
    <url>/2023/04/19/Jetpack-Compose%E5%85%A5%E9%97%A8/Jetpack-Compose%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="headerlink" title="ä¸€.å‰è¨€"></a>ä¸€.å‰è¨€</h1><p>æœ¬ç¯‡æ–‡ç« å°†ç®€å•ä»‹ç» <strong>Jectpack Compose</strong>,åªå¸¦é¢†å¤§å®¶è®¤è¯†åœ¨å®‰å“ä¸­Composeçš„ä½¿ç”¨ï¼Œæ—¢ç„¶è¦ä½¿ç”¨<strong>Jectpack Compose</strong>ï¼Œé‚£å°±å¿…é¡»è¸©ä¸€æ§ä¸€äº†ï¼ˆdogeï¼‰</p>
<h1 id="äºŒ-åŸç”ŸViewçš„ç¼ºç‚¹ä¸Composeçš„ä¼˜ç‚¹"><a href="#äºŒ-åŸç”ŸViewçš„ç¼ºç‚¹ä¸Composeçš„ä¼˜ç‚¹" class="headerlink" title="äºŒ.åŸç”ŸViewçš„ç¼ºç‚¹ä¸Composeçš„ä¼˜ç‚¹"></a>äºŒ.åŸç”ŸViewçš„ç¼ºç‚¹ä¸Composeçš„ä¼˜ç‚¹</h1><h2 id="åŸç”ŸViewçš„ç¼ºç‚¹"><a href="#åŸç”ŸViewçš„ç¼ºç‚¹" class="headerlink" title="åŸç”ŸViewçš„ç¼ºç‚¹"></a>åŸç”ŸViewçš„ç¼ºç‚¹</h2><blockquote>
<p>ä»¥ä¸‹ä»…ä»£è¡¨ä¸ªäººè§‚ç‚¹ï¼Œä¸å¯å¦è®¤viewä¹Ÿæœ‰è‡ªå·±çš„ä¼˜ç‚¹</p>
</blockquote>
<h2 id="è‡ƒè‚¿"><a href="#è‡ƒè‚¿" class="headerlink" title="è‡ƒè‚¿"></a>è‡ƒè‚¿</h2><p>æ‰€æœ‰äººä¸€å…¥è¡ŒAndroidéƒ½æ˜¯ä»xmlå¸ƒå±€å¼€å§‹çš„ï¼Œéƒ½æ˜¯ä»viewå¼€å§‹çš„ï¼Œä¸å¾—ä¸è¯´ä½œä¸ºä¸€ä¸ªåŸºç±»ï¼Œå®ƒç¡®å®å¾ˆå¼ºå¤§ï¼Œå¾ˆæˆç†Ÿï¼Œä½†æ˜¯ç›¸ä¿¡å¤§éƒ¨åˆ†äººéƒ½ä¸æ²¡æœ‰å»çœ‹çœ‹viewçš„æºç æœ‰å¤šå°‘è¡Œï¼Œä»Šå¤©å‘Šè¯‰å¤§å®¶ï¼Œä¸€å…±æœ‰3468è¡Œã€‚</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230403175158572.png"
                      alt="image-20230403175158572"
                ></p>
<p>æ˜¯çš„ï¼Œä½œä¸ºä¸€ä¸ªåŸºç±»ï¼Œå®ƒå¤ªè‡ƒè‚¿äº†ã€‚</p>
<hr>
<h2 id="ä½¿ç”¨éº»çƒ¦"><a href="#ä½¿ç”¨éº»çƒ¦" class="headerlink" title="ä½¿ç”¨éº»çƒ¦"></a>ä½¿ç”¨éº»çƒ¦</h2><p>å¤§å®¶å†™xmléƒ½å†™ä¹ æƒ¯äº†ï¼Œå„ç§å±æ€§ç†Ÿè®°äºå¿ƒï¼Œæ‰€ä»¥å¹¶ä¸è§‰å¾—ä»€ä¹ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå°ä¾‹å­æ¥å¯¹æ¯”ä¸€ä¸‹</p>
<p>ç”¨åŸç”ŸViewçš„æ–¹å¼å£°æ˜ä¸€ä¸ªæ–‡æœ¬ï¼Œä¸è°ˆåŠ¨æ€æ›´æ”¹å€¼ï¼Œä½ å¾—å£°æ˜ä¸€ä¸ªxmlå§</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:id=<span class="string">&quot;@+id/text&quot;</span></span><br><span class="line">    android:text=<span class="string">&quot;è¿™æ˜¯ä¸€æ¡æ–‡æœ¬&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>/&gt;</span><br></pre></td></tr></table></figure></div>

<p>è€ŒComposeç»“åˆkotlinçš„Lamdaï¼Œå£°æ˜ä¸€ä¸ªæ–‡æœ¬ï¼Œåªéœ€è¦ä¸€è¡Œä»£ç </p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">Text(<span class="string">&quot;è¿™æ˜¯ä¸€æ¡æ–‡æœ¬&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<hr>
<p>è¿™ä¸¤ç§æ–¹å¼çš„å®ç°æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å¾ˆç›´è§‚çš„ä½ å¯ä»¥çœ‹åˆ°</p>
<h2 id="é¢„è§ˆåŠŸèƒ½ä¸å¤Ÿå¼ºå¤§"><a href="#é¢„è§ˆåŠŸèƒ½ä¸å¤Ÿå¼ºå¤§" class="headerlink" title="é¢„è§ˆåŠŸèƒ½ä¸å¤Ÿå¼ºå¤§"></a>é¢„è§ˆåŠŸèƒ½ä¸å¤Ÿå¼ºå¤§</h2><p>å¥½äº†æœ‰äº›æ ç²¾å°±è¦è¯´äº†â€œæˆ‘å¯ä»¥åœ¨xmlå¸ƒå±€ä¸­é¢„è§ˆå•Šâ€ï¼Œä½ å…ˆåˆ«æ€¥ï¼Œæˆ‘ä»¬å†ä¸¾ä¸ªåœ¨å·¥ä½œå½“ä¸­çš„ä¾‹å­ï¼Œå½“ä½ ç¾æ»‹æ»‹çš„å®Œæˆäº†å¼€å‘ä»»åŠ¡ï¼Œæ­£åœ¨è¿›è¡ŒUIéªŒæ”¶æ—¶ï¼ŒUIè·‘è¿‡æ¥è·Ÿä½ è¯´ï¼Œè¿™ä¸ªå‘å¸ƒé¡µä¸‹é¢æœ‰ä¸€æ ¹åˆ†å‰²çº¿ï¼Œæˆ‘çš„UIå›¾é‡Œåˆ†å‰²çº¿æ˜¯1.dpï¼Œä½ è¿™é‡Œæœ‰2.dpï¼›ä½ çœ‹ç€ä½ åœ¨xmlä¸­çš„é¢„è§ˆï¼Œç¡®å®æ˜¯1.dpå•Šï¼Œä½ è¯´å¥½æˆ‘çœ‹ä¸‹ï¼Œä¸€è·‘é¡¹ç›®åäº”åˆ†é’Ÿè¿‡å»äº†ï¼Œå‘ç°ç¡®å®æ˜¯2.dpç„¶åå†å›è¿‡å¤´æ¥çœ‹ä¸ºä»€ä¹ˆï¼Œè¿™ä½†æ˜¯Composeå°±å¯ä»¥ç›´æ¥æŒ‡å®šè¿è¡ŒæŸä¸ªé¡µé¢ï¼Œç”šè‡³å¯ä»¥åˆ‡æ¢ä¸»é¢˜å’Œäº¤äº’ï¼Œè€Œä¸æ˜¯åƒxmlåªèƒ½çœ‹çœ‹ã€‚</p>
<p><strong>ç»¼ä¸Šæ‰€è¯‰ï¼Œé«˜ä¸‹ç«‹åˆ¤ï¼Œxmlåœ¨ç°åœ¨çœ‹æ¥ç¡®å®ä¸å¤Ÿä¼˜é›…äº†</strong></p>
<hr>
<h1 id="Composeçš„ä¼˜ç‚¹"><a href="#Composeçš„ä¼˜ç‚¹" class="headerlink" title="Composeçš„ä¼˜ç‚¹"></a>Composeçš„ä¼˜ç‚¹</h1><h3 id="ä¸ºä»€ä¹ˆé‡‡ç”¨-Compose"><a href="#ä¸ºä»€ä¹ˆé‡‡ç”¨-Compose" class="headerlink" title="ä¸ºä»€ä¹ˆé‡‡ç”¨ Compose"></a>ä¸ºä»€ä¹ˆé‡‡ç”¨ Compose</h3><p>Jetpack Compose æ˜¯ç”¨äºæ„å»ºåŸç”Ÿ Android ç•Œé¢çš„æ–°å·¥å…·åŒ…ã€‚å®ƒä½¿ç”¨æ›´å°‘çš„ä»£ç ã€å¼ºå¤§çš„å·¥å…·å’Œç›´è§‚çš„ Kotlin APIï¼Œå¯ä»¥å¸®åŠ©æ‚¨ç®€åŒ–å¹¶åŠ å¿« Android ç•Œé¢å¼€å‘ï¼Œæ‰“é€ ç”ŸåŠ¨è€Œç²¾å½©çš„åº”ç”¨ã€‚å®ƒå¯è®©æ‚¨æ›´å¿«é€Ÿã€æ›´è½»æ¾åœ°æ„å»º Android ç•Œé¢ã€‚</p>
<h2 id="æ›´å°‘çš„ä»£ç "><a href="#æ›´å°‘çš„ä»£ç " class="headerlink" title="æ›´å°‘çš„ä»£ç "></a>æ›´å°‘çš„ä»£ç </h2><p>ç¼–å†™æ›´å°‘çš„ä»£ç ä¼šå½±å“åˆ°æ‰€æœ‰å¼€å‘é˜¶æ®µï¼šä½œä¸ºä»£ç æ’°å†™è€…ï¼Œéœ€è¦æµ‹è¯•å’Œè°ƒè¯•çš„ä»£ç ä¼šæ›´å°‘ï¼Œå‡ºç° bug çš„å¯èƒ½æ€§ä¹Ÿæ›´å°ï¼Œæ‚¨å°±å¯ä»¥ä¸“æ³¨äºè§£å†³æ‰‹å¤´çš„é—®é¢˜ï¼›ä½œä¸ºå®¡æ ¸äººå‘˜æˆ–ç»´æŠ¤äººå‘˜ï¼Œæ‚¨éœ€è¦é˜…è¯»ã€ç†è§£ã€å®¡æ ¸å’Œç»´æŠ¤çš„ä»£ç å°±æ›´å°‘ã€‚</p>
<p>ä¸ä½¿ç”¨ Android View ç³»ç»Ÿï¼ˆæŒ‰é’®ã€åˆ—è¡¨æˆ–åŠ¨ç”»ï¼‰ç›¸æ¯”ï¼ŒCompose å¯è®©æ‚¨ä½¿ç”¨æ›´å°‘çš„ä»£ç å®ç°æ›´å¤šçš„åŠŸèƒ½ã€‚æ— è®ºæ‚¨éœ€è¦æ„å»ºä»€ä¹ˆå†…å®¹ï¼Œç°åœ¨éœ€è¦ç¼–å†™çš„ä»£ç éƒ½æ›´å°‘äº†ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„ä¸€äº›åˆä½œä¼™ä¼´çš„æ„Ÿæƒ³ï¼š</p>
<ul>
<li>â€œå¯¹äºç›¸åŒçš„ Button ç±»ï¼Œä»£ç çš„ä½“é‡è¦å° 10 å€ã€‚â€(Twitter)</li>
<li>â€œä½¿ç”¨ RecyclerView æ„å»ºçš„ä»»ä½•å±å¹•ï¼ˆæˆ‘ä»¬çš„å¤§éƒ¨åˆ†å±å¹•éƒ½ä½¿ç”¨å®ƒæ„å»ºï¼‰çš„å¤§å°ä¹Ÿæ˜¾è‘—å‡å°ã€‚â€(Monzo)</li>
<li>â€œâ€œåªéœ€è¦å¾ˆå°‘å‡ è¡Œä»£ç å°±å¯ä»¥åœ¨åº”ç”¨ä¸­åˆ›å»ºåˆ—è¡¨æˆ–åŠ¨ç”»ï¼Œè¿™ä¸€ç‚¹ä»¤æˆ‘ä»¬éå¸¸æ»¡æ„ã€‚å¯¹äºæ¯é¡¹åŠŸèƒ½ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç è¡Œæ›´å°‘äº†ï¼Œè¿™è®©æˆ‘ä»¬èƒ½å¤Ÿå°†æ›´å¤šç²¾åŠ›æ”¾åœ¨ä¸ºå®¢æˆ·æä¾›ä»·å€¼ä¸Šã€‚â€(Cuvva)</li>
</ul>
<p>ç¼–å†™ä»£ç åªéœ€è¦é‡‡ç”¨ Kotlinï¼Œè€Œä¸å¿…æ‹†åˆ†æˆ Kotlin å’Œ XML éƒ¨åˆ†ï¼šâ€œå½“æ‰€æœ‰ä»£ç éƒ½ä½¿ç”¨åŒä¸€ç§è¯­è¨€ç¼–å†™å¹¶ä¸”é€šå¸¸ä½äºåŒä¸€æ–‡ä»¶ä¸­ï¼ˆè€Œä¸æ˜¯åœ¨ Kotlin å’Œ XML è¯­è¨€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼‰æ—¶ï¼Œè·Ÿè¸ªå˜å¾—æ›´å®¹æ˜“â€(Monzo)</p>
<p>æ— è®ºæ‚¨è¦æ„å»ºä»€ä¹ˆï¼Œä½¿ç”¨ Compose ç¼–å†™çš„ä»£ç éƒ½å¾ˆç®€æ´ä¸”æ˜“äºç»´æŠ¤ã€‚â€œCompose çš„å¸ƒå±€ç³»ç»Ÿåœ¨æ¦‚å¿µä¸Šæ›´ç®€å•ï¼Œå› æ­¤å¯ä»¥æ›´è½»æ¾åœ°æ¨æ–­ã€‚æŸ¥çœ‹å¤æ‚ç»„ä»¶çš„ä»£ç ä¹Ÿæ›´è½»æ¾ã€‚â€(Square)</p>
<h2 id="ç›´è§‚"><a href="#ç›´è§‚" class="headerlink" title="ç›´è§‚"></a>ç›´è§‚</h2><p>Compose ä½¿ç”¨å£°æ˜æ€§ APIï¼Œè¿™æ„å‘³ç€æ‚¨åªéœ€æè¿°ç•Œé¢ï¼ŒCompose ä¼šè´Ÿè´£å®Œæˆå…¶ä½™å·¥ä½œã€‚è¿™ç±» API ååˆ†ç›´è§‚ - æ˜“äºæ¢ç´¢å’Œä½¿ç”¨ï¼šâ€œæˆ‘ä»¬çš„ä¸»é¢˜å±‚æ›´åŠ ç›´è§‚ï¼Œä¹Ÿæ›´åŠ æ¸…æ™°ã€‚æˆ‘ä»¬èƒ½å¤Ÿåœ¨å•ä¸ª Kotlin æ–‡ä»¶ä¸­å®Œæˆä¹‹å‰éœ€è¦åœ¨å¤šä¸ª XML æ–‡ä»¶ä¸­å®Œæˆçš„ä»»åŠ¡ï¼Œè¿™äº› XML æ–‡ä»¶è´Ÿè´£é€šè¿‡å¤šä¸ªåˆ†å±‚ä¸»é¢˜å åŠ å±‚å®šä¹‰å’Œåˆ†é…å±æ€§ã€‚â€(Twitter)</p>
<p>åˆ©ç”¨ Composeï¼Œæ‚¨å¯ä»¥æ„å»ºä¸ä¸ç‰¹å®š activity æˆ– fragment ç›¸å…³è”çš„å°å‹æ— çŠ¶æ€ç»„ä»¶ã€‚è¿™è®©æ‚¨å¯ä»¥è½»æ¾é‡ç”¨å’Œæµ‹è¯•è¿™äº›ç»„ä»¶ï¼šâ€œæˆ‘ä»¬ç»™è‡ªå·±è®¾å®šçš„ç›®æ ‡æ˜¯ï¼Œäº¤ä»˜ä¸€ç»„æ–°çš„æ— çŠ¶æ€ç•Œé¢ç»„ä»¶ï¼Œç¡®ä¿å®ƒä»¬æ˜“äºä½¿ç”¨å’Œç»´æŠ¤ï¼Œä¸”å¯ç›´è§‚å®ç°&#x2F;æ‰©å±•&#x2F;è‡ªå®šä¹‰ã€‚å°±è¿™ä¸€ç‚¹è€Œè¨€ï¼ŒCompose ç¡®å®ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¯é çš„ç­”æ¡ˆã€‚â€(Twitter)</p>
<p>åœ¨ Compose ä¸­ï¼ŒçŠ¶æ€æ˜¯æ˜¾å¼çš„ï¼Œå¹¶ä¸”ä¼šä¼ é€’ç»™ç›¸åº”çš„å¯ç»„åˆé¡¹ã€‚è¿™æ ·ä¸€æ¥ï¼ŒçŠ¶æ€ä¾¿å…·æœ‰å•ä¸€å¯ä¿¡æ¥æºï¼Œå› è€Œæ˜¯å°è£…å’Œåˆ†ç¦»çš„ã€‚ç„¶åï¼Œåº”ç”¨çŠ¶æ€å˜åŒ–æ—¶ï¼Œç•Œé¢ä¼šè‡ªåŠ¨æ›´æ–°ã€‚â€œåœ¨å¯¹æŸäº›å†…å®¹è¿›è¡Œæ¨æ–­æ—¶ï¼Œä¸å¿…å¤„ç†å¤ªå¤šä¿¡æ¯ï¼Œå¹¶ä¸”æ— æ³•æ§åˆ¶æˆ–éš¾ä»¥ç†è§£çš„è¡Œä¸ºä¹Ÿæ›´å°‘â€(Cuvva)</p>
<h2 id="åŠ é€Ÿå¼€å‘"><a href="#åŠ é€Ÿå¼€å‘" class="headerlink" title="åŠ é€Ÿå¼€å‘"></a>åŠ é€Ÿå¼€å‘</h2><p>Compose ä¸æ‚¨æ‰€æœ‰çš„ç°æœ‰ä»£ç å…¼å®¹ï¼šæ‚¨å¯ä»¥ä» View è°ƒç”¨ Compose ä»£ç ï¼Œä¹Ÿå¯ä»¥ä» Compose è°ƒç”¨ Viewã€‚å¤§å¤šæ•°å¸¸ç”¨åº“ï¼ˆå¦‚ Navigationã€ViewModel å’Œ Kotlin åç¨‹ï¼‰éƒ½é€‚ç”¨äº Composeï¼Œå› æ­¤æ‚¨å¯ä»¥éšæ—¶éšåœ°å¼€å§‹é‡‡ç”¨ã€‚â€œæˆ‘ä»¬é›†æˆ Compose çš„åˆè¡·æ˜¯å®ç°äº’æ“ä½œæ€§ï¼Œæˆ‘ä»¬å‘ç°è¿™ä»¶äº‹æƒ…å·²ç»â€˜æ°´åˆ°æ¸ æˆâ€™ã€‚æˆ‘ä»¬ä¸å¿…è€ƒè™‘æµ…è‰²æ¨¡å¼å’Œæ·±è‰²æ¨¡å¼ç­‰é—®é¢˜ï¼Œæ•´ä¸ªä½“éªŒæ— æ¯”é¡ºç•…ã€‚â€(Cuvva)</p>
<p>å€ŸåŠ©å…¨é¢çš„ Android Studio æ”¯æŒä»¥åŠå®æ—¶é¢„è§ˆç­‰åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥æ›´å¿«åœ°è¿­ä»£å’Œäº¤ä»˜ä»£ç ï¼šâ€œ<em>Android Studio ä¸­çš„é¢„è§ˆåŠŸèƒ½æå¤§åœ°èŠ‚çœäº†æˆ‘ä»¬çš„æ—¶é—´ã€‚æ„å»ºå¤šä¸ªé¢„è§ˆçš„èƒ½åŠ›ä¹Ÿå¸®æˆ‘ä»¬èŠ‚çœäº†æ—¶é—´ã€‚æˆ‘ä»¬é€šå¸¸éœ€è¦æ£€æŸ¥ä¸åŒçŠ¶æ€ä¸‹æˆ–é‡‡ç”¨ä¸åŒè®¾ç½®çš„ç•Œé¢ç»„ä»¶ï¼ˆä¾‹å¦‚é”™è¯¯çŠ¶æ€æˆ–é‡‡ç”¨ä¸åŒçš„å­—ä½“å¤§å°ç­‰ï¼‰ã€‚ç”±äºèƒ½å¤Ÿåˆ›å»ºå¤šä¸ªé¢„è§ˆï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾æ‰§è¡Œè¿™äº›æ£€æŸ¥ã€‚</em>â€(Square)</p>
<h2 id="åŠŸèƒ½å¼ºå¤§"><a href="#åŠŸèƒ½å¼ºå¤§" class="headerlink" title="åŠŸèƒ½å¼ºå¤§"></a>åŠŸèƒ½å¼ºå¤§</h2><p>åˆ©ç”¨ Composeï¼Œæ‚¨å¯ä»¥å‡­å€Ÿå¯¹ Android å¹³å° API çš„ç›´æ¥è®¿é—®å’Œå¯¹äº Material Designã€æ·±è‰²ä¸»é¢˜ã€åŠ¨ç”»ç­‰çš„å†…ç½®æ”¯æŒï¼Œåˆ›å»ºç²¾ç¾çš„åº”ç”¨ï¼šâ€œCompose ä¸ä»…è§£å†³äº†å£°æ˜æ€§ç•Œé¢çš„é—®é¢˜ï¼Œè¿˜æ”¹è¿›äº†æ— éšœç¢åŠŸèƒ½ APIã€å¸ƒå±€ç­‰å„ç§å†…å®¹ã€‚å°†è®¾æƒ³å˜ä¸ºç°å®æ‰€éœ€çš„æ­¥éª¤æ›´å°‘äº†â€(Square)ã€‚</p>
<p>åˆ©ç”¨ Composeï¼Œæ‚¨å¯ä»¥è½»æ¾å¿«é€Ÿåœ°é€šè¿‡åŠ¨ç”»è®©åº”ç”¨å˜å¾—ç”ŸåŠ¨æœ‰è¶£ï¼šâ€œåœ¨ Compose ä¸­æ·»åŠ åŠ¨ç”»æ•ˆæœéå¸¸ç®€å•ï¼Œæ²¡æœ‰ç†ç”±ä¸å»ä¸ºé¢œè‰²&#x2F;å¤§å°&#x2F;é«˜åº¦å˜åŒ–æ·»åŠ åŠ¨ç”»æ•ˆæœâ€(Monzo)ï¼Œâ€œä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„å·¥å…·å°±èƒ½åˆ¶ä½œåŠ¨ç”»ï¼Œè¿™ä¸æ˜¾ç¤ºé™æ€å±å¹•æ²¡æœ‰ä»€ä¹ˆä¸åŒâ€(Square)ã€‚</p>
<p>æ— è®ºæ‚¨æ˜¯ä½¿ç”¨ Material Design è¿˜æ˜¯è‡ªå·±çš„è®¾è®¡ç³»ç»Ÿè¿›è¡Œæ„å»ºï¼ŒCompose éƒ½å¯ä»¥è®©æ‚¨çµæ´»åœ°å®ç°æ‰€éœ€çš„è®¾è®¡ï¼šâ€œä»åŸºç¡€ä¸Šå°† Material Design åˆ†ç¦»å‡ºæ¥å¯¹æˆ‘ä»¬æ¥è¯´éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬è¦æ„å»ºè‡ªå·±çš„è®¾è®¡ç³»ç»Ÿï¼Œè¿™å¾€å¾€éœ€è¦ä¸ Material ä¸åŒçš„è®¾è®¡è¦æ±‚ã€‚â€(Square)</p>
<h1 id="ä¸‰-Hello-Compose"><a href="#ä¸‰-Hello-Compose" class="headerlink" title="ä¸‰.Hello Compose"></a>ä¸‰.Hello Compose</h1><p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ï¼Œæˆ‘ä»¬é©¬ä¸Šæ“ç»ƒèµ·æ¥ã€‚</p>
<h2 id="å…ˆnew-ä¸€ä¸ª-project"><a href="#å…ˆnew-ä¸€ä¸ª-project" class="headerlink" title="å…ˆnew ä¸€ä¸ª project"></a>å…ˆnew ä¸€ä¸ª project</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404102128397.png"
                      alt="image-20230404102128397"
                ></p>
<h2 id="ç„¶åé€‰æ‹©åˆ›å»ºä¸€ä¸ªç©ºçš„Compose-é¡¹ç›®"><a href="#ç„¶åé€‰æ‹©åˆ›å»ºä¸€ä¸ªç©ºçš„Compose-é¡¹ç›®" class="headerlink" title="ç„¶åé€‰æ‹©åˆ›å»ºä¸€ä¸ªç©ºçš„Compose é¡¹ç›®"></a>ç„¶åé€‰æ‹©åˆ›å»ºä¸€ä¸ªç©ºçš„Compose é¡¹ç›®</h2><blockquote>
<p>æ³¨æ„åªæœ‰æ–°ç‰ˆASæ‰æœ‰è¿™ä¸ªé€‰é¡¹</p>
</blockquote>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404102342123.png"
                      alt="image-20230404102342123"
                ></p>
<hr>
<p>åå­—å°±å«Hello Composeå§</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404102915709.png"
                      alt="image-20230404102915709"
                ></p>
<p>finish</p>
<hr>
<p>ç¼–è¯‘å®Œæˆåæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·ä¸€ä¸ªç•Œé¢</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404110658795.png"
                      alt="image-20230404110658795" style="zoom: 200%;" 
                >

<p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªé€‚åˆComposeå¼€å‘çš„ç¯å¢ƒå·²ç»æ­å»ºå¥½äº†ï¼Œåé¢çš„ä»‹ç»ä¹Ÿæ˜¯åŸºäºæ­¤ç¯å¢ƒçš„ã€‚</p>
<hr>
<h3 id="setContentå‡½æ•°"><a href="#setContentå‡½æ•°" class="headerlink" title="setContentå‡½æ•°"></a>setContentå‡½æ•°</h3><p>ä¸å¸¸è§„çš„setContentViewå‡½æ•°ä¸åŒsetContentå‡½æ•°å¿…é¡»æ˜¯activityç»§æ‰¿ComponentActivityæ‰èƒ½ä½¿ç”¨ï¼Œå¹¶ä¸”å…¶æ¥æ”¶å‚æ•°ä¸ºå£°æ˜UIå†…å®¹çš„@Composableå‡½æ•°ã€‚</p>
<h3 id="Composable-æ³¨è§£"><a href="#Composable-æ³¨è§£" class="headerlink" title="@Composable æ³¨è§£"></a><strong>@Composable</strong> æ³¨è§£</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¡µé¢ä¸­çš„å¸¦æœ‰ <strong>@Composable</strong> æ³¨è§£çš„å‡½æ•° <strong>Greeting()</strong> ä¸<strong>DefaultPreview()</strong>,å®ƒä»¬éƒ½æ˜¯è¢«å£°æ˜ä¸ºUIå†…å®¹çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒä»¬éƒ½æ˜¯é¡µé¢ï¼›å­—é¢æ„æ€æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ç»„åˆé¡¹ã€‚ï¼ˆpsï¼šä¸‹æ–‡æ‰€è¯´çš„å¯ç»„åˆé¡¹éƒ½æ˜¯æŒ‡ä»£å¸¦æœ‰ <strong>@Composable</strong> æ³¨è§£çš„å‡½æ•°ï¼‰</p>
<h3 id="Preview-æ³¨è§£"><a href="#Preview-æ³¨è§£" class="headerlink" title="@Preview æ³¨è§£"></a>@Preview æ³¨è§£</h3><p>è¿™æ˜¯ä¸€ä¸ªé…åˆ**@Composable** æ³¨è§£ä½¿ç”¨çš„æ³¨è§£ï¼Œæ ‡è¯†ç€å¯ç»„åˆé¡¹å¯ä»¥è¢«é¢„è§ˆï¼Œè¿™ä¸ªæ³¨è§£çš„å¼ºå¤§åœ¨äºå¯ä»¥è¿è¡Œå•ä¸ªé¡µé¢å’ŒæŸ¥çœ‹å…¶ç‚¹å‡»æ•ˆæœã€‚è¯•æƒ³ä¸€ä¸‹å¦‚æœæˆ‘ä»¬åªè¿è¡Œä¸€ä¸ªé¡µé¢åœ¨æ‰‹æœºä¸Šï¼Œæ˜¯ä¸æ˜¯ä¼šå¿«å¾ˆå¤šã€‚</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/3B3A9318-411D-4B89-B6CD-7C756B346216.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<p>è¿™æ˜¯æœ€ç®€å•çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬ç‚¹è¿›@Previewçš„æºç </p>
<p>å‚æ•°ï¼š</p>
<ul>
<li><p>name-æ­¤é¢„è§ˆçš„æ˜¾ç¤ºåç§°ï¼Œå…è®¸åœ¨é¢æ¿ä¸­è¯†åˆ«å®ƒã€‚</p>
</li>
<li><p>group-æ­¤@Previewçš„ç»„åç§°ã€‚è¿™å…è®¸åœ¨UIä¸­å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä»…æ˜¾ç¤ºå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªã€‚</p>
</li>
<li><p>apiLevelâ€”å‘ˆç°å¸¦æ³¨é‡Šçš„@Composableæ—¶ä½¿ç”¨çš„APIçº§åˆ«</p>
</li>
<li><p>widthDpâ€”å°†åœ¨å…¶ä¸­æ¸²æŸ“å¸¦æ³¨é‡Šçš„@Composableçš„æœ€å¤§DPå®½åº¦ã€‚ä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥é™åˆ¶æ¸²æŸ“è§†å£çš„å¤§å°ã€‚</p>
</li>
<li><p>heightDp-å°†åœ¨å…¶ä¸­æ¸²æŸ“æ³¨é‡Šçš„@Composableçš„æœ€å¤§é«˜åº¦ï¼ˆä»¥DPä¸ºå•ä½ï¼‰ã€‚ä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥é™åˆ¶æ¸²æŸ“è§†å£çš„å¤§å°ã€‚</p>
</li>
<li><p>locale-åŒºåŸŸè®¾ç½®çš„å½“å‰ç”¨æˆ·é¦–é€‰é¡¹ï¼Œå¯¹åº”äºåŒºåŸŸè®¾ç½®èµ„æºé™å®šç¬¦ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨é»˜è®¤æ–‡ä»¶å¤¹ã€‚</p>
</li>
<li><p>fontScale-ç”¨æˆ·é¦–é€‰å­—ä½“çš„ç¼©æ”¾å› å­ï¼Œç›¸å¯¹äºåŸºæœ¬å¯†åº¦ç¼©æ”¾ã€‚</p>
</li>
<li><p>showSystemUi-å¦‚æœä¸ºtrueï¼Œå°†æ˜¾ç¤ºè®¾å¤‡çš„çŠ¶æ€æ å’Œæ“ä½œæ ã€‚@Composableå°†åœ¨å®Œæ•´æ´»åŠ¨çš„ä¸Šä¸‹æ–‡ä¸­å‘ˆç°ã€‚</p>
</li>
<li><p>showBackground-å¦‚æœä¸ºtrueï¼Œ@Composableå°†ä½¿ç”¨é»˜è®¤èƒŒæ™¯è‰²ã€‚</p>
</li>
<li><p>backgroundColor-èƒŒæ™¯çš„32ä½ARGBé¢œè‰²intï¼Œå¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä¸º0</p>
</li>
<li><p>uiModeâ€”æ ¹æ®android.content.res.Configuration.uiModeçš„uiæ¨¡å¼ä½æ©ç </p>
</li>
<li><p>deviceâ€”æŒ‡ç¤ºè¦åœ¨é¢„è§ˆä¸­ä½¿ç”¨çš„è®¾å¤‡çš„è®¾å¤‡å­—ç¬¦ä¸²ã€‚<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/361e12b1a2c64b41aa9494d52012bc15.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
</li>
</ul>
<p>æˆ‘ä»¬å°†DefaultPreviewæ”¹ä¸€ä¸‹ï¼ˆpsï¼šlocaleä¸ºè®¾ç½®ä¸åŒçš„ç”¨æˆ·è¯­è¨€åŒºåŸŸçš„å‚æ•°ï¼›å‚æ•° uiMode å¯æ¥å—ä»»æ„ Configuration.UI_* å¸¸é‡ï¼Œå¹¶å…è®¸æ‚¨ç›¸åº”åœ°æ›´æ”¹é¢„è§ˆçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†é¢„è§ˆè®¾ç½®ä¸ºå¤œé—´æ¨¡å¼ï¼Œçœ‹çœ‹ä¸»é¢˜å¦‚ä½•å“åº”ã€‚æœ¬ä¾‹ä¸­æœªä½“ç°ï¼‰</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Preview(name = <span class="string">&quot;name&quot;</span>,</span></span><br><span class="line"><span class="meta">    group = <span class="string">&quot;group&quot;</span>,</span></span><br><span class="line"><span class="meta">    widthDp = 100,</span></span><br><span class="line"><span class="meta">    heightDp = 100,</span></span><br><span class="line"><span class="meta">    fontScale = 2f,</span></span><br><span class="line"><span class="meta">    backgroundColor = 0xFF00FF00,</span></span><br><span class="line"><span class="meta">    showBackground = true,</span></span><br><span class="line"><span class="meta">    showSystemUi = true,</span></span><br><span class="line"><span class="meta">    device = Devices.NEXUS_5</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DefaultPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    PlayComposeTheme &#123;</span><br><span class="line">        Greeting(<span class="string">&quot;Android&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>é¢„è§ˆæ•ˆæœå¦‚ä¸‹</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/6b03da867db348c6a4acb57fdfdb3da7.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>æ³¨æ„ç‚¹<br><strong>showBackground å¿…é¡»ä¸ºtrueï¼ŒbackgroundColor å±æ€§æ‰ç”Ÿæ•ˆï¼Œå¹¶ä¸”backgroundColor æ˜¯ ARGB Longï¼Œè€Œä¸æ˜¯ Color å€¼</strong><br><strong>åŒä¸€ä¸ªå‡½æ•°å¯ä»¥ä½¿ç”¨å¤šä¸ª@Previewæ³¨è§£</strong></p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Preview(</span></span><br><span class="line"><span class="meta">    name = <span class="string">&quot;small font&quot;</span>,</span></span><br><span class="line"><span class="meta">    group = <span class="string">&quot;font scales&quot;</span>,</span></span><br><span class="line"><span class="meta">    fontScale = 0.5f</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Preview(</span></span><br><span class="line"><span class="meta">    name = <span class="string">&quot;large font&quot;</span>,</span></span><br><span class="line"><span class="meta">    group = <span class="string">&quot;font scales&quot;</span>,</span></span><br><span class="line"><span class="meta">    fontScale = 1.5f</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DefaultPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    PlayComposeTheme &#123;</span><br><span class="line">        Greeting(<span class="string">&quot;Android&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/6e3ebe99526e4bcba3e09b30899629d9.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<blockquote>
<p>å¦‚æœè¦ä¼ é€’å‚æ•°ï¼Œè¿˜æœ‰**@PreviewParameteræ³¨è§£**å¯ä»¥é…åˆä½¿ç”¨ã€‚</p>
</blockquote>
<h2 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404114115004.png"
                      alt="image-20230404114115004"
                ></p>
<p>å†æ¥çœ‹çœ‹é¡¹ç›®çš„ç»“æ„ï¼Œé¡¹ç›®åˆ›å»ºæˆåŠŸè¿‡åå·¦ä¾§è‡ªåŠ¨å¸®æˆ‘ä»¬å»ºå¥½äº†ä¸€ä¸ªå«ui.themeçš„æ–‡ä»¶å¤¹ï¼Œè¿™æ˜¯Composeæä¾›ç»™å¼€å‘è€…æ§åˆ¶é¢œè‰²ï¼Œå½¢çŠ¶,ä¸»é¢˜ï¼Œå­—ä½“çš„æ–‡ä»¶å¤¹ï¼Œç”¨ä»¥æ›¿ä»£xmlå¸ƒå±€å½“ä¸­çš„drawble,valuesæ–‡ä»¶å¤¹ï¼Œä¸éš¾çœ‹å‡ºä»¥åComposeæˆç†Ÿåçš„æƒ³æ³•ï¼Œè®²ä¸ªç¬‘è¯ <strong>å®˜ç½‘è¯´ï¼šâ€æˆ‘ä»¬ä¼šæ”¯æŒjavaï¼â€œ</strong></p>
<p>æˆ‘ä»¬ä¸»è¦è®²ä¸‹ä¸»é¢˜</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zyf.hellocompose.ui.theme</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.isSystemInDarkTheme</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.MaterialTheme</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.darkColors</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material.lightColors</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> DarkColorPalette = darkColors(</span><br><span class="line">    primary = Purple200,</span><br><span class="line">    primaryVariant = Purple700,</span><br><span class="line">    secondary = Teal200</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> LightColorPalette = lightColors(</span><br><span class="line">    primary = Purple500,</span><br><span class="line">    primaryVariant = Purple700,</span><br><span class="line">    secondary = Teal200</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Other default colors to override</span></span><br><span class="line"><span class="comment">    background = Color.White,</span></span><br><span class="line"><span class="comment">    surface = Color.White,</span></span><br><span class="line"><span class="comment">    onPrimary = Color.White,</span></span><br><span class="line"><span class="comment">    onSecondary = Color.Black,</span></span><br><span class="line"><span class="comment">    onBackground = Color.Black,</span></span><br><span class="line"><span class="comment">    onSurface = Color.Black,</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">HelloComposeTheme</span><span class="params">(darkTheme: <span class="type">Boolean</span> = isSystemInDarkTheme()</span></span>, content: <span class="meta">@Composable</span> () -&gt; <span class="built_in">Unit</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> colors = <span class="keyword">if</span> (darkTheme) &#123;</span><br><span class="line">        DarkColorPalette</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        LightColorPalette</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MaterialTheme(</span><br><span class="line">        colors = colors,</span><br><span class="line">        typography = Typography,</span><br><span class="line">        shapes = Shapes,</span><br><span class="line">        content = content</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<ul>
<li>DarkColorPaletteä¸LightColorPalette</li>
</ul>
<p>æ·±è‰²ä¸»é¢˜ä¸äº®è‰²ä¸»é¢˜ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ›´å¤šé¢œè‰²çš„ä¸»é¢˜å¯ä»¥åœ¨è¿™é‡Œå®šä¹‰ï¼Œé€šè¿‡å®šä¹‰ä¸»é¢˜çš„ä¸»è¦é¢œè‰²ï¼Œä¸»è¦å˜ä½“åŠæ¬¡è¦é¢œè‰²ç­‰å±æ€§é…ç½®ä½ æƒ³è¦çš„ä¸»é¢˜</p>
<ul>
<li><p>HelloComposeTheme</p>
<p>é¡¹ç›®ä¸­ä½¿ç”¨çš„ä¸»é¢˜ï¼Œæ˜¾è€Œæ˜“è§è¿™æ˜¯ä¸€ä¸ªå¯ç»„åˆé¡¹ï¼Œé€šè¿‡åˆ¤å®šç³»ç»Ÿçš„ä¸»é¢˜æ¥åˆ‡æ¢åˆé€‚çš„æ ·å¼ã€‚ä¸€èˆ¬åœ¨setContent{}ä¸­ åŒ…è£¹é¡µé¢ä½¿ç”¨</p>
<hr>
</li>
</ul>
<h2 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h2><p>å¤ä¹ ä¸€ä¸‹xmlå¸ƒå±€ä¸­å¸¸ç”¨çš„äº”å¤§å¸ƒå±€</p>
<ul>
<li><p><a class="link"   href="https://blog.csdn.net/weixin_45932709/article/details/123965369#1_3" >1.çº¿æ€§å¸ƒå±€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://blog.csdn.net/weixin_45932709/article/details/123965369#2_37" >2.ç›¸å¯¹å¸ƒå±€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://blog.csdn.net/weixin_45932709/article/details/123965369#3_111" >3.å¸§å¸ƒå±€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://blog.csdn.net/weixin_45932709/article/details/123965369#4_129" >4.è¡¨æ ¼å¸ƒå±€ï¼ˆä¸å¸¸ç”¨ï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
</li>
<li><p><a class="link"   href="https://blog.csdn.net/weixin_45932709/article/details/123965369#5_153" >5.ç»å¯¹å¸ƒå±€ï¼ˆä¸å¸¸ç”¨ï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<hr>
</li>
</ul>
<p>åœ¨Composeä¸­ï¼Œä¹Ÿæœ‰å‡ ç§å¸ƒå±€æ¦‚å¿µï¼Œåˆ†åˆ«ä¸º</p>
<h3 id="Column"><a href="#Column" class="headerlink" title="Column"></a>Column</h3><div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Greeting</span><span class="params">(name: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">        Text(text = <span class="string">&quot;Hello <span class="variable">$name</span>!&quot;</span>)</span><br><span class="line">        Text(text = <span class="string">&quot;Hello <span class="variable">$name</span>!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true, showSystemUi = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DefaultPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    HelloComposeTheme &#123;</span><br><span class="line">        Greeting(<span class="string">&quot;Compose&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å‚ç›´æ’åˆ—å…ƒç´ çš„å¸ƒå±€</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404144803400.png"
                      alt="image-20230404144803400"
                ></p>
<hr>
<h3 id="Row"><a href="#Row" class="headerlink" title="Row"></a>Row</h3><div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Greeting</span><span class="params">(name: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">//    Column() &#123;</span></span><br><span class="line"><span class="comment">//        Text(text = &quot;Hello $name!&quot;)</span></span><br><span class="line"><span class="comment">//        Text(text = &quot;Hello $name!&quot;)</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    Row() &#123;</span><br><span class="line">        Text(text = <span class="string">&quot;Hello <span class="variable">$name</span>!&quot;</span>)</span><br><span class="line">        Text(text = <span class="string">&quot;Hello <span class="variable">$name</span>!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true, showSystemUi = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DefaultPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    HelloComposeTheme &#123;</span><br><span class="line">        Greeting(<span class="string">&quot;Compose&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æ°´å¹³æ’åˆ—å…ƒç´ çš„å¸ƒå±€</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404145358361.png"
                      alt="image-20230404145358361"
                ></p>
<hr>
<h3 id="Box"><a href="#Box" class="headerlink" title="Box"></a>Box</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Composable</span><br><span class="line">fun Greeting(name: String) &#123;</span><br><span class="line">    Box() &#123;</span><br><span class="line">        Text(text = &quot;Hello $name!&quot;,Modifier.background(Color.Green).size(200.dp))</span><br><span class="line">        Text(text = &quot;11111111111111111111&quot;,Modifier.background(Color.Yellow))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Preview(showBackground = true, showSystemUi = true)</span><br><span class="line">@Composable</span><br><span class="line">fun DefaultPreview() &#123;</span><br><span class="line">    HelloComposeTheme &#123;</span><br><span class="line">        Greeting(&quot;Compose&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æŒ‰ç…§ä»£ç é¡ºåºå †ç Œåœ¨å¸ƒå±€ä¸­</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404150122732.png"
                      alt="image-20230404150122732"
                ></p>
<p>ä¸Šè¯‰ä»£ç ä¸­<strong>Modifier</strong>ä¸ºä¿®é¥°ç¬¦ï¼Œå…¶ä½œç”¨åœ¨äºä¿®é¥°å…¶å¯ç»„åˆé¡¹å¯ä»¥æ›´æ”¹å¯ç»„åˆé¡¹çš„å¤§å°ã€å¸ƒå±€ã€å¤–è§‚ï¼Œæˆ‘ä»¬å°±æ›´æ”¹äº†å¸ƒå±€çš„èƒŒæ™¯å’Œå°ºå¯¸ä»¥æ›´å¥½çš„è¡¨ç°Boxçš„ç‰¹æ€§</p>
<hr>
<h3 id="ConstraintLayout"><a href="#ConstraintLayout" class="headerlink" title="ConstraintLayout"></a>ConstraintLayout</h3><p>è¿™ä¸ªå¸ƒå±€è¦ä½¿ç”¨éœ€è¦æ·»åŠ å•ç‹¬çš„ä¾èµ–</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="code"><pre><span class="line">implementation &quot;androidx.constraintlayout:constraintlayout-compose:1.0.1&quot;</span><br></pre></td></tr></table></figure></div>



<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">Greeting</span><span class="params">(name: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    ConstraintLayout()&#123;</span><br><span class="line">        <span class="keyword">val</span> (view1, view2,view3) = createRefs()</span><br><span class="line">        Box(</span><br><span class="line">            Modifier.constrainAs(view1) &#123;</span><br><span class="line">                top.linkTo(parent.top)</span><br><span class="line">                start.linkTo(parent.start)</span><br><span class="line">                end.linkTo(parent.end)</span><br><span class="line">                bottom.linkTo(parent.bottom)</span><br><span class="line">            &#125;</span><br><span class="line">                .background(Color.Green)</span><br><span class="line">                .size(<span class="number">200.</span>dp)</span><br><span class="line">        )</span><br><span class="line">        Box(</span><br><span class="line">            Modifier.constrainAs(view2) &#123;</span><br><span class="line">                top.linkTo(view1.bottom)</span><br><span class="line">                start.linkTo(view1.start)</span><br><span class="line">            &#125;</span><br><span class="line">                .background(Color.Yellow)</span><br><span class="line">                .size(<span class="number">200.</span>dp)</span><br><span class="line">        )</span><br><span class="line">        Box(</span><br><span class="line">            Modifier.constrainAs(view3) &#123;</span><br><span class="line">                bottom.linkTo(view1.top)</span><br><span class="line">                start.linkTo(view1.start)</span><br><span class="line">            &#125;</span><br><span class="line">                .background(Color.Blue)</span><br><span class="line">                .size(<span class="number">200.</span>dp)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Preview(showBackground = true, showSystemUi = true)</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">DefaultPreview</span><span class="params">()</span></span> &#123;</span><br><span class="line">    HelloComposeTheme &#123;</span><br><span class="line">        Greeting(<span class="string">&quot;Compose&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure></div>

<p>ä»£ç å°†æ ¹æ®çº¦æŸæ¥ç¡®å®šè‡ªå·±çš„ä½ç½®ï¼Œè¦ä½¿ç”¨ConstraintLayoutéœ€è¦ç»å†ä¸‹åˆ—å‡ æ­¥æ“ä½œ</p>
<ul>
<li><p>é¦–å…ˆè¦ä½¿ç”¨**createRefs()**åˆ›å»ºçº¦æŸ</p>
</li>
<li><p>ç„¶åé€šè¿‡**Modifier.constrainAs()**ç»‘å®šçº¦æŸå’Œåˆ¶å®šçº¦æŸ</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/image-20230404152220446.png"
                      alt="image-20230404152220446"
                ></p>
</li>
</ul>
<h1 id="å››-å°è¯•ç‰›åˆ€"><a href="#å››-å°è¯•ç‰›åˆ€" class="headerlink" title="å››.å°è¯•ç‰›åˆ€"></a>å››.å°è¯•ç‰›åˆ€</h1><p>ç›¸ä¿¡çœ‹äº†ä¸Šè¿°çš„ä»£ç è¿‡åï¼Œä½ ä¼šå‘ç°å…¶å®å¾ˆå¤šä¸œè¥¿å’Œxmlè¿˜æ˜¯äº’é€šçš„ï¼Œä¸‡å˜ä¸ç¦»å…¶å®—å˜›ï¼Œåªæ˜¯æ¢äº†ä¸€ä¸ªè¡¨è¾¾æ–¹å¼è€Œå·²ï¼›</p>
<p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåˆ†äº«é¡µé¢çš„ç»˜åˆ¶æ¥å¯¹æ¯”ä¸€ä¸‹ä¸¤ç§æ–¹å¼çš„å·®åˆ«ï¼Œé¡ºä¾¿ç†Ÿæ‚‰ä¸‹å¯ç»„åˆé¡¹çš„ä½¿ç”¨æ–¹æ³•</p>
<p>  <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/80558c4acda64b398e9a52843cb831a5.png"
                      alt="image-20230404152220446"
                ></p>
<p>ä¸Šå›¾æ˜¯æˆ‘ç”¨xmlå®ç°çš„ï¼Œç‚¹å‡»æŒ‰é’®è¿‡åå¼¹å‡ºäºŒç»´ç åˆ†äº«é¡µé¢ï¼Œä¸‹é¢æ˜¯xmlä»£ç </p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">&lt;RelativeLayout</span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:background=<span class="string">&quot;#99000000&quot;</span></span><br><span class="line">    android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_above=<span class="string">&quot;@+id/bottom_layout&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:id=<span class="string">&quot;@+id/ll_qr_code&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;@dimen/dp270&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;@dimen/dp370&quot;</span></span><br><span class="line">            android:layout_centerInParent=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:background=<span class="string">&quot;@mipmap/self_qr_bg&quot;</span></span><br><span class="line">            android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/iv_avatar_address&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp40&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;@dimen/dp40&quot;</span></span><br><span class="line">                android:layout_gravity=<span class="string">&quot;center&quot;</span></span><br><span class="line">                android:layout_marginTop=<span class="string">&quot;@dimen/dp13&quot;</span></span><br><span class="line">                android:src=<span class="string">&quot;@mipmap/ic_show_qccode_head&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_gravity=<span class="string">&quot;center&quot;</span></span><br><span class="line">                android:layout_marginTop=<span class="string">&quot;@dimen/dp4&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;é‚€è¯·ä½ åŠ å…¥å·¥é˜Ÿ&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_1C1C1C&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;@dimen/sp13&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/tv_title&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_gravity=<span class="string">&quot;center&quot;</span></span><br><span class="line">                android:layout_marginTop=<span class="string">&quot;@dimen/dp3&quot;</span></span><br><span class="line">                android:ellipsize=<span class="string">&quot;end&quot;</span></span><br><span class="line">                android:singleLine=<span class="string">&quot;true&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_969696&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;@dimen/sp12&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/iv_qr_code&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp148&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;@dimen/dp148&quot;</span></span><br><span class="line">                android:layout_gravity=<span class="string">&quot;center&quot;</span></span><br><span class="line">                android:layout_marginTop=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:src=<span class="string">&quot;@mipmap/add&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_gravity=<span class="string">&quot;center&quot;</span></span><br><span class="line">                android:layout_marginTop=<span class="string">&quot;@dimen/dp20&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;æ‰«ç ç«‹å³åŠ å…¥&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;@dimen/sp12&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:id=<span class="string">&quot;@+id/bottom_layout&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;@dimen/dp167&quot;</span></span><br><span class="line">        android:layout_alignParentBottom=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:background=<span class="string">&quot;@drawable/shape_top_round_white_14&quot;</span></span><br><span class="line">        android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">            android:layout_marginTop=<span class="string">&quot;@dimen/dp25&quot;</span></span><br><span class="line">            android:orientation=<span class="string">&quot;horizontal&quot;</span></span><br><span class="line">            android:paddingStart=<span class="string">&quot;@dimen/dp8&quot;</span></span><br><span class="line">            android:paddingEnd=<span class="string">&quot;@dimen/dp8&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/tv_dingding&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">                android:drawableTop=<span class="string">&quot;@mipmap/icon_details_share_dingding&quot;</span></span><br><span class="line">                android:drawablePadding=<span class="string">&quot;@dimen/dp8&quot;</span></span><br><span class="line">                android:gravity=<span class="string">&quot;center_horizontal&quot;</span></span><br><span class="line">                android:minWidth=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;é’‰é’‰&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;12sp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/tv_qq&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">                android:drawableTop=<span class="string">&quot;@mipmap/icon_details_share_qq&quot;</span></span><br><span class="line">                android:drawablePadding=<span class="string">&quot;@dimen/dp8&quot;</span></span><br><span class="line">                android:gravity=<span class="string">&quot;center_horizontal&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;QQ&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;12sp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/tv_wechat&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">                android:drawableTop=<span class="string">&quot;@mipmap/icon_details_share_wechat&quot;</span></span><br><span class="line">                android:drawablePadding=<span class="string">&quot;@dimen/dp8&quot;</span></span><br><span class="line">                android:gravity=<span class="string">&quot;center_horizontal&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;å¾®ä¿¡å¥½å‹&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;12sp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/tv_wechat_moments&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">                android:drawableTop=<span class="string">&quot;@mipmap/icon_details_share_wechat_moments&quot;</span></span><br><span class="line">                android:drawablePadding=<span class="string">&quot;@dimen/dp8&quot;</span></span><br><span class="line">                android:gravity=<span class="string">&quot;center_horizontal&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;æœ‹å‹åœˆ&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;12sp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/tv_copy&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">                android:drawableTop=<span class="string">&quot;@mipmap/icon_details_share_copy&quot;</span></span><br><span class="line">                android:drawablePadding=<span class="string">&quot;@dimen/dp8&quot;</span></span><br><span class="line">                android:gravity=<span class="string">&quot;center_horizontal&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;å¤åˆ¶é“¾æ¥&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;12sp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:id=<span class="string">&quot;@+id/tv_save&quot;</span></span><br><span class="line">                android:layout_width=<span class="string">&quot;@dimen/dp45&quot;</span></span><br><span class="line">                android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">                android:layout_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">                android:drawableTop=<span class="string">&quot;@mipmap/icon_details_share_save&quot;</span></span><br><span class="line">                android:drawablePadding=<span class="string">&quot;@dimen/dp8&quot;</span></span><br><span class="line">                android:gravity=<span class="string">&quot;center_horizontal&quot;</span></span><br><span class="line">                android:text=<span class="string">&quot;ä¿å­˜å›¾ç‰‡&quot;</span></span><br><span class="line">                android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">                android:textSize=<span class="string">&quot;12sp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">&quot;@+id/tv_cancel&quot;</span></span><br><span class="line">            android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">            android:layout_height=<span class="string">&quot;@dimen/dp48&quot;</span></span><br><span class="line">            android:layout_alignParentBottom=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:background=<span class="string">&quot;@color/white&quot;</span></span><br><span class="line">            android:gravity=<span class="string">&quot;center&quot;</span></span><br><span class="line">            android:text=<span class="string">&quot;å–æ¶ˆ&quot;</span></span><br><span class="line">            android:textColor=<span class="string">&quot;@color/color_666666&quot;</span></span><br><span class="line">            android:textSize=<span class="string">&quot;16sp&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>å› ä¸ºæ˜¯é€æ˜å¼¹çª—ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªé€æ˜å¼¹çª—çš„æ ·å¼ï¼Œè¿™ä¸ªcomposeä¹Ÿæ˜¯ä¸€æ ·çš„</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">&lt;!--é€æ˜activityçš„style--&gt;</span><br><span class="line">&lt;style name=<span class="string">&quot;transparent_activity&quot;</span>&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;android:windowBackground&quot;</span>&gt;<span class="meta">@color</span>/transparent&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;android:windowNoTitle&quot;</span>&gt;<span class="literal">true</span>&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;android:windowIsTranslucent&quot;</span>&gt;<span class="literal">true</span>&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">&quot;android:windowAnimationStyle&quot;</span>&gt;<span class="meta">@android</span>:style/Animation.Translucent&lt;/item&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></div>

<h2 id="Composeå®ç°"><a href="#Composeå®ç°" class="headerlink" title="Composeå®ç°"></a>Composeå®ç°</h2><p>é€šè¿‡ä¸Šé¢çš„xmlå¸ƒå±€ä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬æƒ³è¦å®ç°çš„è¿™ä¸ªåˆ†äº«é¡µé¢ï¼Œç»“æ„å¦‚ä¸‹<br>  <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/975cb32ea56f4b50aa1e262e56eab84c.png"
                      alt="image-20230404152220446"
                ><br>æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ†äº«é¡µé¢æ‹†åˆ†ä¸º äºŒç»´ç åˆ†äº«ç»„ä»¶å’Œåº•éƒ¨åˆ†äº«ç»„ä»¶æ¥å®ç°ï¼Œåº•éƒ¨åˆ†äº«ç»„ä»¶åœ¨ä¸‹æ–¹ï¼ŒäºŒç»´ç åˆ†äº«ç»„ä»¶åœ¨ä¸­é—´ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨äº†çº¦æŸå¸ƒå±€</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ†äº«é¡µé¢</span></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ShareQRCode</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ConstraintLayout &#123;</span><br><span class="line">        <span class="keyword">val</span> (bottomLayout, llQrcode) = createRefs()</span><br><span class="line"></span><br><span class="line">		<span class="comment">//äºŒç»´ç åˆ†äº«ç»„ä»¶</span></span><br><span class="line">        LinearLayoutQrcode(</span><br><span class="line">            Modifier.constrainAs(llQrcode)&#123;</span><br><span class="line">                top.linkTo(parent.top)</span><br><span class="line">                start.linkTo(parent.start)</span><br><span class="line">                end.linkTo(parent.end)</span><br><span class="line">                bottom.linkTo(parent.bottom)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">		<span class="comment">//åº•éƒ¨åˆ†äº«ç»„ä»¶</span></span><br><span class="line">        BottomLayout(</span><br><span class="line">            modifier = Modifier.constrainAs(bottomLayout) &#123;</span><br><span class="line">                bottom.linkTo(parent.bottom)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="1-åº•éƒ¨åˆ†äº«ç»„ä»¶"><a href="#1-åº•éƒ¨åˆ†äº«ç»„ä»¶" class="headerlink" title="1.åº•éƒ¨åˆ†äº«ç»„ä»¶"></a>1.åº•éƒ¨åˆ†äº«ç»„ä»¶</h2><p>è®©æˆ‘ä»¬æ¥åˆ†æä¸‹ï¼Œåº•éƒ¨åˆ†äº«ç»„ä»¶éœ€è¦å“ªäº›å…ƒç´ <br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/7e64312536814309903d71be14bfd921.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿™æ ·ä¸€ä¸ªç»“æ„æ¥å®ç°</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">Column&#123;<span class="comment">//èƒŒæ™¯éœ€è¦åŠåœ†è§’</span></span><br><span class="line"></span><br><span class="line"> Row&#123;</span><br><span class="line">	<span class="comment">//è¿™é‡Œæœ‰å…­ä¸ªæŒ‰é’®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å–æ¶ˆæŒ‰é’®éœ€è¦åœ¨åº•éƒ¨</span></span><br><span class="line">Button&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="a-èƒŒæ™¯åŠåœ†è§’"><a href="#a-èƒŒæ™¯åŠåœ†è§’" class="headerlink" title="a.èƒŒæ™¯åŠåœ†è§’"></a>a.èƒŒæ™¯åŠåœ†è§’</h3><div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">Column(</span><br><span class="line">     modifier = modifier</span><br><span class="line">         .height(<span class="number">167.</span>dp)</span><br><span class="line">         .background(</span><br><span class="line">             colorResource(R.color.color_f5f5f5),</span><br><span class="line">             shape = RoundedCornerShape(<span class="number">16.</span>dp, <span class="number">16.</span>dp, <span class="number">0.</span>dp, <span class="number">0.</span>dp)</span><br><span class="line">         )</span><br><span class="line"> )</span><br></pre></td></tr></table></figure></div>

<p>shape å±æ€§è®¾ç½®åœ†è§’ï¼Œä¸Šè¿°ä»£ç ä¸­RoundedCornerShapeåˆ†åˆ«è®¾ç½®å·¦ä¸Šï¼Œå³ä¸Šï¼Œå·¦ä¸‹ï¼Œå³ä¸‹çš„åœ†è§’<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/86d942f964f8449db6be0b585c29280a.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<h3 id="b-è‡ªå®šä¹‰åˆ†äº«æŒ‰é’®"><a href="#b-è‡ªå®šä¹‰åˆ†äº«æŒ‰é’®" class="headerlink" title="b.è‡ªå®šä¹‰åˆ†äº«æŒ‰é’®"></a>b.è‡ªå®šä¹‰åˆ†äº«æŒ‰é’®</h3><p> è‡ªå®šä¹‰åˆ†äº«æŒ‰é’®çš„æ ·å¼æ˜¯è¿™æ ·çš„<br> <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/c209d631cc8449ea8e6de929929f6af6.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>ä¸Šé¢æ˜¯ä¸€ä¸ªå›¾ç‰‡ï¼Œä¸‹é¢æ˜¯æ–‡å­—ï¼Œç„¶åéƒ½æœ‰ä¸€ä¸ªå±€å±…ä¸­ï¼Œä»£ç å¦‚ä¸‹</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ImageButton</span><span class="params">(<span class="meta">@DrawableRes</span> id: <span class="type">Int</span>, text: <span class="type">String</span>, modifier: <span class="type">Modifier</span>)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier</span><br><span class="line">            .width(<span class="number">45.</span>dp),</span><br><span class="line">    ) &#123;</span><br><span class="line">        Image(</span><br><span class="line">            painter = painterResource(id = id),</span><br><span class="line">            contentDescription = <span class="string">&quot;&quot;</span>,</span><br><span class="line">            Modifier</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .padding(bottom = <span class="number">8.</span>dp),</span><br><span class="line">            Alignment.Center</span><br><span class="line">        )</span><br><span class="line">        Text(</span><br><span class="line">            text = text,</span><br><span class="line">            fontSize = <span class="number">11.</span>sp,</span><br><span class="line">            color = colorResource(id = R.color.color_666666),</span><br><span class="line">            textAlign = TextAlign.Center,</span><br><span class="line">            modifier = Modifier.fillMaxWidth()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>Alignment.Center</strong>æ˜¯ä¸€ä¸ªå±…ä¸­å±æ€§ï¼Œ<strong>TextAlign.Center</strong>ä»£è¡¨æ–‡å­—å±…ä¸­ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘å‘ç°å•ç‹¬ä½¿ç”¨Alignment.Centerå¹¶ä¸ç”Ÿæ•ˆï¼Œäºæ˜¯æˆ‘æ­é…äº†Modifier.fillMaxWidth()ä½¿å…¶ç”Ÿæ•ˆï¼ŒpainterResourceæ˜¯ä½¿ç”¨å›¾ç‰‡èµ„æºå‡½æ•°</p>
<p>ç„¶åå†åœ¨rowä¸­ä½¿ç”¨ï¼Œä»xmlä¸­å¯ä»¥çœ‹åˆ°è¿™ä¸ªåœ°æ–¹ä½¿ç”¨äº†æƒé‡ï¼Œåœ¨composeä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ Modifier.weight()å±æ€§æ¥ä»£æ›¿</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">Row(</span><br><span class="line">           Modifier</span><br><span class="line">               .fillMaxWidth()</span><br><span class="line">               .padding(<span class="number">8.</span>dp, <span class="number">25.</span>dp, <span class="number">8.</span>dp, <span class="number">0.</span>dp)</span><br><span class="line"></span><br><span class="line">       ) &#123;</span><br><span class="line">           ImageButton(</span><br><span class="line">               id = R.mipmap.icon_details_share_dingding,</span><br><span class="line">               text = <span class="string">&quot;é’‰é’‰&quot;</span>,</span><br><span class="line">               Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">           )</span><br><span class="line">           ImageButton(</span><br><span class="line">               id = R.mipmap.icon_details_share_qq,</span><br><span class="line">               text = <span class="string">&quot;QQ&quot;</span>,</span><br><span class="line">               Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">           )</span><br><span class="line">           ImageButton(</span><br><span class="line">               id = R.mipmap.icon_details_share_wechat,</span><br><span class="line">               text = <span class="string">&quot;å¾®ä¿¡å¥½å‹&quot;</span>,</span><br><span class="line">               Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">           )</span><br><span class="line">           ImageButton(</span><br><span class="line">               id = R.mipmap.icon_details_share_wechat_moments,</span><br><span class="line">               text = <span class="string">&quot;æœ‹å‹åœˆ&quot;</span>,</span><br><span class="line">               Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">           )</span><br><span class="line">           ImageButton(</span><br><span class="line">               id = R.mipmap.icon_details_share_copy,</span><br><span class="line">               text = <span class="string">&quot;å¤åˆ¶é“¾æ¥&quot;</span>,</span><br><span class="line">               Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">           )</span><br><span class="line">           ImageButton(</span><br><span class="line">               id = R.mipmap.icon_details_share_save,</span><br><span class="line">               text = <span class="string">&quot;ä¿å­˜å›¾ç‰‡&quot;</span>,</span><br><span class="line">               Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">           )</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="c-åœ¨åº•éƒ¨çš„å–æ¶ˆæŒ‰é’®"><a href="#c-åœ¨åº•éƒ¨çš„å–æ¶ˆæŒ‰é’®" class="headerlink" title="c.åœ¨åº•éƒ¨çš„å–æ¶ˆæŒ‰é’®"></a>c.åœ¨åº•éƒ¨çš„å–æ¶ˆæŒ‰é’®</h3><p> ä¸ºäº†å­¦ä¹ å˜›ï¼Œå°±å°è¯•äº†å¦å¤–ä¸€ç§å°†æ§ä»¶æ”¾äºåº•éƒ¨çš„æ–¹å¼</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"> Column(</span><br><span class="line">            Modifier.fillMaxHeight(),</span><br><span class="line">            Arrangement.Bottom</span><br><span class="line">        )&#123;</span><br><span class="line">Buttonï¼ˆï¼‰&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="d-æ€»ä½“"><a href="#d-æ€»ä½“" class="headerlink" title="d.æ€»ä½“"></a>d.æ€»ä½“</h3><p>è¿™é‡Œä¸ºäº†æ˜¾ç¤ºç‚¹å‡»çš„Toastï¼Œå¤šä¼ é€’äº†ä¸€ä¸ªcontext: Activityï¼ŒBottomLayoutå®Œæ•´ä»£ç å¦‚ä¸‹</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">BottomLayout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    context: <span class="type">Activity</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = modifier</span><br><span class="line">            .height(<span class="number">167.</span>dp)</span><br><span class="line">            .background(</span><br><span class="line">                colorResource(R.color.color_f5f5f5),</span><br><span class="line">                shape = RoundedCornerShape(<span class="number">16.</span>dp, <span class="number">16.</span>dp, <span class="number">0.</span>dp, <span class="number">0.</span>dp)</span><br><span class="line">            )</span><br><span class="line">    ) &#123;</span><br><span class="line">        Row(</span><br><span class="line">            Modifier</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .padding(<span class="number">8.</span>dp, <span class="number">25.</span>dp, <span class="number">8.</span>dp, <span class="number">0.</span>dp)</span><br><span class="line"></span><br><span class="line">        ) &#123;</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_dingding,</span><br><span class="line">                text = <span class="string">&quot;é’‰é’‰&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_qq,</span><br><span class="line">                text = <span class="string">&quot;QQ&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_wechat,</span><br><span class="line">                text = <span class="string">&quot;å¾®ä¿¡å¥½å‹&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_wechat_moments,</span><br><span class="line">                text = <span class="string">&quot;æœ‹å‹åœˆ&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_copy,</span><br><span class="line">                text = <span class="string">&quot;å¤åˆ¶é“¾æ¥&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_save,</span><br><span class="line">                text = <span class="string">&quot;ä¿å­˜å›¾ç‰‡&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Column(</span><br><span class="line">            Modifier.fillMaxHeight(),</span><br><span class="line">            Arrangement.Bottom</span><br><span class="line">        ) &#123;</span><br><span class="line">            Button(</span><br><span class="line">                onClick = &#123;</span><br><span class="line">                    Toast.makeText(context, <span class="string">&quot;å–æ¶ˆåˆ†äº«&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">                    context.finish()</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line">                Modifier.fillMaxWidth(),</span><br><span class="line">                colors = ButtonDefaults.buttonColors(</span><br><span class="line">                    containerColor = Color.White</span><br><span class="line">                ),</span><br><span class="line">                shape = RoundedCornerShape(<span class="number">0.</span>dp)<span class="comment">//åœ†è§’</span></span><br><span class="line"></span><br><span class="line">            ) &#123;</span><br><span class="line">                Text(</span><br><span class="line">                    text = <span class="string">&quot;å–æ¶ˆ&quot;</span>,</span><br><span class="line">                    fontSize = <span class="number">16.</span>sp,</span><br><span class="line">                    textAlign = TextAlign.Center,</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .fillMaxWidth()</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ImageButton</span><span class="params">(<span class="meta">@DrawableRes</span> id: <span class="type">Int</span>, text: <span class="type">String</span>, modifier: <span class="type">Modifier</span>)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier</span><br><span class="line">            .width(<span class="number">45.</span>dp),</span><br><span class="line">    ) &#123;</span><br><span class="line">        Image(</span><br><span class="line">            painter = painterResource(id = id),</span><br><span class="line">            contentDescription = <span class="string">&quot;&quot;</span>,</span><br><span class="line">            Modifier</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .padding(bottom = <span class="number">8.</span>dp),</span><br><span class="line">            Alignment.Center</span><br><span class="line">        )</span><br><span class="line">        Text(</span><br><span class="line">            text = text,</span><br><span class="line">            fontSize = <span class="number">11.</span>sp,</span><br><span class="line">            color = colorResource(id = R.color.color_666666),</span><br><span class="line">            textAlign = TextAlign.Center,</span><br><span class="line">            modifier = Modifier.fillMaxWidth()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æ•ˆæœå¦‚ä¸‹<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/7344695b99454ad5a355f893d7ffc12c.jpeg"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<h2 id="2-äºŒç»´ç åˆ†äº«ç»„ä»¶"><a href="#2-äºŒç»´ç åˆ†äº«ç»„ä»¶" class="headerlink" title="2.äºŒç»´ç åˆ†äº«ç»„ä»¶"></a>2.äºŒç»´ç åˆ†äº«ç»„ä»¶</h2><p>ä¸€æ ·çš„æˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/c0053df1dead413982c1524b3d9992d0.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>å¯ä»¥çœ‹å‡ºäºŒç»´ç åˆ†äº«ç»„ä»¶è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå½“ç„¶åœ¨ç»˜åˆ¶ç»„ä»¶å‰è¿˜è¦å®šä½</p>
<h3 id="a-ç»„ä»¶å±…ä¸­"><a href="#a-ç»„ä»¶å±…ä¸­" class="headerlink" title="a.ç»„ä»¶å±…ä¸­"></a>a.ç»„ä»¶å±…ä¸­</h3><p>é¦–å…ˆæˆ‘ä»¬è®©å®ƒæ˜¾ç¤ºå‡ºæ¥</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LinearLayoutQrcode</span><span class="params">(modifier: <span class="type">Modifier</span>)</span></span>&#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier.paint(painterResource(id = R.mipmap.self_qr_bg))</span><br><span class="line">            .width(<span class="number">270.</span>dp)</span><br><span class="line">            .height(<span class="number">370.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œå‡ºæ¥æ•ˆæœå¦‚ä¸‹ï¼Œæ˜¾è€Œæ˜“è§ï¼Œè¿™å’Œæˆ‘ä»¬ç†æƒ³ä¸­çš„æ•ˆæœæœ‰ç‚¹åå·®<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/00145d66ded7497b8250a6950afb373e.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>å¯¹æ¯”äº†ä¸‹ä¹‹å‰çš„xmlå¸ƒå±€ï¼Œå‘ç°æˆ‘ä»¬åœ¨composeä¸­çš„ç»„ä»¶æ˜¯å±…äºçˆ¶å¸ƒå±€å±…ä¸­çš„ï¼Œxmlå¸ƒå±€æ˜¯ä¸ŠåŠéƒ¨åˆ†å¸ƒå±€å±…ä¸­çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹ï¼Œå°†ConstraintLayoutä¸­çš„å±…ä¸­å–æ¶ˆï¼Œå¹¶åœ¨Columnä¸­å±…ä¸­</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•ç”¨</span></span><br><span class="line">        LinearLayoutQrcode(</span><br><span class="line">            Modifier.constrainAs(llQrcode)&#123;</span><br><span class="line"><span class="comment">//                top.linkTo(parent.top)</span></span><br><span class="line"><span class="comment">//                start.linkTo(parent.start)</span></span><br><span class="line"><span class="comment">//                end.linkTo(parent.end)</span></span><br><span class="line"><span class="comment">//                bottom.linkTo(parent.bottom)</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LinearLayoutQrcode</span><span class="params">(modifier: <span class="type">Modifier</span>)</span></span>&#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier.paint(painterResource(id = R.mipmap.self_qr_bg))</span><br><span class="line">            .fillMaxSize(),</span><br><span class="line">        verticalArrangement = Arrangement.Center,</span><br><span class="line">        horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line"></span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>ç„¶è€Œå¹¶æ²¡æœ‰å˜åŒ–ï¼Œç»™æˆ‘å¹²è’™äº†ï¼Œåœ¨ä»”ç»†æ£€æŸ¥åï¼Œæˆ‘è§‰å¾—å¯èƒ½æ˜¯å› ä¸ºLinearLayoutQrcodeä½¿ç”¨çš„æ˜¯çˆ¶å¸ƒå±€çš„modifierï¼Œæ‰€ä»¥fillMaxSizeå±æ€§ä¹Ÿæ˜¯çˆ¶å¸ƒå±€çš„ï¼Œæ‰€ä»¥æˆ‘ç”¨äº†å¦å¤–ä¸€ä¸ªåŠæ³•ï¼Œå…ˆè®©LinearLayoutQrcodeç»„ä»¶è®¾ç½®ä¸€ä¸ªå’ŒBottomLayouté«˜åº¦ä¸€æ ·çš„å¤–è¾¹è·ï¼Œç„¶åå†è®©å®ƒå±…ä¸­ï¼Œå°±èƒ½å®ç°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œå¯æ˜¯composeæ²¡æœ‰å¤–è¾¹è·ï¼Œæ‰€ä»¥æˆ‘å¤šåŒ…äº†ä¸€å±‚Columnï¼Œä»£ç å¦‚ä¸‹</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¼•ç”¨</span></span><br><span class="line">        LinearLayoutQrcode(</span><br><span class="line">            Modifier.constrainAs(llQrcode)&#123;</span><br><span class="line">                top.linkTo(parent.top)</span><br><span class="line">                start.linkTo(parent.start)</span><br><span class="line">                end.linkTo(parent.end)</span><br><span class="line">                bottom.linkTo(parent.bottom)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LinearLayoutQrcode</span><span class="params">(modifier: <span class="type">Modifier</span>)</span></span>&#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier</span><br><span class="line">            .padding(bottom = <span class="number">167.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">        Column(</span><br><span class="line">            Modifier.paint(painterResource(id = R.mipmap.self_qr_bg)),</span><br><span class="line">            horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">        ) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æ•ˆæœ<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/a72ff79407e243d0b66a5f1609d8fd35.jpeg"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>å¯ä»¥çœ‹åˆ°ï¼Œéå¸¸ç†æƒ³å•Šï¼Œæˆ‘ä»¬ç»§ç»­ä¸‹ä¸€æ­¥</p>
<h3 id="b-é¡¶éƒ¨å¤´åƒ"><a href="#b-é¡¶éƒ¨å¤´åƒ" class="headerlink" title="b.é¡¶éƒ¨å¤´åƒ"></a>b.é¡¶éƒ¨å¤´åƒ</h3><div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">Image(</span><br><span class="line">               painter = painterResource(id = R.mipmap.ic_show_qccode_head),</span><br><span class="line">               contentDescription = <span class="string">&quot;é»˜è®¤å¤´åƒ&quot;</span>,</span><br><span class="line">               Modifier</span><br><span class="line">                   .width(<span class="number">53.</span>dp)</span><br><span class="line">                   .height(<span class="number">53.</span>dp)</span><br><span class="line">                   .padding(top = <span class="number">13.</span>dp)</span><br><span class="line">           )</span><br><span class="line">           Text(</span><br><span class="line">               text = <span class="string">&quot;é‚€è¯·ä½ åŠ å…¥å·¥é˜Ÿ&quot;</span>,</span><br><span class="line">               color = colorResource(id = R.color.color_1C1C1C),</span><br><span class="line">               fontSize = <span class="number">13.</span>sp,</span><br><span class="line">               textAlign = TextAlign.Center,</span><br><span class="line">               modifier = Modifier</span><br><span class="line">                   .fillMaxWidth()</span><br><span class="line">           )</span><br><span class="line">           Text(</span><br><span class="line">               text = <span class="string">&quot;æ°´ç”µè´¹-è¯•ä¸€è¯•1-æ–½å·¥é˜Ÿ&quot;</span>, color = colorResource(id = R.color.color_969696),</span><br><span class="line">               fontSize = <span class="number">12.</span>sp,</span><br><span class="line">               textAlign = TextAlign.Center,</span><br><span class="line">               modifier = Modifier</span><br><span class="line">                   .fillMaxWidth()</span><br><span class="line">                   .padding(top = <span class="number">3.</span>dp)</span><br><span class="line">           )</span><br></pre></td></tr></table></figure></div>

<p>è¿™å°±æ²¡å•¥å¥½è¯´çš„ï¼Œæ¯”è¾ƒç®€å•ï¼Œæœ‰ç‚¹ä¸ä¹ æƒ¯çš„å°±æ˜¯æ²¡æœ‰äº†å¤–è¾¹è·ï¼Œå¥½éš¾å—å¥½éš¾å—<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/80558c4acda64b398e9a52843cb831a5.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<h3 id="c-äºŒç»´ç "><a href="#c-äºŒç»´ç " class="headerlink" title="c.äºŒç»´ç "></a>c.äºŒç»´ç </h3><p>æœ€ååŠ ä¸ŠäºŒç»´ç </p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">Image(</span><br><span class="line">               painter = painterResource(id = R.mipmap.qrcode),</span><br><span class="line">               contentDescription = <span class="string">&quot;é»˜è®¤å¤´åƒ&quot;</span>,</span><br><span class="line">               Modifier</span><br><span class="line">                   .width(<span class="number">193.</span>dp)</span><br><span class="line">                   .height(<span class="number">193.</span>dp)</span><br><span class="line">                   .padding(top = <span class="number">45.</span>dp),</span><br><span class="line"></span><br><span class="line">               )</span><br><span class="line"></span><br><span class="line">           Text(</span><br><span class="line">               text = <span class="string">&quot;æ‰«ç ç«‹å³åŠ å…¥&quot;</span>,</span><br><span class="line">               color = colorResource(id = R.color.color_666666),</span><br><span class="line">               fontSize = <span class="number">12.</span>sp,</span><br><span class="line">               textAlign = TextAlign.Center,</span><br><span class="line">               modifier = Modifier</span><br><span class="line">                   .fillMaxWidth()</span><br><span class="line">                   .padding(top = <span class="number">20.</span>dp)</span><br><span class="line">           )</span><br></pre></td></tr></table></figure></div>

<p>å¤§åŠŸå‘Šæˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ•ˆæœ</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/80558c4acda64b398e9a52843cb831a5.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<p>éå¸¸çš„å®Œç¾å•Šï¼Œå’Œxmlåˆ†æ¯«ä¸å·®ï¼Œå¤§åŠŸå‘Šæˆï¼Œå®Œæ•´ä»£ç </p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xf.mycomepose</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity</span><br><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageButton</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast</span><br><span class="line"><span class="keyword">import</span> androidx.activity.ComponentActivity</span><br><span class="line"><span class="keyword">import</span> androidx.activity.compose.setContent</span><br><span class="line"><span class="keyword">import</span> androidx.<span class="keyword">annotation</span>.DrawableRes</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.Image</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.background</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.shape.CornerBasedShape</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.shape.CornerSize</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.shape.RoundedCornerShape</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.*</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composable</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Alignment</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.draw.drawBehind</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.draw.paint</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.Color</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.graphics.RectangleShape</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.res.colorResource</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.res.painterResource</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.text.style.TextAlign</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.tooling.preview.Preview</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.dp</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.unit.sp</span><br><span class="line"><span class="keyword">import</span> androidx.constraintlayout.compose.ConstraintLayout</span><br><span class="line"><span class="keyword">import</span> com.xf.mycomepose.ui.theme.MyComeposeTheme</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShareQRCodeActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            MyComeposeTheme &#123;</span><br><span class="line">                <span class="comment">// A surface container using the &#x27;background&#x27; color from the theme</span></span><br><span class="line">                Surface(</span><br><span class="line">                    modifier = Modifier.fillMaxSize(),</span><br><span class="line">                    color = Color(<span class="number">99000000</span>)</span><br><span class="line">                ) &#123;</span><br><span class="line">                    ShareQRCode(<span class="keyword">this</span><span class="symbol">@ShareQRCodeActivity</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ShareQRCode</span><span class="params">(context: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">    ConstraintLayout &#123;</span><br><span class="line">        <span class="keyword">val</span> (bottomLayout, llQrcode) = createRefs()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        LinearLayoutQrcode(</span><br><span class="line">            Modifier.constrainAs(llQrcode) &#123;</span><br><span class="line">                top.linkTo(parent.top)</span><br><span class="line">                start.linkTo(parent.start)</span><br><span class="line">                end.linkTo(parent.end)</span><br><span class="line">                bottom.linkTo(parent.bottom)</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        BottomLayout(</span><br><span class="line">            modifier = Modifier.constrainAs(bottomLayout) &#123;</span><br><span class="line">                bottom.linkTo(parent.bottom)</span><br><span class="line">            &#125;,</span><br><span class="line">            context = context</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">LinearLayoutQrcode</span><span class="params">(modifier: <span class="type">Modifier</span>)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier</span><br><span class="line">            .padding(bottom = <span class="number">167.</span>dp)</span><br><span class="line">    ) &#123;</span><br><span class="line"></span><br><span class="line">        Column(</span><br><span class="line">            Modifier.paint(painterResource(id = R.mipmap.self_qr_bg)),</span><br><span class="line">            horizontalAlignment = Alignment.CenterHorizontally</span><br><span class="line">        ) &#123;</span><br><span class="line"></span><br><span class="line">            Image(</span><br><span class="line">                painter = painterResource(id = R.mipmap.ic_show_qccode_head),</span><br><span class="line">                contentDescription = <span class="string">&quot;é»˜è®¤å¤´åƒ&quot;</span>,</span><br><span class="line">                Modifier</span><br><span class="line">                    .width(<span class="number">53.</span>dp)</span><br><span class="line">                    .height(<span class="number">53.</span>dp)</span><br><span class="line">                    .padding(top = <span class="number">13.</span>dp)</span><br><span class="line">            )</span><br><span class="line">            Text(</span><br><span class="line">                text = <span class="string">&quot;é‚€è¯·ä½ åŠ å…¥å·¥é˜Ÿ&quot;</span>,</span><br><span class="line">                color = colorResource(id = R.color.color_1C1C1C),</span><br><span class="line">                fontSize = <span class="number">13.</span>sp,</span><br><span class="line">                textAlign = TextAlign.Center,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">            )</span><br><span class="line">            Text(</span><br><span class="line">                text = <span class="string">&quot;æ°´ç”µè´¹-è¯•ä¸€è¯•1-æ–½å·¥é˜Ÿ&quot;</span>,</span><br><span class="line">                color = colorResource(id = R.color.color_969696),</span><br><span class="line">                fontSize = <span class="number">12.</span>sp,</span><br><span class="line">                textAlign = TextAlign.Center,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">                    .padding(top = <span class="number">3.</span>dp)</span><br><span class="line">            )</span><br><span class="line">            Image(</span><br><span class="line">                painter = painterResource(id = R.mipmap.qrcode),</span><br><span class="line">                contentDescription = <span class="string">&quot;é»˜è®¤å¤´åƒ&quot;</span>,</span><br><span class="line">                Modifier</span><br><span class="line">                    .width(<span class="number">193.</span>dp)</span><br><span class="line">                    .height(<span class="number">193.</span>dp)</span><br><span class="line">                    .padding(top = <span class="number">45.</span>dp),</span><br><span class="line"></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            Text(</span><br><span class="line">                text = <span class="string">&quot;æ‰«ç ç«‹å³åŠ å…¥&quot;</span>,</span><br><span class="line">                color = colorResource(id = R.color.color_666666),</span><br><span class="line">                fontSize = <span class="number">12.</span>sp,</span><br><span class="line">                textAlign = TextAlign.Center,</span><br><span class="line">                modifier = Modifier</span><br><span class="line">                    .fillMaxWidth()</span><br><span class="line">                    .padding(top = <span class="number">20.</span>dp)</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">BottomLayout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    modifier: <span class="type">Modifier</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    context: <span class="type">Activity</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier = modifier</span><br><span class="line">            .height(<span class="number">167.</span>dp)</span><br><span class="line">            .background(</span><br><span class="line">                colorResource(R.color.color_f5f5f5),</span><br><span class="line">                shape = RoundedCornerShape(<span class="number">16.</span>dp, <span class="number">16.</span>dp, <span class="number">0.</span>dp, <span class="number">0.</span>dp)</span><br><span class="line">            )</span><br><span class="line">    ) &#123;</span><br><span class="line">        Row(</span><br><span class="line">            Modifier</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .padding(<span class="number">8.</span>dp, <span class="number">25.</span>dp, <span class="number">8.</span>dp, <span class="number">0.</span>dp)</span><br><span class="line"></span><br><span class="line">        ) &#123;</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_dingding,</span><br><span class="line">                text = <span class="string">&quot;é’‰é’‰&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_qq,</span><br><span class="line">                text = <span class="string">&quot;QQ&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_wechat,</span><br><span class="line">                text = <span class="string">&quot;å¾®ä¿¡å¥½å‹&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_wechat_moments,</span><br><span class="line">                text = <span class="string">&quot;æœ‹å‹åœˆ&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_copy,</span><br><span class="line">                text = <span class="string">&quot;å¤åˆ¶é“¾æ¥&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">            ImageButton(</span><br><span class="line">                id = R.mipmap.icon_details_share_save,</span><br><span class="line">                text = <span class="string">&quot;ä¿å­˜å›¾ç‰‡&quot;</span>,</span><br><span class="line">                Modifier.weight(<span class="number">1f</span>)</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Column(</span><br><span class="line">            Modifier.fillMaxHeight(),</span><br><span class="line">            Arrangement.Bottom</span><br><span class="line">        ) &#123;</span><br><span class="line">            Button(</span><br><span class="line">                onClick = &#123;</span><br><span class="line">                    Toast.makeText(context, <span class="string">&quot;å–æ¶ˆåˆ†äº«&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">                    context.finish()</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line">                Modifier.fillMaxWidth(),</span><br><span class="line">                colors = ButtonDefaults.buttonColors(</span><br><span class="line">                    containerColor = Color.White</span><br><span class="line">                ),</span><br><span class="line">                shape = RoundedCornerShape(<span class="number">0.</span>dp)<span class="comment">//åœ†è§’</span></span><br><span class="line"></span><br><span class="line">            ) &#123;</span><br><span class="line">                Text(</span><br><span class="line">                    text = <span class="string">&quot;å–æ¶ˆ&quot;</span>,</span><br><span class="line">                    fontSize = <span class="number">16.</span>sp,</span><br><span class="line">                    textAlign = TextAlign.Center,</span><br><span class="line">                    modifier = Modifier</span><br><span class="line">                        .fillMaxWidth()</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Composable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ImageButton</span><span class="params">(<span class="meta">@DrawableRes</span> id: <span class="type">Int</span>, text: <span class="type">String</span>, modifier: <span class="type">Modifier</span>)</span></span> &#123;</span><br><span class="line">    Column(</span><br><span class="line">        modifier</span><br><span class="line">            .width(<span class="number">45.</span>dp),</span><br><span class="line">    ) &#123;</span><br><span class="line">        Image(</span><br><span class="line">            painter = painterResource(id = id),</span><br><span class="line">            contentDescription = <span class="string">&quot;&quot;</span>,</span><br><span class="line">            Modifier</span><br><span class="line">                .fillMaxWidth()</span><br><span class="line">                .padding(bottom = <span class="number">8.</span>dp),</span><br><span class="line">            Alignment.Center</span><br><span class="line">        )</span><br><span class="line">        Text(</span><br><span class="line">            text = text,</span><br><span class="line">            fontSize = <span class="number">11.</span>sp,</span><br><span class="line">            color = colorResource(id = R.color.color_666666),</span><br><span class="line">            textAlign = TextAlign.Center,</span><br><span class="line">            modifier = Modifier.fillMaxWidth()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>åœ¨MainActivityä¸­è·³è½¬åˆ°è¿™ä¸ªé¡µé¢</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> intent = Intent()</span><br><span class="line">        intent.setClass(<span class="keyword">this</span>, ShareQRCodeActivity::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Button(</span><br><span class="line">            onClick = &#123;</span><br><span class="line">                startActivity(mainActivity, intent, <span class="literal">null</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            modifier = Modifier.constrainAs(button) &#123;</span><br><span class="line">                top.linkTo(parent.top)</span><br><span class="line">                start.linkTo(parent.start)</span><br><span class="line">                end.linkTo(parent.end)</span><br><span class="line">                bottom.linkTo(parent.bottom)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        ) &#123;</span><br><span class="line">            Text(text = <span class="string">&quot;Hello <span class="variable">$name</span>!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>åˆ«å¿˜äº†é€æ˜ä¸»é¢˜</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Jetpack Compose</tag>
      </tags>
  </entry>
  <entry>
    <title>RecyclerViewä¸­è®©textViewåŠ¨æ€é™åˆ¶åœ¨ä¸€è¡Œï¼ˆViewTreeObserver</title>
    <url>/2023/02/17/RecyclerView%E4%B8%AD%E8%AE%A9textView%E5%8A%A8%E6%80%81%E9%99%90%E5%88%B6%E5%9C%A8%E4%B8%80%E8%A1%8C%EF%BC%88ViewTreeObserver/RecyclerView%E4%B8%AD%E8%AE%A9textView%E5%8A%A8%E6%80%81%E9%99%90%E5%88%B6%E5%9C%A8%E4%B8%80%E8%A1%8C%EF%BC%88ViewTreeObserver/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><h2 id="å…³é”®å­—ï¼šOnPreDrawListenerã€ViewTreeObserverã€æ­£ç¡®ç§»é™¤ã€RecyclerView"><a href="#å…³é”®å­—ï¼šOnPreDrawListenerã€ViewTreeObserverã€æ­£ç¡®ç§»é™¤ã€RecyclerView" class="headerlink" title="å…³é”®å­—ï¼šOnPreDrawListenerã€ViewTreeObserverã€æ­£ç¡®ç§»é™¤ã€RecyclerView"></a>å…³é”®å­—ï¼šOnPreDrawListenerã€ViewTreeObserverã€æ­£ç¡®ç§»é™¤ã€RecyclerView</h2><h1 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h1><p>åšå®‰å“çš„éƒ½çŸ¥é“çš„å¸¸è¯†ï¼Œä¸€èˆ¬åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­çš„ä¸€é¡¹æ–‡å­—æ˜¾ç¤ºä¸ä¸‹äº†ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯é™åˆ¶å›ºå®šè¡Œæ•°å¹¶åœ¨å…¶åæ–¹æ·»åŠ çœç•¥å·ï¼Œæœ‰ä¸€æ¬¡åšéœ€æ±‚å¼€å¼€å¿ƒå¿ƒçš„å†™å®Œï¼Œç»“æœUIéªŒæ”¶æ—¶å‘Šè¯‰æˆ‘è¯´è¿™ä¸ªæ•°æ®æ¯”è¾ƒé‡è¦ï¼Œéœ€è¦å…¨éƒ¨å±•ç¤ºï¼Œä½†æ˜¯å‘¢æ•°æ®åˆä¸èƒ½è¶…è¿‡ä¸€è¡Œï¼Œè¿™å°±æ¯”è¾ƒéš¾åŠäº†ï¼Œæˆ‘å¥½ç”Ÿè¯´è¿™ä¸ªåŠŸèƒ½é¡¹ç›®ä¸­æ²¡æœ‰ï¼Œæˆ‘ä¹Ÿæ²¡åšè¿‡ï¼Œè¦ä¸ç„¶ç»™æˆ‘ä¸€å¤©æˆ‘ç ”ç©¶ä¸€ä¸‹ï¼Œè¦ä¸ç„¶å‘¢å°±ç¼“ä¸€ç¼“ï¼Œç„¶åUIå°±å»é—®äº†ä»–ä»¬ç®¡äº‹çš„ï¼ŒUIç®¡äº‹çš„è¯´ï¼Œæ€ä¹ˆèƒ½åšä¸äº†å‘¢ï¼Œä¸å¯èƒ½éœ€è¦ä¸€å¤©ï¼Œä»Šå¤©å¿…é¡»è¦ï¼Œå¹¶åé¦ˆç»™äº†æˆ‘çš„éƒ¨é•¿ï¼Œå½“æ—¶æˆ‘çš„å¿ƒæƒ…æ˜¯è¿™æ ·</p>
<p>dogï¼</p>
<h1 id="äºŒã€è§£å†³"><a href="#äºŒã€è§£å†³" class="headerlink" title="äºŒã€è§£å†³"></a>äºŒã€è§£å†³</h1><h2 id="1-é¡¹ç›®ä¸­çš„ä½¿ç”¨"><a href="#1-é¡¹ç›®ä¸­çš„ä½¿ç”¨" class="headerlink" title="1.é¡¹ç›®ä¸­çš„ä½¿ç”¨"></a>1.é¡¹ç›®ä¸­çš„ä½¿ç”¨</h2><p>æ±‚åŠ©åŒäº‹ååœ¨é¡¹ç›®ä¸­ä½¿ç”¨ä¸‹ä¾‹ä»£ç æ¥åŠ¨æ€æ”¹å˜textViewè¡Œæ•°</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">salaryTextObServer</span><span class="params">(TextView textView, <span class="type">float</span> textSize)</span> &#123;</span><br><span class="line">    textView.getViewTreeObserver().addOnPreDrawListener(<span class="keyword">new</span> <span class="title class_">ViewTreeObserver</span>.OnPreDrawListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onPreDraw</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ç›‘å¬ç§»é™¤ï¼Œä¸ç„¶å°±ä¼šå˜¿å˜¿å˜¿</span></span><br><span class="line">            textView.getViewTreeObserver().removeOnPreDrawListener(<span class="built_in">this</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">line</span> <span class="operator">=</span> textView.getLineCount();</span><br><span class="line">            <span class="keyword">if</span> (line &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                textView.setTextSize(TypedValue.COMPLEX_UNIT_SP, textSize - <span class="number">1</span>);</span><br><span class="line">                salaryTextObServer(textView, textSize - <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å°†éœ€è¦åŠ¨æ€æ”¹å˜è¡Œæ•°çš„textViewä¼ å…¥å°±å¥½äº†ï¼ŒæŒºæ–¹ä¾¿å¹¶ä¸”ç®€å•ã€‚</p>
<h2 id="2-å­¦ä¹ å¹¶ç†è§£"><a href="#2-å­¦ä¹ å¹¶ç†è§£" class="headerlink" title="2.å­¦ä¹ å¹¶ç†è§£"></a>2.å­¦ä¹ å¹¶ç†è§£</h2><p>å¹³å¸¸ç»˜åˆ¶è‡ªå®šä¹‰viewæˆ–è€…ç”¨ç”»ç¬”ç»˜åˆ¶è‡ªå®šä¹‰viewç­‰éƒ½æ²¡æœ‰ä½¿ç”¨åˆ°ViewTreeObserverè¿™ä¸ªç±»ï¼Œæœ¬ç€å­¦ä¹ è¿›æ­¥çš„æƒ³æ³•ï¼Œåœ¨ç½‘ä¸Šä¹Ÿæœç´¢äº†ç›¸å…³èµ„æ–™ï¼Œç®—æ˜¯è‡ªé—®è‡ªç­”å§ï¼Œæ•´ç†å‡ºæ¥ã€‚</p>
<h3 id="a-ViewTreeObserveræ˜¯å¹²å˜›çš„ï¼Ÿ"><a href="#a-ViewTreeObserveræ˜¯å¹²å˜›çš„ï¼Ÿ" class="headerlink" title="a.ViewTreeObserveræ˜¯å¹²å˜›çš„ï¼Ÿ"></a>a.ViewTreeObserveræ˜¯å¹²å˜›çš„ï¼Ÿ</h3><p>é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ä¸ªä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼çš„viewçš„è§‚æµ‹ç±»ï¼Œå½“æˆ‘ä»¬éœ€è¦åŠ¨æ€è§‚æµ‹Viewçš„å®½é«˜ç­‰å±æ€§æ—¶å¯ä»¥ä½¿ç”¨ï¼ŒViewTreeObserverç±»ä¸‹æœ‰å¦‚ä¸‹æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œåˆ†åˆ«é€‚ç”¨äºç‰¹å®šåœºæ™¯ï¼Œé…Œæƒ…ä½¿ç”¨</p>
<ul>
<li>addOnWindowAttachListener çª—å£é™„åŠ ç›‘å¬å™¨</li>
<li>addOnWindowFocusChangeListener  çª—å£ç„¦ç‚¹ç›‘å¬å™¨</li>
<li>addOnGlobalFocusChangeListener å…¨å±€ç„¦ç‚¹ç›‘å¬å™¨</li>
<li>addOnGlobalLayoutListener å…¨å±€å¸ƒå±€ç›‘å¬å™¨</li>
<li>addOnPreDrawListener é¢„ç»˜åˆ¶ç›‘å¬å™¨ï¼ˆè¿™ä¹Ÿæ˜¯æœ¬ç¯‡æ–‡ç« ä½¿ç”¨çš„ï¼Œæˆ‘ç†è§£ä¸ºåœ¨viewç»˜åˆ¶ä¹‹å‰ï¼‰</li>
<li>addOnDrawListener ç»˜åˆ¶ç›‘å¬å™¨</li>
</ul>
<h3 id="a-ViewTreeObserveræœ‰å“ªäº›å‘ï¼Ÿ"><a href="#a-ViewTreeObserveræœ‰å“ªäº›å‘ï¼Ÿ" class="headerlink" title="a.ViewTreeObserveræœ‰å“ªäº›å‘ï¼Ÿ"></a>a.ViewTreeObserveræœ‰å“ªäº›å‘ï¼Ÿ</h3><h2 id="1-ä»¥ä¸Šç›‘å¬å™¨éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„removeæ–¹æ³•ï¼Œåœ¨æ·»åŠ ç›‘å¬å™¨åéƒ½éœ€è¦åœ¨æ–¹æ³•ä¸­removeæ‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼ˆä»€ä¹ˆä½ é—®ä¸ºä»€ä¹ˆä¼šæŠ¥é”™ï¼Ÿå°±åƒè®©ä½ ä¸€ç›´æ‰“æœ›ä¸€ä¸ªç¾å¥³ï¼Œä½ èƒ½åšæŒä¸€æ•´å¤©å—ï¼Ÿæ€»å½’æ˜¯è¦ä¼‘æ¯çš„å˜›ï¼‰ï¼Œå¹¶ä¸”å¦‚æœ¬æ–‡ä¾‹å­ä¸€æ ·ï¼Œå¦‚æœåœ¨åˆ—è¡¨ä¸­ä½¿ç”¨ï¼ŒgetViewTreeObserver-æ—¶åŠ ä¸Šå…·ä½“viewæ§ä»¶ã€‚ï¼ˆä»€ä¹ˆä½ åˆé—®ä¸ºä»€ä¹ˆï¼Ÿå°±åƒè®©ä½ ä»ä¸€ç¾¤é¸­å­é‡Œé¢æ‰¾ä¸€åªä¸‘å°é¸­ï¼Œæ€»å½’æ˜¯å¾ˆè´¹åŠ²çš„å˜›ï¼‰2-View-getViewTreeObserveræ¯æ¬¡å¾—åˆ°çš„ViewTreeObserverå¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹3-ViewTreeObserveråœ¨RecyclerViewä¸­çš„ä½¿ç”¨"><a href="#1-ä»¥ä¸Šç›‘å¬å™¨éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„removeæ–¹æ³•ï¼Œåœ¨æ·»åŠ ç›‘å¬å™¨åéƒ½éœ€è¦åœ¨æ–¹æ³•ä¸­removeæ‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼ˆä»€ä¹ˆä½ é—®ä¸ºä»€ä¹ˆä¼šæŠ¥é”™ï¼Ÿå°±åƒè®©ä½ ä¸€ç›´æ‰“æœ›ä¸€ä¸ªç¾å¥³ï¼Œä½ èƒ½åšæŒä¸€æ•´å¤©å—ï¼Ÿæ€»å½’æ˜¯è¦ä¼‘æ¯çš„å˜›ï¼‰ï¼Œå¹¶ä¸”å¦‚æœ¬æ–‡ä¾‹å­ä¸€æ ·ï¼Œå¦‚æœåœ¨åˆ—è¡¨ä¸­ä½¿ç”¨ï¼ŒgetViewTreeObserver-æ—¶åŠ ä¸Šå…·ä½“viewæ§ä»¶ã€‚ï¼ˆä»€ä¹ˆä½ åˆé—®ä¸ºä»€ä¹ˆï¼Ÿå°±åƒè®©ä½ ä»ä¸€ç¾¤é¸­å­é‡Œé¢æ‰¾ä¸€åªä¸‘å°é¸­ï¼Œæ€»å½’æ˜¯å¾ˆè´¹åŠ²çš„å˜›ï¼‰2-View-getViewTreeObserveræ¯æ¬¡å¾—åˆ°çš„ViewTreeObserverå¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹3-ViewTreeObserveråœ¨RecyclerViewä¸­çš„ä½¿ç”¨" class="headerlink" title="1.ä»¥ä¸Šç›‘å¬å™¨éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„removeæ–¹æ³•ï¼Œåœ¨æ·»åŠ ç›‘å¬å™¨åéƒ½éœ€è¦åœ¨æ–¹æ³•ä¸­removeæ‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼ˆä»€ä¹ˆä½ é—®ä¸ºä»€ä¹ˆä¼šæŠ¥é”™ï¼Ÿå°±åƒè®©ä½ ä¸€ç›´æ‰“æœ›ä¸€ä¸ªç¾å¥³ï¼Œä½ èƒ½åšæŒä¸€æ•´å¤©å—ï¼Ÿæ€»å½’æ˜¯è¦ä¼‘æ¯çš„å˜›ï¼‰ï¼Œå¹¶ä¸”å¦‚æœ¬æ–‡ä¾‹å­ä¸€æ ·ï¼Œå¦‚æœåœ¨åˆ—è¡¨ä¸­ä½¿ç”¨ï¼ŒgetViewTreeObserver()æ—¶åŠ ä¸Šå…·ä½“viewæ§ä»¶ã€‚ï¼ˆä»€ä¹ˆä½ åˆé—®ä¸ºä»€ä¹ˆï¼Ÿå°±åƒè®©ä½ ä»ä¸€ç¾¤é¸­å­é‡Œé¢æ‰¾ä¸€åªä¸‘å°é¸­ï¼Œæ€»å½’æ˜¯å¾ˆè´¹åŠ²çš„å˜›ï¼‰2.View#getViewTreeObserveræ¯æ¬¡å¾—åˆ°çš„ViewTreeObserverå¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹3.ViewTreeObserveråœ¨RecyclerViewä¸­çš„ä½¿ç”¨
 "></a>1.ä»¥ä¸Šç›‘å¬å™¨éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„removeæ–¹æ³•ï¼Œåœ¨æ·»åŠ ç›‘å¬å™¨åéƒ½éœ€è¦åœ¨æ–¹æ³•ä¸­removeæ‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼ˆä»€ä¹ˆä½ é—®ä¸ºä»€ä¹ˆä¼šæŠ¥é”™ï¼Ÿå°±åƒè®©ä½ ä¸€ç›´æ‰“æœ›ä¸€ä¸ªç¾å¥³ï¼Œä½ èƒ½åšæŒä¸€æ•´å¤©å—ï¼Ÿæ€»å½’æ˜¯è¦ä¼‘æ¯çš„å˜›ï¼‰ï¼Œå¹¶ä¸”å¦‚æœ¬æ–‡ä¾‹å­ä¸€æ ·ï¼Œå¦‚æœåœ¨åˆ—è¡¨ä¸­ä½¿ç”¨ï¼ŒgetViewTreeObserver()æ—¶åŠ ä¸Šå…·ä½“viewæ§ä»¶ã€‚ï¼ˆä»€ä¹ˆä½ åˆé—®ä¸ºä»€ä¹ˆï¼Ÿå°±åƒè®©ä½ ä»ä¸€ç¾¤é¸­å­é‡Œé¢æ‰¾ä¸€åªä¸‘å°é¸­ï¼Œæ€»å½’æ˜¯å¾ˆè´¹åŠ²çš„å˜›ï¼‰<br>2.<a class="link"   href="https://juejin.cn/post/6844903858511020039" >View#getViewTreeObserveræ¯æ¬¡å¾—åˆ°çš„ViewTreeObserverå¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªå®ä¾‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>3.<a class="link"   href="https://juejin.cn/post/6844903939339468814" >ViewTreeObserveråœ¨RecyclerViewä¸­çš„ä½¿ç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>
 </h2><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å­¦ä¹ å¦‚é€†æ°´è¡ŒèˆŸï¼Œä¸è¿›åˆ™é€€</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>view</tag>
      </tags>
  </entry>
  <entry>
    <title>andriod andserver å…¨å±€è½¬å‘ä»£ç†ï¼ˆéƒ¨åˆ†æ¥å£åœ¨æœ¬åœ°ï¼‰çš„å®ç°æ€è·¯</title>
    <url>/2022/05/11/andriod-andserver-%E5%85%A8%E5%B1%80%E8%BD%AC%E5%8F%91%E4%BB%A3%E7%90%86%EF%BC%88%E9%83%A8%E5%88%86%E6%8E%A5%E5%8F%A3%E5%9C%A8%E6%9C%AC%E5%9C%B0%EF%BC%89%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/andriod-andserver-%E5%85%A8%E5%B1%80%E8%BD%AC%E5%8F%91%E4%BB%A3%E7%90%86%EF%BC%88%E9%83%A8%E5%88%86%E6%8E%A5%E5%8F%A3%E5%9C%A8%E6%9C%AC%E5%9C%B0%EF%BC%89%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>AndServer æ˜¯ Android å¹³å°çš„ Web Server å’Œ Web Frameworkã€‚ å®ƒåŸºäºç¼–è¯‘æ—¶æ³¨è§£æä¾›äº†ç±»ä¼¼ SpringMVC çš„æ³¨è§£å’ŒåŠŸèƒ½ï¼Œå¦‚æœæ‚¨ç†Ÿæ‚‰ SpringMVCï¼Œåˆ™å¯ä»¥éå¸¸å¿«é€Ÿåœ°æŒæ¡å®ƒã€‚â€”-yanzhenjie</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p> é“¾æ¥:æºç åœ°å€ <a class="link"   href="https://github.com/yanzhenjie/AndServer/" >https://github.com/yanzhenjie/AndServer/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.<br>  é“¾æ¥:æ–‡æ¡£åœ°å€ <a class="link"   href="https://yanzhenjie.github.io/AndServer/" >https://yanzhenjie.github.io/AndServer/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.<br>   é“¾æ¥:æ—§ç‰ˆæ–‡æ¡£ <a class="link"   href="https://yanzhenjie.github.io/AndServer/1.x/" >https://yanzhenjie.github.io/AndServer/1.x/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</p>
<h1 id="å®ç°æ€è·¯"><a href="#å®ç°æ€è·¯" class="headerlink" title="å®ç°æ€è·¯"></a>å®ç°æ€è·¯</h1><h3 id="ä¸šåŠ¡éœ€æ±‚"><a href="#ä¸šåŠ¡éœ€æ±‚" class="headerlink" title="ä¸šåŠ¡éœ€æ±‚"></a>ä¸šåŠ¡éœ€æ±‚</h3><p>é¡¹ç›®é‡‡ç”¨äº†andserverçš„æ¶æ„æ¥å®ç°ä¸€ä¸ªå®‰å“ç«¯çš„ç½‘ç»œæ¡†æ¶ï¼Œç”±ä¸€ä¸ªwebviewå¥—ä¸€ä¸ªç½‘é¡µå‘è¯·æ±‚åˆ°andserverï¼Œä½†æ˜¯å¾ˆå¤šæ¥å£æ˜¯éœ€è¦ä¸­å°å¤„ç†çš„ã€‚</p>
<p>å®‰å“ç«¯ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š<br>  é¡¹ç›®å‰æœŸåœ¨andserverçš„æ¥å£æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä½¿ç”¨retrofitè½¬å‘ç»™ä¸­å°ï¼Œæ¥æ”¶åˆ°ä¸­å°çš„è¯·æ±‚åï¼Œå†ç”±andserverè¿”å›ç»™ç½‘é¡µï¼›ç”šè‡³æœ‰çš„æ¥å£éœ€è¦åœ¨å®‰å“ç«¯åšä¸€äº›å¤„ç†ç„¶åå†è½¬å‘ã€‚    </p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">    @<span class="title class_">RequestMapping</span>(method = &#123;<span class="title class_">RequestMethod</span>.<span class="property">OPTIONS</span>, <span class="title class_">RequestMethod</span>.<span class="property">GET</span>&#125;, path = <span class="string">&quot;/test&quot;</span>)</span><br><span class="line">    public <span class="title class_">AndroidResponse</span> <span class="title function_">test</span>(@<span class="title class_">RequestParam</span>(<span class="string">&quot;organizationId&quot;</span>) <span class="title class_">String</span> store, @<span class="title class_">RequestParam</span>(<span class="string">&quot;customerId&quot;</span>) <span class="title class_">String</span> customer) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">        <span class="title class_">AndroidResponse</span> response = <span class="keyword">new</span> <span class="title class_">AndroidResponse</span>();</span><br><span class="line">        <span class="comment">//è¿™é‡Œå¯ä»¥è‡ªå·±åšå¤„ç†(è¯·æ±‚å‰)</span></span><br><span class="line">        <span class="title class_">Call</span>&lt;<span class="title class_">AndroidResponse</span>&gt; call = api.<span class="title function_">test</span>(store, customer);</span><br><span class="line">        <span class="title class_">Response</span>&lt;<span class="title class_">AndroidResponse</span>&gt; responseResponse = call.<span class="title function_">execute</span>();</span><br><span class="line">        <span class="keyword">if</span> (!responseResponse.<span class="title function_">isSuccessful</span>() || responseResponse.<span class="title function_">errorBody</span>() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;Unable to sysLookupItem request:isSuccessful&quot;</span> + responseResponse.<span class="title function_">isSuccessful</span>() + <span class="string">&quot;,errorBody:&quot;</span> + responseResponse.<span class="title function_">errorBody</span>());</span><br><span class="line"><span class="comment">//                throw new RuntimeException(&quot;Unable to reqeust&quot;);</span></span><br><span class="line">            <span class="title class_">List</span>&lt;<span class="title class_">LookupitemModel</span>&gt; lookupitemModels = <span class="title function_">offlineLookupitem</span>();</span><br><span class="line">            <span class="keyword">if</span> (lookupitemModels != <span class="literal">null</span>) &#123;</span><br><span class="line">                response .<span class="title function_">setData</span>(lookupitemModels);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> response ;</span><br><span class="line">        &#125;</span><br><span class="line">        response = responseResponse.<span class="title function_">body</span>();</span><br><span class="line">        <span class="comment">//è¿™é‡Œå¯ä»¥è‡ªå·±åšå¤„ç†(è¯·æ±‚å)</span></span><br><span class="line">        <span class="keyword">return</span> response ;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="ç“¶é¢ˆ"><a href="#ç“¶é¢ˆ" class="headerlink" title="ç“¶é¢ˆ"></a>ç“¶é¢ˆ</h3><p>å‰é¢å†™çš„æŒºé¡ºç•…çš„ï¼Œçœ‹åˆ°è¿™å„¿å¤§å®¶å¯èƒ½éƒ½è§‰å¾—æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªèƒ½è§£å†³é—®é¢˜çš„æ–¹æ¡ˆï¼Œä½†æ˜¯æœ‰ä¸€å¤©å‰åå°çš„æ¥å£å› ä¸ºä¸šåŠ¡éœ€æ±‚è¿›è¡Œäº†ä¸€äº›æ”¹åŠ¨ï¼Œæ¯”å¦‚åŠ äº†ä¸ªå…¥å‚ä¹‹ç±»çš„ï¼Œè¿™ä¸ªæ—¶å€™å®‰å“ç«¯ä¸ä»…éœ€è¦æ”¹åŠ¨andserverçš„apiï¼Œè¿˜éœ€è¦æ”¹åŠ¨retrofitçš„apiï¼Œæ”¹ä¸€ä¸ªæ¥å£æ²¡æœ‰é—®é¢˜ï¼Œæ”¹ä¸¤ä¸ªæ¥å£ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å½“æ”¹åŠ¨çš„æ¥å£æ¶‰åŠåˆ°æ•´ä¸ªé¡¹ç›®ï¼Œä¸”é¡¹ç›®æ¯”è¾ƒèµ¶çš„æ—¶å€™ï¼Œè¿™ä¸ªé—®é¢˜å°±å¾ˆå¤§äº†ã€‚</p>
<p>æ¶æ„å¸ˆè¯´ï¼šâ€œæˆ‘ä»¬å¿…é¡»è¦æœ‰ä¸€ä¸ªå…¨å±€çš„è½¬å‘ï¼Œç„¶åè¿˜ä¸èƒ½å…¨è½¬å‘ï¼Œä¸€äº›è°ƒç¡¬ä»¶çš„æ¥å£å¾—ä½ è‡ªå·±å¤„ç†ï¼Œä¸€äº›ç™»å½•çš„åˆå§‹åŒ–ä½ çš„æ‹¦æˆªåšäº†å¤„ç†ç„¶åå‘ä¸­å°â€¦â€¦â€</p>
<p>æˆ‘çš„å†…å¿ƒï¼šâ€œ&#x2F;-+ï¼@#ï¿¥%&amp;**â€</p>
<p>æˆ‘çš„å›ç­”ï¼šâ€œå¥½çš„ï¼Œæˆ‘ä¸‹å»çœ‹çœ‹â€<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/e245f3d9f01e4ea6af2f7f35e8e8c9ff.jpg"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p>ç„¶åå°±æ˜¯æŸ¥èµ„æ–™å“‡ï¼Œé¢å‘ç™¾åº¦ç¼–ç¨‹å˜›ï¼Œå¼€å§‹æˆ‘å°±æƒ³ï¼Œæ—¢ç„¶andserveræä¾›äº†ç±»ä¼¼ SpringMVC çš„æ³¨è§£å’ŒåŠŸèƒ½ï¼Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡Interceptoræ‹¦æˆªå™¨æ¥å®ç°ç„¶åæŠŠæ–‡æ¡£å¢™æ”¾å¥½ï¼Œä¸€å¤´æ’äº†ä¸Šå»</p>
<p>andserverçš„æ–‡æ¡£æ˜¯è¿™ä¹ˆè§£é‡Šçš„ï¼š<br>   é“¾æ¥:  HandlerInterceptor <a class="link"   href="https://yanzhenjie.com/AndServer/class/HandlerInterceptor.html" >https://yanzhenjie.com/AndServer/class/HandlerInterceptor.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.<span class="property">aw</span>.<span class="property">ccpos</span>.<span class="property">client</span>.<span class="property">logger</span>.<span class="property">Logger</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">annotation</span>.<span class="property">Interceptor</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">framework</span>.<span class="property">HandlerInterceptor</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">framework</span>.<span class="property">handler</span>.<span class="property">RequestHandler</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">http</span>.<span class="property">HttpRequest</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">http</span>.<span class="property">HttpResponse</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.<span class="property">annotation</span>.<span class="property">NonNull</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Interceptor</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">SysInterceptor</span> implements <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Intercept the execution of a handler.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  current request.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response current response.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler  the corresponding handler of the current request.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if the interceptor has processed the request and responded.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public boolean <span class="title function_">onIntercept</span>(@<span class="title class_">NonNull</span> <span class="title class_">HttpRequest</span> request, @<span class="title class_">NonNull</span> <span class="title class_">HttpResponse</span> response, @<span class="title class_">NonNull</span> <span class="title class_">RequestHandler</span> handler) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">RequestModel</span> requestModel = <span class="keyword">new</span> <span class="title class_">RequestModel</span>();</span><br><span class="line">        <span class="title class_">String</span> app = request.<span class="title function_">getHeader</span>(<span class="string">&quot;app&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setApp</span>(app);</span><br><span class="line">        <span class="title class_">String</span> token = request.<span class="title function_">getHeader</span>(<span class="string">&quot;x-token&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setToken</span>(token);</span><br><span class="line">        <span class="title class_">String</span> storeId = request.<span class="title function_">getHeader</span>(<span class="string">&quot;storeId&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setStoreId</span>(storeId);</span><br><span class="line">        <span class="title class_">String</span> terminalId = request.<span class="title function_">getHeader</span>(<span class="string">&quot;terminalId&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setTerminalId</span>(terminalId);</span><br><span class="line">        <span class="title class_">String</span> terminalNo = request.<span class="title function_">getHeader</span>(<span class="string">&quot;terminalNo&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setTerminalNo</span>(terminalNo);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> organizationId = request.<span class="title function_">getHeader</span>(<span class="string">&quot;organizationId&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setOrganizationId</span>(organizationId);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> userid = request.<span class="title function_">getHeader</span>(<span class="string">&quot;userid&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setUserid</span>(userid);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> username = request.<span class="title function_">getHeader</span>(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setUsername</span>(username);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> displayName = request.<span class="title function_">getHeader</span>(<span class="string">&quot;displayname&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setDisplayName</span>(displayName);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> customerId = request.<span class="title function_">getHeader</span>(<span class="string">&quot;terminalCustomerId&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setCustomerId</span>(customerId);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> storeCode = request.<span class="title function_">getHeader</span>(<span class="string">&quot;storeCode&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setStoreCode</span>(storeCode);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> sName = request.<span class="title function_">getHeader</span>(<span class="string">&quot;storeName&quot;</span>);</span><br><span class="line">        requestModel.<span class="title function_">setStoreNameOriginal</span>(sName);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">SysUtil</span>.<span class="title function_">create</span>(requestModel);</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">d</span>(<span class="string">&quot;SysInterceptor check : requestModel &quot;</span> + requestModel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤–éƒ¨é“¾æ¥æ‹’ç»è®¿é—®</span></span><br><span class="line"><span class="comment">//        String ip = request.getHeader(&quot;Host&quot;);</span></span><br><span class="line"><span class="comment">//        if (!ip.equals(&quot;0.0.0.0:8080&quot;))&#123;</span></span><br><span class="line"><span class="comment">//            Logger.w(&quot;External address access, blocked&quot;);</span></span><br><span class="line"><span class="comment">//            return true;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç¤ºä¾‹ä¸­å†™çš„åŠŸèƒ½å’Œæˆ‘ä»¬éœ€è¦è½¬å‘çš„æ¥å£åŠŸèƒ½å·®ä¸å¤šï¼Œçœ‹åˆ°è¿‡åæˆ‘å°±å¼€æ’¸ä»£ç ï¼Œæ’¸å®Œä¸€è·‘ï¼Œç¡®å®èƒ½æ‹¦æˆªåˆ°ï¼Œå¯ä»¥è½¬å‘ï¼Œå°±æ˜¯æ‰€æœ‰çš„æ¥å£éƒ½è¢«æ‹¦æˆªäº†ï¼Œæˆ‘ä¸€ä¸ªæ¥å£éƒ½åˆ«æƒ³å¤„ç†ï¼Œæœ‰çš„åŒå­¦å°±è¯´äº†ï¼Œä½ æ¯ä¸€ä¸ªè¦å¤„ç†çš„urlåˆ¤æ–­ä¸€ä¸‹æ”¾è¿‡å»ä¸å°±è¡Œäº†ï¼Ÿ<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/e245f3d9f01e4ea6af2f7f35e8e8c9ff.jpg"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>ç¡®å®å¯ä»¥ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å’Œç¬¬ä¸€ç§æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæ‰€ä»¥è¿˜æ˜¯å¦å¯»å®ƒæ³•å§</p>
<h3 id="æœ€ç»ˆè§£å†³"><a href="#æœ€ç»ˆè§£å†³" class="headerlink" title="æœ€ç»ˆè§£å†³"></a>æœ€ç»ˆè§£å†³</h3><p>ExeceptionResolver<br>   é“¾æ¥:  ExeceptionResolver<a class="link"   href="https://yanzhenjie.com/AndServer/class/ExceptionResolver.html" >https://yanzhenjie.com/AndServer/class/ExceptionResolver.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.<br>andserverçš„æ–‡æ¡£æ˜¯è¿™ä¹ˆè§£é‡Šçš„ï¼š<br>ExeceptionResolverç”¨æ¥å¤„ç†æ‰€æœ‰è¯·æ±‚Http Apiæ—¶å‘ç”Ÿçš„å¼‚å¸¸ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè¾“å‡ºå¼‚å¸¸çš„Messageåˆ°å®¢æˆ·ç«¯ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™åˆæœ‰åŒå­¦è¦è¯´äº†ï¼Œçœ‹èµ·æ¥å’Œæˆ‘ä»¬éœ€æ±‚æ²¡å…³ç³»å•Š<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/e245f3d9f01e4ea6af2f7f35e8e8c9ff.jpg"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>åˆ«ç€æ€¥ï¼Œæˆ‘ç»™ä½ è®²è®²æˆ‘æ¸…æ™°çš„è„‘å›è·¯ï¼Œå½“æˆ‘ä»¬æœ¬åœ°æœ‰æ¥å£çš„æ—¶å€™ï¼Œandserveræ­£å¸¸èµ°æ¥å£ï¼Œæˆ‘ä»¬æ­£å¸¸å¤„ç†ç„¶åè¿”å›ï¼Œéœ€è¦åœ¨æ¥å£ä¸­è¯·æ±‚ä¸­å°å°±ä½¿ç”¨retrofitï¼Œæ¥å£æœ‰æ”¹åŠ¨å®‰å“ç«¯å¿…é¡»è·Ÿç€æ”¹ï¼Œè¿™ä¸ªæ˜¯æ— æ³•é¿å…çš„ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç›´æ¥è½¬å‘èµ°çš„æ¥å£ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ExeceptionResolverå°±ä¼šæ•è·åˆ°å¼‚å¸¸ç„¶åä»æ–°è½¬å‘å‡ºå»å°±å¥½äº†<br>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.<span class="property">aw</span>.<span class="property">ccpos</span>.<span class="property">client</span>.<span class="property">Client</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">aw</span>.<span class="property">ccpos</span>.<span class="property">client</span>.<span class="property">logger</span>.<span class="property">Logger</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">annotation</span>.<span class="property">Resolver</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">error</span>.<span class="property">MethodNotSupportException</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">error</span>.<span class="property">NotFoundException</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">framework</span>.<span class="property">ExceptionResolver</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">framework</span>.<span class="property">body</span>.<span class="property">JsonBody</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">http</span>.<span class="property">HttpMethod</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">http</span>.<span class="property">HttpRequest</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">http</span>.<span class="property">HttpResponse</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">yanzhenjie</span>.<span class="property">andserver</span>.<span class="property">http</span>.<span class="property">RequestBody</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">HashMap</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Map</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.<span class="property">annotation</span>.<span class="property">NonNull</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span> : </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : yifeng_zeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span> : 2021/2/5 10:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : Andserver GlobalExceptionSolver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="title class_">Resolver</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">GlobalExceptionSolver</span> implements <span class="title class_">ExceptionResolver</span> &#123;</span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">onResolve</span>(<span class="params">@NonNull HttpRequest request, @NonNull HttpResponse response, @NonNull Throwable e</span>) &#123;</span><br><span class="line">        <span class="title class_">HttpMethod</span> method = request.<span class="title function_">getMethod</span>();</span><br><span class="line">	<span class="comment">//GlobalExceptionåé¢å†è¯´</span></span><br><span class="line">        <span class="keyword">if</span> (!(e <span class="keyword">instanceof</span> <span class="title class_">NotFoundException</span>) &amp;&amp; !(e <span class="keyword">instanceof</span> <span class="title class_">MethodNotSupportException</span>)</span><br><span class="line">                &amp;&amp; !(e <span class="keyword">instanceof</span> <span class="title class_">GlobalException</span>)) &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;handle request failed&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">String</span> uri = request.<span class="title function_">getURI</span>();</span><br><span class="line">        uri = uri.<span class="title function_">replace</span>(<span class="string">&quot;scheme:&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//        uri = uri.replace(&quot;/spin/user&quot;,&quot;/user&quot;);</span></span><br><span class="line">        <span class="keyword">if</span> (uri.<span class="title function_">startsWith</span>(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">            uri = uri.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Logger</span>.<span class="title function_">i</span>(<span class="string">&quot;redirect with URI &quot;</span> + uri);</span><br><span class="line">        <span class="title class_">String</span> url = <span class="title class_">Client</span>.<span class="title function_">i</span>().<span class="title function_">getServerUrl</span>() + uri;</span><br><span class="line"></span><br><span class="line">       	<span class="title class_">Logger</span>.<span class="title function_">i</span>(<span class="string">&quot;redirect to url &quot;</span> + url);</span><br><span class="line">        <span class="title class_">String</span> terminalId = request.<span class="title function_">getHeader</span>(<span class="string">&quot;terminalId&quot;</span>);</span><br><span class="line">        <span class="title class_">SysUtil</span>.<span class="property">requestModelLocal</span>.<span class="title function_">setTerminalId</span>(terminalId);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> token = request.<span class="title function_">getHeader</span>(<span class="string">&quot;x-token&quot;</span>);</span><br><span class="line">        <span class="title class_">SysUtil</span>.<span class="property">requestModelLocal</span>.<span class="title function_">setToken</span>(token);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> terminalNo = request.<span class="title function_">getHeader</span>(<span class="string">&quot;terminalNo&quot;</span>);</span><br><span class="line">         <span class="title class_">SysUtil</span>.<span class="property">requestModelLocal</span>.<span class="title function_">setTerminalNo</span>(terminalNo);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> organizationId = request.<span class="title function_">getHeader</span>(<span class="string">&quot;organizationId&quot;</span>);</span><br><span class="line">         <span class="title class_">SysUtil</span>.<span class="property">requestModelLocal</span>.<span class="title function_">setOrganizationId</span>(organizationId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="attr">POST</span>:</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="title class_">RequestBody</span> body = request.<span class="title function_">getBody</span>();</span><br><span class="line">                    <span class="title class_">String</span> string = body.<span class="title function_">string</span>();</span><br><span class="line">                    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">GlobalException</span>)&#123;</span><br><span class="line">                        string = e.<span class="title function_">getMessage</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="title class_">String</span> header : request.<span class="title function_">getHeaderNames</span>()) &#123;</span><br><span class="line">                        headers.<span class="title function_">put</span>(header, request.<span class="title function_">getHeader</span>(header));</span><br><span class="line">                    &#125;</span><br><span class="line"><span class="comment">//                    List&lt;Cookie&gt; cookies= request.getCookies();</span></span><br><span class="line">                    <span class="title class_">String</span> result = <span class="title class_">HttpUtils</span>.<span class="title function_">postSync</span>(url, string, headers);</span><br><span class="line">                    response.<span class="title function_">setBody</span>(<span class="keyword">new</span> <span class="title class_">JsonBody</span>(result));</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> ioException) &#123;</span><br><span class="line">                    <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;Exception redirect post&quot;</span>, ioException);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="attr">GET</span>:</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; parameters = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//                    for (String parameter : request.getParameterNames()) &#123;</span></span><br><span class="line"><span class="comment">//                        parameters.put(parameter, request.getParameter(parameter));</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"></span><br><span class="line">                    <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="title class_">String</span> header : request.<span class="title function_">getHeaderNames</span>()) &#123;</span><br><span class="line">                        headers.<span class="title function_">put</span>(header, request.<span class="title function_">getHeader</span>(header));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="title class_">String</span> result = <span class="title class_">HttpUtils</span>.<span class="title function_">getSync</span>(url, headers, parameters);</span><br><span class="line">                    response.<span class="title function_">setBody</span>(<span class="keyword">new</span> <span class="title class_">JsonBody</span>(result));</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> ioException) &#123;</span><br><span class="line">                    <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;Exception redirect get&quot;</span>, ioException);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="attr">DELETE</span>:</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; parameters = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="title class_">String</span> parameter : request.<span class="title function_">getParameterNames</span>()) &#123;</span><br><span class="line">                        parameters.<span class="title function_">put</span>(parameter, request.<span class="title function_">getParameter</span>(parameter));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="title class_">String</span> header : request.<span class="title function_">getHeaderNames</span>()) &#123;</span><br><span class="line">                        headers.<span class="title function_">put</span>(header, request.<span class="title function_">getHeader</span>(header));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (parameters.<span class="title function_">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="title class_">RequestBody</span> body = request.<span class="title function_">getBody</span>();</span><br><span class="line">                        <span class="title class_">String</span> string = body.<span class="title function_">string</span>();</span><br><span class="line">                        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">GlobalException</span>)&#123;</span><br><span class="line">                            string = e.<span class="title function_">getMessage</span>();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="title class_">String</span> result = <span class="title class_">HttpUtils</span>.<span class="title function_">deleteSync</span>(url, string, headers);</span><br><span class="line">                        response.<span class="title function_">setBody</span>(<span class="keyword">new</span> <span class="title class_">JsonBody</span>(result));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="title class_">String</span> result = <span class="title class_">HttpUtils</span>.<span class="title function_">deleteSync</span>(url, headers, parameters);</span><br><span class="line">                        response.<span class="title function_">setBody</span>(<span class="keyword">new</span> <span class="title class_">JsonBody</span>(result));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> ioException) &#123;</span><br><span class="line">                    <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;Exception redirect DELETE&quot;</span>, ioException);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="attr">PUT</span>:</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="title class_">RequestBody</span> body = request.<span class="title function_">getBody</span>();</span><br><span class="line">                    <span class="title class_">String</span> string = body.<span class="title function_">string</span>();</span><br><span class="line">                    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">GlobalException</span>)&#123;</span><br><span class="line">                        string = e.<span class="title function_">getMessage</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="title class_">String</span> header : request.<span class="title function_">getHeaderNames</span>()) &#123;</span><br><span class="line">                        headers.<span class="title function_">put</span>(header, request.<span class="title function_">getHeader</span>(header));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="title class_">String</span> result = <span class="title class_">HttpUtils</span>.<span class="title function_">putSync</span>(url, string, headers);</span><br><span class="line">                    response.<span class="title function_">setBody</span>(<span class="keyword">new</span> <span class="title class_">JsonBody</span>(result));</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> ioException) &#123;</span><br><span class="line">                    <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;Exception redirect PUT&quot;</span>, ioException);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>æœ‰ä¼¸æ‰‹å…šå°±è¦è¯´äº†ï¼Œæˆ‘æ²¡æœ‰ä½ è½¬å‘è¿™ä¸ªHttpUtilsï¼Œæˆ‘åˆéš¾å¾—æ‰¾ï¼Œä½ æƒ³ä¸æƒ³è¦èµå•Šï¼Œemmm<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/e245f3d9f01e4ea6af2f7f35e8e8c9ff.jpg"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">net</span>.<span class="property">ConnectException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">net</span>.<span class="property">SocketTimeoutException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">net</span>.<span class="property">UnknownHostException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Map</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">concurrent</span>.<span class="property">TimeUnit</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">HostnameVerifier</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">SSLSession</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">concurrent</span>.<span class="property">TimeUnit</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">Call</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">Callback</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">HttpUrl</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">Interceptor</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">MediaType</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">OkHttpClient</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">Request</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">RequestBody</span>;</span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">Response</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">HttpUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> final <span class="title class_">MediaType</span> <span class="title class_">JSON</span> = <span class="title class_">MediaType</span>.<span class="title function_">parse</span>(<span class="string">&quot;application/json; charset=utf-8&quot;</span>);</span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">OkHttpClient</span> client = <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.<span class="title class_">Builder</span>().</span><br><span class="line">    <span class="title function_">connectTimeout</span>(<span class="number">300</span>, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>).</span><br><span class="line">    <span class="title function_">readTimeout</span>(<span class="number">300</span>, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>)</span><br><span class="line">    .<span class="title function_">sslSocketFactory</span>(<span class="title class_">HttpsUtils</span>.<span class="title function_">getSslSocketFactory</span>(<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>))</span><br><span class="line">    .<span class="title function_">hostnameVerifier</span>(<span class="keyword">new</span> <span class="title class_">HostnameVerifier</span>() &#123;</span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public boolean <span class="title function_">verify</span>(<span class="params"><span class="built_in">String</span> hostname, SSLSession session</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).<span class="title function_">writeTimeout</span>(<span class="number">300</span>, <span class="title class_">TimeUnit</span>.<span class="property">SECONDS</span>).<span class="title function_">addInterceptor</span>(<span class="keyword">new</span> <span class="title class_">Interceptor</span>() &#123;</span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public <span class="title class_">Response</span> <span class="title function_">intercept</span>(<span class="title class_">Chain</span> chain) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">            <span class="title class_">Request</span>.<span class="property">Builder</span> builder = chain.<span class="title function_">request</span>()</span><br><span class="line">                    .<span class="title function_">newBuilder</span>();</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getToken</span>() != <span class="literal">null</span>) &#123;</span><br><span class="line">                builder.<span class="title function_">addHeader</span>(<span class="string">&quot;x-token&quot;</span>, <span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getToken</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getOrganizationId</span>() != <span class="literal">null</span>) &#123;</span><br><span class="line">                builder.<span class="title function_">addHeader</span>(<span class="string">&quot;organizationId&quot;</span>, <span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getOrganizationId</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getTerminalId</span>() != <span class="literal">null</span>) &#123;</span><br><span class="line">                builder.<span class="title function_">addHeader</span>(<span class="string">&quot;terminalId&quot;</span>, <span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getTerminalId</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getTerminalNo</span>() != <span class="literal">null</span>) &#123;</span><br><span class="line">                builder.<span class="title function_">addHeader</span>(<span class="string">&quot;terminalNo&quot;</span>, <span class="title class_">SysUtil</span>.<span class="title function_">get</span>().<span class="title function_">getTerminalNo</span>());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title class_">Request</span> request = builder.<span class="title function_">build</span>();</span><br><span class="line">            <span class="keyword">return</span> chain.<span class="title function_">proceed</span>(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).<span class="title function_">build</span>();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *ï¿½ì²½http postï¿½ï¿½ï¿½ï¿½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">postAsync</span>(<span class="title class_">String</span> url, <span class="title class_">String</span> body) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">RequestBody</span> params = <span class="title class_">RequestBody</span>.<span class="title function_">create</span>(<span class="title class_">JSON</span>, body);</span><br><span class="line">        <span class="title class_">Request</span> request = <span class="keyword">new</span> <span class="title class_">Request</span>.<span class="title class_">Builder</span>().<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>).<span class="title function_">url</span>(url).<span class="title function_">post</span>(params).<span class="title function_">build</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Call</span> call = client.<span class="title function_">newCall</span>(request);</span><br><span class="line">            call.<span class="title function_">enqueue</span>(<span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">                @<span class="title class_">Override</span></span><br><span class="line">                public <span class="keyword">void</span> <span class="title function_">onFailure</span>(<span class="params">Call call, IOException e</span>) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @<span class="title class_">Override</span></span><br><span class="line">                public <span class="keyword">void</span> <span class="title function_">onResponse</span>(<span class="title class_">Call</span> call, <span class="title class_">Response</span> response) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (response.<span class="title function_">isSuccessful</span>()) &#123;</span><br><span class="line">                        response.<span class="title function_">body</span>().<span class="title function_">string</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ï¿½ì²½http getï¿½ï¿½ï¿½ï¿½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getAsync</span>(<span class="title class_">String</span> url, <span class="title class_">String</span> body) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Request</span> request = <span class="keyword">new</span> <span class="title class_">Request</span>.<span class="title class_">Builder</span>().<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>).<span class="title function_">url</span>(url).<span class="title function_">get</span>().<span class="title function_">build</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Call</span> call = client.<span class="title function_">newCall</span>(request);</span><br><span class="line">            call.<span class="title function_">enqueue</span>(<span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">                @<span class="title class_">Override</span></span><br><span class="line">                public <span class="keyword">void</span> <span class="title function_">onFailure</span>(<span class="params">Call call, IOException e</span>) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @<span class="title class_">Override</span></span><br><span class="line">                public <span class="keyword">void</span> <span class="title function_">onResponse</span>(<span class="title class_">Call</span> call, <span class="title class_">Response</span> response) throws <span class="title class_">IOException</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (response.<span class="title function_">isSuccessful</span>()) &#123;</span><br><span class="line">                        response.<span class="title function_">body</span>().<span class="title function_">string</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Í¬ï¿½ï¿½http postï¿½ï¿½ï¿½ï¿½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">postSync</span>(<span class="title class_">String</span> url, <span class="title class_">String</span> body, <span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> returnMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title class_">RequestBody</span> params = <span class="title class_">RequestBody</span>.<span class="title function_">create</span>(<span class="title class_">JSON</span>, body);</span><br><span class="line">        <span class="title class_">Request</span>.<span class="property">Builder</span> builder = <span class="keyword">new</span> <span class="title class_">Request</span>.<span class="title class_">Builder</span>();</span><br><span class="line">        builder.<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">Map</span>.<span class="property">Entry</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; header : headers.<span class="title function_">entrySet</span>()) &#123;</span><br><span class="line">            builder.<span class="title function_">addHeader</span>(header.<span class="title function_">getKey</span>(), header.<span class="title function_">getValue</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Request</span> request = builder.<span class="title function_">url</span>(url).<span class="title function_">post</span>(params).<span class="title function_">build</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Response</span> response = client.<span class="title function_">newCall</span>(request).<span class="title function_">execute</span>();</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="title function_">isSuccessful</span>()) &#123;</span><br><span class="line"></span><br><span class="line">                returnMessage = response.<span class="title function_">body</span>().<span class="title function_">string</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Exception</span> e = <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ì³£ï¿½ï¿½Ï¢ï¿½ï¿½&quot;</span> + response.<span class="title function_">code</span>() + <span class="string">&quot;:&quot;</span> + response.<span class="title function_">message</span>());</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">UnknownHostException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">ConnectException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">SocketTimeoutException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Í¬ï¿½ï¿½http getï¿½ï¿½ï¿½ï¿½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">getSync</span>(<span class="title class_">String</span> url,<span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers,<span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; params) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> returnMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">HttpUrl</span>.<span class="property">Builder</span> httpBuilder = <span class="title class_">HttpUrl</span>.<span class="title function_">parse</span>(url).<span class="title function_">newBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (params != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="title class_">Map</span>.<span class="property">Entry</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; param : params.<span class="title function_">entrySet</span>()) &#123;</span><br><span class="line">                httpBuilder.<span class="title function_">addQueryParameter</span>(param.<span class="title function_">getKey</span>(), param.<span class="title function_">getValue</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Request</span>.<span class="property">Builder</span> builder = <span class="keyword">new</span> <span class="title class_">Request</span>.<span class="title class_">Builder</span>();</span><br><span class="line">        builder.<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">Map</span>.<span class="property">Entry</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; header : headers.<span class="title function_">entrySet</span>()) &#123;</span><br><span class="line">            builder.<span class="title function_">addHeader</span>(header.<span class="title function_">getKey</span>(), header.<span class="title function_">getValue</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Request</span> request = builder.<span class="title function_">url</span>(httpBuilder.<span class="title function_">build</span>())</span><br><span class="line">                .<span class="title function_">build</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Response</span> response = client.<span class="title function_">newCall</span>(request).<span class="title function_">execute</span>();</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="title function_">isSuccessful</span>()) &#123;</span><br><span class="line"></span><br><span class="line">                returnMessage = response.<span class="title function_">body</span>().<span class="title function_">string</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Exception</span> e = <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;&quot;</span> + response.<span class="title function_">code</span>() + <span class="string">&quot;:&quot;</span> + response.<span class="title function_">message</span>());</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">UnknownHostException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">ConnectException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">SocketTimeoutException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * åŒæ­¥putè¯·æ±‚*</span></span><br><span class="line"><span class="comment">    /</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">putSync</span>(<span class="title class_">String</span> url, <span class="title class_">String</span> body,<span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">String</span> returnMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title class_">RequestBody</span> params = <span class="title class_">RequestBody</span>.<span class="title function_">create</span>(<span class="title class_">JSON</span>, body);</span><br><span class="line">        <span class="title class_">Request</span>.<span class="property">Builder</span> builder = <span class="keyword">new</span> <span class="title class_">Request</span>.<span class="title class_">Builder</span>();</span><br><span class="line">        builder.<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">Map</span>.<span class="property">Entry</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; header : headers.<span class="title function_">entrySet</span>()) &#123;</span><br><span class="line">            builder.<span class="title function_">addHeader</span>(header.<span class="title function_">getKey</span>(), header.<span class="title function_">getValue</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Request</span> request = builder.<span class="title function_">url</span>(url).<span class="title function_">put</span>(params).<span class="title function_">build</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Response</span> response = client.<span class="title function_">newCall</span>(request).<span class="title function_">execute</span>();</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="title function_">isSuccessful</span>()) &#123;</span><br><span class="line"></span><br><span class="line">                returnMessage = response.<span class="title function_">body</span>().<span class="title function_">string</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Exception</span> e = <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ì³£ï¿½ï¿½Ï¢ï¿½ï¿½&quot;</span> + response.<span class="title function_">code</span>() + <span class="string">&quot;:&quot;</span> + response.<span class="title function_">message</span>());</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">UnknownHostException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">ConnectException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">SocketTimeoutException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * åŒæ­¥deleteè¯·æ±‚,body</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">deleteSync</span>(<span class="title class_">String</span> url, <span class="title class_">String</span> body,<span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">String</span> returnMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title class_">RequestBody</span> params = <span class="title class_">RequestBody</span>.<span class="title function_">create</span>(<span class="title class_">JSON</span>, body);</span><br><span class="line">        <span class="title class_">Request</span>.<span class="property">Builder</span> builder = <span class="keyword">new</span> <span class="title class_">Request</span>.<span class="title class_">Builder</span>();</span><br><span class="line">        builder.<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">Map</span>.<span class="property">Entry</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; header : headers.<span class="title function_">entrySet</span>()) &#123;</span><br><span class="line">            builder.<span class="title function_">addHeader</span>(header.<span class="title function_">getKey</span>(), header.<span class="title function_">getValue</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Request</span> request = builder.<span class="title function_">url</span>(url).<span class="title function_">delete</span>(params).<span class="title function_">build</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Response</span> response = client.<span class="title function_">newCall</span>(request).<span class="title function_">execute</span>();</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="title function_">isSuccessful</span>()) &#123;</span><br><span class="line"></span><br><span class="line">                returnMessage = response.<span class="title function_">body</span>().<span class="title function_">string</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Exception</span> e = <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ì³£ï¿½ï¿½Ï¢ï¿½ï¿½&quot;</span> + response.<span class="title function_">code</span>() + <span class="string">&quot;:&quot;</span> + response.<span class="title function_">message</span>());</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">UnknownHostException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">ConnectException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">SocketTimeoutException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * åŒæ­¥deleteè¯·æ±‚,body</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">deleteSync</span>(<span class="title class_">String</span> url,<span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; headers,<span class="title class_">Map</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; params) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line">        <span class="title class_">String</span> returnMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title class_">HttpUrl</span>.<span class="property">Builder</span> httpBuilder = <span class="title class_">HttpUrl</span>.<span class="title function_">parse</span>(url).<span class="title function_">newBuilder</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (params != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="title class_">Map</span>.<span class="property">Entry</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; param : params.<span class="title function_">entrySet</span>()) &#123;</span><br><span class="line">                httpBuilder.<span class="title function_">addQueryParameter</span>(param.<span class="title function_">getKey</span>(), param.<span class="title function_">getValue</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title class_">Request</span>.<span class="property">Builder</span> builder = <span class="keyword">new</span> <span class="title class_">Request</span>.<span class="title class_">Builder</span>();</span><br><span class="line">        builder.<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">Map</span>.<span class="property">Entry</span>&lt;<span class="title class_">String</span>, <span class="title class_">String</span>&gt; header : headers.<span class="title function_">entrySet</span>()) &#123;</span><br><span class="line">            builder.<span class="title function_">addHeader</span>(header.<span class="title function_">getKey</span>(), header.<span class="title function_">getValue</span>());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Request</span> request = builder.<span class="title function_">addHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">                .<span class="title function_">url</span>(httpBuilder.<span class="title function_">build</span>())</span><br><span class="line">                .<span class="title function_">delete</span>()</span><br><span class="line">                .<span class="title function_">build</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Response</span> response = client.<span class="title function_">newCall</span>(request).<span class="title function_">execute</span>();</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="title function_">isSuccessful</span>()) &#123;</span><br><span class="line"></span><br><span class="line">                returnMessage = response.<span class="title function_">body</span>().<span class="title function_">string</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Exception</span> e = <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ì³£ï¿½ï¿½Ï¢ï¿½ï¿½&quot;</span> + response.<span class="title function_">code</span>() + <span class="string">&quot;:&quot;</span> + response.<span class="title function_">message</span>());</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">UnknownHostException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">ConnectException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">SocketTimeoutException</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> returnMessage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">InputStream</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">lang</span>.<span class="property">reflect</span>.<span class="property">Field</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">KeyManagementException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">KeyStore</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">KeyStoreException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">NoSuchAlgorithmException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">SecureRandom</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">CertificateException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">CertificateFactory</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">X509Certificate</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">HostnameVerifier</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">KeyManager</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">KeyManagerFactory</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">SSLContext</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">SSLSession</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">SSLSocketFactory</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">TrustManager</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">TrustManagerFactory</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">net</span>.<span class="property">ssl</span>.<span class="property">X509TrustManager</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.<span class="property">OkHttpClient</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">HttpsUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="title class_">SSLSocketFactory</span> <span class="title function_">getSslSocketFactory</span>(<span class="params">InputStream[] certificates, InputStream bksFile, <span class="built_in">String</span> password</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">TrustManager</span>[] trustManagers = <span class="title function_">prepareTrustManager</span>(certificates);</span><br><span class="line">            <span class="title class_">KeyManager</span>[] keyManagers = <span class="title function_">prepareKeyManager</span>(bksFile, password);</span><br><span class="line">            <span class="title class_">SSLContext</span> sslContext = <span class="title class_">SSLContext</span>.<span class="title function_">getInstance</span>(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">            <span class="title class_">TrustManager</span> trustManager = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (trustManagers != <span class="literal">null</span>) &#123;</span><br><span class="line">                trustManager = <span class="keyword">new</span> <span class="title class_">MyTrustManager</span>(<span class="title function_">chooseTrustManager</span>(trustManagers));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                trustManager = <span class="keyword">new</span> <span class="title class_">UnSafeTrustManager</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            sslContext.<span class="title function_">init</span>(keyManagers, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;trustManager&#125;, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">            <span class="keyword">return</span> sslContext.<span class="title function_">getSocketFactory</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">NoSuchAlgorithmException</span> e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">KeyManagementException</span> e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">KeyStoreException</span> e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">static</span> <span class="title class_">TrustManager</span>[] <span class="title function_">prepareTrustManager</span>(<span class="params">InputStream... certificates</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (certificates == <span class="literal">null</span> || certificates.<span class="property">length</span> &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">CertificateFactory</span> certificateFactory = <span class="title class_">CertificateFactory</span>.<span class="title function_">getInstance</span>(<span class="string">&quot;X.509&quot;</span>);</span><br><span class="line">            <span class="title class_">KeyStore</span> keyStore = <span class="title class_">KeyStore</span>.<span class="title function_">getInstance</span>(<span class="title class_">KeyStore</span>.<span class="title function_">getDefaultType</span>());</span><br><span class="line">            keyStore.<span class="title function_">load</span>(<span class="literal">null</span>);</span><br><span class="line">            int index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="title class_">InputStream</span> certificate : certificates) &#123;</span><br><span class="line">                <span class="title class_">String</span> certificateAlias = <span class="title class_">Integer</span>.<span class="title function_">toString</span>(index++);</span><br><span class="line">                keyStore.<span class="title function_">setCertificateEntry</span>(certificateAlias, certificateFactory.<span class="title function_">generateCertificate</span>(certificate));</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (certificate != <span class="literal">null</span>)</span><br><span class="line">                        certificate.<span class="title function_">close</span>();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="title class_">IOException</span> e) &#123;</span><br><span class="line">                    <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;error to close certificate&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title class_">TrustManagerFactory</span> trustManagerFactory = <span class="literal">null</span>;</span><br><span class="line">            trustManagerFactory = <span class="title class_">TrustManagerFactory</span>.<span class="title function_">getInstance</span>(<span class="title class_">TrustManagerFactory</span>.<span class="title function_">getDefaultAlgorithm</span>());</span><br><span class="line">            trustManagerFactory.<span class="title function_">init</span>(keyStore);</span><br><span class="line">            <span class="title class_">TrustManager</span>[] trustManagers = trustManagerFactory.<span class="title function_">getTrustManagers</span>();</span><br><span class="line">            <span class="keyword">return</span> trustManagers;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;fail to prepareTrustManager&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">static</span> <span class="title class_">KeyManager</span>[] <span class="title function_">prepareKeyManager</span>(<span class="params">InputStream bksFile, <span class="built_in">String</span> password</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (bksFile == <span class="literal">null</span> || password == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="title class_">KeyStore</span> clientKeyStore = <span class="title class_">KeyStore</span>.<span class="title function_">getInstance</span>(<span class="string">&quot;BKS&quot;</span>);</span><br><span class="line">            clientKeyStore.<span class="title function_">load</span>(bksFile, password.<span class="title function_">toCharArray</span>());</span><br><span class="line">            <span class="title class_">KeyManagerFactory</span> keyManagerFactory = <span class="title class_">KeyManagerFactory</span>.<span class="title function_">getInstance</span>(<span class="title class_">KeyManagerFactory</span>.<span class="title function_">getDefaultAlgorithm</span>());</span><br><span class="line">            keyManagerFactory.<span class="title function_">init</span>(clientKeyStore, password.<span class="title function_">toCharArray</span>());</span><br><span class="line">            <span class="keyword">return</span> keyManagerFactory.<span class="title function_">getKeyManagers</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;fail to prepareKeyManager&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">static</span> X509TrustManager <span class="title function_">chooseTrustManager</span>(<span class="params">TrustManager[] trustManagers</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">TrustManager</span> trustManager : trustManagers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (trustManager <span class="keyword">instanceof</span> X509TrustManager) &#123;</span><br><span class="line">                <span class="keyword">return</span> (X509TrustManager) trustManager;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ignoreSSLCheck</span>(<span class="params">OkHttpClient sClient</span>) &#123;</span><br><span class="line">        <span class="title class_">SSLContext</span> sc = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sc = <span class="title class_">SSLContext</span>.<span class="title function_">getInstance</span>(<span class="string">&quot;SSL&quot;</span>);</span><br><span class="line">            sc.<span class="title function_">init</span>(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;<span class="keyword">new</span> <span class="title function_">X509TrustManager</span>(<span class="params"></span>) &#123;</span><br><span class="line">                @<span class="title class_">Override</span></span><br><span class="line">                public <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span>(java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">X509Certificate</span>[] chain, <span class="title class_">String</span> authType) throws java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">CertificateException</span> &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @<span class="title class_">Override</span></span><br><span class="line">                public <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span>(java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">X509Certificate</span>[] chain, <span class="title class_">String</span> authType) throws java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">CertificateException</span> &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @<span class="title class_">Override</span></span><br><span class="line">                public java.<span class="property">security</span>.<span class="property">cert</span>.<span class="property">X509Certificate</span>[] <span class="title function_">getAcceptedIssuers</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;&#125;, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;fail to ignoreSSLCheck&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">HostnameVerifier</span> hv1 = <span class="keyword">new</span> <span class="title class_">HostnameVerifier</span>() &#123;</span><br><span class="line">            @<span class="title class_">Override</span></span><br><span class="line">            public boolean <span class="title function_">verify</span>(<span class="params"><span class="built_in">String</span> hostname, SSLSession session</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">String</span> workerClassName = <span class="string">&quot;okhttp3.OkHttpClient&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title class_">Class</span> workerClass = <span class="title class_">Class</span>.<span class="title function_">forName</span>(workerClassName);</span><br><span class="line">            <span class="title class_">Field</span> hostnameVerifier = workerClass.<span class="title function_">getDeclaredField</span>(<span class="string">&quot;hostnameVerifier&quot;</span>);</span><br><span class="line">            hostnameVerifier.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">            hostnameVerifier.<span class="title function_">set</span>(sClient, hv1);</span><br><span class="line"></span><br><span class="line">            <span class="title class_">Field</span> sslSocketFactory = workerClass.<span class="title function_">getDeclaredField</span>(<span class="string">&quot;sslSocketFactory&quot;</span>);</span><br><span class="line">            sslSocketFactory.<span class="title function_">setAccessible</span>(<span class="literal">true</span>);</span><br><span class="line">            sslSocketFactory.<span class="title function_">set</span>(sClient, sc.<span class="title function_">getSocketFactory</span>());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">err</span>(<span class="string">&quot;fail to hostnameVerifier&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UnSafeTrustManager</span> implements X509TrustManager &#123;</span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span>(X509Certificate[] chain, <span class="title class_">String</span> authType) throws <span class="title class_">CertificateException</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span>(X509Certificate[] chain, <span class="title class_">String</span> authType) throws <span class="title class_">CertificateException</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public X509Certificate[] <span class="title function_">getAcceptedIssuers</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> X509Certificate[]&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyTrustManager</span> implements X509TrustManager &#123;</span><br><span class="line">        private X509TrustManager defaultTrustManager;</span><br><span class="line">        private X509TrustManager localTrustManager;</span><br><span class="line"></span><br><span class="line">        public <span class="title class_">MyTrustManager</span>(X509TrustManager localTrustManager) throws <span class="title class_">NoSuchAlgorithmException</span>, <span class="title class_">KeyStoreException</span> &#123;</span><br><span class="line">            <span class="title class_">TrustManagerFactory</span> var4 = <span class="title class_">TrustManagerFactory</span>.<span class="title function_">getInstance</span>(<span class="title class_">TrustManagerFactory</span>.<span class="title function_">getDefaultAlgorithm</span>());</span><br><span class="line">            var4.<span class="title function_">init</span>((<span class="title class_">KeyStore</span>) <span class="literal">null</span>);</span><br><span class="line">            defaultTrustManager = <span class="title function_">chooseTrustManager</span>(var4.<span class="title function_">getTrustManagers</span>());</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">localTrustManager</span> = localTrustManager;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span>(X509Certificate[] chain, <span class="title class_">String</span> authType) throws <span class="title class_">CertificateException</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span>(X509Certificate[] chain, <span class="title class_">String</span> authType) throws <span class="title class_">CertificateException</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                defaultTrustManager.<span class="title function_">checkServerTrusted</span>(chain, authType);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (<span class="title class_">CertificateException</span> ce) &#123;</span><br><span class="line">                localTrustManager.<span class="title function_">checkServerTrusted</span>(chain, authType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public X509Certificate[] <span class="title function_">getAcceptedIssuers</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> X509Certificate[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">class</span> <span class="title class_">UnSafeHostnameVerifier</span> implements <span class="title class_">HostnameVerifier</span> &#123;</span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        public boolean <span class="title function_">verify</span>(<span class="params"><span class="built_in">String</span> hostname, SSLSession session</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="å‡çº§ç‰ˆæœ¬"><a href="#å‡çº§ç‰ˆæœ¬" class="headerlink" title="å‡çº§ç‰ˆæœ¬"></a>å‡çº§ç‰ˆæœ¬</h3><p>æœ‰ç»†å¿ƒçš„åŒå­¦å‘ç°æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªGlobalExceptionçš„å¼‚å¸¸ï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯æˆ‘ä»¬åœ¨andserveræ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¯¹è¯·æ±‚å¤„ç†è¿‡åä¸éœ€è¦å¤„ç†è¿”å›çš„ä¿¡æ¯çš„æ—¶å€™ä½¿ç”¨çš„è‡ªå®šä¹‰Exceptionï¼›å¯ä»¥æ ¹æ®ä½ ä»¬è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚å–ç”¨</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : yifeng_zeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span> : 2021/11/5 14:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : å…¨å±€è½¬å‘å¼‚å¸¸ï¼Œä¸ºäº†æŠŠbodyä¼ ç»™GlobalExceptionSolver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">GlobalException</span> <span class="keyword">extends</span> <span class="title class_ inherited__">BasicException</span> &#123;</span><br><span class="line">    private <span class="keyword">static</span> int statusCode = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="title class_">GlobalException</span>(<span class="title class_">DataRequest</span> request) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(statusCode,<span class="title class_">JSON</span>.<span class="title function_">toJSONString</span>(request));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title class_">GlobalException</span>(<span class="title class_">String</span> request) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(statusCode,request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä½¿ç”¨</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">@<span class="title class_">Override</span></span><br><span class="line">	@<span class="title class_">RequestMapping</span>(method = &#123;<span class="title class_">RequestMethod</span>.<span class="property">OPTIONS</span>, <span class="title class_">RequestMethod</span>.<span class="property">POST</span>&#125;, path = <span class="string">&quot;/finishOrderSale&quot;</span>)</span><br><span class="line">	public <span class="title class_">Response</span> <span class="title function_">finishOrderSale</span>(@<span class="title class_">RequestBody</span> <span class="title class_">Request</span> requestModel)throws <span class="title class_">IOException</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (requestModel.<span class="title function_">getData</span>()!=<span class="literal">null</span>)&#123;</span><br><span class="line">		<span class="comment">//è¿™é‡Œå¯ä»¥å¯¹requestModelè¿›è¡Œå¤„ç†</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">GlobalException</span>(requestModel);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title class_">Response</span>  response = <span class="keyword">new</span>  <span class="title class_">Response</span>();</span><br><span class="line">		<span class="keyword">return</span> response;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªæ—¶å€™ï¼Œååœ¨å±å¹•å‰çš„ä½ æ˜¯ä¸æ˜¯åº”è¯¥è¯´ä¸€å¥ï¼šâ€œç§’å•Šï¼â€<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/e245f3d9f01e4ea6af2f7f35e8e8c9ff.jpg"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Andserver</tag>
      </tags>
  </entry>
  <entry>
    <title>android retrofit ä»æ— çŸ¥åˆ°å…¥é—¨</title>
    <url>/2022/07/29/android-retrofit-%E4%BB%8E%E6%97%A0%E7%9F%A5%E5%88%B0%E5%85%A5%E9%97%A8/android-retrofit-%E4%BB%8E%E6%97%A0%E7%9F%A5%E5%88%B0%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬æ–‡ä¼šä»é›¶å¼€å§‹ä»‹ç»retrofitçš„ä¸€äº›ç®€å•ä½¿ç”¨å’Œå°è£…ï¼ŒåŸºäºretrofit:2.3.0</p>
<hr>
<h1 id="ä¸€ã€åˆè¯†retrofit"><a href="#ä¸€ã€åˆè¯†retrofit" class="headerlink" title="ä¸€ã€åˆè¯†retrofit"></a>ä¸€ã€åˆè¯†retrofit</h1><h2 id="1-retrofitæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-retrofitæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.retrofitæ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.retrofitæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>retrofitå®˜æ–¹æ–‡æ¡£çš„ä»‹ç»éå¸¸çš„ç®€æ´æ˜äº†ï¼Œä¿—è¯è¯´å¾—å¥½ï¼Œå­—è¶Šå°‘è¶Šç‰›é€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªé€‚ç”¨äºAndroidå’ŒJavaçš„ç±»å‹å®‰å…¨HTTPå®¢æˆ·ç«¯ï¼Œå®ƒçš„åº•å±‚æ˜¯åŸºäºokhttpçš„ï¼Œç”¨äº†å„ç§å„æ ·çš„è®¾è®¡æ¨¡å¼å°è£…èµ·æ¥çš„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸å¤šèµ˜è¿°ï¼Œè‡³äºä¹Ÿä¸äº†è§£okhttpçš„ï¼Œemmmï¼Œæ‡‚çš„éƒ½æ‡‚</p>
<h2 id="2-ä¸€äº›é…ç½®å’Œæ•°æ®å‡†å¤‡"><a href="#2-ä¸€äº›é…ç½®å’Œæ•°æ®å‡†å¤‡" class="headerlink" title="2.ä¸€äº›é…ç½®å’Œæ•°æ®å‡†å¤‡"></a>2.ä¸€äº›é…ç½®å’Œæ•°æ®å‡†å¤‡</h2><blockquote>
<p>æ—¢ç„¶æ˜¯ç”¨äºé€šä¿¡çš„ï¼Œå°±ä¸è¦å¿˜è®°æ·»åŠ ç½‘ç»œæƒé™ï¼Œåœ¨é¡¹ç›®çš„Androidmanifestä¸­æ·»åŠ </p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!-- è®¿é—®ç½‘ç»œçš„æƒé™ --&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>&gt;&lt;/uses-permission&gt;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>å½“ç„¶ä¹Ÿå°‘ä¸äº†æ·»åŠ ä¾èµ–ï¼Œä¸ºäº†ä¸è¿‡å¤šèµ˜è¿°è¿™äº›ï¼Œæˆ‘ä»¬ä¸€æ¬¡æ·»åŠ é½å…¨ï¼Œåœ¨build.gradleä¸­æ·»åŠ </p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//retrofit</span></span><br><span class="line">api <span class="string">&#x27;com.squareup.retrofit2:retrofit:2.3.0&#x27;</span></span><br><span class="line">api <span class="string">&#x27;com.squareup.retrofit2:converter-gson:2.3.0&#x27;</span></span><br><span class="line">api <span class="string">&#x27;com.squareup.retrofit2:adapter-rxjava2:2.3.0&#x27;</span></span><br><span class="line">api <span class="string">&#x27;com.trello.rxlifecycle2:rxlifecycle-components:2.2.1&#x27;</span></span><br><span class="line">api <span class="string">&#x27;com.facebook.stetho:stetho:1.5.0&#x27;</span></span><br><span class="line">api <span class="string">&#x27;com.facebook.stetho:stetho-okhttp3:1.5.0&#x27;</span></span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬æ¥ä¸€ä¸ªè¯·æ±‚çš„è¿”å›ä½“<br>â€œä¸ºäº†è§„èŒƒæˆ‘ä»¬å†™çš„è§„èŒƒä¸€ç‚¹â€</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModel(</span></span><br><span class="line"><span class="meta">    value = &quot;DataResponse&quot;,</span></span><br><span class="line"><span class="meta">    description = &quot;è¯·æ±‚è¿”å›å€¼&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">DataResponse</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">7574544066074667453L</span>;</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;é”™è¯¯ç¼–ç ,0ä»£è¡¨æ— é”™è¯¯&quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;errorCode&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">errorCode</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;ç»“æœç¼–ç &quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;resultCode&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">resultCode</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;ç»“æœä¿¡æ¯&quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;message&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;é™„åŠ ä¿¡æ¯&quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;extInfo&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; extInfo = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;è¯·æ±‚è¿”å›æ•°æ®&quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;data&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> String requestId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataResponse</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataResponse</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataResponse</span><span class="params">(T data, <span class="type">int</span> errorCode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">        <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getErrorCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.errorCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setErrorCode</span><span class="params">(<span class="type">int</span> errorCode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getExtInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.extInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setExtInfo</span><span class="params">(Map&lt;String, Object&gt; extInfo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.extInfo = extInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getResultCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.resultCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setResultCode</span><span class="params">(String resultCode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.resultCode = resultCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isError</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.errorCode != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRequestId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.requestId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRequestId</span><span class="params">(String requestId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.requestId = requestId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        builder.append(<span class="string">&quot;DataResponse [errorCode=&quot;</span>);</span><br><span class="line">        builder.append(<span class="built_in">this</span>.errorCode);</span><br><span class="line">        builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.resultCode != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;resultCode=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.resultCode);</span><br><span class="line">            builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.message != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;message=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.message);</span><br><span class="line">            builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.extInfo != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;extInfo=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.extInfo);</span><br><span class="line">            builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.data != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;data=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.data);</span><br><span class="line">            builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.requestId != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;requestId=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.requestId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        builder.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è‡ªç„¶æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ªè¯·æ±‚å¤´</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiModel(</span></span><br><span class="line"><span class="meta">    value = &quot;DataRequest&quot;,</span></span><br><span class="line"><span class="meta">    description = &quot;è¯·æ±‚&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">DataRequest</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">7574544066074667453L</span>;</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;è¯·æ±‚æ•°æ®&quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;data&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;é™„åŠ ä¿¡æ¯&quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;extInfo&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; extInfo = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="meta">@ApiModelProperty(</span></span><br><span class="line"><span class="meta">        value = &quot;é™„åŠ åŠ¨ä½œ&quot;,</span></span><br><span class="line"><span class="meta">        name = &quot;action&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> String action;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String requestId;</span><br><span class="line">    <span class="keyword">private</span> Date requestTime;</span><br><span class="line">    <span class="keyword">private</span> String security;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataRequest</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">getExtInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.extInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setExtInfo</span><span class="params">(Map&lt;String, String&gt; extInfo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.extInfo = extInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAction</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAction</span><span class="params">(String action)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.action = action;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        builder.append(<span class="string">&quot;DataRequest [&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.data != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;data=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.data);</span><br><span class="line">            builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.extInfo != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;extInfo=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.extInfo);</span><br><span class="line">            builder.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.action != <span class="literal">null</span>) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;action=&quot;</span>);</span><br><span class="line">            builder.append(<span class="built_in">this</span>.action);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        builder.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> builder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSecurity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.security;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSecurity</span><span class="params">(String security)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.security = security;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRequestId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.requestId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRequestId</span><span class="params">(String requestId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.requestId = requestId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getRequestTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.requestTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRequestTime</span><span class="params">(Date requestTime)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.requestTime = requestTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="3-å¿«é€Ÿä¸Šæ‰‹retrofit"><a href="#3-å¿«é€Ÿä¸Šæ‰‹retrofit" class="headerlink" title="3.å¿«é€Ÿä¸Šæ‰‹retrofit"></a>3.å¿«é€Ÿä¸Šæ‰‹retrofit</h2><p>å¦‚æœä½ å­¦ä¹ è¿‡springbootï¼Œé‚£ä¹ˆä½ å¯¹æ¥ä¸‹æ¥è¿™ä¸€å¥—ä¸è¦å¤ªç†Ÿæ‚‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä¸€ä¸ªæœ€ç®€å•çš„ä¸å¸¦å‚getè¯·æ±‚ç†Ÿæ‚‰ä¸€ä¸‹</p>
<h3 id="a-æ¥å£"><a href="#a-æ¥å£" class="headerlink" title="a.æ¥å£"></a>a.æ¥å£</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥ä¸€ä¸ªRetrofitæ ‡å‡†çš„æ¥å£</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ITestService</span> &#123;</span><br><span class="line">    <span class="meta">@GET(&quot;/test&quot;)</span></span><br><span class="line">    Call&lt;DefaultResponse&lt;Object&gt;&gt; <span class="title function_">get</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å…¶ä¸­<br><em><strong>â€œ&#x2F;testâ€</strong></em><br>ä»£è¡¨æˆ‘ä»¬ä¸åå°çº¦å®šçš„è·¯å¾„ï¼›<br><em><strong>DefaultResponse<Object></strong></em><br>ä»£è¡¨æˆ‘ä»¬ä¸åå°çº¦å®šçš„å‘è¿”å›ä½“<br><em><strong>@GET</strong></em><br>æ³¨è§£ä»£è¡¨æˆ‘ä»¬ä¸åå°çº¦å®šè¿™æ˜¯ä¸€ä¸ªgetè¯·æ±‚çš„æ³¨è§£ï¼›<br>    <em><strong>Callæ–¹æ³•</strong></em><br>æ˜¯æˆ‘ä»¬éœ€è¦äº†è§£çš„é‡ä¸­ä¹‹é‡<br>retrofit2ä¸­çš„callæ–¹æ³•æºä»£ç å¦‚ä¸‹<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/retrofit1.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>ç¿»è¯‘è¿‡æ¥å¤§æ¦‚æ„æ€æ˜¯è¯¥æ–¹æ³•å‘WebæœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶è¿”å›å“åº”ï¼Œæ¯ä¸ªè°ƒç”¨éƒ½ä¼šäº§ç”Ÿè‡ªå·±çš„HTTPè¯·æ±‚å’Œå“åº”å¯¹ã€‚å…¶ä»–çš„æ–¹æ³•ä¸€èˆ¬ç”¨çš„ä¸å¤šï¼Œé‡ç‚¹æ˜¯execute()å’Œenqueue(Callback<T> callback)ï¼Œç¨åæˆ‘ä»¬ä¼šæœ‰ç¤ºä¾‹</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//executeåŒæ­¥æ‰§è¡Œè¯·æ±‚</span></span><br><span class="line"> 	Response&lt;T&gt; <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"><span class="comment">//enqueueå¼‚æ­¥æ‰§è¡Œè¯·æ±‚</span></span><br><span class="line">  	<span class="keyword">void</span> <span class="title function_">enqueue</span><span class="params">(Callback&lt;T&gt; callback)</span>;</span><br><span class="line"><span class="comment">//æ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œéƒ½å¯ä»¥éšæ—¶ä½¿ç”¨cancelå–æ¶ˆé€šè¯ã€‚</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">//ä½¿ç”¨cloneå¯¹åŒä¸€WebæœåŠ¡å™¨è¿›è¡Œå¤šä¸ªå‚æ•°ç›¸åŒçš„è°ƒç”¨ï¼›è¿™å¯ç”¨äºå®ç°è½®è¯¢æˆ–é‡è¯•å¤±è´¥çš„å‘¼å«ã€‚</span></span><br><span class="line">	Call&lt;T&gt; <span class="title function_">clone</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure></div>

<p>callæ¥å£çš„å®ç°åœ¨æºç çš„OkHttpCallä¸­ï¼Œè¿™è¯´æ˜retrofitç¡®å®æ˜¯åŸºäºOkHttpçš„ï¼Œæˆ‘ä»¬ä»¥execute()ä¸ºä¾‹</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="keyword">public</span> Response&lt;T&gt; <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  okhttp3.Call call;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (executed) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Already executed.&quot;</span>);</span><br><span class="line">    executed = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (creationFailure != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (creationFailure <span class="keyword">instanceof</span> IOException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> (IOException) creationFailure;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> (RuntimeException) creationFailure;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    call = rawCall;</span><br><span class="line">    <span class="keyword">if</span> (call == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        call = rawCall = createRawCall();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException | RuntimeException e) &#123;</span><br><span class="line">        creationFailure = e;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (canceled) &#123;</span><br><span class="line">    call.cancel();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> parseResponse(call.execute());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>  è‡³äºä¸ºä»€ä¹ˆåŒæ­¥æ–¹æ³•è¦æŠ›å¼‚å¸¸ï¼Œè¿™æ˜¯å› ä¸ºåŒæ­¥è¯·æ±‚å¯èƒ½å¿™äºå†™è¯·æ±‚æˆ–è¯»å–å“åº”çš„å‘¼å«ï¼Œè¿™æ—¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸</p>
<h3 id="b-å®ç°"><a href="#b-å®ç°" class="headerlink" title="b.å®ç°"></a>b.å®ç°</h3><p>ç„¶åæˆ‘ä»¬å®ç°æˆ‘ä»¬å†™çš„ITestService æ¥å£ï¼Œå½“ç„¶ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œå¹¶ä¸”è¿™å’Œspringbootæœ‰ä¸€äº›åŒºåˆ«<br>  <div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">//è¿™æ˜¯åå°çš„url</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;xxxxxxxxx&quot;</span></span><br><span class="line"><span class="type">Retrofit</span> <span class="variable">retrofit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">    .baseUrl(url)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="type">ITestService</span> <span class="variable">service</span> <span class="operator">=</span> retrofit.create(ITestService .class);</span><br></pre></td></tr></table></figure></div></p>
<h3 id="c-execute-å’Œenqueue-Callback-callback"><a href="#c-execute-å’Œenqueue-Callback-callback" class="headerlink" title="c.execute()å’Œenqueue(Callback callback)"></a>c.execute()å’Œenqueue(Callback<T> callback)</h3><p>æœ€åæˆ‘ä»¬æ¥è°ƒç”¨æˆ‘ä»¬å†™çš„ç¬¬ä¸€ä¸ªæ¥å£ï¼Œå‰é¢è¯´äº†ï¼Œæœ‰ä¸¤ç§æ–¹å¼<br>  <div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"> Call&lt;DefaultResponse&lt;Object&gt;&gt; responseCall = service .get()</span><br><span class="line"> <span class="comment">//åŒæ­¥</span></span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line"> Response&lt;DefaultResponse&lt;Object&gt;&gt; responseResponse = responseCall.execute();</span><br><span class="line"> <span class="comment">//åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (responseResponse.isSuccessful())&#123;</span><br><span class="line">   			 DefaultResponse&lt;Object&gt; response = responseResponse.body();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼‚æ­¥</span></span><br><span class="line">responseCall.enqueue(<span class="keyword">new</span> <span class="title class_">Callback</span>&lt;DefaultResponse&lt;Object&gt;&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(Call&lt;DefaultResponse&lt;Object&gt;&gt; call, Response&lt;DefaultResponse&lt;Object&gt;&gt; response)</span> &#123;</span><br><span class="line">                    <span class="comment">//æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Call&lt;DefaultResponse&lt;Object&gt;&gt; call, Throwable t)</span> &#123;</span><br><span class="line"> 					<span class="comment">//å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;); </span><br><span class="line"></span><br></pre></td></tr></table></figure></div><br>è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½æ‹¿åˆ°åå°æ¥å£çš„è¿”å›ï¼Œè¿™åªæ˜¯å¸®åŠ©ä½ ç†è§£retrofitçš„æ¨¡å¼ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ·±å…¥äº†è§£ä¸€ä¸‹å…¶ä»–çš„ç”¨æ³•ã€‚</p>
<h1 id="äºŒã€æ›´å¤šç”¨æ³•ï¼ˆæ³¨è§£ä»‹ç»ï¼‰"><a href="#äºŒã€æ›´å¤šç”¨æ³•ï¼ˆæ³¨è§£ä»‹ç»ï¼‰" class="headerlink" title="äºŒã€æ›´å¤šç”¨æ³•ï¼ˆæ³¨è§£ä»‹ç»ï¼‰"></a>äºŒã€æ›´å¤šç”¨æ³•ï¼ˆæ³¨è§£ä»‹ç»ï¼‰</h1><p>ä¹‹å‰æˆ‘ä»¬å±•ç¤ºäº†æœ€ç®€å•çš„Getè¯·æ±‚ï¼Œå¹¶äº†è§£åˆ°å¯ä»¥ä½¿ç”¨@GETæ³¨è§£<br>å¦‚æœä½ è¦ä½¿ç”¨åˆ«çš„è¯·æ±‚ï¼Œretrofitä¹Ÿæä¾›äº†ç›¸å¯¹åº”çš„æ³¨è§£,å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œç”šè‡³å¯ä»¥å®šåˆ¶åŒ–è¯·æ±‚ï¼Œååˆ†æ–¹ä¾¿å¿«æ·ã€‚</p>
<h2 id="1-å…«ç§è¯·æ±‚æ³¨è§£"><a href="#1-å…«ç§è¯·æ±‚æ³¨è§£" class="headerlink" title="1.å…«ç§è¯·æ±‚æ³¨è§£"></a>1.å…«ç§è¯·æ±‚æ³¨è§£</h2><table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>@GET</td>
<td>getè¯·æ±‚</td>
</tr>
<tr>
<td>@POST</td>
<td>postè¯·æ±‚</td>
</tr>
<tr>
<td>@PUT</td>
<td>putè¯·æ±‚</td>
</tr>
<tr>
<td>@DELETE</td>
<td>deleteè¯·æ±‚</td>
</tr>
<tr>
<td>@OPTIONS</td>
<td>OPTIONSè¯·æ±‚</td>
</tr>
<tr>
<td>@PATCH</td>
<td>PATCHè¯·æ±‚</td>
</tr>
<tr>
<td>@HEAD</td>
<td>HEADè¯·æ±‚</td>
</tr>
<tr>
<td>@HTTP</td>
<td>æ˜¯ä¸Šé¢æ³¨è§£çš„æ€»å’Œï¼Œå¯ä»¥å®ç°ä¸Šé¢æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶å¯ä»¥æ‹“å±•</td>
</tr>
<tr>
<td>ä¸‹é¢æ˜¯ä»£ç ä¸€äº›ä»£ç ç¤ºä¾‹ï¼š</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>@GET</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœä½ çš„getè¯·æ±‚æƒ³è¦å¸¦å‚æ•°ï¼Œä½ å¯ä»¥åŠ ä¸Š@Query</span></span><br><span class="line">   <span class="meta">@GET(&quot;/test&quot;)</span></span><br><span class="line">   Call&lt;DefaultResponse&lt;Object&gt;&gt; <span class="title function_">get</span><span class="params">(<span class="meta">@Query(&quot;id&quot;)</span> String id)</span>;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>@POST</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//postè¯·æ±‚å¸¦è¯·æ±‚ä½“,åŠ ä¸Š@Body</span></span><br><span class="line"><span class="meta">@POST(&quot;/test&quot;)</span>	</span><br><span class="line">Call&lt;DefaultResponse&lt;Object&gt;&gt; <span class="title function_">post</span><span class="params">(<span class="meta">@Body</span> DataRequest request )</span>;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>@PUT</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PUT(&quot;/test&quot;)</span>	</span><br><span class="line">Call&lt;DefaultResponse&lt;Object&gt;&gt; <span class="title function_">put</span><span class="params">(<span class="meta">@Body</span> DataRequest request )</span>;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>@DELETE</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DELETE(&quot;/test&quot;)</span>	</span><br><span class="line">Call&lt;DefaultResponse&lt;Object&gt;&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@Body</span> DataRequest request )</span>;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>@HTTP</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * methodï¼šç½‘ç»œè¯·æ±‚çš„æ–¹æ³•ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</span></span><br><span class="line"><span class="comment">  * pathï¼šç½‘ç»œè¯·æ±‚åœ°å€è·¯å¾„</span></span><br><span class="line"><span class="comment">  * hasBodyï¼šæ˜¯å¦æœ‰è¯·æ±‚ä½“</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@HTTP(method = &quot;GET&quot;, path = &quot;blog/&#123;id&#125;&quot;, hasBody = false)</span></span><br><span class="line"> Call&lt;DefaultResponse&lt;Object&gt;&gt; <span class="title function_">gethttp</span><span class="params">(<span class="meta">@Path(&quot;id&quot;)</span> <span class="type">int</span> id)</span>;</span><br><span class="line"> <span class="comment">// &#123;id&#125; è¡¨ç¤ºæ˜¯ä¸€ä¸ªå˜é‡ï¼Œ@Pathæ˜¯ä»–çš„è·¯å¾„</span></span><br><span class="line"> <span class="comment">// method çš„å€¼ retrofit ä¸ä¼šåšå¤„ç†ï¼Œæ‰€ä»¥è¦è‡ªè¡Œä¿è¯å‡†ç¡®</span></span><br></pre></td></tr></table></figure></div>
<p>  @OPTIONSä¸ @PATCHç”±äºç¯‡å¹…åŸå› ä¸å¤šåšç¤ºä¾‹</p>
<h2 id="2-å››ç§æ ‡è®°æ³¨è§£"><a href="#2-å››ç§æ ‡è®°æ³¨è§£" class="headerlink" title="2.å››ç§æ ‡è®°æ³¨è§£"></a>2.å››ç§æ ‡è®°æ³¨è§£</h2><table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>@Headers</td>
<td>ä½¿ç”¨ @Headers æ³¨è§£è®¾ç½®å›ºå®šçš„è¯·æ±‚å¤´ï¼Œæ‰€æœ‰è¯·æ±‚å¤´ä¸ä¼šç›¸äº’è¦†ç›–ï¼Œå³ä½¿åå­—ç›¸åŒã€‚</td>
</tr>
<tr>
<td>@FormUrlEncoded</td>
<td>è¡¨ç¤ºå‘é€form-encodedçš„æ•°æ®ï¼Œæ¯ä¸ªé”®å€¼å¯¹éœ€è¦ç”¨@Filedæ¥æ³¨è§£é”®åï¼Œéšåçš„å¯¹è±¡éœ€è¦æä¾›å€¼ã€‚</td>
</tr>
<tr>
<td>@Multipart</td>
<td>è¡¨ç¤ºå‘é€form-encodedçš„æ•°æ®ï¼ˆé€‚ç”¨äº æœ‰æ–‡ä»¶ ä¸Šä¼ çš„åœºæ™¯ï¼‰ï¼Œæ¯ä¸ªé”®å€¼å¯¹éœ€è¦ç”¨@Partæ¥æ³¨è§£é”®åï¼Œéšåçš„å¯¹è±¡éœ€è¦æä¾›å€¼ã€‚</td>
</tr>
<tr>
<td>@Streaming</td>
<td>è¡¨ç¤ºè¿”å›çš„æ•°æ®å°†ä»¥æµæ¥è¿”å›,é»˜è®¤æ˜¯è½½å…¥å†…å­˜çš„</td>
</tr>
</tbody></table>
<blockquote>
<p>æ³¨è§£å¤ªå¤šäº†ï¼Œä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸ºå®˜ç½‘ç¤ºä¾‹</p>
</blockquote>
<blockquote>
<p>@Headers</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Headers(&quot;Cache-Control: max-age=640000&quot;)</span></span><br><span class="line"><span class="meta">@GET(&quot;widget/list&quot;)</span></span><br><span class="line">Call&lt;List&lt;Widget&gt;&gt; <span class="title function_">widgetList</span><span class="params">()</span>;</span><br><span class="line"><span class="meta">@Headers(&#123;</span></span><br><span class="line"><span class="meta">    &quot;Accept: application/vnd.github.v3.full+json&quot;,</span></span><br><span class="line"><span class="meta">    &quot;User-Agent: Retrofit-Sample-App&quot;</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>@FormUrlEncoded</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FormUrlEncoded</span></span><br><span class="line"><span class="meta">@POST(&quot;user/edit&quot;)</span></span><br><span class="line">Call&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@Field(&quot;first_name&quot;)</span> String first, <span class="meta">@Field(&quot;last_name&quot;)</span> String last)</span>;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>@Multipart</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Multipart</span></span><br><span class="line"><span class="meta">@PUT(&quot;user/photo&quot;)</span></span><br><span class="line">Call&lt;User&gt; <span class="title function_">updateUser</span><span class="params">(<span class="meta">@Part(&quot;photo&quot;)</span> RequestBody photo, <span class="meta">@Part(&quot;description&quot;)</span> RequestBody description)</span>;</span><br></pre></td></tr></table></figure></div>
<p>@Streamingç”±äºç¯‡å¹…åŸå› ä¸å¤šåšç¤ºä¾‹</p>
<h2 id="3-åäºŒä¸ªå‚æ•°æ³¨è§£"><a href="#3-åäºŒä¸ªå‚æ•°æ³¨è§£" class="headerlink" title="3.åäºŒä¸ªå‚æ•°æ³¨è§£"></a>3.åäºŒä¸ªå‚æ•°æ³¨è§£</h2><blockquote>
<p>@Url<br>@Path<br>@Query  @QueryName  @QueryMap<br>@Header  @HeaderMap<br>@Field  @FieldMap<br>@Part  @PartMap<br>@Body<br>è¿™åäºŒä¸ªå‚æ•°æ³¨è§£æ˜¯æ­é…ä¸Šé¢çš„å…«ç§è¯·æ±‚æ³¨è§£ä½¿ç”¨çš„ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¹Ÿæœ‰éƒ¨åˆ†ä½¿ç”¨åˆ°ï¼Œæœ‰å„ç§ç”¨é€”ï¼Œè¿™é‡Œä»¥@Pathä¸ºä¾‹ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>@Path</td>
<td>æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºæ¥å£ path ï¼Œä¸ baseUrl ç»„æˆå®Œæ•´çš„ Url</td>
</tr>
</tbody></table>
<blockquote>
<p>@Path</p>
</blockquote>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GET(&quot;users/&#123;username&#125;&quot;)</span></span><br><span class="line">Call&lt;User&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@Path(&quot;username&quot;)</span> String username)</span>;</span><br></pre></td></tr></table></figure></div>

<h1 id="ä¸‰ã€è¿›é˜¶ä½¿ç”¨"><a href="#ä¸‰ã€è¿›é˜¶ä½¿ç”¨" class="headerlink" title="ä¸‰ã€è¿›é˜¶ä½¿ç”¨"></a>ä¸‰ã€è¿›é˜¶ä½¿ç”¨</h1><p>åœ¨åˆè¯†retrofitä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†retrofitçš„åŸºæœ¬æ„é€ æ–¹æ³•å’Œä½¿ç”¨ï¼Œä½†å¦‚æœè¦å®é™…è¿ç”¨åˆ°é¡¹ç›®å½“ä¸­ï¼Œé‚£ä¹ˆç®€å•çš„ä½¿ç”¨æ–¹æ³•è¿˜ä¸å¤Ÿï¼Œå› ä¸ºåœ¨å®é™…é¡¹ç›®ä¸­ä¸å¯èƒ½æ¯ä¸€ä¸ªè¯·æ±‚éƒ½åƒæˆ‘ä»¬å¼€å§‹é‚£æ ·å†™ä¸€éï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±å°è£…æ›´å¥½çš„</p>
<h2 id="1-RetrofitService"><a href="#1-RetrofitService" class="headerlink" title="1.RetrofitService"></a>1.RetrofitService</h2><p>è¿™æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹çš„ä½¿ç”¨æ–¹æ³•ï¼Œurlä¸€èˆ¬æ˜¯ä¸ä¼šå˜çš„<br>  <div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="comment">//è¿™æ˜¯åå°çš„url</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;xxxxxxxxx&quot;</span></span><br><span class="line"><span class="type">Retrofit</span> <span class="variable">retrofit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">    .baseUrl(url)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure></div><br>  æ­£å¦‚å‰è¨€ï¼Œè¿™å¤ªlowäº†ï¼Œä½ æ‹¿è¿™ä¸ªè·Ÿåˆ«äººè¯´ä½ ä¼šretrofit,å¤§ä½¬ä»¬çœ‹åˆ°äº†éƒ½ä¼šç¬‘çš„,å°±åƒè¿™æ ·<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/retrofit2.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>  æ‰€ä»¥æˆ‘ä»¬éœ€è¦<strong>RetrofitService</strong><br>  è®©æˆ‘ä»¬åŸºäºä¹‹å‰çš„ä»£ç åŠ ä¸Šä¸€ç‚¹ç‚¹çš„æ”¹åŠ¨<br>  <div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RetrofitService</span> &#123;</span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> RetrofitService i;</span><br><span class="line"><span class="keyword">private</span> Retrofit retrofit;</span><br><span class="line"> <span class="keyword">private</span>  <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;xxxxxxxxx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> RetrofitService <span class="title function_">i</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="literal">null</span>) &#123;</span><br><span class="line">            i = <span class="keyword">new</span> <span class="title class_">RetrofitService</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">RetrofitService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            retrofit = <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                    .baseUrl(url)</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            Log.e(<span class="string">&quot;RetrofitService&quot;</span>, <span class="string">&quot;RetrofitService: &quot;</span>+url+<span class="string">&quot; ExceptionMessage: &quot;</span>+e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">create</span><span class="params">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ—¶å€™ï¼Œåé¢çš„ä½¿ç”¨æ–¹å¼æ˜¯ç›¸åŒçš„å“¦</span></span><br><span class="line"><span class="type">ITestService</span> <span class="variable">api</span> <span class="operator">=</span> RetrofitService.i().create(ITestService .class);</span><br></pre></td></tr></table></figure></div></p>
<h2 id="2-ConverterFactory"><a href="#2-ConverterFactory" class="headerlink" title="2.ConverterFactory"></a>2.ConverterFactory</h2><p>  åªæœ‰ä¸€ä¸ªå•ä¾‹æ¨¡å¼çš„RetrofitServiceè¿˜è¿œè¿œä¸å¤Ÿï¼Œæˆ‘ä»¬å†åœ¨åŸºç¡€çš„æ„é€ æ–¹æ³•ä¸­åŠ ä¸€ä¸ªå…¨å±€çš„dateç±»å‹è½¬æ¢ï¼Œæˆ‘ä»¬ä»¥Jacksonä¸ºä¾‹ï¼Œæ”¹åŠ¨RetrofitService()æ–¹æ³•<br>   <div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="title function_">RetrofitService</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    	<span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">        <span class="type">JacksonConverterFactory</span> <span class="variable">jacksonConverterFactory</span> <span class="operator">=</span> JacksonConverterFactory.create(objectMapper);</span><br><span class="line">        retrofit = <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                .baseUrl(url)</span><br><span class="line">                <span class="comment">//è®¾ç½®å…¨å±€dateç±»å‹è½¬æ¢</span></span><br><span class="line">                .addConverterFactory(jacksonConverterFactory)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        Log.e(<span class="string">&quot;RetrofitService&quot;</span>, <span class="string">&quot;RetrofitService: &quot;</span>+url+<span class="string">&quot; ExceptionMessage: &quot;</span>+e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<h2 id="3-OkHttpClient"><a href="#3-OkHttpClient" class="headerlink" title="3.OkHttpClient"></a>3.OkHttpClient</h2><p>  æœ‰äº†ç±»å‹è½¬æ¢ï¼Œåˆæ€ä¹ˆèƒ½æ²¡æœ‰è¶…æ—¶æ—¶é—´å’Œinterceptå‘¢ï¼Ÿï¼Œè¿™é‡Œä½¿ç”¨äº†OkHttpClientï¼Œæˆ‘ä»¬åœ¨RetrofitServiceä¸­åŠ å…¥äº†å¦‚ä¸‹æ”¹åŠ¨<br>   <div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">OkHttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder()</span><br><span class="line">		 <span class="comment">//è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">          .connectTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">          .readTimeout(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">          <span class="comment">//è®¾ç½®httpsè¯ä¹¦</span></span><br><span class="line">          .sslSocketFactory(HttpsUtils.getSslSocketFactory(<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>))</span><br><span class="line">          .hostnameVerifier(<span class="keyword">new</span> <span class="title class_">HostnameVerifier</span>() &#123;</span><br><span class="line">              <span class="meta">@Override</span></span><br><span class="line">              <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String hostname, SSLSession session)</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .writeTimeout(<span class="number">30</span>, TimeUnit.SECONDS).addInterceptor(<span class="keyword">new</span> <span class="title class_">Interceptor</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> Response <span class="title function_">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">          Request.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span> chain.request()</span><br><span class="line">                  .newBuilder();</span><br><span class="line">          	<span class="comment">//æ·»åŠ å¤´</span></span><br><span class="line">              builder.addHeader(<span class="string">&quot;token&quot;</span>, <span class="number">111222333</span>);</span><br><span class="line">          </span><br><span class="line">          <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> builder.build();</span><br><span class="line">          <span class="keyword">return</span> chain.proceed(request);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;).build();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="title function_">RetrofitService</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">      	<span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">          objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">          <span class="type">JacksonConverterFactory</span> <span class="variable">jacksonConverterFactory</span> <span class="operator">=</span> JacksonConverterFactory.create(objectMapper);</span><br><span class="line">          retrofit = <span class="keyword">new</span> <span class="title class_">Retrofit</span>.Builder()</span><br><span class="line">                  .baseUrl(url)</span><br><span class="line">                  <span class="comment">//è®¾ç½®è¶…æ—¶æ—¶é—´,intercept</span></span><br><span class="line">                  .client(client)</span><br><span class="line">                  <span class="comment">//è®¾ç½®å…¨å±€dateç±»å‹è½¬æ¢</span></span><br><span class="line">                  .addConverterFactory(jacksonConverterFactory)</span><br><span class="line">                  .build();</span><br><span class="line">      &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">          Log.e(<span class="string">&quot;RetrofitService&quot;</span>, <span class="string">&quot;RetrofitService: &quot;</span>+url+<span class="string">&quot; ExceptionMessage: &quot;</span>+e.getMessage());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div></p>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªRetrofitå·¥å…·ç±»å®Œæˆï¼Œå¦‚æœä½ éœ€è¦æ›´å¤šåŠŸèƒ½å¯ä»¥é˜…è¯»Retrofit.javaçš„æºç <br>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šretrofitçš„åŸºç¡€ç”¨æ³•ï¼Œè¿™é‡Œæœ‰å®˜æ–¹çš„æ–‡æ¡£å’Œä¾›ä½ å‚è€ƒ</p>
<h2 id="retrofitå®˜ç½‘"><a href="#retrofitå®˜ç½‘" class="headerlink" title=" retrofitå®˜ç½‘."></a> <a class="link"   href="https://square.github.io/retrofit/#download" >retrofitå®˜ç½‘ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</h2>]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>retrofit</tag>
      </tags>
  </entry>
  <entry>
    <title>kotlin å°†Listï¼œAnyï¼è½¬ä¸ºListï¼œObject ï¼</title>
    <url>/2023/01/16/kotlin-%E5%B0%86List%EF%BC%9CAny%EF%BC%9E%E8%BD%AC%E4%B8%BAList%EF%BC%9CObject-%EF%BC%9E/kotlin-%E5%B0%86List%EF%BC%9CAny%EF%BC%9E%E8%BD%AC%E4%B8%BAList%EF%BC%9CObject-%EF%BC%9E/</url>
    <content><![CDATA[<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.gson.Gson; </span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> List<span class="type">&lt;Any&gt;</span>.<span class="title">toBeanList</span><span class="params">()</span></span>: List&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> newList : MutableList&lt;T&gt; = arrayListOf()</span><br><span class="line">        <span class="keyword">for</span> (item <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">            <span class="keyword">val</span> toJson = gson.toJson( item)</span><br><span class="line">            <span class="keyword">val</span> entity: T = gson.fromJson(toJson,T::<span class="keyword">class</span>.java)</span><br><span class="line">            newList.add(entity)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newList.toList()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¸»è¦æ˜¯è®°å½•inlineä¸reifiedï¼Œæ€•å¿˜è®°äº†ï¼Œå¦ä¸€ä¸ªå°±æ˜¯ä¹¦ä¸è¦è¯»å¤ªæ­»äº†ï¼Œçµæ´»å˜é€šå§</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot éƒ¨åˆ†è½¬å‘ï¼ˆä¸ä½¿ç”¨æ‹¦æˆªå™¨ï¼‰</title>
    <url>/2022/05/10/springboot-%E9%83%A8%E5%88%86%E8%BD%AC%E5%8F%91%EF%BC%88%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%89/springboot-%E9%83%A8%E5%88%86%E8%BD%AC%E5%8F%91%EF%BC%88%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%89/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬ç¯‡æ–‡ç« å®ç°springbootåœ¨æ²¡æœ‰æ¥å£å¯ä»¥è®¿é—®çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸æ¥è¯´æœåŠ¡å™¨åº”è¯¥è¿”å›404çš„æ¥å£è½¬å‘åˆ°å…¶ä»–çš„æœåŠ¡å™¨ä¸Šçš„åŠŸèƒ½<br><code>éœ€è¦æœ‰ä¸€å®šçš„springbootåŸºç¡€</code></p>
<hr>
<h1 id="ä¸€ã€Interceptor"><a href="#ä¸€ã€Interceptor" class="headerlink" title="ä¸€ã€Interceptor"></a>ä¸€ã€Interceptor</h1><p>ä¸€æƒ³åˆ°è½¬å‘ï¼Œé¦–å…ˆæˆ‘æƒ³åˆ°çš„å°±æ˜¯æ‹¦æˆªå™¨äº†ï¼Œå™¼é‡Œå•ªå•¦å°±å¼€å§‹æ“ä½œï¼Œä»£ç ç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aw.ccpos.util.HttpServletRequestReader;</span><br><span class="line"><span class="keyword">import</span> com.aw.ccpos.util.HttpUtils;</span><br><span class="line"><span class="keyword">import</span> com.aw.ccpos.util.SysUtil;</span><br><span class="line"><span class="keyword">import</span> com.aw.service.pos.base.model.RequestModel;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StreamUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InfoInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(InfoInterceptor.class);</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">			<span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">// åªæœ‰è¿”å›trueæ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œè¿”å›falseå–æ¶ˆå½“å‰è¯·æ±‚</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params">						  ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">						  </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><strong>postHandle</strong>æ–¹æ³•ä¸­çš„ModelAndView å¯ä»¥è‡ªå®šä¹‰404çš„é”™è¯¯é¡µé¢ï¼ŒHttpServletResponse åˆ™æ˜¯è¿”å›ï¼Œä½†æ˜¯å°è¯•è¿‡åå‘ç°æ‰€æœ‰çš„æ¥å£éƒ½è¦è¿™ä¹ˆæä¸€éï¼Œæ„æ€æ˜¯å¦‚æœé€šè¿‡è¿™ä¸ªåŠæ³•æ‰€æœ‰çš„æ¥å£éƒ½ä¼šè¢«æ‹¦æˆªè½¬å‘ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„</p>
<h1 id="äºŒã€-x2F"><a href="#äºŒã€-x2F" class="headerlink" title="äºŒã€&#x2F;**"></a>äºŒã€&#x2F;**</h1><p>å·¦æ€å³æƒ³è¿‡åé‡‡ç”¨äº†å¦‚ä¸‹æ–¹æ³•</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.aw.ccpos.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(value = &quot;GraphDB&quot;, tags = &#123;</span></span><br><span class="line"><span class="meta">        &quot;graphdb-Api&quot;</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GraphDBController</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoutingDelegate routingDelegate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/**&quot;, method = &#123;RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE&#125;, produces = MediaType.TEXT_PLAIN_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity <span class="title function_">catchAll</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> routingDelegate.redirect(request, response,  Constants.SERVER_URL, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>æ—¢ç„¶æˆ‘ä»¬åªéœ€è¦å¤„ç†æœåŠ¡å™¨æ‰¾ä¸åˆ°çš„æ–¹æ³•ï¼Œé‚£ä¹ˆåªéœ€è¦&#x2F;**ç„¶ååŒ…å«æˆ‘ä»¬é¡µé¢çš„è¯·æ±‚ç±»å‹å°±å¥½äº†ï¼Œå› ä¸ºæˆ‘ä»£ç†è½¬å‘çš„å·¥å…·ç±»éœ€è¦MediaType.TEXT_PLAIN_VALUEç±»å‹ï¼Œæ‰€ä»¥æˆ‘è¿™ä¹ˆè®¾ç½®ï¼Œè¯»è€…å¯ä»¥å¦‚ä¸éœ€è¦å¯ä»¥è‡ªå·±å†™è½¬å‘ï¼ŒRoutingDelegate è½¬å‘å·¥å…·ç±»ä¼šåœ¨åæ–‡æä¾›</p>
<h2 id="1-RoutingDelegate"><a href="#1-RoutingDelegate" class="headerlink" title="1.RoutingDelegate"></a>1.RoutingDelegate</h2><p>è½¬å‘å·¥å…·ç±»   ä»£ç å¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.aw.ccpos.util.HttpsUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.NoopHostnameVerifier;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLConnectionSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.TrustStrategy;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.client.HttpComponentsClientHttpRequestFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StreamUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyManagementException;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStoreException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingDelegate</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">redirect</span><span class="params">(HttpServletRequest request, HttpServletResponse response,String routeUrl, String prefix)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// build up the redirect URL</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> createRedictUrl(request,routeUrl, prefix);</span><br><span class="line">            <span class="type">RequestEntity</span> <span class="variable">requestEntity</span> <span class="operator">=</span> createRequestEntity(request, redirectUrl);</span><br><span class="line">            <span class="keyword">return</span> route(requestEntity);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>(<span class="string">&quot;REDIRECT ERROR&quot;</span>, HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">createRedictUrl</span><span class="params">(HttpServletRequest request, String routeUrl, String prefix)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">queryString</span> <span class="operator">=</span> request.getQueryString();</span><br><span class="line">        <span class="keyword">return</span> routeUrl + request.getRequestURI() +</span><br><span class="line">                (queryString != <span class="literal">null</span> ? <span class="string">&quot;?&quot;</span> + queryString : <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RequestEntity <span class="title function_">createRequestEntity</span><span class="params">(HttpServletRequest request, String url)</span> <span class="keyword">throws</span> URISyntaxException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">        <span class="type">HttpMethod</span> <span class="variable">httpMethod</span> <span class="operator">=</span> HttpMethod.resolve(method);</span><br><span class="line">        MultiValueMap&lt;String, String&gt; headers = parseRequestHeader(request);</span><br><span class="line">        <span class="type">byte</span>[] body = parseRequestBody(request);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RequestEntity</span>&lt;&gt;(body, headers, httpMethod, <span class="keyword">new</span> <span class="title class_">URI</span>(url));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ResponseEntity&lt;String&gt; <span class="title function_">route</span><span class="params">(RequestEntity requestEntity)</span> &#123;</span><br><span class="line">        ResponseEntity&lt;String&gt; responseEntity;</span><br><span class="line">        responseEntity = getRestTemplate().exchange(requestEntity, String.class);</span><br><span class="line">        <span class="keyword">return</span> responseEntity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] parseRequestBody(HttpServletRequest request) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> request.getInputStream();</span><br><span class="line">        <span class="keyword">return</span> StreamUtils.copyToByteArray(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MultiValueMap&lt;String, String&gt; <span class="title function_">parseRequestHeader</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">        List&lt;String&gt; headerNames = Collections.list(request.getHeaderNames());</span><br><span class="line">        <span class="keyword">for</span> (String headerName : headerNames) &#123;</span><br><span class="line">            List&lt;String&gt; headerValues = Collections.list(request.getHeaders(headerName));</span><br><span class="line">            <span class="keyword">for</span> (String headerValue : headerValues) &#123;</span><br><span class="line">                headers.add(headerName, headerValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> headers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>  &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SSLContext</span> <span class="variable">sslContext</span> <span class="operator">=</span> SSLContext.getInstance(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">            KeyManager[] keyManagers = HttpsUtils.prepareKeyManager(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">            TrustManager[] trustManagers = HttpsUtils.prepareTrustManager(<span class="literal">null</span>);</span><br><span class="line">            <span class="type">TrustManager</span> <span class="variable">trustManager</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (trustManagers != <span class="literal">null</span>) &#123;</span><br><span class="line">                trustManager = <span class="keyword">new</span> <span class="title class_">HttpsUtils</span>.MyTrustManager( HttpsUtils.chooseTrustManager(trustManagers));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                trustManager = <span class="keyword">new</span> <span class="title class_">HttpsUtils</span>.UnSafeTrustManager();</span><br><span class="line">            &#125;</span><br><span class="line">            sslContext.init(keyManagers, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;trustManager&#125;, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">            <span class="type">SSLConnectionSocketFactory</span> <span class="variable">csf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SSLConnectionSocketFactory</span>(sslContext,</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;TLSv1&quot;</span>&#125;,</span><br><span class="line">                    <span class="literal">null</span>,</span><br><span class="line">                    NoopHostnameVerifier.INSTANCE);</span><br><span class="line"></span><br><span class="line">            <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom()</span><br><span class="line">                    .setSSLSocketFactory(csf)</span><br><span class="line">                    .build();</span><br><span class="line"></span><br><span class="line">            <span class="type">HttpComponentsClientHttpRequestFactory</span> <span class="variable">requestFactory</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">HttpComponentsClientHttpRequestFactory</span>();</span><br><span class="line"></span><br><span class="line">            requestFactory.setHttpClient(httpClient);</span><br><span class="line">            <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(requestFactory);</span><br><span class="line">            <span class="keyword">return</span> restTemplate;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (NoSuchAlgorithmException | KeyManagementException | KeyStoreException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ ‡å‡†çš„httpsçš„è½¬å‘ç±»ï¼Œæ¯”è¾ƒå€¼å¾—ä¸€æçš„æ˜¯getRestTemplate()æ–¹æ³•ï¼Œå®ƒå°è£…äº†ä¸€ä¸ªä¿¡ä»»ä»»ä½•è¯ä¹¦çš„RestTemplateè½¬å‘ï¼Œä¸ç„¶httpsè¯·æ±‚è½¬å‘ä¼šæŠ¥é”™ï¼Œå·¥å…·ç±»HttpsUtilåœ¨ä¸‹æ–‡ä¼šç»™å‡º</p>
<h2 id="2-HttpsUtilsï¼ˆhttpsæ”¯æŒï¼‰"><a href="#2-HttpsUtilsï¼ˆhttpsæ”¯æŒï¼‰" class="headerlink" title="2.HttpsUtilsï¼ˆhttpsæ”¯æŒï¼‰"></a>2.HttpsUtilsï¼ˆhttpsæ”¯æŒï¼‰</h2><p>ä»£ç å¦‚ä¸‹ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyManagementException;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStore;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStoreException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.SecureRandom;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.CertificateException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.CertificateFactory;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.HostnameVerifier;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.KeyManager;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.KeyManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSession;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLSocketFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.TrustManager;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.TrustManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.X509TrustManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> okhttp3.OkHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpsUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.<span class="type">Logger</span> <span class="variable">Logger</span> <span class="operator">=</span> LoggerFactory.getLogger(HttpsUtils.class);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SSLSocketFactory <span class="title function_">getSslSocketFactory</span><span class="params">(InputStream[] certificates, InputStream bksFile, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TrustManager[] trustManagers = prepareTrustManager(certificates);</span><br><span class="line">            KeyManager[] keyManagers = prepareKeyManager(bksFile, password);</span><br><span class="line">            <span class="type">SSLContext</span> <span class="variable">sslContext</span> <span class="operator">=</span> SSLContext.getInstance(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">            <span class="type">TrustManager</span> <span class="variable">trustManager</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (trustManagers != <span class="literal">null</span>) &#123;</span><br><span class="line">                trustManager = <span class="keyword">new</span> <span class="title class_">MyTrustManager</span>(chooseTrustManager(trustManagers));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                trustManager = <span class="keyword">new</span> <span class="title class_">UnSafeTrustManager</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            sslContext.init(keyManagers, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;trustManager&#125;, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">            <span class="keyword">return</span> sslContext.getSocketFactory();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyStoreException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TrustManager[] prepareTrustManager(InputStream... certificates) &#123;</span><br><span class="line">        <span class="keyword">if</span> (certificates == <span class="literal">null</span> || certificates.length &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">CertificateFactory</span> <span class="variable">certificateFactory</span> <span class="operator">=</span> CertificateFactory.getInstance(<span class="string">&quot;X.509&quot;</span>);</span><br><span class="line">            <span class="type">KeyStore</span> <span class="variable">keyStore</span> <span class="operator">=</span> KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">            keyStore.load(<span class="literal">null</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (InputStream certificate : certificates) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">certificateAlias</span> <span class="operator">=</span> Integer.toString(index++);</span><br><span class="line">                keyStore.setCertificateEntry(certificateAlias, certificateFactory.generateCertificate(certificate));</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (certificate != <span class="literal">null</span>)</span><br><span class="line">                        certificate.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    Logger.error(<span class="string">&quot;error to close certificate&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">TrustManagerFactory</span> <span class="variable">trustManagerFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            trustManagerFactory = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());</span><br><span class="line">            trustManagerFactory.init(keyStore);</span><br><span class="line">            TrustManager[] trustManagers = trustManagerFactory.getTrustManagers();</span><br><span class="line">            <span class="keyword">return</span> trustManagers;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Logger.error(<span class="string">&quot;fail to prepareTrustManager&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> KeyManager[] prepareKeyManager(InputStream bksFile, String password) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (bksFile == <span class="literal">null</span> || password == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">KeyStore</span> <span class="variable">clientKeyStore</span> <span class="operator">=</span> KeyStore.getInstance(<span class="string">&quot;BKS&quot;</span>);</span><br><span class="line">            clientKeyStore.load(bksFile, password.toCharArray());</span><br><span class="line">            <span class="type">KeyManagerFactory</span> <span class="variable">keyManagerFactory</span> <span class="operator">=</span> KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());</span><br><span class="line">            keyManagerFactory.init(clientKeyStore, password.toCharArray());</span><br><span class="line">            <span class="keyword">return</span> keyManagerFactory.getKeyManagers();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Logger.error(<span class="string">&quot;fail to prepareKeyManager&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> X509TrustManager <span class="title function_">chooseTrustManager</span><span class="params">(TrustManager[] trustManagers)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (TrustManager trustManager : trustManagers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (trustManager <span class="keyword">instanceof</span> X509TrustManager) &#123;</span><br><span class="line">                <span class="keyword">return</span> (X509TrustManager) trustManager;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">ignoreSSLCheck</span><span class="params">(OkHttpClient sClient)</span> &#123;</span><br><span class="line">        <span class="type">SSLContext</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sc = SSLContext.getInstance(<span class="string">&quot;SSL&quot;</span>);</span><br><span class="line">            sc.init(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">TrustManager</span>[]&#123;<span class="keyword">new</span> <span class="title class_">X509TrustManager</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;&#125;, <span class="keyword">new</span> <span class="title class_">SecureRandom</span>());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Logger.error(<span class="string">&quot;fail to ignoreSSLCheck&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">HostnameVerifier</span> <span class="variable">hv1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HostnameVerifier</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String hostname, SSLSession session)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">workerClassName</span> <span class="operator">=</span> <span class="string">&quot;okhttp3.OkHttpClient&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">workerClass</span> <span class="operator">=</span> Class.forName(workerClassName);</span><br><span class="line">            <span class="type">Field</span> <span class="variable">hostnameVerifier</span> <span class="operator">=</span> workerClass.getDeclaredField(<span class="string">&quot;hostnameVerifier&quot;</span>);</span><br><span class="line">            hostnameVerifier.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            hostnameVerifier.set(sClient, hv1);</span><br><span class="line"></span><br><span class="line">            <span class="type">Field</span> <span class="variable">sslSocketFactory</span> <span class="operator">=</span> workerClass.getDeclaredField(<span class="string">&quot;sslSocketFactory&quot;</span>);</span><br><span class="line">            sslSocketFactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            sslSocketFactory.set(sClient, sc.getSocketFactory());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Logger.error(<span class="string">&quot;fail to hostnameVerifier&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UnSafeTrustManager</span> <span class="keyword">implements</span> <span class="title class_">X509TrustManager</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">X509Certificate</span>[]&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyTrustManager</span> <span class="keyword">implements</span> <span class="title class_">X509TrustManager</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> X509TrustManager defaultTrustManager;</span><br><span class="line">        <span class="keyword">private</span> X509TrustManager localTrustManager;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">MyTrustManager</span><span class="params">(X509TrustManager localTrustManager)</span> <span class="keyword">throws</span> NoSuchAlgorithmException, KeyStoreException &#123;</span><br><span class="line">            <span class="type">TrustManagerFactory</span> <span class="variable">var4</span> <span class="operator">=</span> TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());</span><br><span class="line">            var4.init((KeyStore) <span class="literal">null</span>);</span><br><span class="line">            defaultTrustManager = chooseTrustManager(var4.getTrustManagers());</span><br><span class="line">            <span class="built_in">this</span>.localTrustManager = localTrustManager;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkClientTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkServerTrusted</span><span class="params">(X509Certificate[] chain, String authType)</span> <span class="keyword">throws</span> CertificateException &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                defaultTrustManager.checkServerTrusted(chain, authType);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (CertificateException ce) &#123;</span><br><span class="line">                localTrustManager.checkServerTrusted(chain, authType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">X509Certificate</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">UnSafeHostnameVerifier</span> <span class="keyword">implements</span> <span class="title class_">HostnameVerifier</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String hostname, SSLSession session)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<hr>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»¥ä¸Šå®Œæˆspringbootéƒ¨åˆ†ä»£ç†è½¬å‘ï¼Œå…±å‹‰</p>
]]></content>
      <categories>
        <category>åç«¯</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>å†™ç»™Androidå¼€å‘çš„Androidç®€å²</title>
    <url>/2023/05/17/%E5%86%99%E7%BB%99Android%E5%BC%80%E5%8F%91%E7%9A%84Android%E7%AE%80%E5%8F%B2/%E5%86%99%E7%BB%99Android%E5%BC%80%E5%8F%91%E7%9A%84Android%E7%AE%80%E5%8F%B2/</url>
    <content><![CDATA[<p>Android æ˜¯ä¸€ä¸ªæµè¡Œçš„ç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œç”± Google å¼€å‘å¹¶äº 2008 å¹´é¦–æ¬¡æ¨å‡ºã€‚ä»¥ä¸‹æ˜¯ Android çš„è¯¦ç»†å‘å±•å†å²ï¼š</p>
<h3 id="2003-å¹´å¼€å§‹å¼€å‘"><a href="#2003-å¹´å¼€å§‹å¼€å‘" class="headerlink" title="2003 å¹´å¼€å§‹å¼€å‘"></a>2003 å¹´å¼€å§‹å¼€å‘</h3><p>Android æœ€åˆç”±é²å°”æ–¯Â·å¡æ™®å’Œå®‰è¿ªÂ·é²å®¾ï¼ˆAndy Rubinï¼‰äº 2003 å¹´åˆ›ç«‹ï¼Œå¹¶åœ¨ä¸€å®¶åä¸º Android Inc. çš„å…¬å¸ä¸‹è¿›è¡Œå¼€å‘ã€‚è¯¥å…¬å¸æ—¨åœ¨å¼€å‘å¯å®šåˆ¶å’ŒåŸºäº Linux çš„ç§»åŠ¨è®¾å¤‡æ“ä½œç³»ç»Ÿã€‚</p>
<h3 id="2005-å¹´è¢«æ”¶è´­"><a href="#2005-å¹´è¢«æ”¶è´­" class="headerlink" title="2005 å¹´è¢«æ”¶è´­"></a>2005 å¹´è¢«æ”¶è´­</h3><p>2005 å¹´ï¼ŒGoogle æ”¶è´­äº† Android Inc. ï¼Œå…¶åˆ›å§‹äººå’Œå‘˜å·¥éšååŠ å…¥äº† Googleã€‚</p>
<h3 id="2007-å¹´å‘å¸ƒ-Open-Handset-Alliance"><a href="#2007-å¹´å‘å¸ƒ-Open-Handset-Alliance" class="headerlink" title="2007 å¹´å‘å¸ƒ Open Handset Alliance"></a>2007 å¹´å‘å¸ƒ Open Handset Alliance</h3><p>2007 å¹´ 11 æœˆï¼ŒGoogle å®£å¸ƒæˆç«‹ Open Handset Alliance ï¼ˆOHAï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªè”ç›Ÿç»„ç»‡ï¼Œé¢å‘ç§»åŠ¨è®¾å¤‡ç”Ÿæ€ç³»ç»Ÿæä¾›è‡ªç”±å’Œå¼€æ”¾çš„æ ‡å‡†åŒ–å¹³å°ã€‚è¯¥è”ç›Ÿç”±æ‰‹æœºåˆ¶é€ å•†ã€è½¯ä»¶å¼€å‘å•†ã€èŠ¯ç‰‡åˆ¶é€ å•†å’Œç”µä¿¡è¿è¥å•†ç­‰è¡Œä¸šç»„æˆã€‚</p>
<h3 id="2008-å¹´å‘å¸ƒ-Android-1-0"><a href="#2008-å¹´å‘å¸ƒ-Android-1-0" class="headerlink" title="2008 å¹´å‘å¸ƒ Android 1.0"></a>2008 å¹´å‘å¸ƒ Android 1.0</h3><p>2008 å¹´ 9 æœˆï¼ŒAndroid 1.0 æ­£å¼å‘å¸ƒï¼ŒåŒ…æ‹¬ä¸€ç³»åˆ—åŸºæœ¬åº”ç”¨ç¨‹åºï¼Œå¦‚ <strong>æ‹¨æ‰“ç”µè¯ã€å‘é€çŸ­ä¿¡ã€æµè§ˆå™¨ã€åœ°å›¾</strong> ç­‰ã€‚</p>
<h3 id="åç»­ç‰ˆæœ¬"><a href="#åç»­ç‰ˆæœ¬" class="headerlink" title="åç»­ç‰ˆæœ¬"></a>åç»­ç‰ˆæœ¬</h3><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒAndroid å‘å¸ƒäº†è®¸å¤šé‡è¦ç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½å¼•å…¥äº†æ–°çš„ç‰¹æ€§å’Œæ›´æ–°ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>2009 å¹´ï¼šAndroid 1.5 Cupcake<ul>
<li>è™šæ‹Ÿé”®ç›˜ã€‚</li>
<li>æ’ä»¶æ¡†æ¶ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹è¾“å…¥æ³•ã€‚</li>
<li>å½•éŸ³æœºåº”ç”¨ç¨‹åºã€‚</li>
<li>è‡ªåŠ¨æ—‹è½¬å±å¹•çš„æ”¯æŒã€‚</li>
</ul>
</li>
<li>2009 å¹´ï¼šAndroid 1.6 Donut<ul>
<li>å¿«æ·æœç´¢æ¡†ï¼ˆQuick Search Boxï¼‰ã€‚</li>
<li>æ”¯æŒ CDMA ç½‘ç»œã€‚</li>
<li>æ–°çš„æ‘„åƒå¤´å’Œå›¾åº“åº”ç”¨ç¨‹åºã€‚</li>
<li>æ”¹è¿›çš„ Android Market åº”ç”¨å•†åº—ã€‚</li>
</ul>
</li>
<li>2010 å¹´ï¼šAndroid 2.0&#x2F;2.1 Ã‰clair<ul>
<li>Google Maps å¯¼èˆªåº”ç”¨ç¨‹åºã€‚</li>
<li>æ”¹è¿›çš„ç”¨æˆ·ç•Œé¢å’Œæ“ä½œä½“éªŒã€‚</li>
<li>HTML5 åŠŸèƒ½æ”¯æŒã€‚</li>
<li>æ”¹è¿›çš„ Android Market åº”ç”¨å•†åº—ã€‚</li>
<li>å¤šç‚¹è§¦æ§å’Œè™šæ‹Ÿç›¸æœºåŠŸèƒ½ã€‚</li>
</ul>
</li>
<li>2010 å¹´ï¼šAndroid 2.2 Froyo<ul>
<li>å¢å¼ºçš„æ€§èƒ½ã€é€Ÿåº¦å’Œå†…å­˜ç®¡ç†ã€‚</li>
<li>æ”¹è¿›äº† Flash Player æ”¯æŒã€‚</li>
<li>æ”¯æŒ Wi-Fi çƒ­ç‚¹åˆ†äº«ã€‚</li>
<li>å¢åŠ äº† USB å’Œ Bluetooth Tethering åŠŸèƒ½ã€‚</li>
</ul>
</li>
<li>2011 å¹´ï¼šAndroid 2.3 Gingerbread<ul>
<li>æ–°å¢ NFCï¼ˆè¿‘åœºé€šè®¯ï¼‰æ”¯æŒã€‚</li>
<li>è§†é¢‘å’ŒéŸ³é¢‘æ ¼å¼æ”¯æŒæ”¹è¿›ã€‚</li>
<li>ä¸‹æ‹‰é€šçŸ¥æ æ·»åŠ å¿«æ·åˆ‡æ¢åŠŸèƒ½ã€‚</li>
<li>å¢å¼ºçš„é”®ç›˜å’Œæ–‡æœ¬è¾“å…¥åŠŸèƒ½ã€‚</li>
</ul>
</li>
<li>2011 å¹´ï¼šAndroid 3.0&#x2F;3.1&#x2F;3.2 Honeycombï¼ˆä¸“ä¸ºå¹³æ¿ç”µè„‘è®¾è®¡ï¼‰<ul>
<li>ä¸“é—¨ä¸ºå¹³æ¿ç”µè„‘è®¾è®¡çš„ç‰ˆæœ¬ã€‚</li>
<li>æ–°å¢äº†æ›´å¤§ã€é«˜åˆ†è¾¨ç‡çš„å›¾æ ‡å’Œæ§ä»¶ã€‚</li>
<li>è®¾è®¡æ›´åŠ ç›´è§‚å’Œç¬¦åˆäººä½“å·¥ç¨‹å­¦ï¼Œå¯æ›´å¥½åœ°é€‚åº”å¹³æ¿ç”µè„‘å±å¹•ã€‚</li>
<li>Android 3.2 ç‰ˆæœ¬å¼•å…¥æ›´å¤šè¯­è¨€æ”¯æŒã€‚</li>
</ul>
</li>
<li>2011 å¹´ï¼šAndroid 4.0 Ice Cream Sandwich<ul>
<li>å…¨æ–°ç•Œé¢è®¾è®¡ Holoã€‚æä¾›äº†æ”¯æŒæ‹‰å‡ºå¼é€šçŸ¥æ çš„æ–°çŠ¶æ€æ å’Œè™šæ‹Ÿå¯¼èˆªæ ï¼Œå¹¶æ”¯æŒå¤šä»»åŠ¡è§†å›¾ã€‚</li>
<li>æ”¹è¿›é€šçŸ¥ç³»ç»ŸåŠåº”ç”¨ç¨‹åºç®¡ç†ã€‚</li>
<li>å¼•å…¥ People app å’Œ Face Unlock åŠŸèƒ½ã€‚</li>
<li>å¢å¼ºæ€§èƒ½å’Œç¨³å®šæ€§ã€‚</li>
</ul>
</li>
<li>2012 å¹´ï¼šAndroid 4.1&#x2F;4.2&#x2F;4.3 Jelly Bean<ul>
<li>é¡¹ç›® Butter æå‡ç”¨æˆ·ç•Œé¢æµç•…åº¦ã€‚</li>
<li>Siri ç±»ä¼¼çš„ Google Now åŠŸèƒ½ã€‚</li>
<li>ç›¸ç‰‡åº”ç”¨ç¨‹åºå¢å¼ºã€‚</li>
<li>è“ç‰™å’Œå®‰å…¨æ€§æ”¹è¿›ã€‚</li>
</ul>
</li>
<li>2013 å¹´ï¼šAndroid 4.4 KitKat<ul>
<li>å­µåŒ–å™¨æ”¯æŒã€‚</li>
<li>å…¨å±€æ‰“å­—æœç´¢åŠŸèƒ½ã€‚</li>
<li>åŸç”ŸçŸ­ä¿¡åº”ç”¨ç¨‹åºå˜ä¸º Hangoutsã€‚</li>
<li>ç§»åŠ¨è®¾å¤‡ç®¡ç†ä¸­æ–°å¢æ”¯æŒä¸ªäººå’Œä¼ä¸šçš„åˆ†ç¦»æ•°æ®å­˜å‚¨å’Œè®¿é—®æƒé™æ§åˆ¶ã€‚</li>
<li>å¢åŠ äº†é€æ˜çŠ¶æ€æ ï¼Œä½¿åº”ç”¨ç¨‹åºå¯ä»¥å»¶ä¼¸åˆ°å±å¹•é¡¶éƒ¨ã€‚åŒæ—¶ä¼˜åŒ–äº†éŸ³é¢‘ã€è§†é¢‘ä»¥åŠæ¸²æŸ“å¼•æ“ç­‰æ–¹é¢çš„æ€§èƒ½ã€‚</li>
</ul>
</li>
<li>2014 å¹´ï¼šAndroid 5.0&#x2F;5.1 Lollipop<ul>
<li>Material Design æ›´æ–°å¤–è§‚è®¾è®¡ã€‚</li>
<li>å¤šç”¨æˆ·æ”¯æŒã€‚</li>
<li>æ†ç»‘è¿‡çš„é€šçŸ¥å’Œé”å±é¢„è§ˆã€‚</li>
<li>è®¾å¤‡ä¿æŠ¤åŠŸèƒ½ï¼Œå¯ä»¥é˜²æ­¢æœªç»æˆæƒçš„ç”¨æˆ·è®¿é—®ä¸¢å¤±æˆ–è¢«ç›—çš„è®¾å¤‡ã€‚</li>
<li>åŒæ—¶å¢åŠ äº† ART è™šæ‹Ÿæœºæ”¯æŒï¼Œå¤§å¹…åº¦æå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚</li>
</ul>
</li>
<li>2015 å¹´ï¼šAndroid 6.0 Marshmallow<ul>
<li>æ”¯æŒè¿è¡Œæ—¶æƒé™ç®¡ç†ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä½¿ç”¨åº”ç”¨ç¨‹åºæ—¶æˆæƒæˆ–æ‹’ç»å¼€å¯æŸäº›æ“ä½œæƒé™ï¼Œå¦‚è®¿é—®ç›¸æœºæˆ–è”ç³»äººã€‚</li>
<li>Google Now On Tap åŠŸèƒ½ï¼Œå¯ä¸ºä½ æä¾›æ›´åŠ ä¸ªæ€§åŒ–å’Œå®šåˆ¶åŒ–çš„æœç´¢ç»“æœã€‚</li>
<li>å»¶é•¿äº†ç”µæ± å¯¿å‘½å¹¶å‡å°‘ç§»åŠ¨æ•°æ®ä½¿ç”¨é‡çš„ Doze æ¨¡å¼ã€‚</li>
<li>æ”¹è¿›çš„æŒ‡çº¹è¯†åˆ« APIã€‚</li>
</ul>
</li>
<li>2016 å¹´ï¼šAndroid 7.0&#x2F;7.1 Nougat<ul>
<li>æ–°å¢äº†ã€Œåˆ†å±æ¨¡å¼ã€ï¼Œå¯å°†ä¸¤ä¸ªåº”ç”¨ç¨‹åºå¹¶æ’å±•ç¤ºï¼ŒåŒæ—¶æ”¯æŒä¼˜åŒ–å› ç½‘ç»œè¿æ¥è€Œæ‰“æ–­åº”ç”¨ç¨‹åºä½¿ç”¨ä½“éªŒçš„å¤šçª—å£æ¨¡å¼ã€‚</li>
<li>æ”¯æŒå¤šä»»åŠ¡åˆ†å±ã€‚</li>
<li>æ”¹è¿›é€šçŸ¥ç³»ç»Ÿã€‚</li>
<li>Vulkan API æ”¯æŒæ¸¸æˆä½“éªŒæ”¹å–„ã€‚</li>
</ul>
</li>
<li>2017 å¹´ï¼šAndroid 8.0&#x2F;8.1 Oreo<ul>
<li>å¼•å…¥ Project Trebleï¼Œç®€åŒ–äº† Android æ›´æ–°æµç¨‹ã€‚æœ€å¤§çš„æ›´æ–°åŒ…æ‹¬é™åˆ¶äº†ä¸å¿…è¦çš„åå°ä»»åŠ¡ï¼Œä¾‹å¦‚Â«èƒ¡èåœå’Œæ£å­Â»ç®—æ³•æ¥ä¿ç•™ç”µé‡ï¼›Webview å·²ç»ä»ç³»ç»Ÿä¸­ç§»é™¤ï¼Œåœ¨ Google Play å•†åº—ä¸­åˆ†å‘æ›´æ–°ã€‚</li>
<li>è‡ªé€‚åº”å›¾æ ‡ã€‚</li>
<li>å¼ºåŒ– WiFi è¿æ¥é€Ÿåº¦åŠå®‰å…¨æ€§ã€‚</li>
<li>æ–°å¢ PiPï¼ˆç”»ä¸­ç”»ï¼‰åŠŸèƒ½ä»¥ä¾¿äºå¤šä»»åŠ¡å¤„ç†ã€‚</li>
</ul>
</li>
<li>2018 å¹´ï¼šAndroid 9.0 Pie<ul>
<li>å¿«æ·å¯åŠ¨åº”ç”¨ç¨‹åºæ“ä½œã€‚å¼•å…¥äº†åä¸ºã€Œé€‚é…å±å¹•ç¼ºå£ã€(Notch)çš„ç‰¹æ€§ï¼Œä»¥æ”¯æŒæ–°ä¸€ä»£æ‰‹æœºå±å¹•çš„åˆ˜æµ·è®¾è®¡ã€‚åŒæ ·æ”¯æŒåŒæ—¶å¼€å¯å¤šä¸ª Bluetoothã€Wi-Fi ç­‰è¿æ¥ï¼Œæ–¹ä¾¿è®¾å¤‡è¿æ¥ç®¡ç†ã€‚</li>
<li>é¢œè‰²å‘ˆç°å¢å¼ºã€‚</li>
<li>è‡ªé€‚åº”äº®åº¦æ§åˆ¶ã€‚</li>
<li>å…¨é¢é‡‡å–é«˜æ•ˆ AI å’Œæœºå™¨å­¦ä¹ æŠ€æœ¯ã€‚</li>
</ul>
</li>
<li>2019 å¹´ï¼šAndroid 10<ul>
<li>æ‰‹åŠ¿å¯¼èˆªã€‚</li>
<li>æš—é»‘æ¨¡å¼ã€‚</li>
<li>é‡è¦é€šçŸ¥å¯è¿›è¡Œå›å¤ã€‚</li>
<li>ç³»ç»Ÿå®‰å…¨æ€§æ”¯æŒå¢å¼ºã€‚åŠ å¼ºäº†éšç§ä¿æŠ¤æªæ–½ï¼Œæ”¯æŒåº”ç”¨ç¨‹åºè¯»å–çŸ­ä¿¡æƒé™çš„éƒ¨åˆ†å˜åŒ–ï¼Œä½¿ç”¨é resettable çš„ MAC åœ°å€ç­‰ã€‚</li>
</ul>
</li>
<li>2020 å¹´ï¼šAndroid 11<ul>
<li>æ–°å¢äº† Bubbles èŠå¤©æ°”æ³¡åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ä¸æ‰“æ–­ç°æœ‰ä»»åŠ¡çš„æƒ…å†µä¸‹æŸ¥çœ‹èŠå¤©å†…å®¹ã€‚è°ƒæ•´äº†é€šçŸ¥æ ·å¼å’Œå¸ƒå±€ï¼Œå¹¶åŠ å¼ºäº†åº”ç”¨ç¨‹åºæ•…éšœç›‘è§†å’Œå®šä½ã€‚</li>
<li>åª’ä½“å’Œæ§åˆ¶ï¼Œæœºå™¨å­¦ä¹ åŠ å¼ºæ™ºèƒ½åŒ–æ“ä½œã€‚</li>
<li>æˆ‘çš„è®¾å¤‡ä¸­æ–°å¢â€œå°é»„è½¦â€æ”¯æŒã€‚</li>
<li>éšç§æé†’å…¨æ–¹é¢å¢å¼ºã€‚</li>
</ul>
</li>
<li>2021 å¹´ï¼šAndroid 12<ul>
<li>Material You è®¾è®¡è¯­è¨€ã€‚</li>
<li>å¤šç‚¹è§¦æ§å¢å¼ºã€‚</li>
<li>æ›´å¿«ã€æ›´æµç•…çš„åŠ¨ç”»æ•ˆæœã€‚</li>
<li>å¯¹äºéšç§ä¿æŠ¤åšå‡ºäº†å¤§é‡æ”¹è¿›ã€‚</li>
</ul>
</li>
</ul>
<p>åœ¨æ¯ä¸ªç‰ˆæœ¬çš„å‘å¸ƒä¸­ï¼ŒGoogle å¢åŠ äº†å„ç§æ–°ç‰¹æ€§å’Œæ”¹è¿›ã€‚ç°åœ¨ï¼ŒAndroid æˆä¸ºäº†å…¨çƒæœ€æµè¡Œçš„æ‰‹æœºæ“ä½œç³»ç»Ÿä¹‹ä¸€ï¼Œå¹¶æ”¯æŒè®¸å¤šä¸åŒç±»å‹çš„è®¾å¤‡ï¼ŒåŒ…æ‹¬æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€æ™ºèƒ½æ‰‹è¡¨ç­‰ã€‚</p>
<h2 id="Andoridçš„å„ä¸ªç‰ˆæœ¬å å¸‚åœºçš„ä»½é¢"><a href="#Andoridçš„å„ä¸ªç‰ˆæœ¬å å¸‚åœºçš„ä»½é¢" class="headerlink" title="Andoridçš„å„ä¸ªç‰ˆæœ¬å å¸‚åœºçš„ä»½é¢"></a>Andoridçš„å„ä¸ªç‰ˆæœ¬å å¸‚åœºçš„ä»½é¢</h2><p>è°·æ­Œæ¯æœˆéƒ½ä¼šå‘å¸ƒæœ€æ–°çš„â€œPlatform Distributionâ€æŠ¥å‘Šã€‚ä»¥ä¸‹æ˜¯ 2023 å¹´ 4 æœˆä»½çš„æ•°æ®ï¼š</p>
<ol>
<li>Android 11ï¼š21.9%</li>
<li>Android 12ï¼š16.5%</li>
<li>Android 10ï¼š15.3%</li>
<li>Android 9 Pie: 12.8%</li>
<li>Android 8.0&#x2F;8.1 Oreo: 7%</li>
<li>Android 7.0&#x2F;7.1 Nougat: 4.7%</li>
<li>Android 6.0 Marshmallow: 2.8%</li>
<li>Android 5.0&#x2F;5.1 Lollipop: 1.3%</li>
<li>å…¶ä»–ç‰ˆæœ¬åŠ SDK 29 ä»¥ä¸‹çš„ Android ç‰ˆæœ¬ï¼š18.7%</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¾ƒæ–°çš„Androidç‰ˆæœ¬æ¯”å¦‚ Android 11ã€Android 12 å¸‚åœºå æœ‰ç‡å¤„äºé¢†å…ˆä½ç½®ï¼Œä½†ä»ç„¶æœ‰ç›¸å½“å¤šé‡çš„æœºå‹è¿è¡Œç€ Android 10 åŠä¹‹å‰çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€‚</p>
<h2 id="ä¸åŒ-Android-ç‰ˆæœ¬å¯¹åº”çš„-compileSdk-ç­‰çº§"><a href="#ä¸åŒ-Android-ç‰ˆæœ¬å¯¹åº”çš„-compileSdk-ç­‰çº§" class="headerlink" title="ä¸åŒ Android ç‰ˆæœ¬å¯¹åº”çš„ compileSdk ç­‰çº§"></a>ä¸åŒ Android ç‰ˆæœ¬å¯¹åº”çš„ <code>compileSdk</code> ç­‰çº§</h2><ol>
<li>Android 1.0-1.1: æ²¡æœ‰ <code>compileSdk</code> çš„æ¦‚å¿µã€‚</li>
<li>Android 1.5 Cupcake: <code>compileSdk</code> ç­‰çº§ä¸º 3ã€‚</li>
<li>Android 1.6 Donut: <code>compileSdk</code> ç­‰çº§ä¸º 4ã€‚</li>
<li>Android 2.0-2.1 Eclair: <code>compileSdk</code> ç­‰çº§ä¸º 5-7ã€‚</li>
<li>Android 2.2 Froyo: <code>compileSdk</code> ç­‰çº§ä¸º 8ã€‚</li>
<li>Android 2.3 Gingerbread: <code>compileSdk</code> ç­‰çº§ä¸º 9-10ã€‚</li>
<li>Android 3.0-3.2 Honeycomb: <code>compileSdk</code> ç­‰çº§ä¸º 11-13ã€‚</li>
<li>Android 4.0 Ice Cream Sandwich: <code>compileSdk</code> ç­‰çº§ä¸º 14-15ã€‚</li>
<li>Android 4.1-4.3 Jelly Bean: <code>compileSdk</code> ç­‰çº§ä¸º 16-18ã€‚</li>
<li>Android 4.4 KitKat: <code>compileSdk</code> ç­‰çº§ä¸º 19ã€‚</li>
<li>Android 5.0-5.1 Lollipop: <code>compileSdk</code> ç­‰çº§ä¸º 21-22ã€‚</li>
<li>Android 6.0 Marshmallow: <code>compileSdk</code> ç­‰çº§ä¸º 23ã€‚</li>
<li>Android 7.0-7.1 Nougat: <code>compileSdk</code> ç­‰çº§ä¸º 24-25ã€‚</li>
<li>Android 8.0-8.1 Oreo: <code>compileSdk</code> ç­‰çº§ä¸º 26-27ã€‚</li>
<li>Android 9 Pie: <code>compileSdk</code> ç­‰çº§ä¸º 28ã€‚</li>
<li>Android 10: <code>compileSdk</code> ç­‰çº§ä¸º 29ã€‚</li>
<li>Android 11: <code>compileSdk</code> ç­‰çº§ä¸º 30ã€‚</li>
<li>Android 12: <code>compileSdk</code> ç­‰çº§ä¸º 31ã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒç‰ˆæœ¬çš„ <code>compileSdk</code> ç­‰çº§å¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨ä¸åŒçš„ç‰¹æ€§å’Œ APIï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºçš„å…¼å®¹æ€§é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ç¼–å†™åº”ç”¨ç¨‹åºæ—¶ï¼Œè¯·é€‰æ‹©é€‚å½“çš„ <code>compileSdk</code> ç­‰çº§ï¼Œä»¥ç¡®ä¿è¯¥åº”ç”¨ç¨‹åºèƒ½åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ­£ç¡®è¿è¡Œã€‚</p>
<h2 id="Android-çš„è½¯ä»¶åŒ…ï¼ˆLibraryï¼‰å‘å±•å†å²"><a href="#Android-çš„è½¯ä»¶åŒ…ï¼ˆLibraryï¼‰å‘å±•å†å²" class="headerlink" title="Android çš„è½¯ä»¶åŒ…ï¼ˆLibraryï¼‰å‘å±•å†å²"></a>Android çš„è½¯ä»¶åŒ…ï¼ˆLibraryï¼‰å‘å±•å†å²</h2><ol>
<li>Support Library v4-v7: æ—©æœŸçš„ Android ç‰ˆæœ¬ä¸­ï¼Œç¼ºä¹ä¸€äº›ç°ä»£åº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„æ–°ç‰¹æ€§å’ŒåŠŸèƒ½ã€‚å› æ­¤ï¼ŒGoogle æ¨å‡ºäº† Support Library v4-v7 è½¯ä»¶åŒ…ï¼Œä»¥æä¾›è¿™äº›ç¼ºå¤±çš„ç‰¹æ€§å’ŒåŠŸèƒ½å¹¶æé«˜å¼€å‘æ•ˆç‡ã€‚å…¶ä¸­åŒ…æ‹¬ RecyclerViewã€CardViewã€AppCompat ç­‰å¸¸ç”¨ç»„ä»¶ã€‚</li>
<li>Android X: 2018 å¹´ï¼ŒAndroid å…¨é¢æ”¯æŒ Kotlin å¹¶æ¨å‡ºäº† Android Jetpack åŒ…ï¼ŒAndroid X æ˜¯å…¬å…±æ”¯æŒåº“æ ¸å¿ƒéƒ¨åˆ†ï¼Œå¹¶æä¾›äº†ä¸ Jetpack å…¶ä»–ç»„ä»¶ç»“åˆä½¿ç”¨çš„å‘åå…¼å®¹çš„ API æ”¯æŒã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒåº•å±‚æ¶æ„åŠå…¶å®ç°æ–¹å¼éƒ½è¿›è¡Œäº†æ”¹è¿›ï¼Œå®ƒä½¿ç”¨å®šä¹‰æ¸…æ™°ã€èƒ½å¤Ÿåˆ†ç¦»çš„æ¨¡å—ã€è‰¯å¥½ç»„ç»‡ã€ä¾èµ–å…³ç³»æ˜ç¡®çš„æ¡†æ¶æ¥é‡æ–°ç»„ç»‡å®ƒçš„è½¯ä»¶åŒ…ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ›´è½»æ¾å¿«æ·åœ°ç¼–å†™ Android åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶è¿˜å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li>Jetpack ç»„ä»¶ï¼šJetpack æ˜¯ä¸€ä¸ªé›†æˆå¼çš„å·¥å…·åŒ…ï¼ŒåŒ…æ‹¬å¤šä¸ªç»„ä»¶ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æ›´å¿«ã€æ›´è½»æ¾åœ°ç¼–å†™é«˜è´¨é‡çš„ Android åº”ç”¨ç¨‹åºã€‚è¿™äº›ç»„ä»¶åŒ…æ‹¬ä½†ä¸é™äºï¼šNavigationã€LiveDataã€ViewModelã€Roomã€Data Binding ç­‰ã€‚</li>
</ol>
<p>ä¸ Support Library ä¸åŒï¼ŒAndroid X å’Œ Jetpack ç»„ä»¶çš„é‡è¦æ„ä¹‰ä¸åœ¨äºå…¶â€œå‰ç¼€â€åå­—ï¼ˆä» v7 å˜æˆ Android Xï¼‰ï¼Œè€Œæ˜¯å®ƒä»¬æ‰€ä»£è¡¨çš„å®Œå…¨ä¸åŒçš„è®¾è®¡æ€æƒ³å’Œ API é›†åˆã€‚å®ƒä»¬é€šè¿‡æä¾›æ›´ç®€å•ã€æ ‡å‡†åŒ–ä¸”è‰¯å¥½ç»„ç»‡çš„è§£å†³æ–¹æ¡ˆæ¥ç®€åŒ– Android å¼€å‘è¿‡ç¨‹ï¼ŒåŒæ—¶é€šè¿‡å…¶å‘åå…¼å®¹æ€§å’Œåä½œæ–¹å¼ï¼Œä½¿å¾—ç¡®å®šåº”ç”¨ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>å¼€å‘æ—¥å¸¸ andorid</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å“EditText.requestFocuså¤±æ•ˆ</title>
    <url>/2021/10/20/%E5%AE%89%E5%8D%93EditText-requestFocus%E5%A4%B1%E6%95%88/%E5%AE%89%E5%8D%93EditText-requestFocus%E5%A4%B1%E6%95%88/</url>
    <content><![CDATA[<p>   ä¹‹å‰é¡¹ç›®éœ€æ±‚è¦æ±‚åœ¨è¿›å…¥ä¸€ä¸ªactivityçš„æ—¶å€™è‡ªåŠ¨è·å–é¡µé¢å†…æŸä¸ªEditTextçš„ç„¦ç‚¹ï¼Œè®©ç”¨æˆ·å¯ä»¥è¿›å…¥é¡µé¢è¿‡åé©¬ä¸Šè¾“å…¥ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">editText.requestFocus();</span><br></pre></td></tr></table></figure></div>
<p>  æˆ‘ç»è¿‡è°ƒè¯•è¿‡åè¿™è¡Œä»£ç å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œäºæ˜¯åœ¨ç½‘ä¸ŠæŸ¥æ‰¾äº†ä¸€äº›èµ„æ–™å‘ç°äº†åŸå› ï¼Œ<br>å› ä¸ºæˆ‘æ˜¯åœ¨onCreateï¼ˆï¼‰æ–¹æ³•ä¸­è°ƒç”¨çš„è¿™è¡Œä»£ç ï¼Œä½†æ˜¯åœ¨activityçš„ç”Ÿå‘½å‘¨æœŸä¸­è¿™ä¸ªæ—¶å€™editTextè¿™ä¸ªæ—¶å€™å¹¶æ²¡æœ‰è¢«æ¸²æŸ“åœ¨ç•Œé¢ä¸Šï¼Œæ‰€ä»¥è¿™è¡Œä»£ç ç†æ‰€å½“ç„¶çš„å¤±æ•ˆäº†ã€‚</p>
<p>è¯ä¸å¤šè¯´ï¼Œä¸‹é¢ä¸Šè§£å†³åŠæ³•</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€æ¬¡è®¾ç½®å»¶æ—¶ï¼Œç­‰å¾…é¡µé¢æ¸²æŸ“å®Œæ¯•å†è®¾ç½®ç„¦ç‚¹</span></span><br><span class="line">editText.postDelayed(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        editText.requestFocus();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br></pre></td></tr></table></figure></div>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>å¼€å‘æ—¥å¸¸ java</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å“webviewé€šç”¨é…ç½®âœˆï¸</title>
    <url>/2021/11/12/%E5%AE%89%E5%8D%93webview%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE/%E5%AE%89%E5%8D%93webview%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="ä¸»è¦æ˜¯javaçš„å®ç°ï¼Œè§£å†³ä¸€äº›ç™½å±æˆ–è€…åŠ è½½ä¸å‡ºæ¥çš„é…ç½®ï¼Œäº²æµ‹å¯ç”¨âœ”ï¸âœ”ï¸âœ”ï¸"><a href="#ä¸»è¦æ˜¯javaçš„å®ç°ï¼Œè§£å†³ä¸€äº›ç™½å±æˆ–è€…åŠ è½½ä¸å‡ºæ¥çš„é…ç½®ï¼Œäº²æµ‹å¯ç”¨âœ”ï¸âœ”ï¸âœ”ï¸" class="headerlink" title="ä¸»è¦æ˜¯javaçš„å®ç°ï¼Œè§£å†³ä¸€äº›ç™½å±æˆ–è€…åŠ è½½ä¸å‡ºæ¥çš„é…ç½®ï¼Œäº²æµ‹å¯ç”¨âœ”ï¸âœ”ï¸âœ”ï¸"></a>ä¸»è¦æ˜¯javaçš„å®ç°ï¼Œè§£å†³ä¸€äº›ç™½å±æˆ–è€…åŠ è½½ä¸å‡ºæ¥çš„é…ç½®ï¼Œäº²æµ‹å¯ç”¨âœ”ï¸âœ”ï¸âœ”ï¸</h1><div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line">webView = <span class="keyword">new</span> <span class="title class_">WebView</span>(mContext);</span><br><span class="line">        webViewContainer.addView(webView, <span class="keyword">new</span> <span class="title class_">FrameLayout</span>.LayoutParams(</span><br><span class="line">                FrameLayout.LayoutParams.MATCH_PARENT,</span><br><span class="line">                FrameLayout.LayoutParams.MATCH_PARENT));</span><br><span class="line">        webView.loadUrl(url);</span><br><span class="line">        <span class="comment">//é‡æ–°åŠ è½½ ç‚¹å‡»ç½‘é¡µé‡Œé¢çš„é“¾æ¥è¿˜æ˜¯åœ¨å½“å‰çš„webviewé‡Œè·³è½¬ã€‚ä¸è·³åˆ°æµè§ˆå™¨é‚£è¾¹</span></span><br><span class="line">        webView.setWebViewClient(<span class="keyword">new</span> <span class="title class_">WebViewClient</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// é‡å†™æ­¤æ–¹æ³•èƒ½å¤Ÿè®©webviewå¤„ç†httpsè¯·æ±‚</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceivedSslError</span><span class="params">(WebView view, SslErrorHandler handler, android.net.http.SslError error)</span> &#123;</span><br><span class="line">                handler.proceed();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceivedError</span><span class="params">(WebView view, <span class="type">int</span> errorCode, String description, String failingUrl)</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//æ”¯æŒjs</span></span><br><span class="line">        webView.getSettings().setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// è§£å†³å›¾ç‰‡ä¸æ˜¾ç¤º</span></span><br><span class="line">        webView.getSettings().setBlockNetworkImage(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span>(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">            webView.getSettings().setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è‡ªé€‚åº”å±å¹•</span></span><br><span class="line">        webView.getSettings().setLayoutAlgorithm(WebSettings.LayoutAlgorithm.SINGLE_COLUMN);</span><br><span class="line">        webView.getSettings().setLoadWithOverviewMode(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®å¯ä»¥æ”¯æŒç¼©æ”¾</span></span><br><span class="line">        webView.getSettings().setSupportZoom(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//æ‰©å¤§æ¯”ä¾‹çš„ç¼©æ”¾</span></span><br><span class="line">        webView.getSettings().setUseWideViewPort(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ˜¯å¦å‡ºç°ç¼©æ”¾å·¥å…·</span></span><br><span class="line">        webView.getSettings().setBuiltInZoomControls(<span class="literal">false</span>);</span><br><span class="line">		<span class="comment">//è§£å†³ç™½å±é—®é¢˜ï¼ŒåŸå› ä¸æ˜</span></span><br><span class="line">        webView.getSettings().setDomStorageEnabled(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure></div>

<p>ä»£ç çš„ä½œç”¨æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œå†ç½—åˆ—ä¸€ä¸‹ğŸ””</p>
<ul>
<li><strong>setWebViewClient</strong>ï¼šæ–°åŠ è½½ ç‚¹å‡»ç½‘é¡µé‡Œé¢çš„é“¾æ¥è¿˜æ˜¯åœ¨å½“å‰çš„webviewé‡Œè·³è½¬ã€‚ä¸è·³åˆ°æµè§ˆå™¨é‚£è¾¹</li>
<li><strong>onReceivedSslError</strong>ï¼š  é‡å†™æ­¤æ–¹æ³•èƒ½å¤Ÿè®©webviewå¤„ç†httpsè¯·æ±‚</li>
<li><strong>setJavaScriptEnabled</strong>ï¼šæ”¯æŒjs</li>
<li><strong>setBlockNetworkImage</strong>ï¼Œ<strong>setMixedContentMode</strong>ï¼šè§£å†³å›¾ç‰‡ä¸æ˜¾ç¤º</li>
<li><strong>setLayoutAlgorithm</strong>ï¼šè‡ªé€‚åº”å±å¹•</li>
<li><strong>setSupportZoom</strong>ï¼šè®¾ç½®å¯ä»¥æ”¯æŒç¼©æ”¾</li>
<li><strong>setUseWideViewPort</strong>ï¼šæ‰©å¤§æ¯”ä¾‹çš„ç¼©æ”¾</li>
<li><strong>setBuiltInZoomControls</strong>ï¼šè®¾ç½®æ˜¯å¦å‡ºç°ç¼©æ”¾</li>
<li><strong>setDomStorageEnabled</strong>ï¼šè§£å†³ç™½å±é—®é¢˜ï¼ŒåŸå› ä¸æ˜</li>
</ul>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é€‚åˆè‡ªå·±çš„æ‰æ˜¯æœ€å¥½çš„ï¼Œä¸ä¸€å®šè¦åŠ ä¸Šæ‰€æœ‰é…ç½®ğŸ’˜</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>å¼€å‘æ—¥å¸¸ andorid</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å“ä½¿ç”¨fastjsonè§£æå¸¦BigDecimalå‚æ•°çš„å®ä½“ç±»æŠ¥é”™java.lang.NumberFormatException: For input string:ä¹±ç ...</title>
    <url>/2021/09/26/%E5%AE%89%E5%8D%93%E4%BD%BF%E7%94%A8fastjson%E8%A7%A3%E6%9E%90%E5%B8%A6BigDecimal%E5%8F%82%E6%95%B0%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB%E6%8A%A5%E9%94%99java-lang-NumberFormatException-For-input-string-%E4%B9%B1%E7%A0%81/%E5%AE%89%E5%8D%93%E4%BD%BF%E7%94%A8fastjson%E8%A7%A3%E6%9E%90%E5%B8%A6BigDecimal%E5%8F%82%E6%95%B0%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB%E6%8A%A5%E9%94%99java-lang-NumberFormatException-For-input-string-%E4%B9%B1%E7%A0%81/</url>
    <content><![CDATA[<h1 id="å‘ç°é—®é¢˜"><a href="#å‘ç°é—®é¢˜" class="headerlink" title="å‘ç°é—®é¢˜"></a>å‘ç°é—®é¢˜</h1><p>ä»Šå¤©åœ¨å…¬å¸å·¥ä½œçš„æ—¶ç”¨fastjson beancopyæ•°æ®ï¼Œå‡ºç°äº†ä¸€ä¸ªæŠ¥é”™ç±»ä¼¼å¦‚ä¸‹</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">java.<span class="property">lang</span>.<span class="property">NumberFormatException</span>: <span class="title class_">For</span> input <span class="attr">string</span>:</span><br><span class="line"><span class="comment">// æ­¤å¤„ä¹±ç </span></span><br><span class="line">at java.<span class="property">lang</span>.<span class="property">Integer</span>.<span class="built_in">parseInt</span>(<span class="title class_">Integer</span>.<span class="property">java</span>:<span class="number">521</span>)</span><br><span class="line">at java.<span class="property">lang</span>.<span class="property">Integer</span>.<span class="built_in">parseInt</span>(<span class="title class_">Integer</span>.<span class="property">java</span>:<span class="number">556</span>)</span><br><span class="line">at java.<span class="property">math</span>.<span class="property">BigDecimal</span>.(<span class="title class_">BigDecimal</span>.<span class="property">java</span>:<span class="number">336</span>)</span><br><span class="line">at java.<span class="property">math</span>.<span class="property">BigDecimal</span>.(<span class="title class_">BigDecimal</span>.<span class="property">java</span>:<span class="number">374</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">JSONLexerBase</span>.<span class="title function_">scanFieldDecimal</span>(<span class="title class_">JSON</span>LexerBase.<span class="property">java</span>:<span class="number">3727</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">deserializer</span>.<span class="property">JavaBeanDeserializer</span>.<span class="title function_">deserialze</span>(<span class="title class_">JavaBeanDeserializer</span>.<span class="property">java</span>:<span class="number">594</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">deserializer</span>.<span class="property">JavaBeanDeserializer</span>.<span class="title function_">deserialze</span>(<span class="title class_">JavaBeanDeserializer</span>.<span class="property">java</span>:<span class="number">295</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">deserializer</span>.<span class="property">JavaBeanDeserializer</span>.<span class="title function_">deserialze</span>(<span class="title class_">JavaBeanDeserializer</span>.<span class="property">java</span>:<span class="number">291</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">deserializer</span>.<span class="property">DefaultFieldDeserializer</span>.<span class="title function_">parseField</span>(<span class="title class_">DefaultFieldDeserializer</span>.<span class="property">java</span>:<span class="number">88</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">deserializer</span>.<span class="property">JavaBeanDeserializer</span>.<span class="title function_">parseField</span>(<span class="title class_">JavaBeanDeserializer</span>.<span class="property">java</span>:<span class="number">1282</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">deserializer</span>.<span class="property">JavaBeanDeserializer</span>.<span class="title function_">deserialze</span>(<span class="title class_">JavaBeanDeserializer</span>.<span class="property">java</span>:<span class="number">897</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">deserializer</span>.<span class="property">JavaBeanDeserializer</span>.<span class="title function_">deserialze</span>(<span class="title class_">JavaBeanDeserializer</span>.<span class="property">java</span>:<span class="number">295</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">DefaultJSONParser</span>.<span class="title function_">parseObject</span>(<span class="title class_">DefaultJSONParser</span>.<span class="property">java</span>:<span class="number">706</span>)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Caused</span> <span class="attr">by</span>: com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">JSONException</span>: <span class="title class_">For</span> input <span class="attr">string</span>:</span><br><span class="line"><span class="comment">//æ­¤å¤„ ä¹±ç </span></span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">parser</span>.<span class="property">DefaultJSONParser</span>.<span class="title function_">parseObject</span>(<span class="title class_">DefaultJSONParser</span>.<span class="property">java</span>:<span class="number">713</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">JSON</span>.<span class="title function_">parseObject</span>(<span class="title class_">JSON</span>.<span class="property">java</span>:<span class="number">394</span>)</span><br><span class="line">at com.<span class="property">alibaba</span>.<span class="property">fastjson</span>.<span class="property">JSON</span>.<span class="title function_">parseObject</span>(<span class="title class_">JSON</span>.<span class="property">java</span>:<span class="number">357</span>)</span><br><span class="line">at rxhttp.<span class="property">wrapper</span>.<span class="property">converter</span>.<span class="property">FastJsonConverter</span>.<span class="title function_">convert</span>(<span class="title class_">FastJsonConverter</span>.<span class="property">java</span>:<span class="number">59</span>)</span><br><span class="line">at rxhttp.<span class="property">wrapper</span>.<span class="property">utils</span>.<span class="property">Converter</span>.<span class="title function_">convert</span>(<span class="title class_">Converter</span>.<span class="property">kt</span>:<span class="number">45</span>)</span><br><span class="line">at rxhttp.<span class="property">wrapper</span>.<span class="property">parse</span>.<span class="property">AbstractParser</span>.<span class="title function_">convert</span>(<span class="title class_">AbstractParser</span>.<span class="property">kt</span>:<span class="number">33</span>)</span><br><span class="line">at com.<span class="property">galaxis</span>.<span class="property">paser</span>.<span class="property">ResultPaser</span>.<span class="title function_">onParse</span>(<span class="title class_">ResultPaser</span>.<span class="property">java</span>:<span class="number">41</span>)</span><br><span class="line">at rxhttp.<span class="property">wrapper</span>.<span class="property">param</span>.<span class="property">ObservableParser$SyncParserObserver</span>.<span class="title function_">onNext</span>(<span class="title class_">ObservableParser</span>.<span class="property">java</span>:<span class="number">103</span>)</span><br><span class="line">at rxhttp.<span class="property">wrapper</span>.<span class="property">param</span>.<span class="property">ObservableParser$SyncParserObserver</span>.<span class="title function_">onNext</span>(<span class="title class_">ObservableParser</span>.<span class="property">java</span>:<span class="number">54</span>)</span><br><span class="line">at rxhttp.<span class="property">wrapper</span>.<span class="property">param</span>.<span class="property">ObservableCallEnqueue$HttpDisposable</span>.<span class="title function_">onResponse</span>(<span class="title class_">ObservableCallEnqueue</span>.<span class="property">java</span>:<span class="number">79</span>)</span><br><span class="line">at okhttp3.<span class="property">internal</span>.<span class="property">connection</span>.<span class="property">RealCall$AsyncCall</span>.<span class="title function_">run</span>(<span class="title class_">RealCall</span>.<span class="property">kt</span>:<span class="number">504</span>)</span><br><span class="line">at java.<span class="property">util</span>.<span class="property">concurrent</span>.<span class="property">ThreadPoolExecutor</span>.<span class="title function_">runWorker</span>(<span class="title class_">ThreadPoolExecutor</span>.<span class="property">java</span>:<span class="number">1133</span>)</span><br><span class="line">at java.<span class="property">util</span>.<span class="property">concurrent</span>.<span class="property">ThreadPoolExecutor$Worker</span>.<span class="title function_">run</span>(<span class="title class_">ThreadPoolExecutor</span>.<span class="property">java</span>:<span class="number">607</span>)</span><br><span class="line">at java.<span class="property">lang</span>.<span class="property">Thread</span>.<span class="title function_">run</span>(<span class="title class_">Thread</span>.<span class="property">java</span>:<span class="number">761</span>)</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘å¿ƒä¸­çš„å½“æ—¶ååˆ†å¹³é™ï¼Œä¸å°±æ˜¯ä¸èƒ½å¼ºè½¬å—ï¼Ÿæˆ‘æ¥çœ‹çœ‹æ€ä¹ˆå¼ºè½¬ä¸å°±è¡Œäº†ï¼Œä½†æ˜¯ä»”ç»†ä¸€çœ‹ä¸å¤ªå¯¹BigDecimalæ€ä¹ˆè½¬åˆ°Integerå°±ä¸è¡Œäº†ï¼Œä¹Ÿå¤ªlowäº†å§</p>
<h1 id="æ‰¾åˆ°é—®é¢˜"><a href="#æ‰¾åˆ°é—®é¢˜" class="headerlink" title="æ‰¾åˆ°é—®é¢˜"></a>æ‰¾åˆ°é—®é¢˜</h1><p>ç„¶åå°±æ˜¯æ¼«é•¿çš„æŸ¥æ‰¾é—®é¢˜çš„è¿‡ç¨‹ï¼Œå‘ç°æŠ¥é”™çš„ä¹±ç å’Œæˆ‘ä»£ç é‡Œçš„éƒ½æ²¡æœ‰ç›¸ç¬¦åˆçš„åœ°æ–¹ï¼Œæœ€ç»ˆæŠŠé—®é¢˜ç¡®å®šåœ¨äº†fastjsonæœ¬èº«ä¸Šï¼Œè™½ç„¶æœ‰ç‚¹ä¸ç›¸ä¿¡ï¼Œä½†æ˜¯æ’é™¤æ³•åªèƒ½åœ¨å®ƒä¸Šé¢äº†ã€‚<br>åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»ˆäºæ‰¾åˆ°äº†githubä¸Šé¢çš„è¿™ä¸ªissueï¼Œç½‘å€å¦‚ä¸‹ï¼š<br>é“¾æ¥: <a class="link"   href="https://github.com/alibaba/fastjson/pull/3555" >https://github.com/alibaba/fastjson/pull/3555 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</p>
<p>å¤§æ¦‚è¯´çš„å°±æ˜¯ä¿®å¤äº†ä¸€ä¸ªfastjsonåœ¨Androidç³»ç»Ÿä¸Šå¤„ç†BigDecimalè§£æé”™è¯¯çš„ä¸€ä¸ªbugï¼Œå¹¶ä¸”å·²ç»ä¿®å¤ã€‚</p>
<h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><p>æˆ‘ä¸€çœ‹é‚£å¥½å§ï¼Œè°å«æˆ‘æ²¡æœ¬äº‹ä¸èƒ½è‡ªå·±è§£æå‘¢æ˜¯å§ï¼Œæ—¢ç„¶ä½ éƒ½ä¿®äº†æˆ‘å‡ä¸ªç‰ˆæœ¬æ€»å¯ä»¥ç”¨äº†å§ï¼Œç„¶åæˆ‘å‘ç°æœ€æ–°çš„ç‰ˆæœ¬è¿˜æ˜¯æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ ¹æœ¬æ²¡æä¸Šå»ï¼ï¼o(â•¥ï¹â•¥)o</p>
<p>ç»å†äº†ä¹ä¹å…«åä¸€éš¾ï¼Œæœ€åæˆ‘ä½¿ç”¨äº† fastjsonè‡ªå¸¦çš„@JSONFieldçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç»•å¼€äº†è¿™ä¸ªbugå®Œæˆäº†è§£æ</p>
<p>åœ¨BigDecimalçš„å­—æ®µä¸ŠåŠ ä¸Šäº†è¿™ä¸ªæ³¨è§£ï¼Œç„¶åè‡ªå·±å†™è½¬æ¢çš„æ–¹æ³•ï¼Œå°±å¯ä»¥ç»•å¼€è¿™ä¸ªbugå•¦</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JSONField(serializeUsing= BigDecimalToDouble.class,deserializeUsing = DoubleToBigDecimal.class)</span></span><br></pre></td></tr></table></figure></div>
<p>BigDecimalToDouble .class</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.JSONSerializer;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.ObjectSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span> : ccpos</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : yifeng_zeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span> : 2021/9/23 12:51</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : fastjsonè½‰æ›</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">class</span> <span class="title class_">BigDecimalToDouble</span> <span class="keyword">implements</span> <span class="title class_">ObjectSerializer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(JSONSerializer serializer, Object object, Object fieldName, Type fieldType, <span class="type">int</span> features)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">value</span> <span class="operator">=</span> (BigDecimal) object;</span><br><span class="line">        <span class="type">Double</span> <span class="variable">doubleValue</span> <span class="operator">=</span> value.doubleValue();</span><br><span class="line">        serializer.write(doubleValue);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>DoubleToBigDecimal .class</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ProjectName</span> : ccpos</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> : yifeng_zeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Time</span> : 2021/9/23 12:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> : fastjsonè½‰æ›</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleToBigDecimal</span> <span class="keyword">implements</span> <span class="title class_">ObjectDeserializer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">deserialze</span><span class="params">(DefaultJSONParser parser, Type type, Object fieldName)</span> &#123;</span><br><span class="line">        <span class="type">Double</span> <span class="variable">value</span> <span class="operator">=</span> parser.parseObject(Double.class);</span><br><span class="line">        <span class="comment">// DataType æ•°æ®ç±»å‹ æšä¸¾</span></span><br><span class="line">       <span class="keyword">return</span> (T) <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getFastMatchToken</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿˜æ˜¯æŒºç®€å•çš„ï¼Œä¸æ˜¯å—ï¼Ÿ(ç®€å•ä¸ªé¬¼ï¼ŒåŠå¤©æ²¡æœ‰äº†ï¼Œå°å£°bibiï¼‰</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>å¼€å‘æ—¥å¸¸</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å“çš„æ’­æ”¾å™¨å¯¹æ¯”ä¸é€‰å‹ï¼ˆvlcï¼ŒEXOplayerï¼ŒIjkplayerï¼ŒGSYVideoPlayerï¼‰ğŸ“ºè¯¦ç»†è¿‡ç¨‹</title>
    <url>/2023/07/27/%E5%AE%89%E5%8D%93%E7%9A%84%E6%92%AD%E6%94%BE%E5%99%A8%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E5%9E%8B%EF%BC%88vlc%EF%BC%8CEXOplayer%EF%BC%8CIjkplayer%EF%BC%8CGSYVideoPlayer%EF%BC%89%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/%E5%AE%89%E5%8D%93%E7%9A%84%E6%92%AD%E6%94%BE%E5%99%A8%E5%AF%B9%E6%AF%94%E4%B8%8E%E9%80%89%E5%9E%8B%EF%BC%88vlc%EF%BC%8CEXOplayer%EF%BC%8CIjkplayer%EF%BC%8CGSYVideoPlayer%EF%BC%89%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<hr>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><em><strong>æœ¬æ–‡ä¸»è¦ä»å®é™…çš„è§’åº¦å»è§£è¯»å’Œé€‰å‹</strong></em><br>å…¥èŒæ–°å…¬å¸ï¼Œéœ€è¦åšä¸€æ¬¾æ¶‰åŠåˆ°æ’­æ”¾å™¨ï¼Œæ’­æ”¾rtsp æµçš„appï¼Œè¦æ±‚åˆ°æˆ‘æ¥é€‰å‹ï¼Œå¹¶ç»™äº†æˆ‘ä¸‹é¢ä¸‰ä¸ªé€‰æ‹©<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/player1.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>åœ¨è¿™ä¹‹å‰æˆ‘åªæ˜¯ä¸€åæ™®æ™®é€šé€šçš„å®‰å“åº”ç”¨å¼€å‘å·¥ç¨‹å¸ˆï¼Œæ²¡æœ‰æ¥è§¦è¿‡éŸ³è§†é¢‘ï¼Œå¦‚æœä½ ä¹Ÿå’Œæˆ‘ä¸€æ ·ï¼Œé‚£ä¹ˆè¿™ä»¶äº‹çœŸçš„å¤ªé…·å•¦ğŸ˜</p>
<p>ç„¶åå°±æ˜¯ä¸ºæœŸå‡ å¤©çš„å¯¹æ¯”ä¸é€‰å‹</p>
<hr>
<h1 id="ä¸€ã€vlc"><a href="#ä¸€ã€vlc" class="headerlink" title="ä¸€ã€vlc"></a>ä¸€ã€vlc</h1><p>é‡äº‹ä¸å†³é—®ç¾¤å‹ï¼Œç¾¤å‹ç»™æˆ‘æ¨èäº†vlcè¿™ä¸ªå¼€æºçš„æ’­æ”¾å™¨ï¼Œå¹¶å‹å¥½çš„å‘æˆ‘æ¨èäº†æ–‡ç« å’ŒvlcDemoï¼Œæˆ‘è®°ä¸å¾—æ˜¯å¦æ˜¯ä»–è‡ªå·±çš„æ–‡ç« å’Œdemoäº†ï¼Œè¿™æ˜¯è¿æ¥</p>
<ul>
<li><a class="link"   href="https://blog.csdn.net/gs12software/article/details/130618598" >å®‰å“ä½¿ç”¨VLCæ’­æ”¾è§†é¢‘ï¼Œå®ç°æˆªå›¾å’Œå½•åˆ¶åŠŸèƒ½ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li><a class="link"   href="https://blog.csdn.net/tongzhengtong/article/details/116794101?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168923986716800197038973%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=168923986716800197038973&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-116794101-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=android%20vlc%20rtsp%20rtmp&spm=1018.2226.3001.4187@" >android ä½¿ç”¨VLC,å½•åƒ æˆªå›¾åŠŸèƒ½ï¼Œæ”¯æŒrtsp rtmp http SMB ç­‰ç­‰ã€‚ æµåª’ä½“,ç‚¹æ’­è§†é¢‘ç­‰ç­‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<p>ç„¶åæˆ‘æµè§ˆäº†<a class="link"   href="https://github.com/videolan/vlc" >vlcçš„githubåœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>å’Œ<a class="link"   href="https://code.videolan.org/videolan/libvlc-android-samples" >ç¤ºä¾‹ä»£ç çš„åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œå¹¶å‚è€ƒä¸Šé¢ä¸¤ä¸ªè¿æ¥ï¼Œå®ç°äº†ä¸€ä¸ªç®€å•çš„vlcdemoï¼Œä¹Ÿå¯¹å…¶æœ‰äº†ä¸€ç‚¹ç®€å•çš„äº†è§£</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>è·¨å¹³å°ï¼Œå…¼å®¹æ€§å¥½</li>
<li>åŠŸèƒ½å…¨é¢ï¼Œæ”¯æŒ rtspã€rtmpã€ftpã€httpã€https ç­‰åè®®</li>
<li>ä»£ç å®Œå…¨è§£è€¦ï¼Œmodules ç›¸äº’ç‹¬ç«‹ï¼Œä¸å½±å“ï¼Œå¼•å…¥æ–° modules æ–¹ä¾¿</li>
<li>ç»´æŠ¤å›¢é˜Ÿå¼ºå¤§ï¼Œæ›´æ–°é¢‘ç¹</li>
</ul>
<p> <strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>Android å¹³å°ç¼–è¯‘å‡ºçš„åŒ…è¾ƒå¤§ï¼Œæœ‰ 16M å·¦å³ï¼›</li>
<li>åœ¨ Android å¹³å°ä¸Šå¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œéœ€è¦ä¼˜åŒ–(è¿™ä¸ªæˆ‘æ²¡ä½“ä¼šåˆ°)</li>
<li>æ ¹æ®ç¾¤å‹çš„å‹å¥½æé†’ï¼Œå¦‚æœæ¶‰åŠåˆ°æˆªå›¾å½•åƒçš„åŠŸèƒ½è¦æ”¹soï¼Œè¦ä¼šc++ï¼Œæˆ‘ä¸ä¼šï¼Œæ‰€ä»¥ç®—ç¼ºç‚¹ï¼ğŸ¶</li>
</ul>
<p>æœ€ç»ˆå› ä¸ºAndroid å¹³å°ç¼–è¯‘å‡ºçš„åŒ…è¾ƒå¤§è¿™ä¸ªç¼ºç‚¹ï¼Œæ²¡æœ‰é‡‡ç”¨vlcã€‚ğŸ˜”</p>
<h1 id="äºŒã€EXOplayer"><a href="#äºŒã€EXOplayer" class="headerlink" title="äºŒã€EXOplayer"></a>äºŒã€EXOplayer</h1><p>ç„¶åå°±æ˜¯EXOplayerçš„è°ƒç ”ï¼Œä»€ä¹ˆï¼Ÿä½ é—®æˆ‘ä¸ºä»€ä¹ˆä¸å…ˆè°ƒç ”å…¶ä»–çš„ï¼Œæˆ‘æœ‰æˆ‘è‡ªå·±çš„è€ƒé‡å¥½å§ï¼Œä½ ä¸è¦æ•™æœ¬å®‰å“å¼€å‘åšäº‹ï¼Œé¦–å…ˆæˆ‘ä»¬æ’é™¤mediaplayerï¼Œå› ä¸ºç™¾åº¦è¿‡ååŸºæœ¬æ²¡æœ‰æ¨èçš„ï¼Œç„¶åå°±æ˜¯Ijkplayerå·²ç»æ˜¯ä¸€ä¸ªå“”å“©å“”å“©ä¸ç»´æŠ¤çš„å¼€æºé¡¹ç›®äº†ï¼Œè€ŒEXOplayeræ˜¯è°·æ­Œå¼€æºçš„æŒç»­ç»´æŠ¤çš„ï¼Œä½ è¯´æˆ‘å…ˆè°ƒç ”è°ï¼Ÿå¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬éª‘ä¸Šå¿ƒçˆ±çš„ğŸ›µï¼Œå¼€å§‹ã€‚</p>
<p>æˆ‘å…ˆæ‰¾åˆ°EXOplayerçš„githubåœ°å€ ï¼š<a class="link"   href="https://github.com/google/ExoPlayer" >https://github.com/google/ExoPlayer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>ç„¶åæ‰¾åˆ°æ–‡æ¡£ï¼š<a class="link"   href="https://exoplayer.dev/" >https://exoplayer.dev/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>ç„¶åå°±ç‹—è¡€çš„å‘ç°å•Šè¿™ä¸ªEXOplayerå•Šï¼Œä»–å¥—å¨ƒ</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/player2.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>è¿™æ˜¯ä»€ä¹ˆâ”ï¼Œè¿™æ˜¯è°·æ­Œæ‰¾å®‰å“ï¼Œè€çˆ¹æ‰¾å„¿å­ğŸ¶ï¼›</p>
<p>ç„¶åæˆ‘åˆå»å®‰å“å®˜ç½‘çœ‹ï¼š<a class="link"   href="https://developer.android.google.cn/guide/topics/media/exoplayer?hl=zh_cn" >https://developer.android.google.cn/guide/topics/media/exoplayer?hl=zh_cn <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/player3.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<p>å¥½å¥½å¥½ï¼Œä½ å®˜æ–¹è¿™ä¹ˆç©æ˜¯å§â”ï¼Œæˆ‘æ•´ä¸ªä¸€çœ‹ä¸‹æ¥ï¼Œå‘ç°EXOplayerçš„æœ€æ–°ä¾èµ–å·²ç»å¸¦media3çš„å‰ç¼€äº†ï¼Œå‰é¢å‡ ä¸ªç‰ˆæœ¬è¿˜æœ‰å‰ç¼€ä¸åŒçš„ä»£ç ç›¸åŒçš„åº“ï¼Œç©çš„æ˜¯çœŸæ»´èŠ±å•Šï¼Œåˆé•¿è§è¯†äº†ï¼ˆæ›´æ­£ï¼Œå‡ºç°æ¨å¥‡æ€ªçš„åœºæ™¯æ˜¯å› ä¸ºå¸¦Googleå‰ç¼€çš„exoplayerå°†è¦è¢«åºŸå¼ƒï¼Œæ–°çš„EXOplayerè¢«æ•´åˆåˆ°media3ä¸­ï¼‰</p>
<p>è¯´äº†é‚£ä¹ˆå¤šå…¶å®éƒ½æ˜¯æ’æ›²ï¼Œå·¥ä½œèµšé’±å˜›ï¼Œä¸å¯’ç¢œï¼Œæœ€åæˆ‘åˆå­¦ä¹ å¹¶å®ç°äº†ç”¨EXOplayeræ’­æ”¾è§†é¢‘å’Œè‡ªå®šä¹‰å®ç°æ’­æ”¾å™¨ç•Œé¢ï¼Œå‘ç°å¦‚æœåªæ˜¯èº«ä¸ºä¸€ä¸ªapié«˜çº§è°ƒç”¨å¸ˆçš„è¯ï¼Œå…¶å®ä½¿ç”¨æ–¹æ³•éƒ½æ˜¯å¤§å·®ä¸å¤§çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘å¯¹æ’­æ”¾å™¨å¿ƒé‡Œå¤§æ¦‚å°±æœ‰ä¸ªåº•äº†ã€‚</p>
<p>å†è¯´ä¸‹EXOplayerçš„ä¼˜ç¼ºç‚¹ï¼š<br><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>æ¥å…¥åŒ…ä½“ç§¯å°ï¼Œ1.1M</li>
<li>æŠ¤å›¢é˜Ÿå¼ºå¤§ï¼Œæ›´æ–°é€Ÿåº¦å¿«<br><strong>ç¼ºç‚¹ï¼š</strong></li>
<li>è·¨å¹³å°ï¼Œä¸å¤ªé€‚åˆç›´æ’­</li>
<li>å¯æ‰©å±•æ€§ä¸€èˆ¬ï¼Œè§†é¢‘è½¯è§£æ¥å…¥è¾ƒéº»çƒ¦</li>
<li>é€‚åˆæ’­æ”¾åœºæ™¯ç®€å•çš„é¡¹ç›®ï¼Œæ’­æ”¾è¿‡ç¨‹ä¸­æ— åˆ‡æ¢ç æµçš„æƒ…å†µ</li>
</ul>
<p>è™½ç„¶è¯´ä¸Šæ‰‹èµ·æ¥ç®€å•ï¼ŒåŒ…ä½“ç§¯åˆå°ï¼Œç°åœ¨è¿˜çº³å…¥äº†å®‰å“å®˜æ–¹æ–‡æ¡£ï¼Œä½†æ˜¯ä¸å¤ªé€‚åˆç›´æ’­ï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯å®æ—¶æ’­æ”¾ä¸€ä¸ªrtspæµçš„è§†é¢‘ï¼Œå¹¶ä¸”æ’­æ”¾åœºæ™¯æœ‰ä¸€å®šå¤æ‚åº¦ï¼Œæ‰€ä»¥æœ€åé€‰æ‹©æ”¾å¼ƒğŸ˜”</p>
<h1 id="ä¸‰ã€Ijkplayer"><a href="#ä¸‰ã€Ijkplayer" class="headerlink" title="ä¸‰ã€Ijkplayer"></a>ä¸‰ã€Ijkplayer</h1><p>æˆ‘ä»¬è€è§„çŸ©ï¼Œé¦–å…ˆæ˜¯æ‰¾githubåœ°å€ ï¼š<a class="link"   href="https://github.com/Bilibili/ijkplayer" >https://github.com/Bilibili/ijkplayer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>äº†è§£è¿‡åï¼Œæˆ‘åŒæ ·å®ç°äº†ä¸€ä¸ªdemoï¼ŒåŸºç¡€ä½¿ç”¨éƒ½å·®ä¸å¤šï¼Œå°±æ˜¯soè¦ä¸ç„¶è‡ªå·±ç¼–è¯‘ï¼Œè¦ä¸ç„¶åœ¨ç½‘ä¸Šæ‰¾ä¸‹åˆ«äººç¼–è¯‘å¥½çš„ï¼Œè¿˜æœ‰ä¸€ä»¶äº‹ï¼ˆè€çˆ¹è¯´çš„ä¸æ˜¯æˆ‘è¯´çš„ï¼‰å°±æ˜¯æœ‰ä¸€äº›ç‰ˆæœ¬æ˜¯æœ‰é—®é¢˜çš„ï¼Œä½¿ç”¨çš„æ—¶å€™æœ€å¥½çœ‹ä¸‹ï¼Œæ€»å¾—ä½“éªŒä¸‹æ¥å¯¹äºæˆ‘æ¥è¯´å°±æ˜¯å¼•å…¥çš„æ—¶å€™æ˜¯æœ€éº»çƒ¦çš„ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>åŒ…ä½“ç§¯æ¯” VLC å°</li>
<li>èµ„æ–™æ¯”è¾ƒé½å…¨ï¼ˆä½†æˆ‘ä¸ªäººè®¤ä¸ºè¿™ä¹Ÿæ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œåˆ°å¤„éƒ½æ˜¯é—®é¢˜ï¼‰</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>å¯æ‰©å±•æ€§è¾ƒå·®ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰æä¾› modules ä¾›å¼€å‘è€…äºŒæ¬¡å¼€å‘</li>
<li>å®˜æ–¹ç›®å‰åŸºæœ¬ä¸ç»´æŠ¤ï¼Œä¸æ›´æ–°</li>
</ul>
<p>ä½†æ˜¯å› ä¸ºIjkplayeræ”¯æŒrtspï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰æ›´å¥½çš„é€‰æ‹©å°±å†³å®šé‡‡ç”¨äº†ï¼Œç›´åˆ°æˆ‘å‘ç°äº†å®è—å’Œæœ¬ç¯‡æ–‡ç« çš„ä¸»è§’<strong>GSYVideoPlayer</strong></p>
<h1 id="å››ã€GSYVideoPlayerğŸ”¥ğŸ”¥ğŸ”¥"><a href="#å››ã€GSYVideoPlayerğŸ”¥ğŸ”¥ğŸ”¥" class="headerlink" title="å››ã€GSYVideoPlayerğŸ”¥ğŸ”¥ğŸ”¥"></a>å››ã€GSYVideoPlayerğŸ”¥ğŸ”¥ğŸ”¥</h1><p>githubåœ°å€ï¼š <a class="link"   href="https://github.com/CarGuo/GSYVideoPlayer" >https://github.com/CarGuo/GSYVideoPlayer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><strong>è®©æˆ‘ä»¬çœ‹çœ‹ä»‹ç»ï¼š</strong><br>    è§†é¢‘æ’­æ”¾å™¨ï¼ˆIJKplayerã€ExoPlayerã€MediaPlayerï¼‰ï¼ŒHTTPSæ”¯æŒï¼Œæ”¯æŒå¼¹å¹•ï¼Œæ”¯æŒæ»¤é•œã€æ°´å°ã€gifæˆªå›¾ï¼Œç‰‡å¤´å¹¿å‘Šã€ä¸­é—´å¹¿å‘Šï¼Œå¤šä¸ªåŒæ—¶æ’­æ”¾ï¼Œæ”¯æŒåŸºæœ¬çš„æ‹–åŠ¨ï¼Œå£°éŸ³ã€äº®åº¦è°ƒèŠ‚ï¼Œæ”¯æŒè¾¹æ’­è¾¹ç¼“å­˜ï¼Œæ”¯æŒè§†é¢‘æœ¬èº«è‡ªå¸¦rotationçš„æ—‹è½¬ï¼ˆ90,270ä¹‹ç±»ï¼‰ï¼Œé‡åŠ›æ—‹è½¬ä¸æ‰‹åŠ¨æ—‹è½¬çš„åŒæ­¥æ”¯æŒï¼Œæ”¯æŒåˆ—è¡¨æ’­æ”¾ ï¼Œç›´æ¥æ·»åŠ æ§ä»¶ä¸ºå°é¢ï¼Œåˆ—è¡¨å…¨å±åŠ¨ç”»ï¼Œè§†é¢‘åŠ è½½é€Ÿåº¦ï¼Œåˆ—è¡¨å°çª—å£æ”¯æŒæ‹–åŠ¨ï¼ŒåŠ¨ç”»æ•ˆæœï¼Œè°ƒæ•´æ¯”ä¾‹ï¼Œå¤šåˆ†è¾¨ç‡åˆ‡æ¢ï¼Œæ”¯æŒåˆ‡æ¢æ’­æ”¾å™¨ï¼Œè¿›åº¦æ¡å°çª—å£é¢„è§ˆï¼Œå…¶ä»–ä¸€äº›å°åŠ¨ç”»æ•ˆæœï¼Œrtspã€concatã€mpegã€‚ï¼ˆæ€»ç»“ï¼Œé«˜ç«¯å¤§æ°”ä¸Šæ¡£æ¬¡ï¼‰<br>    <strong>è®©æˆ‘ä»¬çœ‹çœ‹ä½œè€…ï¼š</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/player4.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ></p>
<pre><code>æ›¾ç»æœ‰äººå’Œæˆ‘è¯´è¿‡ï¼Œåœ¨ä¸­å›½åšå®‰å“å¼€å‘ä¸è®¤è¯†è¿™ä¸ªäººï¼Œå°±ä¸è¦è¯´è‡ªå·±æ˜¯å®‰å“å¼€å‘ğŸ¶
</code></pre>
<p><strong>è®©æˆ‘ä»¬çœ‹çœ‹æ–‡æ¡£ï¼š</strong><br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/player5.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>ç°åœ¨ï¼Œå‘Šè¯‰æˆ‘ä½ ä»¬çš„ç­”æ¡ˆï¼ğŸ‡ğŸ†âœ¨ğŸ‡ğŸ†âœ¨ğŸ‡ğŸ†âœ¨ï¼ˆéƒ­ç¥o(ï¿£â–½ï¿£)ï¼Œæˆ‘çˆ±ä½ æˆ‘è¦xxxxxï¼‰<br>å’³å’³ï¼Œå¼€ä¸ªå°å°çš„ç©ç¬‘</p>
<p>å› ä¸ºåœ°å€åœ¨è¿™é‡Œäº†ï¼Œè¦æ˜¯githubæ²¡æœ‰æ¡ä»¶çš„å¯ä»¥å»<a class="link"   href="https://gitee.com/CarGuo/GSYVideoPlayer" >https://gitee.com/CarGuo/GSYVideoPlayer <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>çœ‹ä¸‹æ–‡æ¡£æˆ‘å°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œæˆ‘æ‹‰äº†é¡¹ç›®è¿‡åè‡ªå·±æ”¹å§æ”¹å§ï¼Œç”¨çš„å¾ˆæ»¡æ„ï¼Œæœ€ç»ˆå†³å®šä½¿ç”¨<strong>GSYVideoPlayer</strong>æ¥å¼€å‘é¡¹ç›®</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<ul>
<li>æ”¯æŒå¥½å‡ ç§å¼€æºæ’­æ”¾å™¨ï¼Œé›†å¤§æˆè€…</li>
<li>å¯ä»¥æŒ‰éœ€å¼•ç”¨æ‰€éœ€è¦çš„ä¾èµ–ï¼Œè¿™æ ·ä¸€æ¥åŒ…ä½“ç§¯ä¸ä¼šå¤ªå¤§</li>
<li>ä½œè€…ç»´æŠ¤å¾ˆå‹¤å¿«ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜issuesï¼Œä½œè€…ä¹Ÿä¼šå¸®å¿™çœ‹çœ‹</li>
<li>æ–‡æ¡£å†™çš„å¾ˆæ¸…æ¥šä¸éœ€è¦é¢å¤–æŸ¥èµ„æ–™ï¼Œå®åœ¨ä¸æ‡‚ä»£ç æ‹‰ä¸‹æ¥ä¸€è·‘ï¼Œå¯¹ç…§ç€ä»£ç åŸºæœ¬ä¸Šå°±èƒ½ç†è§£äº†</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<p>-æœ‰ä¸€äº›ç‰ˆæœ¬å¯¹åº”ä¼šæœ‰ä¸åŒçš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä½¿ç”¨çš„æ—¶å€™ç”¨äº†æœ€æ–°çš„ä¾èµ–ï¼ŒæŒ‰ç…§æ–‡æ¡£ä¸èƒ½æ’­æ”¾rtspæµï¼Œé™ä½äº†ä¾èµ–è¿‡åå°±å¯ä»¥æ’­æ”¾äº†</p>
<h1 id="äº”ã€å…¶ä»–çš„å¼€æºæ’­æ”¾å™¨"><a href="#äº”ã€å…¶ä»–çš„å¼€æºæ’­æ”¾å™¨" class="headerlink" title="äº”ã€å…¶ä»–çš„å¼€æºæ’­æ”¾å™¨"></a>äº”ã€å…¶ä»–çš„å¼€æºæ’­æ”¾å™¨</h1><p>æœ¬ç€å­¦ä¹ çš„æ€åº¦ï¼Œæˆ‘æœŸé—´ä¹Ÿçœ‹äº†ä¸€äº›åˆ«çš„å¼€æºæ’­æ”¾å™¨ï¼Œå’Œå¤§å®¶ä¸€èµ·åˆ†äº«ä¸€ä¸‹</p>
<h2 id="jiaozivideoplayer"><a href="#jiaozivideoplayer" class="headerlink" title="jiaozivideoplayer"></a>jiaozivideoplayer</h2><p><a class="link"   href="https://github.com/Jzvd/JZVideo" >https://github.com/Jzvd/JZVideo <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>çŸ¥é“è¿™ä¸ªæ˜¯å› ä¸ºå‰å…¬å¸çš„çŸ­è§†é¢‘æ’­æ”¾æ˜¯ç”¨é¥ºå­æ”¹çš„ï¼Œæˆ‘åœ¨appä¸Šçœ‹æ•ˆæœä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼ŒåŸæœ¬å¥½åƒå«èŠ‚æ“ï¼Œç°åœ¨æ”¹åå«é¥ºå­ï¼Œç½‘å‹éƒ½è¯´éš¾ç”¨ï¼Œæ‰€ä»¥æ²¡æœ‰è¯¦ç»†å°è¯•ï¼Œæ„Ÿå…´è¶£çš„å…„å¼Ÿå¯ä»¥å»çœ‹çœ‹</p>
<h2 id="MediaPlayer"><a href="#MediaPlayer" class="headerlink" title="MediaPlayer"></a>MediaPlayer</h2><p><a class="link"   href="https://developer.android.google.cn/guide/topics/media/mediaplayer?hl=zh_cn" >https://developer.android.google.cn/guide/topics/media/mediaplayer?hl=zh_cn <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>å› ä¸ºåŸç”Ÿçš„MediaPlayerä¸æ”¯æŒrtspæµï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ²¡æœ‰è¿‡å¤šçš„çœ‹</p>
<h2 id="QPlayer2"><a href="#QPlayer2" class="headerlink" title="QPlayer2"></a>QPlayer2</h2><p><a class="link"   href="https://github.com/pili-engineering/QPlayer2-Android" >https://github.com/pili-engineering/QPlayer2-Android <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>ä¸ƒç‰›æ’­æ”¾å™¨çš„è¡ç”Ÿå“ï¼ŒåŸæœ¬çš„ä¸ƒç‰›æ’­æ”¾å™¨å·²ç»åœæ­¢ç»´æŠ¤ï¼Œä¹Ÿæ˜¯å› ä¸ºä¸æ”¯æŒrtspæµæ‰€ä»¥æ²¡æœ‰å°è¯•</p>
<h2 id="SmarterStreaming"><a href="#SmarterStreaming" class="headerlink" title="SmarterStreaming"></a>SmarterStreaming</h2><p><a class="link"   href="https://github.com/daniulive/SmarterStreaming" >https://github.com/daniulive/SmarterStreaming <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>å¤§ç‰›ç›´æ’­ï¼Œçœ‹èµ·æ¥å¾ˆç‰›é€¼çš„æ ·å­ï¼Œå¯æƒœè¦æ”¶è´¹</p>
<hr>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åœ¨æˆ‘è¿™ä¸ªéœ€æ±‚ä¸‹æˆ‘æœ€ç»ˆé€‰ç”¨äº†GSYVideoPlayerï¼Œä½†å„ä½æœ‹å‹ä»¬è¿˜æ˜¯è¦çœ‹è‡ªå·±çš„éœ€æ±‚ï¼Œé€‰ç”¨è‡ªå·±é€‚åˆçš„ä¸‰æ–¹æ¡†æ¶ï¼Œå¼€å‘èµ·æ¥æ‰èƒ½äº‹åŠåŠŸå€</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a class="link"   href="https://juejin.cn/post/6956604648476622856?searchId=2023072616491758248039F36B28127672#comment" >Ijkplayerã€ExoPlayerã€VLCæ’­æ”¾å™¨ç»¼åˆæ¯”è¾ƒ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>éŸ³è§†é¢‘</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å“è®¾ç½®äº†å¸¦drawableçš„backgroundåéƒ¨åˆ†æœºå‹marginå¤±æ•ˆ</title>
    <url>/2023/02/13/%E5%AE%89%E5%8D%93%E8%AE%BE%E7%BD%AE%E4%BA%86%E5%B8%A6drawable%E7%9A%84background%E5%90%8E%E9%83%A8%E5%88%86%E6%9C%BA%E5%9E%8Bmargin%E5%A4%B1%E6%95%88/%E5%AE%89%E5%8D%93%E8%AE%BE%E7%BD%AE%E4%BA%86%E5%B8%A6drawable%E7%9A%84background%E5%90%8E%E9%83%A8%E5%88%86%E6%9C%BA%E5%9E%8Bmargin%E5%A4%B1%E6%95%88/</url>
    <content><![CDATA[<h1 id="é¡¹ç›®èƒŒæ™¯"><a href="#é¡¹ç›®èƒŒæ™¯" class="headerlink" title="é¡¹ç›®èƒŒæ™¯"></a>é¡¹ç›®èƒŒæ™¯</h1><p>æ¥æ”¶äº†â€œå‰è¾ˆâ€çš„å®è´µå¸ƒå±€ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ›´æ”¹çš„éœ€æ±‚ï¼ŒUIéªŒæ”¶æ—¶å‘ç°äº†è¿™éƒ¨åˆ†å¼‚å¸¸ï¼ŒçœŸæ˜¯è°¢è°¢å‰è¾ˆ</p>
<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>android:layout_marginLeftåœ¨è®¾ç½®drawableçš„android:backgroundæ—¶ï¼Œåœ¨éƒ¨åˆ†æœºå‹ä¸Šå¤±æ•ˆ</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">     android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">     android:layout_height=<span class="string">&quot;@dimen/dp100&quot;</span></span><br><span class="line">     android:layout_marginLeft=<span class="string">&quot;@dimen/dp15&quot;</span></span><br><span class="line">     android:layout_marginTop=<span class="string">&quot;@dimen/dp10&quot;</span></span><br><span class="line">     android:layout_marginEnd=<span class="string">&quot;@dimen/dp15&quot;</span></span><br><span class="line">     android:background=<span class="string">&quot;@drawable/bg_corner5_fafafa&quot;</span></span><br><span class="line">     android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br></pre></td></tr></table></figure></div>

<hr>
<h1 id="åŸå› åˆ†æï¼š"><a href="#åŸå› åˆ†æï¼š" class="headerlink" title="åŸå› åˆ†æï¼š"></a>åŸå› åˆ†æï¼š</h1><p>ä½†æ˜¯å¸ƒå±€é¢„è§ˆä¸Šå’Œéƒ¨åˆ†æœºå‹æ˜¯ç”Ÿæ•ˆçš„ï¼Œå¹¶ä¸”å¤±æ•ˆçš„æœºå‹åœ¨æ›´æ”¹drawableä¸ºcoloræ—¶æ˜¯ç”Ÿæ•ˆçš„ï¼Œè¿™ä¸€åº¦è®©æˆ‘è®¤ä¸ºè¿™æ˜¯drawableèµ„æºæ–‡ä»¶çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘çœ‹äº†åŠå¤©drawableèµ„æºæ–‡ä»¶ä¹Ÿæ²¡çœ‹å‡ºæ¥ï¼Œå°±é‚£ä¹ˆä¸¤è¡Œä»£ç ï¼›æœ€åå‘ç°<strong>android:layout_marginLeft</strong>ä¸å…¶ä»–çš„<strong>android:layout_marginEnd</strong>ç­‰å±æ€§ä¸åŒ¹é…ï¼ï¼ï¼ï¼ï¼è¿™æ—¶æˆ‘ååº”è¿‡æ¥ï¼Œåº”è¯¥æ˜¯åŒäº‹å†™ä»£ç ä¸è§„èŒƒå¯¼è‡´çš„</p>
<hr>
<h1 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h1><p>å°†<strong>layout_marginLeft</strong>æ›´æ¢ä¸º<strong>layout_marginStart</strong></p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">     android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">     android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">     android:layout_marginStart=<span class="string">&quot;@dimen/dp15&quot;</span></span><br><span class="line">     android:layout_marginEnd=<span class="string">&quot;@dimen/dp15&quot;</span></span><br><span class="line">     android:layout_marginTop=<span class="string">&quot;@dimen/dp10&quot;</span></span><br><span class="line">     android:layout_marginBottom=<span class="string">&quot;@dimen/dp15&quot;</span></span><br><span class="line">     android:background=<span class="string">&quot;@drawable/bg_corner5_fafafa&quot;</span></span><br><span class="line">     android:orientation=<span class="string">&quot;vertical&quot;</span>&gt;</span><br></pre></td></tr></table></figure></div>
<p>ä»£ç ç”Ÿæ•ˆï¼Œæ‰€ä»¥å¹³æ—¶å†™ä»£ç è¿˜æ˜¯è¦è§„èŒƒ</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>å¼€å‘æ—¥å¸¸</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å“ï¼šåˆè¯†Presentationï¼ˆå®ç°åŒå±å¼‚æ˜¾ï¼Œç‰¹æ®Šçš„æƒé™æ·»åŠ ï¼‰</title>
    <url>/2023/03/09/%E5%AE%89%E5%8D%93%EF%BC%9A%E5%88%9D%E8%AF%86Presentation%EF%BC%88%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%B1%8F%E5%BC%82%E6%98%BE%EF%BC%8C%E7%89%B9%E6%AE%8A%E7%9A%84%E6%9D%83%E9%99%90%E6%B7%BB%E5%8A%A0%EF%BC%89/%E5%AE%89%E5%8D%93%EF%BC%9A%E5%88%9D%E8%AF%86Presentation%EF%BC%88%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%B1%8F%E5%BC%82%E6%98%BE%EF%BC%8C%E7%89%B9%E6%AE%8A%E7%9A%84%E6%9D%83%E9%99%90%E6%B7%BB%E5%8A%A0%EF%BC%89/</url>
    <content><![CDATA[<p> @<a href="%E5%AE%89%E5%8D%93%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E5%8F%8C%E5%B1%8F%E5%BC%82%E6%98%BE">TOC</a></p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p>  é“¾æ¥: <a class="link"   href="https://blog.csdn.net/wlwl0071986/article/details/48542923?spm=1001.2101.3001.6650.15&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-15.no_search_link&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-15.no_search_link" >Androidå®ç°åŒå±å¼‚æ˜¾ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.<br>  é“¾æ¥: <a class="link"   href="https://blog.csdn.net/pugongying1988/article/details/70597492" >Android 6.0:Unable to add window android.view.ViewRootImpl$W@5e2d85a â€“ permission denied <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.<br>     å…¬å¸é¡¹ç›®åæœŸéœ€è¦è®¾å¤‡æ”¯æŒåŒå±å¼‚æ˜¾ï¼Œå®¶å¢ƒè´«å¯’çš„æˆ‘è¡¨ç¤ºå‹æ ¹æ²¡å¬è¿‡ï¼Œèµ¶ç´§ç èµ·æ¥ï¼Œè‡ªå·±å»ºäº†ä¸€ä¸ªå°demoã€‚</p>
<h1 id="åˆè¯†Presentation"><a href="#åˆè¯†Presentation" class="headerlink" title="åˆè¯†Presentation"></a>åˆè¯†Presentation</h1><p>  æˆ‘å‘ç°äº†Presentationï¼Œå®‰å“å®˜æ–¹å¯¹äºPresentationæ˜¯è¿™æ ·æè¿°çš„<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/9276ac5819cf44d092f303408f6fae2c.png"
                      alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"
                ><br>å¤§è‡´æ„æ€å°±æ˜¯ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è¯æ¡†ï¼Œæ˜¯ä¸ºäº†åœ¨è¾…åŠ©æ˜¾ç¤ºå™¨ä¸Šæ¼”ç¤ºå†…å®¹ã€‚</p>
<h1 id="å¿«é€Ÿä¸Šæ‰‹"><a href="#å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="å¿«é€Ÿä¸Šæ‰‹"></a>å¿«é€Ÿä¸Šæ‰‹</h1><p>æƒ³è¦ä½¿ç”¨Presentationï¼Œé¦–å…ˆå¾—æ‰¾åˆ°è‡ªå·±çš„è¾…åŠ©å±å¹•ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†å®‰å“å®˜æ–¹æ¨èçš„ç¬¬äºŒç§æ–¹å¼<br>    åˆ›å»ºä¸€ä¸ªactivityï¼Œç„¶ååœ¨é‡Œé¢å†™ä¸€ä¸ªå†…éƒ¨ç±»ç»§æ‰¿äºPresentationï¼Œå½“ç„¶æˆ‘åªæ˜¯å›¾æ–¹ä¾¿ï¼Œå®é™…ä¸Šè‚¯å®šæ˜¯è¦æ–°å»ºä¸€ä¸ªçš„</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">private <span class="keyword">class</span> <span class="title class_">DifferentDislay</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Presentation</span> &#123;</span><br><span class="line">    public <span class="title class_">DifferentDislay</span>(<span class="title class_">Context</span> outerContext, <span class="title class_">Display</span> display) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(outerContext, display);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="title class_">DifferentDislay</span>(<span class="title class_">Context</span> outerContext, <span class="title class_">Display</span> display, int theme) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(outerContext, display, theme);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    protected <span class="keyword">void</span> <span class="title function_">onCreate</span>(<span class="params">Bundle savedInstanceState</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">onCreate</span>(savedInstanceState);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªåœ°æ–¹çš„å¸ƒå±€å°±æ˜¯ä½ å‰¯å±çš„å¸ƒå±€æ‹‰ï¼å¸ƒå±€æˆ‘å°±ä¸è´´äº†</span></span><br><span class="line">        <span class="title function_">setContentView</span>(R.<span class="property">layout</span>.<span class="property">diffrentdisplay</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åå¼€å§‹ç®€å•å¿«ä¹çš„æ‰¾å‰¯å±ï¼Œæ‰¾åˆ°è¿‡åæ˜¾ç¤ºå‡ºæ¥</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">DisplayManager</span> mDisplayManager;<span class="comment">//å±å¹•ç®¡ç†ç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Display</span>[] displays;<span class="comment">//å±å¹•æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> int <span class="variable constant_">OVERLAY_PERMISSION_REQ_CODE</span> = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    protected <span class="keyword">void</span> <span class="title function_">onCreate</span>(<span class="params">Bundle savedInstanceState</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">onCreate</span>(savedInstanceState);</span><br><span class="line">        <span class="title function_">setContentView</span>(R.<span class="property">layout</span>.<span class="property">activity_main</span>);</span><br><span class="line">        <span class="title function_">initPresentation</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">initPresentation</span>(<span class="params"></span>) &#123;</span><br><span class="line">        mDisplayManager = (<span class="title class_">DisplayManager</span>) <span class="variable language_">this</span>.<span class="title function_">getSystemService</span>(<span class="title class_">Context</span>.<span class="property">DISPLAY_SERVICE</span>);</span><br><span class="line"></span><br><span class="line">        displays = mDisplayManager.<span class="title function_">getDisplays</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">DifferentDislay</span> mPresentation = <span class="keyword">new</span> <span class="title class_">DifferentDislay</span>(<span class="variable language_">this</span></span><br><span class="line">                , displays[<span class="number">1</span>]);<span class="comment">//displays[1]æ˜¯å‰¯å±</span></span><br><span class="line"></span><br><span class="line">        mPresentation.<span class="title function_">getWindow</span>().<span class="title function_">setType</span>(</span><br><span class="line"></span><br><span class="line">                <span class="title class_">WindowManager</span>.<span class="property">LayoutParams</span>.<span class="property">TYPE_SYSTEM_ALERT</span>);</span><br><span class="line"></span><br><span class="line">        mPresentation.<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå°±å¼€å§‹è¡€æ³ªå¡«å‘å²ï¼Œè¿è¡Œè¿‡åæœæ–­çš„é—ªé€€äº†ï¼Œä¸€çœ‹æŠ¥é”™ï¼Œå“¦ï¼Œæ²¡æœ‰åŠ æƒé™å˜›ï¼Œå°äº‹ï¼Œåœ¨AndroidManifest.xmlä¸­åŠ ä¸Šæƒé™</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- æ˜¾ç¤ºç³»ç»Ÿçª—å£æƒé™ --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure></div>
<p>okï¼Œå†æ¬¡è¿è¡Œï¼Œæœæ–­åˆé—ªé€€ï¼Œç­‰ç­‰ï¼Œæˆ‘çš„è®¾å¤‡æ˜¯å®‰å“7.0çš„ï¼Œè¦åŠ¨æ€ç”³è¯·ï¼Œé‚£å°±ç”³è¯·ä¸€ä¸ªå‘—ã€‚å¯æ˜¯æˆ‘å‘ç°æˆ‘çš„åŠ¨æ€ç”³è¯·æƒé™ä»£ç ä¸èµ·ä½œç”¨ï¼Œæœ€åå‘ç°è¿™ä¸ªæƒé™è¦è·³åˆ°å•ç‹¬çš„é¡µé¢ç”³è¯·ï¼Œå®Œå…¨ä»£ç å¦‚ä¸‹ï¼š</p>
<h1 id="æ‡’äººç›´è¾¾"><a href="#æ‡’äººç›´è¾¾" class="headerlink" title="æ‡’äººç›´è¾¾"></a>æ‡’äººç›´è¾¾</h1><div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">DisplayManager</span> mDisplayManager;<span class="comment">//å±å¹•ç®¡ç†ç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Display</span>[] displays;<span class="comment">//å±å¹•æ•°ç»„</span></span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> int <span class="variable constant_">OVERLAY_PERMISSION_REQ_CODE</span> = <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    protected <span class="keyword">void</span> <span class="title function_">onCreate</span>(<span class="params">Bundle savedInstanceState</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">onCreate</span>(savedInstanceState);</span><br><span class="line">        <span class="title function_">setContentView</span>(R.<span class="property">layout</span>.<span class="property">activity_main</span>);</span><br><span class="line">        <span class="title function_">requestDrawOverLays</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">initPresentation</span>(<span class="params"></span>) &#123;</span><br><span class="line">        mDisplayManager = (<span class="title class_">DisplayManager</span>) <span class="variable language_">this</span>.<span class="title function_">getSystemService</span>(<span class="title class_">Context</span>.<span class="property">DISPLAY_SERVICE</span>);</span><br><span class="line"></span><br><span class="line">        displays = mDisplayManager.<span class="title function_">getDisplays</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title class_">DifferentDislay</span> mPresentation = <span class="keyword">new</span> <span class="title class_">DifferentDislay</span>(<span class="variable language_">this</span></span><br><span class="line">                , displays[<span class="number">1</span>]);<span class="comment">//displays[1]æ˜¯å‰¯å±  å¦‚æœåªæœ‰ä¸€ä¸ªå±å¹•ä½¿ç”¨displays[0]</span></span><br><span class="line"></span><br><span class="line">        mPresentation.<span class="title function_">getWindow</span>().<span class="title function_">setType</span>(</span><br><span class="line"></span><br><span class="line">                <span class="title class_">WindowManager</span>.<span class="property">LayoutParams</span>.<span class="property">TYPE_SYSTEM_ALERT</span>);</span><br><span class="line"></span><br><span class="line">        mPresentation.<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private <span class="keyword">class</span> <span class="title class_">DifferentDislay</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Presentation</span> &#123;</span><br><span class="line">        public <span class="title class_">DifferentDislay</span>(<span class="title class_">Context</span> outerContext, <span class="title class_">Display</span> display) &#123;</span><br><span class="line">            <span class="variable language_">super</span>(outerContext, display);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public <span class="title class_">DifferentDislay</span>(<span class="title class_">Context</span> outerContext, <span class="title class_">Display</span> display, int theme) &#123;</span><br><span class="line">            <span class="variable language_">super</span>(outerContext, display, theme);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @<span class="title class_">Override</span></span><br><span class="line">        protected <span class="keyword">void</span> <span class="title function_">onCreate</span>(<span class="params">Bundle savedInstanceState</span>) &#123;</span><br><span class="line">            <span class="variable language_">super</span>.<span class="title function_">onCreate</span>(savedInstanceState);</span><br><span class="line">            <span class="title function_">setContentView</span>(R.<span class="property">layout</span>.<span class="property">diffrentdisplay</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @<span class="title class_">TargetApi</span>(<span class="title class_">Build</span>.<span class="property">VERSION_CODES</span>.<span class="property">M</span>)</span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">requestDrawOverLays</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title class_">Settings</span>.<span class="title function_">canDrawOverlays</span>(<span class="title class_">MainActivity</span>.<span class="property">this</span>)) &#123;</span><br><span class="line">            <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(<span class="variable language_">this</span>, <span class="string">&quot;æ‚¨è¿˜æ²¡æœ‰æ‰“å¼€æ‚¬æµ®çª—æƒé™&quot;</span>, <span class="title class_">Toast</span>.<span class="property">LENGTH_SHORT</span>).<span class="title function_">show</span>();</span><br><span class="line">            <span class="comment">//è·³è½¬åˆ°ç›¸åº”è½¯ä»¶çš„è®¾ç½®é¡µé¢</span></span><br><span class="line">            <span class="title class_">Intent</span> intent = <span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="title class_">Settings</span>.<span class="property">ACTION_MANAGE_OVERLAY_PERMISSION</span>, <span class="title class_">Uri</span>.<span class="title function_">parse</span>(<span class="string">&quot;package:&quot;</span> + <span class="title class_">MainActivity</span>.<span class="property">this</span>.<span class="title function_">getPackageName</span>()));</span><br><span class="line">            <span class="title function_">startActivityForResult</span>(intent, <span class="variable constant_">OVERLAY_PERMISSION_REQ_CODE</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æˆæƒæˆåŠŸä¹‹åæ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">            <span class="title function_">initPresentation</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @<span class="title class_">TargetApi</span>(<span class="title class_">Build</span>.<span class="property">VERSION_CODES</span>.<span class="property">M</span>)</span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    protected <span class="keyword">void</span> <span class="title function_">onActivityResult</span>(<span class="params">int requestCode, int resultCode, Intent data</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>.<span class="title function_">onActivityResult</span>(requestCode, resultCode, data);</span><br><span class="line">        <span class="keyword">if</span> (requestCode == <span class="variable constant_">OVERLAY_PERMISSION_REQ_CODE</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Settings</span>.<span class="title function_">canDrawOverlays</span>(<span class="variable language_">this</span>)) &#123;</span><br><span class="line">                <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(<span class="variable language_">this</span>, <span class="string">&quot;æˆæƒå¤±è´¥&quot;</span>, <span class="title class_">Toast</span>.<span class="property">LENGTH_SHORT</span>).<span class="title function_">show</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(<span class="variable language_">this</span>, <span class="string">&quot;æˆæƒæˆåŠŸ&quot;</span>, <span class="title class_">Toast</span>.<span class="property">LENGTH_SHORT</span>).<span class="title function_">show</span>();</span><br><span class="line">                <span class="title function_">initPresentation</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™æ ·ï¼Œä¸€ä¸ªç®€å•çš„åŒå±å¼‚æ˜¾demoå°±å®Œæˆå•¦ï¼Œå…±å‹‰ï¼Œåˆ«å¿˜è®°åŠ æƒé™å“¦ï¼</p>
<h1 id="è¡¥å……ï¼ˆTYPE-APPLICATION-OVERLAYï¼‰"><a href="#è¡¥å……ï¼ˆTYPE-APPLICATION-OVERLAYï¼‰" class="headerlink" title="è¡¥å……ï¼ˆTYPE_APPLICATION_OVERLAYï¼‰"></a>è¡¥å……ï¼ˆTYPE_APPLICATION_OVERLAYï¼‰</h1><p>åæ¥çš„åæ¥ï¼Œæˆ‘æœ‰ä¸€ä¸ªåŒäº‹è¦åšç±»ä¼¼çš„åŠŸèƒ½ï¼Œæˆ‘æƒ³èµ·æ¥æœ‰è®°å½•è¿™éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œå°±å°†è¿™ç¯‡æ–‡ç« åˆ†äº«ç»™å¥¹äº†ï¼Œå¥¹ä½¿ç”¨äº†æˆ‘çš„æºç ä½†æ˜¯è¿˜æ˜¯æŠ¥äº†ç±»ä¼¼çš„æ²¡æœ‰æƒé™çš„é—®é¢˜ï¼Œè¿™è®©æˆ‘ååˆ†çš„ä¸è§£,åé¢ç»è¿‡å¥¹çš„ä¸€ç•ªåŠªåŠ›ï¼Œå‘ç°8.0ä»¥ä¸Šç‰ˆæœ¬çš„å®‰å“æœºéœ€è¦å°†æ‡’äººç›´è¾¾ä»£ç ä¸­çš„</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">mPresentation.getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);</span><br></pre></td></tr></table></figure></div>
<p>æ›¿æ¢ä¸º</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line">mPresentation.getWindow().setType(WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY);</span><br></pre></td></tr></table></figure></div>

<p>æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆå°†ä»£ç æ›´æ”¹ä¸ºå¦‚ä¸‹</p>
<div class="highlight-container" data-rel="Kotlin"><figure class="iseeu highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">26</span>) &#123;</span><br><span class="line">               getWindow().setType(WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               getWindow().setType(WindowManager.LayoutParams.TYPE_SYSTEM_ALERT);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure></div>
<p>ç®—æ˜¯ä¸€ä¸ªç‰ˆæœ¬é€‚é…é—®é¢˜å§</p>
]]></content>
      <categories>
        <category>andorid</category>
      </categories>
      <tags>
        <tag>Presentation</tag>
      </tags>
  </entry>
</search>
